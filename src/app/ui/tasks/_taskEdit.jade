form#modal-task(ng-switch-when='task-edit' rms-task-edit='')
  .task-modal-wrapper-main
    .task-modal-row
      .task-modal-row-title Project:
      a(href="{{config.teamwork + 'projects/' + task.project.id}}" target='_blank').task-modal-row-value {{task.project.name}}
    .task-modal-row
      .task-modal-row-title Todo list:
      a(href="{{config.teamwork + 'tasklists/' + task.todoList.id}}" target='_blank').task-modal-row-value {{task.todoList.name}}

    .task-modal-row(ng-if='!task.$u.title')
      .task-modal-row-title Title:
      a(href="{{config.teamwork + 'tasks/' + task.id}}" target='_blank').task-modal-row-value  {{task.title}}
    .task-modal-row(ng-if='task.$u.title')
      .task-modal-row-title Title:
      input.task-modal-title(type='text' ng-model='edit.title')
      a(href="{{config.teamwork + 'tasks/' + task.id}}" target='_blank')
        img.task-modal-icon-link(src="./images/icons/link.svg")

    .task-modal-row(ng-if='!task.$u.estimate')
      .task-modal-row-title Estimate:
      .task-modal-row-value {{filter.taskPeriod(task, 'estimate')}}
    .task-modal-row(ng-if='task.$u.estimate' widget-duration='' ng-model='edit.estimate')
      .task-modal-row-title Estimate:
      input(type='number').task-modal-estimate-hours
      span.task-modal-estimate-duration h
      input(type='number').task-modal-estimate-minutes
      span.task-modal-estimate-duration m
      img(src="./images/icons/recycling-can.svg" ng-click="edit.estimate = null").task-modal-icon-recycling
      span.splitDiff(ng-if='edit.splitDiff' style='color:yellow') {{filter.periodDiff(edit.splitDiff)}}

    .task-modal-row(ng-if='!task.$u.duedate')
      .task-modal-row-title DueDate:
      .task-modal-row-value {{filter.taskEditDueDate(edit.duedate)}}
    // Note: widget-date cannot be on <input /> since angularjs has own directive input[type=text]
    .task-modal-row(ng-if='task.$u.duedate' widget-date='' ng-model='edit.duedate')
      .task-modal-row-title DueDate:
      input.task-modal-duedate(type='text')
      img(src="./images/icons/recycling-can.svg" ng-click="edit.duedate = null").task-modal-icon-recycling

    .task-modal-row(ng-if='task.$u.estimate')
      .task-modal-row-title Split:
      input(type="checkbox" name="is-split" ng-model='edit.isSplit' ng-disabled='!edit.estimate || !edit.duedate')
      button.btn.auto-split(ng-click='autoSplit()' ng-disabled='!edit.isSplit || edit.duedate == null || edit.duedate < today || edit.estimate == null || edit.responsible == null') AutoSplit

    .task-modal-row(ng-if='!task.$u.responsible')
      .task-modal-row-title Person:
      .task-modal-row-value {{task.responsible.title}}
    .task-modal-row.overflow-visible.fix-person-row(ng-if='task.$u.responsible')
      .task-modal-row-title Person:
      ui-select(ng-model='edit.responsible', theme='selectize', ng-disabled='disabled', title='Choose a person').task-modal-person
        ui-select-match(placeholder='Select a person...') {{$select.selected.name}}
        ui-select-choices(repeat='person in people | filter: {name: $select.search}')
          div(ng-bind-html='person.name | highlight: $select.search')
      img(src="./images/icons/recycling-can.svg" ng-click="edit.responsible = null").task-modal-icon-recycling.icon-after-select

    .task-modal-row.overflow-visible(ng-if='!task.$u.tags')
      .task-modal-row-title Tags:
      .task-modal-row-value.tags
        span.task-tag(ng-repeat='tag in orderedTags' style='background-color: {{tag.color}}') {{tag.name}}
    .task-modal-row.overflow-visible(ng-if='task.$u.tags')
      .task-modal-row-title Tags:
      .task-modal-row-value.tags
        span.task-tag(ng-repeat='tag in orderedTags' style='background-color: {{tag.color}}')
          | {{tag.name}}
          img(src='./images/icons/close.svg' ng-click='tagsRemove(tag)')
        ui-select.task-modal-tag(ng-if='tagsToSelect.length > 0' ng-model='edit.tagsSelected', theme='selectize', ng-disabled='disabled', title='Choose a tag')
          ui-select-match(placeholder='Select tag...') {{$select.selected.name}}
          ui-select-choices(repeat='tag in tagsToSelect | filter: {name: $select.search}')
            table: tr
              td: .point(style='background-color: {{tag.color}}')
              td(ng-bind-html='tag.name | highlight: $select.search')

    .task-modal-row(ng-if='!task.$u.description')
      .task-modal-row-title Description:
      .task-modal-row-value {{edit.description}}
    .task-modal-row(ng-if='task.$u.description')
      .task-modal-row-title Description:
      textarea.task-modal-title(rows='4' ng-model='edit.description')

  .task-modal-wrapper-split(ng-if='edit.splitView')
    table
      thead
        th
        th(ng-repeat='week in edit.splitView') {{week.monday.format('MM/DD/YYYY') + ' (' + week.monday.week() + ')'}}
      tbody
        tr.row-total-time(ng-repeat-start="dow in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']")
          td
          td(ng-if='task.$u.split' ng-repeat='week in edit.splitView' ng-class='{warn:(week.days[$parent.$parent.$index].timeLeftShow < 0)}') {{filter.timeLeft(week.days[$parent.$parent.$index].timeLeftShow) || '&nbsp;'}}
        tr(ng-repeat-end='')
          td {{dow}}
          td(ng-repeat='week in edit.splitView' ng-class='{select:week.days[$parent.$index].select}')
            .task-split-estimate-wrapper(ng-if='!task.$u.split') {{filter.taskPeriod(null, null, week.days[$parent.$parent.$index].plan.val)}}
            .task-split-estimate-wrapper(ng-if='task.$u.split' widget-duration='' ng-model='week.days[$parent.$parent.$index].plan.val')
              input(type='number' tabindex='{{20 + (2 * $parent.$parent.$index) + (20 * $index)}}').task-modal-estimate-hours
              input(type='number' tabindex='{{21 + (2 * $parent.$parent.$index) + (20 * $index)}}').task-modal-estimate-minutes
        tr
          td
          td.table-icon-arrow(ng-click='splitPrevWeek()'): img(src='./images/icons/arrow-left.svg')
          td
          td.table-icon-arrow(ng-click='splitNextWeek()'): img(src='./images/icons/arrow-right.svg')

  .form-btn-row
    .btn-group
      button.btn(type='submit' ng-if='!viewonly' ng-disabled='!changes' ng-click='save($event, false)') Save
      button.btn.plan(ng-disabled='!edit.duedate' ng-if='task.$u.plan && config.canUserSetPlan && !task.plan' ng-click='save($event, true)') {{changes ? 'Save & ' : ''}} Add to plan
      button.btn.plan(ng-disabled='!edit.duedate' ng-if='task.$u.plan && config.canUserSetPlan && task.plan && changes' ng-click='save($event, true)') Save & Keep in plan
      button.btn.plan(ng-if='task.$u.plan && config.canUserSetPlan && task.plan && !changes' ng-click='save($event, false)') {{changes ? 'Save & ' : ''}} Remove from plan
      button.btn.right(ng-click='close()') Close
