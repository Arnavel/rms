!function t(e,o,r){function n(s,a){if(!o[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=o[s]={exports:{}};e[s][0].call(p.exports,function(t){var o=e[s][1][t];return n(o?o:t)},p,p.exports,t,e,o,r)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d=function(t,e){function o(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;a=t("../dscommon/util").assert,l=t("../dscommon/util").validate,p=t("../dscommon/util").serviceOwner,r=t("../dscommon/DSObject"),n=t("./models/Person"),t("../utils/angular-local-storage.js"),e.exports=(c=angular.module("config",["LocalStorageModule"])).name,c.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),c.run(["$rootScope","config",function(t,e){t.config=e}]),i=1,s=1,u=function(t){return(t=/https?:\/\/.*?($|\/)/.exec(t)[0])?("/"!==t.charAt(t.length-1)&&(t+="/"),t):null},c.factory("config",["$http","localStorageService",function(t,e){var o,a,c,f,h,m,y,_,v,g,w,S;if(o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return d(o,t),o.begin("Config"),o.propStr("token",{valid:l.trimString}),o.propStr("teamwork",{init:"http://teamwork.webprofy.ru/",valid:u}),o.propCalc("hasRoles",function(){return this.teamwork.indexOf("://teamwork.webprofy.ru/")>0||this.teamwork.indexOf("://delightsoft.teamworkpm.net/")>0}),o.propCalc("hasTimeReports",function(){return this.teamwork.indexOf("://teamwork.webprofy.ru/")>0||this.teamwork.indexOf("://delightsoft.teamworkpm.net/")>0}),o.propConst("planTag","План"),o.propConst("teamleadRole","Teamlead"),o.propNum("hResizer"),o.propNum("vResizer"),o.propStr("currentUserId"),o.propDoc("currentUser",n),o.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),o.propStr("selectedRole"),o.propNum("selectedCompany",{init:-1}),o.propStr("selectedManager"),o.propNum("selectedLoad"),o.propNum("activeSidebarTab",{init:0}),o.propNum("refreshPeriod"),o.propNum("autosave",{init:0}),o.propNum("view3GroupByPerson",{init:0}),o.propNum("view3HidePeopleWOTasks",{init:0}),o.propStr("view3FilterByPerson",{init:""}),o.propStr("view3FilterByProject",{init:""}),o.propStr("view3FilterByTask",{init:""}),o.propNum("histStart",{init:-1}),o.onAnyPropChange(function(t,o,r,n){"currentUserId"!==o&&"currentUser"!==o&&("teamwork"!==o&&"token"!==o||this.set("histStart",-1),"undefined"!=typeof r?e.set(o,r):e.remove(o))}),o.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},o.end(),o}(r),a=p.add(new o(p,"config")),f=!0,h=!0,g=1,w=0,"string"==typeof(v=e.get("ver"))&&((S=v.split(".")).length=2)&&(g=parseInt(S[0]),w=parseInt(S[1])),h=(f=g===i)&&w===s,h||e.set("ver",i+"."+s),f){y=o.prototype.__props;for(m in y)c=y[m],(h||"teamwork"===m||"token"===m)&&(c.readonly||null===(_=e.get(m))||a.set(m,_))}return a}])},{"../dscommon/DSObject":20,"../dscommon/util":25,"../utils/angular-local-storage.js":32,"./models/Person":5}],2:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d=function(t,e){function o(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(l=angular.module("data/PeopleWithJson",[])).name,c=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,s=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),r=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),n=t("../../dscommon/DSDataServiceBase"),u=t("../models/Person"),l.factory("PeopleWithJson",["DSDataSource","config","$rootScope","$http","$q",function(t,e,o,l,f){var h;return h=function(t){function h(){return h.__super__.constructor.apply(this,arguments)}return d(h,t),h.begin("PeopleWithJson"),h.addPool(),h.propDoc("teamworkPeople",s),h.propObj("cancel",{init:null}),h.propSet("people",u),h.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),h.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},h.prototype.init=function(t){var r,s,d,h;c&&(t instanceof n||p.invalidArg("dsDataService")),(h=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:u,source:!0})))).release(this),d=this.get("peopleSet"),s=function(t){return function(e,o){o||(e.hasOwnProperty("status")?toastr.error("Failed to load <i>data/people.json</i>:<br/><br/> "+e.status+" "+e.statusText,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}):toastr.error("Invalid <i>data/people.json</i>:<br/><br/> "+e.message,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}),t.set("cancel",null)),t._endLoad(!1)}}(this),r=function(t){return function(){var r;t._startLoad()&&(r=t.set("cancel",f.defer()),l.get("data/people.json?t="+(new Date).getTime(),{timeout:r,transformResponse:function(t,e,o){if(200===o)return JSONLint.parse(t)}}).then(function(r){200===r.status?(t.set("cancel",null),i.block(function(){var n,i,s,u,c,p,l,f,m,y,_,v,g,w,S,O,b,D,P,k,T,$,j,R;if(g=o.peopleRoles=r.data.roles,j=o.selectedRole=e.get("selectedRole"))for(u=0,l=g.length;u<l;u++)if(s=g[u],s.role===j){o.selectedRole=s;break}for(i=o.filterManagers=[{name:"All",$ds_key:null}],P=r.data.people,c=0,f=P.length;c<f;c++)if(S=P[c],h.items.hasOwnProperty(O=""+S.id)&&((R=h.items[O]).set("roles",n=new a(t,S.role)),n.release(t),S.hasOwnProperty("projects")))if(Array.isArray(S.projects))try{for(R.projects=D={},k=S.projects,p=0,m=k.length;p<m;p++)b=k[p],D[b]=!0;i.push(R)}catch(A){console.error("Person "+S.name+": Invalid prop 'projects'")}else console.error("Person "+S.name+": Invalid prop 'projects'");if($=o.selectedManager=e.get("selectedManager"))for(_=0,y=i.length;_<y;_++)if(s=i[_],s.$ds_key===$){o.selectedManager=s;break}v={},T=h.items;for(O in T)w=T[O],v[O]=w,w.addRef(t);d.merge(t,v),t._endLoad(!0)})):s(r,0===r.status)},s))}}(this),this._unwatchA=h.watchStatus(this,function(t){return function(e,o){var n;if(o!==(n=t.get("status")))switch(o){case"ready":i.block(r);break;case"update":i.block(r);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},h.end(),h}(r)}])},{"../../dscommon/DSData":14,"../../dscommon/DSDataServiceBase":15,"../../dscommon/DSDigest":17,"../../dscommon/DSSet":23,"../../dscommon/DSTags":24,"../../dscommon/util":25,"../models/Person":5}],3:[function(t,e,o){var r,n,i,s,a,u,c=function(t,e){function o(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(u=angular.module("dscommon/DSDataTeamworkPaged",[])).name,s=t("../../../dscommon/util").assert,a=t("../../../dscommon/util").error,r=t("../../../dscommon/DSData"),n=t("../../../dscommon/DSDigest"),i=500,u.factory("DSDataTeamworkPaged",["DSDataSource","$rootScope","$q",function(t,e,o){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return c(a,e),a.begin("DSDataTeamworkPaged"),a.propDoc("source",t),a.propObj("cancel",{init:null}),a.propEnum("method",["httpGet","httpPost","httpPut"]),a.propStr("request"),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),a.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},a.prototype.load=function(){var t,e,r,a,u;if(s){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(u=this.get("request"))&&u.length>0))throw new Error("load(): Request is not specified")}this._startLoad()&&(e=this.set("cancel",o.defer()),r=function(t){return function(e,o){o||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),t=function(t,e){return""+e+(e.indexOf("?")===-1?"?":"&")+"page="+t+"&pageSize="+i},this.startLoad(),(a=function(o){return function(s){var u;return function(){switch(u=this.get("method")){case"httpGet":return this.get("source").httpGet(t(s,this.get("request")),e);case"httpPost":return this.get("source").httpPost(t(s,this.get("request")),this.params.json,e);case"httpPut":return this.get("source").httpPut(t(s,this.get("request")),this.params.json,e)}}.call(o).then(function(t){var e;if(200===t.status){if(o.set("cancel",null),o.importResponse(t.data,t.status)===i)return void a(s+1);e=n.block(function(){return o.finalizeLoad()}),"object"==typeof e&&null!==e&&"then"in e?e.then(function(){o._endLoad(!0)}):o._endLoad(!0)}else r(t,0===t.status)},r)}}(this))(1))},a.end(),a}(r)}])},{"../../../dscommon/DSData":14,"../../../dscommon/DSDigest":17,"../../../dscommon/util":25}],4:[function(t,e,o){var r,n,i,s,a=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWPeople",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,n=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../models/Person"),s.factory("TWPeople",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,o,n){var i;return i=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,t),o.begin("TWPeople"),o.addPool(),o.propSet("people",r),o.ds_dstr.push(function(){this.__unwatch2()}),o.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},o.prototype.startLoad=function(){return this.peopleMap={}},o.prototype.importResponse=function(t){var e,o,n,i,s,a;for(e=0,a=t.people,o=0,i=a.length;o<i;o++)n=a[o],++e,s=r.pool.find(this,""+n.id,this.peopleMap),s.set("id",+n.id),s.set("name",(n["last-name"]+" "+n["first-name"].charAt(0).toUpperCase()+".").trim()),s.set("firstName",n["first-name"].trim()),s.set("avatar",n["avatar-url"]),s.set("email",n["email-address"]),s.set("companyId",+n["company-id"]),s.set("currentUser",!1);return e},o.prototype.finalizeLoad=function(){this.get("peopleSet").merge(this,this.peopleMap),delete this.peopleMap},o.end(),o}(t)}])},{"../../../dscommon/DSDataSource":16,"../../../dscommon/util":25,"../../models/Person":5,"./DSDataTeamworkPaged":3}],5:[function(t,e,o){var r,n,i,s,a,u=function(t,e){function o(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=t("../../dscommon/DSDocument"),n=t("../../dscommon/DSTags"),e.exports=i=function(t){function e(){return o.apply(this,arguments)}var o;return u(e,t),e.begin("Person"),n.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propBool("missing"),e.propDuration("contractTime"),o=function(t,e){r.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(r)},{"../../dscommon/DSDocument":18,"../../dscommon/DSTags":24,"../../dscommon/util":25}],6:[function(t,e,o){var r,n,i,s,a=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,r=t("../../dscommon/DSObject"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("status"),e.propObj("people"),e.end(),e}(r)},{"../../dscommon/DSObject":20,"../../dscommon/util":25}],7:[function(t,e,o){var r,n,i,s,a=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,r=t("../../dscommon/DSDocument"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Tag"),e.addPool(),e.propNum("id",{init:0}),e.propStr("name"),e.propStr("color"),e.propStr("twColor"),e.propStr("border"),e.propNum("priority",{init:1e3}),e.end(),e}(r)},{"../../dscommon/DSDocument":18,"../../dscommon/util":25}],8:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d,f,h,m,y=function(t,e){function o(){this.constructor=t}for(var r in e)_.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},_={}.hasOwnProperty;f=t("../../dscommon/util").assert,h=t("../../dscommon/util").error,m=t("../ui/time"),n=t("../../dscommon/DSDocument"),a=t("./Project"),s=t("./Person"),p=t("./TaskList"),d=t("./TaskTimeTracking"),u=t("./Tag"),i=t("../../dscommon/DSTags"),r=t("./types/Comments"),l=t("./types/TaskSplit"),e.exports=c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var o,n,c,f,h;return y(e,t),e.begin("Task"),r.addPropType(e),l.addPropType(e),i.addPropType(e),e.defaultTag=o={name:"[default]",priority:1e3},e.addPool(!0),h=function(t,r){var n,i,s,a,u,c;if(t.set("plan",!(!r||!r.get(e.planTag))),null!==r){u=1e6,c=null,n=r.map;for(s in n)i=n[s],(a=i.get("priority"))<u&&(c=i,u=a);t.__setCalcPriority(c.priority),t.__setCalcStyle(c)}else t.__setCalcPriority(o.priority),t.__setCalcStyle(o)},c={__onChange:function(t,o,r,n){var s,a,c;switch(o){case"plan":c=t.get("tags"),c?(c=c.clone(this),r?c.get(e.planTag)||(c.set(e.planTag,a=u.pool.find(this,e.planTag)),a.release(this),t.set("tags",c)):c.get(e.planTag)&&(c.set(e.planTag,!1),t.set("tags",c.empty()?null:c)),c.release(this)):r&&((s={})[e.planTag]=a=u.pool.find(this,e.planTag),c=new i(this,s),t.set("tags",c),c.release(this));break;case"tags":h(t,r)}}},f={__onChange:function(t,e,o,r){"tags"===e&&h(t,o)}},e.ds_ctor.push(function(){this.__proto__.constructor.ds_editable?this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(c):this.$ds_evt=[c]:this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(f):this.$ds_evt=[f]}),e.str=function(t){return null===t?"":t.get("title")},e.propNum("id",{init:0}),e.propStr("title"),e.propDuration("estimate").str=function(t){var e,o,r;return e=Math.floor(t.asHours()),o=t.minutes(),r=e?e+"h":"",o&&(r+=" "+o+"m"),r||(r="0"),r},e.propMoment("duedate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propMoment("startDate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propDoc("creator",s),e.propDoc("responsible",s),e.propDoc("taskList",p),e.propDoc("project",a),e.propTaskRelativeSplit("split"),e.propStr("description",{str:function(t){return t&&0!==t.length?t.length<=20?t:t.substr(0,20)+"...":""}}),e.propComments("comments"),e.propDoc("timeTracking",d,{write:null}),e.propStr("firstTimeEntryId",{write:null}),e.propBool("completed"),e.propBool("isReady",{write:null}),e.propBool("plan",{write:null,read:null}),e.propDSTags("tags"),e.propNum("priority",{init:o.priority,calc:!0}),e.propObj("style",{init:function(){return o},calc:!0}),e.propBool("clipboard",{init:!1,common:!0}),e.prototype.isOverdue=function(){var t;return null!==(t=this.get("duedate"))&&t<m.today},e.prototype.timeWithinEstimate=function(){var t;return null===(t=this.get("estimate"))?0:Math.min(100,Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))},e.prototype.timeAboveEstimate=function(){var t,e;return null===(t=this.get("estimate"))?0:(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))<=100?0:e>200?100:e-100},e.prototype.timeReported=function(){var t,e;return null===(t=this.get("estimate"))?"":(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))>200?e+" %":""},e.prototype.grade=function(){var t;return null===(t=this.get("estimate"))?"":t.asMinutes()<60?"easy":t.asMinutes()>=60&&t.asMinutes()<240?"medium":t.asMinutes()>=240&&t.asMinutes()<480?"hard":t.asMinutes()>=480?"complex":void 0},e.prototype.setVisible=function(t){var e,o;t?1===(this.__visCount=(this.__visCount||0)+1)&&null!=(e=this.get("timeTracking"))&&e.setVisible(!0):0===--this.__visCount&&null!=(o=this.get("timeTracking"))&&o.setVisible(!1)},e.end(),n=e.Editable.prototype.init,e.Editable.prototype.init=function(){n.apply(this,arguments),h(this,this.get("tags"))},e}(n)},{"../../dscommon/DSDocument":18,"../../dscommon/DSTags":24,"../../dscommon/util":25,"../ui/time":13,"./Person":5,"./Project":6,"./Tag":7,"./TaskList":9,"./TaskTimeTracking":10,"./types/Comments":11,"./types/TaskSplit":12}],9:[function(t,e,o){var r,n,i,s,a,u=function(t,e){function o(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=t("../../dscommon/DSObject"),n=t("./Project"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskList"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propDoc("project",n),e.propNum("position"),e.end(),e}(r)},{"../../dscommon/DSObject":20,"../../dscommon/util":25,"./Project":6}],10:[function(t,e,o){var r,n,i=function(t,e){function o(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("../../dscommon/DSObject"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("TaskTimeTracking"),e.addPool(!0),e.propNum("taskId",{init:0}),e.propBool("isReady"),e.propNum("totalMin",{init:0}),e.propNum("priorTodayMin",{init:0}),e.propObj("timeEntries",{init:{}}),e.end(),e}(r)},{"../../dscommon/DSObject":20}],11:[function(t,e,o){var r,n,i,s;i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,n=t("../../../dscommon/DSDocument"),e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,o;return t.addPropType=function(e){e.propComments=function(o,r){var n;return i&&r&&"function"!=typeof r&&s.invalidArg("valid"),r=(n=r)?function(t){return(null===t||Array.isArray(t))&&n(t)?t:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:o,type:"comments",valid:r,read:function(e){return null!==e?new t(e):null},str:function(t){var e;return 0===t.list.length?"":(e=t.list[0]).length<=20?e:e.substr(0,20)+"..."},equal:function(t,e){var o,r,n,i,s;if(null===t||null===e)return t===e;if(t.list.length!==e.list.length)return!1;for(s=t.list,o=r=0,n=s.length;r<n;o=++r)if(i=s[o],i!==e.list[o])return!1;return!0},init:null})}},o=moment.duration(0),e=function(e){var o,r,n,a;if(i)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(o=0,r=e.length;o<r;o++)a=e[o],"string"!=typeof a&&s.invalidArg("persisted");1===arguments.length&&"object"==typeof(n=arguments[0])&&n.__proto__===t.prototype?this.list=n.list.slice():this.list=e||[]},t.prototype.clone=function(){return new t(this)},t.prototype.add=function(t){this.list.push(t)},t.prototype.unshift=function(t){this.list.unshift(t)},t.prototype.shift=function(){return this.list.shift()},t.prototype.valueOf=function(){return this.list},t.prototype.clear=function(){this.list=[]},t}()},{"../../../dscommon/DSDocument":18,"../../../dscommon/util":25}],12:[function(t,e,o){var r,n,i,s;i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,r=t("../../../dscommon/DSDocument"),e.exports=n=function(){function t(){return e.apply(this,arguments)}var e,o;return t.addPropType=function(e){e.propTaskRelativeSplit=function(o,r){var n;return i&&r&&"function"!=typeof r&&s.invalidArg("valid"),r=(n=r)?function(e){return(null===e||"object"==typeof e&&e instanceof t)&&n(e)?e:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:o,type:"taskRelativeSplit",valid:r,read:function(e){return null!==e?new t(e):null},str:function(t){return t?"split":""},equal:function(t,e){var o,r,n,i,s,a;if(null===t||null===e)return t===e;if((n=null!=t?t.list:void 0).length!==(s=null!=e?e.list:void 0).length)return!1;for(o=r=0,i=n.length;r<i;o=r+=2)if(a=n[o],a!==s[o]||n[o+1].valueOf()!==s[o+1].valueOf())return!1;return!0},init:null})}},o=moment.duration(0),e=function(e){var o,r,n,a,u,c,p,l,d;if(i)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(e.length%2!==0&&s.invalidArg("persisted"),n=0,u=e.length;n<u;n++)d=e[n],"number"!=typeof d&&s.invalidArg("persisted");if(1===arguments.length&&"object"==typeof(l=arguments[0])&&l.__proto__===t.prototype)this.list=l.list.slice();else if(this.list=p=[],Array.isArray(e))for(r=a=0,c=e.length;a<c;r=a+=2)o=e[r],p.push(moment.duration(o,"day").valueOf()),p.push(moment.duration(e[r+1],"minute"))},t.prototype.clone=function(){return new t(this)},t.prototype.set=function(t,e,o){var r,n,a,u,c,p,l;for(i&&(moment.isMoment(t)||s.invalidArg("duedate"),moment.isMoment(e)||s.invalidArg("date"),null===o||moment.isDuration(o)||s.invalidArg("estimate")),n=e.diff(t),l=p=this.list,a=u=0,c=l.length;u<c;a=u+=2){if(r=l[a],r===n){if(null!==o&&0!==o.valueOf()){if(p[a+1].valueOf()===o.valueOf())return;p[a+1]=o}else p.splice(a,2);return void delete this.value}if(n<r)return 0!==(null!=o?o.valueOf():void 0)&&p.splice(a,0,n,o),void delete this.value}return 0!==(null!=o?o.valueOf():void 0)&&(delete this.value,p.push(n),p.push(o)),this},t.prototype.get=function(t,e){var o,r,n,a,u,c,p;for(i&&(moment.isMoment(t)||s.invalidArg("duedate"),moment.isMoment(e)||s.invalidArg("date")),r=e.diff(t),p=c=this.list,n=a=0,u=p.length;a<u;n=a+=2)if(o=p[n],o===r)return c[n+1];return null},t.prototype.day=function(t,e){var o;return i&&(moment.isMoment(e)||s.invalidArg("date")),Object.defineProperty(o={},"val",{get:function(o){return function(){return o.get(t(),e)}}(this),set:function(o){return function(r){return o.set(t(),e,r)}}(this)}),o},t.prototype.valueOf=function(){var t,e,o,r,n,i,s,a,u;if(u=this.value)return u;for(this.value=s=[],i=n=this.list,e=o=0,r=i.length;o<r;e=o+=2)a=i[e],t=n[e+1],s.push(moment.duration(a).asDays()),s.push(t.asMinutes());return s},t.prototype.shift=function(t,e){var o,r,n,a,u,c,p;if(i)switch(arguments.length){case 1:"number"!=typeof t&&s.invalidArg("diff");break;case 2:moment.isMoment(t)||s.invalidArg("newDuedate"),moment.isMoment(e)||s.invalidArg("oldDuedate");break;default:throw new Error("Invalid arguments")}if(delete this.value,o="number"==typeof t?t:t.diff(e),0!==o)for(c=u=this.list,r=n=0,a=c.length;n<a;r=n+=2)p=c[r],u[r]-=o},t.prototype.firstDate=function(t){var e;return i&&(moment.isMoment(t)||s.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[0]):null},t.prototype.lastDate=function(t){var e;return i&&(moment.isMoment(t)||s.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[e.length-2]):null},t.prototype.clear=function(){delete this.value,this.list=[]},t.prototype.fixEstimate=function(t){var e,o,r,n,i,s;if(t>0)this.list[this.list.length-1].add(t);else if(t<0)for(i=n=this.list.slice(1),e=o=0,r=i.length;o<r;e=o+=2)if(s=i[e],(t+=s.valueOf())>0){this.list[e+1]=moment.duration(t),this.list=this.list.slice(e);break}},Object.defineProperty(t.prototype,"total",{get:function(){var t,e,r,n,i,s;if(0===(r=this.list).length)return o;if(1===r.length)return r[1];for(i=moment.duration(r[1]),n=r.slice(3),t=0,e=n.length;t<e;t+=2)s=n[t],i.add(s);return i}}),t}()},{"../../../dscommon/DSDocument":18,"../../../dscommon/util":25}],13:[function(t,e,o){var r,n;e.exports=r={today:moment().startOf("day"),historyLimit:moment().startOf("week").subtract(2,"weeks")},(n=function(){setTimeout(function(){r.today=moment().startOf("day"),n()},moment().startOf("day").add(1,"day").add(20,"seconds").valueOf()-(new Date).getTime())})()},{}],14:[function(t,e,o){var r,n,i,s,a,u,c=function(t,e){function o(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,u=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,n=t("./DSObject"),e.exports=r=function(t){function e(){return o.apply(this,arguments)}var o;return c(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var o,r,n,i;for(n=this.__proto__.__sets,o=0,r=n.length;o<r;o++)i=n[o],this["_"+i].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void u.remove(this.release(u)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},o=function(t,o,r){if(n.call(this,t,o),i){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof r&&s.invalidArg("params")}this.set("params",r),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&u.add(this.addRef(u))},e.prototype.clear=function(){var t,e,o,r;for(o=this.__proto__.__sets,t=0,e=o.length;t<e;t++)r=o[t],this["_"+r].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;n.end.call(this),this.prototype.__sets=function(){var o,r;o=this.prototype.__props,r=[];for(t in o)e=o[t],"set"===e.type&&r.push(t);return r}.call(this)},e}(n)},{"./DSObject":20,"./util":25}],15:[function(t,e,o){var r,n,i,s,a,u=function(t,e){function o(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,n=t("./DSObject"),i=t("./DSPool"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){s&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,o){var r,i,u,c;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),"object"==typeof o&&null!==o||a.invalidArg("sources");for(r in o){u=o[r],"object"==typeof u&&null!==u||a.invalidArg("sources");for(i in u)switch(c=u[i],i){case"name":break;case"type":!c instanceof n&&a.invalidArg("sources");break;case"set":!c instanceof n&&a.invalidArg("sources");break;case"params":"object"==typeof c&&null!==c||a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(n)},{"./DSObject":20,"./DSPool":22,"./util":25}],16:[function(t,e,o){var r,n,i,s,a,u,c,p,l=function(t,e){function o(){this.constructor=t}for(var r in e)d.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataSource",[])).name,p=t("./util").serviceOwner,u=t("./util").modeReleaseDataOnReload,i=t("./util").assert,a=t("./util").error,s=t("../utils/base64"),n=t("./DSObject"),r=t("./DSDigest"),c.factory("DSDataSource",["config","$rootScope","$q","$http",function(t,e,o,u){var c;return c=function(o){function c(){return p.apply(this,arguments)}var p;return l(c,o),c.begin("DSDataSource"),c.addDataSource(),c.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,o,n){switch(o){case"ready":r.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},p=function(o,r){n.call(this,o,r),this.cancelDefers=[],this._lastRefresh=null,this._refreshTimer=null,e.$watch(function(){return t.refreshPeriod},function(t){return function(e){t._setNextRefresh()}}(this))},c.prototype.setConnection=function(t,e){var o,r,n,u;if(i&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(u=this.cancelDefers,r=0,n=u.length;r<n;r++)o=u[r],o.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+s.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},c.prototype._setNextRefresh=function(){var e,o,r;null!==this._refreshTimer&&clearTimeout(this._refreshTimer),null!==t.refreshPeriod&&(r=null===this._lastRefresh?0:(o=this._lastRefresh.add(t.refreshPeriod,"minutes"),e=moment(),o>=e?o-e:0),this._refreshTimer=setTimeout(function(t){return function(){t.refresh()}}(this),r))},c.prototype.refresh=function(){this._lastRefresh=moment(),this._setNextRefresh(),"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},c.prototype.httpGet=function(t,e){var o,r;return this.cancelDefers.push(e),r=function(t){return function(o){return _.remove(t.cancelDefers,e),o}}(this),o={timeout:e.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),u.get(""+this.url+t,o).then(r,r)},c.prototype.httpPost=function(t,e,o){var r,n;return this.cancelDefers.push(o),n=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),r={timeout:o.promise},this.authHeader&&(r.headers={Authorization:this.authHeader}),u.post(""+this.url+t,e,r).then(n,n)},c.prototype.httpPut=function(t,e,o){var r,n;return this.cancelDefers.push(o),n=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),r={timeout:o.promise},this.authHeader&&(r.headers={Authorization:this.authHeader}),u.put(""+this.url+t,e,r).then(n,n)},c.end(),c}(n)}])},{"../utils/base64":34,"./DSDigest":17,"./DSObject":20,"./util":25}],17:[function(t,e,o){var r,n,i;n=t("./util").assert,i=t("./util").error,e.exports=r=function(){function t(){}var e,o,r,s;return o=0,e=0,r={},s=function(){var t,o,n,i,a,u,c;i=!0;for(a in r){i=!1;break}if(!i){e++,c=r,r={};for(t in c){o=c[t];for(u in o)(n=o[u])(u)}e--,s()}},t.block=function(t){e++;try{return t()}finally{0===--e&&s()}},t.render=function(t,o,s){var a;n&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof o&&o.length>0||i.invalidArg("key"),"function"!=typeof s&&i.invalidArg("func")),0===e?s(o):(a=r.hasOwnProperty(t)?r[t]:r[t]={},a[o]=s)},t.forget=function(t,o){var s;n&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof o&&o.length>0||i.invalidArg("key")),0!==e&&r.hasOwnProperty(t)&&(s=r[t],delete s[o])},t}()},{"./util":25}],18:[function(t,e,o){var r,n,i,s,a,u,c,p=function(t,e){function o(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l={}.hasOwnProperty;a=t("./util").assert,u=t("./util").error,c=t("./util").traceRefs,i=t("./DSObjectBase"),n=t("./DSObject"),s=t("./DSSet"),e.exports=r=function(t){function e(t,o){if(e.__super__.constructor.call(this,t,o),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")}return p(e,t),e.begin("DSDocument"),
e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;n.end.call(this),e=this,this.Editable=t=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}var r,l,d,f,h,m,y;p(o,t),o.begin(e.docType+".Editable"),delete o.prototype.$ds_docType,o.ds_editable=!0,r=null,h=o.__super__.__init;for(l in h)y=h[l],e.prototype.__props[l.substr(1)].calc&&((r||(r={}))[l]=y);o.prototype.__init=r,o.ds_dstr.push(function(){var t,e,o,r;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(o in t)e=t[o],(r=e.s)instanceof i&&r.release(this),(y=e.v)instanceof i&&y.release(this)}),o.prototype.init=function(t,o,r){var n,p,l,d,f,h,m,y,v,g;if(a&&(null!==t&&t.__proto__.constructor===e||u.invalidArg("serverDoc"),null!==o&&o instanceof s||u.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof r&&u.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=o,this.__change=r){m=!1;for(v in r)y=r[v],this.__props[v].equal(t.get(v),y.v)?delete r[v]:m=!0;if(m){if(c){h=[];for(v in r)n=r[v],n.v instanceof i&&h.push(n.v),n.s instanceof i&&h.push(n.s);for(p=0,f=h.length;p<f;p++)d=h[p],g=d.$ds_referries,0===g.length?console.error(i.desc(d)+": Empty $ds_referries"):(l=g.lastIndexOf(owner))<0?(console.error(i.desc(this)+": Referry not found: "+i.desc(owner)),totalReleaseVerb):(totalReleaseVerb&&(console.info(++util.serviceOwner.msgCount+": transfer: "+i.desc(d)+", refs: "+this.$ds_ref+", from: "+i.desc(owner)+", to: "+i.desc(this)),util.serviceOwner.msgCount===window.totalBreak),g[l]=this)}this.addRef(this),o.add(this,this)}else delete this.__change}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},o.prototype.__onChange=function(t,e,o,r){var n,s,a,u,c,p,l,d,f,h,m,y;if((d=t.__props[e]).common){if(this.$ds_evt)for(f=this.$ds_evt,a=f.length-1;a>=0;a+=-1)l=f[a],l.__onChange.call(l,this,e,o,r)}else if((n=this.__change)&&n.hasOwnProperty(e)){if(d.equal(y=(d=n[e]).v,o)){for((m=d.s)instanceof i&&m.release(this),y instanceof i&&y.release(this),delete n[e],s=!0,u=0,p=n.length;u<p;u++)if(e=n[u],"__error"!==e&&"__refreshView"!==e){s=!1;break}s&&(delete this.__change,this.$ds_chg.remove(this))}}else if(this.$ds_evt)for(h=this.$ds_evt,c=h.length-1;c>=0;c+=-1)l=h[c],l.__onChange.call(l,this,e,o,r)},o.prototype._clearChanges=function(){var t,e,o,r,n,s,a;if(t=this.__change){for(n in t){if(r=t[n],this.$ds_evt)for(s=this.$ds_evt,e=s.length-1;e>=0;e+=-1)o=s[e],o.__onChange.call(o,this,n,this.$ds_doc[n],r.v);(a=r.s)instanceof i&&a.release(this),(y=r.v)instanceof i&&y.release(this)}delete this.__change,this.$ds_chg.remove(this)}},f=o.prototype.__props=e.prototype.__props,o.prototype.get=function(t){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]},o.prototype.set=function(t,e){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]=e},m=e.prototype.__props;for(l in m)d=m[l],d.calc||!function(t,e,r){var n;return d.common?Object.defineProperty(o.prototype,t,{get:function(){return this.$ds_doc[t]},set:function(e){var o;(o=this.$ds_doc[t])!==e&&(this.$ds_doc[t]=e,this.$ds_chg.$ds_hist.add(this,t,e,o))}}):Object.defineProperty(o.prototype,t,{get:n=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(o){var s,c,p,d,f,h,m,_,v,g,w;if(a&&"undefined"==typeof(o=e(y=o))&&u.invalidValue(this,t,y),!r(m=n.call(this),o)){if(o instanceof i&&o.addRef(this),s=this.__change)if(r(w=this.$ds_doc[t],o)){this.$ds_chg.$ds_hist.add(this,t,o,(c=s[t]).v),(y=c.v)instanceof i&&y.release(this),(g=c.s)instanceof i&&g.release(this),delete s[t],p=!0;for(l in s)if("__error"!==l&&"__refreshView"!==l){p=!1;break}if(p){if(this.$ds_evt)for(_=this.$ds_evt,d=_.length-1;d>=0;d+=-1)h=_[d],h.__onChange.call(h,this,t,o,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(c=s[t])?(this.$ds_chg.$ds_hist.add(this,t,o,c.v),(y=c.v)instanceof i&&y.release(this),c.v=o):(w instanceof i&&w.addRef(this),s[t]={v:o,s:w},this.$ds_chg.$ds_hist.add(this,t,o,m));else s=this.__change={},m instanceof i&&m.addRef(this),s[t]={v:o,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,o,m);if(this.$ds_evt)for(v=this.$ds_evt,f=v.length-1;f>=0;f+=-1)h=v[f],h.__onChange.call(h,this,t,o,m)}}})}(d.name,d.valid,d.equal);return n.end.call(o),o}(e)},e}(n)},{"./DSObject":20,"./DSObjectBase":21,"./DSSet":23,"./util":25}],19:[function(t,e,o){var r,n,i,s,a,u,c,p=function(t,e){function o(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l={}.hasOwnProperty;c=t("./util"),i=t("./util").assert,u=t("./util").traceRefs,a=t("./util").totalReleaseVerb,s=t("./util").error,n=t("./DSObjectBase"),e.exports=r=function(t){function e(){return o.apply(this,arguments)}var o;return p(e,t),e.begin("DSList"),o=function(t,e,o){n.call(this,t,e),i&&!o instanceof n&&s.notDSObjectClass(o),this.type=o,this.items=[]},e.ds_dstr.push(function(){var t,e,o,r;for(o=this.items,t=0,e=o.length;t<e;t++)r=o[t],r.release(this)}),e.prototype.merge=function(t,e){var o,r,p,l,d,f,h,m,y,v;for(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),_.isArray(e)||s.invalidArg("newList")),l=this.items,v=this.type,d=0,h=l.length;d<h;d++)p=l[d],p.release(this);for(l.length=0,o=f=0,m=e.length;f<m;o=++f)p=e[o],!p instanceof v&&s.invalidListValue(this,o,p),u&&(y=p.$ds_referries,0===y.length?console.error(n.desc(DSDitem)+": Empty $ds_referries"):(r=y.lastIndexOf(t))<0?console.error(n.desc(this)+": Referry not found: "+n.desc(t)):(a&&(console.info(++c.serviceOwner.msgCount+": transfer: "+n.desc(p)+", refs: "+this.$ds_ref+", from: "+n.desc(t)+", to: "+n.desc(this)),c.serviceOwner.msgCount===window.totalBreak),y[r]=this)),l.push(p);return l},e.end(),e}(n)},{"./DSObjectBase":21,"./util":25}],20:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d=function(t,e){function o(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("./util").assert,p=t("./util").serviceOwner,l=t("./util").totalRelease,p=t("./util").serviceOwner,c=t("./util").error,i=t("./DSObjectBase"),a=t("./DSSet"),r=t("./DSList"),s=t("./DSPool"),e.exports=n=function(t){function e(){return o.apply(this,arguments)}var o;return d(e,t),e.desc=i.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof r||t instanceof s?l?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:l?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===p?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},o=function(t,e){if(i.call(this,t,e),u&&this.__proto__.constructor===i)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){l?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new s(p,e.docType+".pool",e,t),p.clearPool(function(){e.__pool.release(p),delete e.__pool})),e.__pool}}(this)}):this.pool=new s(p,this.docType+".pool",this,t)},e.propPool=function(t,e,o){var r,n;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),r="_"+t,this.ds_dstr.push(function(){this[r].release(this),delete this[r]}),(n=this.prop({name:t,type:"pool",init:function(){return new s(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,o)},readonly:!0})).itemType=e,n},e.propSet=function(t,e){var o,r;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this)}),(r=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[o].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[o].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[o]}}),r},e.propList=function(t,e){var o,n;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this)}),(n=this.prop({name:t,type:"list",init:function(){return new r(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[o].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[o]}}),n},e}(i)},{"./DSList":19,"./DSObjectBase":21,"./DSPool":22,"./DSSet":23,"./util":25}],21:[function(t,e,o){var r,n,i,s,a,u,c,p,l;l=t("./util"),n=t("./util").assert,c=t("./util").traceData,s=t("./util").serviceOwner,p=t("./util").traceRefs,a=t("./util").totalRelease,u=t("./util").totalReleaseVerb,i=t("./util").error,e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,o,r,s,d,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&i.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=o=null,(window.totalReleaseReset=function(){o=0,window.totalPool=h={},l.serviceOwner.start(),l.serviceOwner.msgCount=0})(),window.totalRelease=function(){return l.serviceOwner.stop(),h}),e=function(e,r){var s,c,d;if(n){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBаse directly");"object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry"),"string"!=typeof r&&i.invalidArg("key")}if(this.$ds_key=r,this.$ds_ref=1,a&&(h[this.$ds_globalId=++o]=this,u&&(console.info(++l.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),l.serviceOwner.msgCount===window.totalBreak)),p&&(this.$ds_referries=[e]),s=this.__proto__.__init)for(c in s)d=s[c],this[c]="function"==typeof d?d.call(this):d;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(n&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),0===this.$ds_ref)throw new Error("addRef() on already fully released object");return p&&this.$ds_referries.push(e),this.$ds_ref++,u&&(console.info(++l.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),l.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var o,r;if(n&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),u&&(console.info(++l.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),l.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(p&&((o=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(o,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((r=this.$ds_pool).watchOn&&(n&&(_.find(this.$ds_evt,function(t){return function(t){return t===r}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,r)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+"@"+this.$ds_key+("object"==typeof this.$ds_pool?" <- "+this.$ds_pool:"")},t.prototype.toJSON=function(){return this.__proto__.$ds_docType+"@"+this.$ds_key},t.prototype.writeMap=function(){var t,e,o,r;r={},o=this.__proto__.__props;for(e in o)t=o[e],t.write&&(r[e]=t.write(this["_"+e]));return r},t.prototype.readMap=function(e){var o,r,n,i,s;n=this.__proto__.__props;for(r in e)s=e[r],n.hasOwnProperty(r)&&(o=n[r]).read?(this[r]=i=o.read.call(this,s),i instanceof t&&i.release(this)):console.error("Unexpected property "+r)},t.begin=function(t){var e;n&&"string"!=typeof t&&i.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,o,r;for(o=0,r=t.length;o<r;o++)e=t[o],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,o;for(o=e.length-1;o>=0;o+=-1)t=e[o],t.call(this)})},t.prop=function(t){var e,o,r,s,a,u,c,p,l,d;if(n){if("object"!=typeof t&&i.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if("undefined"!=typeof t.calc&&"boolean"!=typeof t.calc)throw new Error("Invalid value of opts.calc");if("undefined"!=typeof t.common&&"boolean"!=typeof t.common)throw new Error("Invalid value of opts.common");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.calc&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(r=t.init)?r():r))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&t.write&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&t.read&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("calc")&&t.calc)throw new Error("Ambiguous opts.readonly and opts.calc");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.readonly and opts.common");if(t.hasOwnProperty("calc")&&t.calc&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.calc and opts.common")}if(this.prototype.hasOwnProperty("__init")?n&&this.prototype.__props.hasOwnProperty(t.name)&&i.duplicatedProperty(this,t.name):(this.prototype.__init=(p=this.__super__.__init)?_.clone(p):{},c=this.prototype.__props=(l=this.__super__.__props)?_.clone(l):{},this.prototype.get=function(t){return n&&(c.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return n&&(c.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e}),u=this.prototype.__props[t.name]={name:t.name,type:t.type,write:t.write||(t.hasOwnProperty("write")&&!t.write||t.calc||t.common?null:function(t){return null===t?null:t.valueOf()}),read:t.read||(t.hasOwnProperty("read")&&!t.read||t.calc||t.common?null:function(t){return t}),equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){return null===t?"":t.toString()},readonly:t.readonly||!1,calc:t.calc||!1,common:t.common||!1},t.hasOwnProperty("init"))d=u.valid=t.valid,u.init=this.prototype.__init[s="_"+(a=t.name)]=t.init,t.calc&&(t.readonly===!0,this.prototype["__setCalc"+(a.substr(0,1).toUpperCase()+a.substr(1))]=function(t){var o,r,n,u,c;if("undefined"==typeof(t=d(c=t))&&i.invalidValue(this,a,c),!e(u=this[s],t)&&(this[s]=t,o=this.$ds_evt))for(r=o.length-1;r>=0;r+=-1)n=o[r],n.__onChange.call(n,this,a,t,u)}),Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[s]},set:t.set||(t.readonly?function(t){i.propIsReadOnly(this,a)}:function(t){var o,r,n,u,c;if("undefined"==typeof(t=d(c=t))&&i.invalidValue(this,a,c),!e(u=this[s],t)&&(this[s]=t,o=this.$ds_evt))for(r=o.length-1;r>=0;r+=-1)n=o[r],n.__onChange.call(n,this,a,t,u)})});else if(t.hasOwnProperty("value"))u.value=t.value,u.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");u.func=o=t.func,u.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return o.call(this)},set:t.set||function(t){i.propIsReadOnly(this,a)}})}return u},t.propSimple=function(t,e,o){var r,s;return n&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&i.invalidArg("type"),"string"!=typeof e&&i.invalidArg("name")),s=(r=s)?function(e){return null!==e&&typeof e!==t||void 0===(e=r(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop(_.assign({name:e,type:t,init:"undefined"==typeof init||null===init?null:"function"==typeof init||"object"!==t?init:function(){return _.clone(init)},valid:s,write:o&&(o.calc||o.common)?null:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()}},o))},t.propNum=function(t,e){this.propSimple("number",t,e)},t.propBool=function(t,e){return this.propSimple("boolean",t,e)},t.propStr=function(t,e){return this.propSimple("string",t,e)},t.propObj=function(t,e){return this.propSimple("object",t,e)},t.propDoc=function(e,o,r){var s,a,u;return n&&(u&&"function"!=typeof u&&i.invalidArg("valid"),"function"!=typeof o&&i.invalidArg("type"),!o instanceof t&&i.notDSObjectClass(o)),u=(a=u)?function(t){return(null===t||t instanceof o)&&void 0!==(t=a(t))?t:void 0}:function(t){return null===t||t instanceof o?t:void 0},s="_"+e,this.ds_dstr.push(function(){this[s]&&this[s].release(this)}),this.prop(_.assign({name:e,type:o,init:null,valid:u,write:r&&(r.calc||r.common)?null:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof o.str?o.str:function(t){return null===t?"":t.$ds_key},set:function(t){var o,r,n,a,c;if("undefined"==typeof(t=u(c=t))&&i.invalidValue(this,e,c),(a=this[s])!==t){if(this[s]=t,t&&t.addRef(this),o=this.$ds_evt)for(r=o.length-1;r>=0;r+=-1)n=o[r],n.__onChange.call(n,this,e,t,a);a&&a.release(this)}}},r))},t.propCalc=function(t,e,o){return n&&(e&&"function"==typeof e||i.invalidArg("func")),this.prop(_.assign({name:t,type:"calc",func:e},o))},t.propConst=function(t,e,o){return n&&"undefined"==typeof e&&i.invalidArg("value"),this.prop(_.assign({name:t,type:"const",value:e},o))},t.propEnum=function(t,e,o){var r,s,a,u,c,p;if(n)for(_.isArray(e)&&0!==e.length||i.invalidArg("values"),r=0,s=e.length;r<s;r++)c=e[r];return p=(u=p)?function(t){return(null===t||e.indexOf(t)>=0)&&u(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},a="_"+t,this.prop(_.assign({name:t,type:"enum",init:e[0],valid:p,set:function(e){var o,r,n,s,u;if("undefined"==typeof(e=p(u=e))&&i.invalidValue(this,t,u),(n=this[a])!==e&&(this[a]=e,this.$ds_evt))for(s=this.$ds_evt,o=s.length-1;o>=0;o+=-1)r=s[o],r.__onChange.call(r,this,t,e,n)}},o))},t.propMoment=function(t,e,o){var r;return n&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(r=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&r(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop(_.assign({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null},o))},t.propDuration=function(t,e,o){var r;return n&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(r=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&r(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop(_.assign({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null},o))},t.onAnyPropChange=function(t){n&&"function"!=typeof t&&i.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],d=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,o,r,s,a;for(n&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||i.invalidArg("sources")),r=-1,e=0,o=t.length;e<o;e++)a=t[e],a&&r<(s=d.indexOf(a.get("status")))&&(r=s);return r===-1?"nodata":d[r]},c&&(s=0,r=0),t.addDataSource=function(e){var o,a;if(n){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&i.invalidArg("onStatusChange")}this.ds_dataSource=!0,c&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++s,console.info(++r+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),r===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++r+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),r===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},o=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(o){var n,s,u,p,l;if("undefined"==typeof(o=a(l=o))&&i.invalidValue(this,"status",l),(u=this._status)!==o)for(c&&(console.info(++r+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+o+", old: "+u),r===window.sourceBreak),this._status=o,null!=e&&e.call(this,o,u),p=this.$ds_statusWatchers,n=p.length-1;n>=0;n+=-1)s=p[n],s.lst(this,o,u,s.unwatch)}}),o.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var o,r,s,a;return n&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("referry"),"function"!=typeof e&&i.invalidArg("listener")),(a=this.$ds_statusWatchers).push(s={lst:e}),this.addRef(t),s.unwatch=r=function(e){return function(o){return function(){o||(e.release(t),_.remove(a,s),o=!0)}}}(this)(!1),o=this.get("status"),"update"===o?(e(this,"ready","nodata",r),_.find(a,s)&&e(this,"update","ready",r)):e(this,o,"nodata",r),r}},t}()},{"./util":25}],22:[function(t,e,o){var r,n,i,s,a,u,c=function(t,e){function o(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,u=t("./util").traceWatch,n=t("./DSObjectBase"),r=t("./DSDigest"),e.exports=i=function(t){function e(){return o.apply(this,arguments)}var o,i;return c(e,t),e.begin("DSPool"),o=function(t,e,o,r){var i;n.call(this,t,e),s&&(n.isAssignableFrom(o)||a.notDSObjectClass(o)),i=this.items={},this.type=o,r&&(this.watchOn=!0,this.evt=[])},i=function(t){var e,o,r,n,i;if((n=this.items).hasOwnProperty(t))for(r=n[t],i=this.evt,o=i.length-1;o>=0;o+=-1)e=i[o],e.lst(r)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&r.render(this.$ds_key,t.$ds_key,function(t){return function(e){i.call(t,e)}}(this))},e.prototype.find=function(t,e,o){var r,n;return s&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof o||"object"==typeof o&&null!==o||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(n=e)),o&&o.hasOwnProperty(e)?o[e]:(this.items.hasOwnProperty(e)?(r=this.items[e]).addRef(t):(r=this.items[e]=new this.type(t,e,n),r.$ds_pool=this,this.evt&&(r.hasOwnProperty("$ds_evt")?(s&&_.find(r.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),r.$ds_evt.push(this)):r.$ds_evt=[this],this.__onChange(r))),o?o[e]=r:r)},e.prototype.enableWatch=function(t){if(s&&!this.evt)throw new Error("Pool '"+n.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var o,r,i,c,p;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(i in e)if(c=e[i],"change"!==i&&"add"!==i&&"remove"!==i)throw new Error("Unexpected event listener: "+i);if(u&&(e.owner=t),!this.evt)throw new Error("Pool '"+n.desc(this)+"' watch functionality is not enabled")}return(r=this.evt).push(p={lst:e}),this.addRef(t),o=!0,function(e){return function(){o&&(o=!1,e.release(t),_.remove(r,p))}}(this)},e.end(),e}(n)},{"./DSDigest":17,"./DSObjectBase":21,"./util":25}],23:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d=function(t,e){function o(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;l=t("./util"),i=t("./util").assert,c=t("./util").traceRefs,p=t("./util").traceWatch,u=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,s=t("./util").error,r=t("./DSObjectBase"),e.exports=n=function(t){function e(){return a.apply(this,arguments)}var o,n,a;return d(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,o,r;o=t=this.items;for(e in o)r=o[e],r.release(this),delete t[e]}),a=function(t,e,o,n){r.call(this,t,e),i&&(!o instanceof r&&s.notDSObjectClass(o),"object"!=typeof n&&void 0!==n&&s.invalidArg("data")),this.data=n,this.type=o,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,o,r;for(o=this.evt,e=o.length-1;e>=0;e+=-1)t=o[e],null!=(r=t.change)&&r.apply(t,arguments)},e.prototype.merge=function(t,e){var r,a,u;i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("newMap")),u=this.items;for(a in u)r=u[a],e.hasOwnProperty(a)||n.call(this,r);for(a in e){if(r=e[a],i&&a!==r.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+r.$ds_key);o.call(this,t,r)}return this.items},e.prototype.reset=function(){var t,e,o,r,n;for(t=this.evt,_.forEach(o=this.items,function(e){return function(o){var r,n,i;for(n=0,i=t.length;n<i;n++)r=t[n],"function"==typeof r.remove&&r.remove(o);o.release(e)}}(this)),e=0,n=o.length;e<n;e++)r=o[e],delete o[r]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&n.call(this,t)},n=function(t){var e,o,r;for(t.hasOwnProperty("$ds_evt")&&(i&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],r=this.evt,o=r.length-1;o>=0;o+=-1)e=r[o],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=o=function(t,e){var o,n,a,p,d,f;if(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),e instanceof this.type||s.invalidMapElementType(this,e)),(p=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(i&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],p[e.$ds_key]=e,c&&(f=e.$ds_referries,0===f.length?console.error(r.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(r.desc(this)+": Referry not found: "+r.desc(t)):(u&&(console.info(++l.serviceOwner.msgCount+": transfer: "+r.desc(e)+", refs: "+this.$ds_ref+", from: "+r.desc(t)+", to: "+r.desc(this)),l.serviceOwner.msgCount===window.totalBreak),f[a]=this)),d=this.evt,n=d.length-1;n>=0;n+=-1)o=d[n],"function"==typeof o.add&&o.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,o){var r,n,a,u;if(i){"object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("listener");for(a in e)if(u=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);p&&(e.owner=t)}if(_.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(n=this.evt).push(e),!o)return this.addRef(t),r=!0,function(o){return function(){r&&(r=!1,o.release(t),_.remove(n,function(t){return t===e}))}}(this)},e.prototype.addRef=function(t){var o;return 1===this.$ds_ref&&(o=this.data)&&1===++o.__busySets&&o.addRef(o.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var o;return e.__super__.release.call(this,t),1===this.$ds_ref&&(o=this.data)&&0===--o.__busySets&&o.release(o.__backRef),this},e.end(),e}(r)},{"./DSObjectBase":21,"./util":25}],24:[function(t,e,o){var r,n,i,s,a=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,r=t("./DSObjectBase"),e.exports=n=function(t){function e(t,o){var n,a,u,c,p,l,d,f,h,m;if(e.__super__.constructor.call(this,t,""+ ++e.nextTags),i&&(2===arguments.length&&"object"==typeof(f=arguments[1])||void 0!==o&&"string"!=typeof o&&s.invalidArg("enums")),2===arguments.length&&"object"==typeof(f=arguments[1])){f.__proto__===e.prototype?(this.map=_.clone(f.map),this.value=f.value):(this.map=p=_.clone(o),this.value=_.sortBy(function(){var t;t=[];for(a in p)t.push(a);return t}()).join(", ")),l=this.map;for(u in l)m=l[u],m instanceof r&&m.addRef(this)}else{if(this.map=p={},"string"==typeof o)for(d=o.split(","),n=0,c=d.length;n<c;n++)h=d[n],p[h.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(a in p)t.push(a);return t}()).join(", ")}}return a(e,t),e.nextTags=0,e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(o,r){var n,a;return i&&r&&"function"!=typeof r&&s.invalidArg("valid"),r=(a=r)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&a(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},n="_"+o,this.ds_dstr.push(function(){this[n]&&this[n].release(this)}),t.prop({name:o,type:"DSTags",valid:r,read:function(t){return null!==t?new e(this,t):null},str:function(t){return t.value},init:null,set:function(t){var e,i,a,u,c;if("undefined"==typeof(t=r(c=t))&&s.invalidValue(this,o,c),(u=this[n])!==t){if(this[n]=t,t&&t.addRef(this),e=this.$ds_evt)for(i=e.length-1;i>=0;i+=-1)a=e[i],a.__onChange.call(a,this,o,t,u);u&&u.release(this)}}})}},e.ds_dstr.push(function(){var t,e,o;e=this.map;for(t in e)o=e[t],o instanceof r&&o.release(this)}),e.prototype.clone=function(t){return new e(t,this)},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.set=function(t,e){var o,n,a,u;return i&&("string"!=typeof t&&s.invalidArg("enumValue"),"undefined"==typeof e&&s.invalidArg("value")),e?(o=(a=this.map).hasOwnProperty(t),e instanceof r&&e.addRef(this),(u=a[t])instanceof r&&u.release(this),a[t]=e,o||(this.value=_.sortBy(function(){var t;t=[];for(n in a)t.push(n);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((u=a[t])instanceof r&&u.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(n in a)t.push(n);return t}()).join(", ")),this},e.prototype.get=function(t){return i&&"string"!=typeof t&&s.invalidArg("enumValue"),!!this.map.hasOwnProperty(t)&&this.map[t]},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.empty=function(){
var t;for(t in this.map)return!1;return!0},e.prototype.diff=function(t){var o,r,n;return i&&("object"==typeof t&&t.__proto__===e.prototype||s.invalidArg("src")),n=t.map,function(){var t;t=[];for(o in r=this.map)n.hasOwnProperty(o)||t.push("+"+o);return t}.call(this).concat(function(){var t;t=[];for(o in n)r.hasOwnProperty(o)||t.push("-"+o);return t}()).join(", ")},e.end(),e}(r)},{"./DSObjectBase":21,"./util":25}],25:[function(t,e,o){var r,n;e.exports=n={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(r=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,o,r,n,i,s,a;for(i=this.services,e=0,r=i.length;e<r;e++)a=i[e],a.release(this);if(this.poolCleaners)for(s=this.poolCleaners,o=0,n=s.length;o<n;o++)(t=s[o])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,o){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+o+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,o){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+o+"'")}}}},{}],26:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d=function(t,e){function o(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(p=angular.module("data/dsDataService",[t("../../dscommon/DSDataSource"),t("../../app/config"),t("../../dscommon/DSDataSource"),t("../../app/data/teamwork/TWPeople"),t("../../app/data/PeopleWithJson"),t("./teamwork/TWProjects"),t("./teamwork/TWPeriodTimeTracking")])).name,a=t("../../dscommon/util").assert,l=t("../../dscommon/util").serviceOwner,c=t("../../dscommon/util").error,u=t("../../utils/base64"),r=t("../../dscommon/DSDataServiceBase"),i=t("../../app/models/Person"),s=t("../../app/models/Project"),n=t("../models/PeriodTimeTracking"),p.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),p.factory("dsDataService",["TWPeriodTimeTracking","PeopleWithJson","TWPeople","TWProjects","DSDataSource","config","$http","$rootScope","$q",function(t,e,o,a,c,p,f,h,m){var y;return y=function(l){function y(){var t;r.apply(this,arguments),this.set("dataSource",new c(this,"dataSource")).release(this),t=null,this.__unwatch2=h.$watch(function(){return[p.get("teamwork"),p.get("token")]},function(e){return function(o){var r,n,i;return n=o[0],i=o[1],n&&i?(t&&(t.resolve(),t=null),r=function(o,r){r||(console.error("error: ",o),t=null),e.get("dataSource").setConnection(null,null)},f.get(n+"authenticate.json",{timeout:(t=m.defer()).promise,headers:{Authorization:"Basic "+u.encode(i)}}).then(function(o){200===o.status?(t=null,p.set("currentUserId",o.data.account.userId),e.get("dataSource").setConnection(n,i)):r(o,0===o.status)},r),void 0):e.get("dataSource").setConnection(null,null)}}(this),!0)}return d(y,l),y.begin("DSDataService"),y.propDoc("dataSource",c),y.propSet("peopleSet",i),y.propSet("projectsSet",s),y.propSet("periodTimeTrackingSet",n),y.ds_dstr.push(function(){this.__unwatch2()}),y.prototype.refresh=function(){this.get("dataSource").refresh()},y.prototype.findDataSet=function(n,i){var s,u,c,p,l,d;switch(r.prototype.findDataSet.call(this,n,i),i.type.docType){case"Person":return i.source?(delete i.source,"function"==typeof(s=l=o.pool.find(this,i)).init&&s.init(this),(d=l.get("peopleSet")).addRef(n),l.release(this)):("function"==typeof(u=l=e.pool.find(this,i)).init&&u.init(this),(d=l.get("peopleSet")).addRef(n),l.release(this)),d;case"Project":return"function"==typeof(c=l=a.pool.find(this,i)).init&&c.init(this),(d=l.get("projectsSet")).addRef(n),l.release(this),d;case"PeriodTimeTracking":return"function"==typeof(p=l=t.pool.find(this,i)).init&&p.init(this),(d=l.get("timeTrackingSet")).addRef(n),l.release(this),d}},y.prototype.requestSources=function(t,e,o){throw r.prototype.requestSources.call(this,t,e,o),new Error("requestSources() is not implemented for reports.  It's not expected that DSView will be used")},y.end(),y}(r),l.add(new y(l,"dataService"))}])},{"../../app/config":1,"../../app/data/PeopleWithJson":2,"../../app/data/teamwork/TWPeople":4,"../../app/models/Person":5,"../../app/models/Project":6,"../../dscommon/DSDataServiceBase":15,"../../dscommon/DSDataSource":16,"../../dscommon/util":25,"../../utils/base64":34,"../models/PeriodTimeTracking":29,"./teamwork/TWPeriodTimeTracking":27,"./teamwork/TWProjects":28}],27:[function(t,e,o){var r,n,i,s,a,u,c,p,l,d,f,h,m=function(t,e){function o(){this.constructor=t}for(var r in e)y.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWPeriodTimeTracking",[t("../../../dscommon/DSDataSource")])).name,d=t("../../../dscommon/util").assert,f=t("../../../dscommon/util").error,i=t("../../../dscommon/DSObject"),r=t("../../../dscommon/DSData"),s=t("../../../dscommon/DSSet"),n=t("../../../dscommon/DSDigest"),c=t("../../../app/models/Person"),p=t("../../../app/models/Project"),u=t("../../models/PeriodTimeTracking"),l=500,a=50,h.factory("TWPeriodTimeTracking",["DSDataSource","$rootScope","$q",function(t,e,o){var f;return f=function(e){function f(){return f.__super__.constructor.apply(this,arguments)}return m(f,e),f.begin("LoadPeriodTimeTracking"),f.addPool(),f.propDoc("source",t),f.propDoc("people",s),f.propDoc("projects",s),f.propSet("timeTracking",u),f.propObj("cancel",{init:null}),f.ds_dstr.push(function(){this.__unwatchA(),this.__unwatch1(),this.__unwatch2()}),f.prototype.clear=function(){var t;"function"==typeof this.__unwatch1&&this.__unwatch1(),this.__unwatchA=null,"function"==typeof this.__unwatch2&&this.__unwatch2(),this.__unwatchB=null,r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},f.prototype.init=function(e){var o,r;if(!moment.isMoment(o=this.get("params").from))throw new Error("Missing params.from");if(!moment.isMoment(r=this.get("params").to))throw new Error("Missing params.to");if(!(o<r))throw new Error("Params.to is less or equal to params.from");this.set("people",e.findDataSet(this,{type:c,mode:"original"})).release(this),this.set("projects",e.findDataSet(this,{type:p,mode:"original"})).release(this),this.__unwatchA=t.setLoadAndRefresh.call(this,e),this.init=null},f.prototype.load=function(){var t,e,r,s;if(d&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(s=[e=this.get("people"),r=this.get("projects")],t=function(t){return function(){var p,d,f,h,m,y,_,v,g,w,S,O,b,D,P;if("ready"===i.integratedStatus(s)){t.__unwatch1(),t.__unwatch2(),O=u.pool.items;for(S in O)b=O[S],b.set("totalMin",0);w={},y={},h=t.get("params").from,D=t.get("params").to,m=function(o){var n,i,s,a,p,d,f,m,_,v,g,S;for(i=0,a=o.length;i<a;i++)if(s=o[i],(n=moment(s.date))>=h){if(S=s.id,m=parseInt(s["person-id"]),_=parseInt(s["project-id"]),p=60*parseInt(s.hours)+parseInt(s.minutes),""!==s["todo-item-id"]?(v=parseInt(s["todo-item-id"]),g=s["todo-item-name"]):(v=null,g=null),n>=D)return!1;d=u.pool.find(t,m+"-"+_+"-"+v,w),(f=e.items[m])||(f=c.pool.find(t,"missing-"+m,y),f.set("id",m),f.set("missing",!0)),d.set("person",f),d.set("project",r.items[_]),d.set("taskId",v),d.set("taskName",g),d.set("totalMin",d.get("totalMin")+p),d.set("lastReport",n)}return o.length===l},d=function(){var e,o;t.get("timeTrackingSet").merge(t,w);for(e in y)o=y[e],o.release(t);t._endLoad(!0)},_=function(e,o){var r,n;o||(console.error("error: ",e),t.set("cancel",null));for(r in w)n=w[r],n.release(t);t._endLoad(!1)},g={},v=function(e){g.hasOwnProperty(e)?n.block(function(){return m(g[e])})?v(e+1):d():t.get("source").httpGet("time_entries.json?page="+e+"&pageSize="+l,t.set("cancel",o.defer())).then(function(o){var r;200===o.status?(t.set("cancel",null),(r=o.data["time-entries"])?moment(r[r.length-1].date)<h?r.length===l?v(e+1):d():n.block(function(){return m(r)})?v(e+1):d():d()):_(o,0===o.status)},_)},P=1,p=a,(f=function(e){t.get("source").httpGet("time_entries.json?page="+e+"&pageSize="+l,t.set("cancel",o.defer())).then(function(o){var r,i;200===o.status?(t.set("cancel",null),(r=o.data["time-entries"])&&0!==r.length?moment(r[0].date)>=h?P===e?(config.set("histStart",e),n.block(function(){return m(r)})?v(e+1):d()):(g[e]=r,f(P+Math.floor(((p=e)-P)/2))):moment(r[r.length-1].date)<h?p===e?(i=[p,p+a],P=i[0],p=i[1],f(p)):p===e+1?d():(P=e+1,f(P+Math.floor((p-P)/2))):n.block(function(){return m(r)})?v(e+1):d():f(P+Math.floor(((p=e)-P)/2))):_(o,0===o.status)},_)})(p)}}}(this),this.__unwatch1=e.watchStatus(this,t),this.__unwatch2=r.watchStatus(this,t))},f.end(),f}(r)}])},{"../../../app/models/Person":5,"../../../app/models/Project":6,"../../../dscommon/DSData":14,"../../../dscommon/DSDataSource":16,"../../../dscommon/DSDigest":17,"../../../dscommon/DSObject":20,"../../../dscommon/DSSet":23,"../../../dscommon/util":25,"../../models/PeriodTimeTracking":29}],28:[function(t,e,o){var r,n,i,s,a=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWProjects",[t("../../../dscommon/DSDataSource"),t("../../../app/data/teamwork/DSDataTeamworkPaged")])).name,n=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../../app/models/Project"),s.factory("TWProjects",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,o,n){var i;return i=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,t),o.begin("TWProjects"),o.addPool(),o.propSet("projects",r),o.ds_dstr.push(function(){this.__unwatch2()}),o.prototype.init=function(t){this.set("request","projects.json?status=ALL"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null,this.projectsMap={}},o.prototype.startLoad=function(){this.projectsMap={}},o.prototype.importResponse=function(t){var e,o,n,i,s,a;for(e=0,a=t.projects,o=0,i=a.length;o<i;o++)n=a[o],++e,s=r.pool.find(this,""+n.id,this.projectsMap),s.set("id",parseInt(n.id)),s.set("name",n.name),s.set("status",n.status);return e},o.prototype.finalizeLoad=function(){this.get("projectsSet").merge(this,this.projectsMap)},o.end(),o}(t)}])},{"../../../app/data/teamwork/DSDataTeamworkPaged":3,"../../../app/models/Project":6,"../../../dscommon/DSDataSource":16,"../../../dscommon/util":25}],29:[function(t,e,o){var r,n,i,s,a,u=function(t,e){function o(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;r=t("../../dscommon/DSObject"),i=t("../../app/models/Person"),s=t("../../app/models/Project"),a=t("../../app/models/Task"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("PeriodTimeTracking"),e.addPool(),e.propDoc("person",i),e.propDoc("project",s),e.propNum("taskId"),e.propStr("taskName"),e.propMoment("lastReport"),e.propNum("totalMin",{init:0}),e.end(),e}(r)},{"../../app/models/Person":5,"../../app/models/Project":6,"../../app/models/Task":8,"../../dscommon/DSObject":20}],30:[function(t,e,o){var r,n,i,s,a,u,c,p,l;r=t("../../static/libs/FileSaver.js/FileSaver"),l=t("../dscommon/util").serviceOwner,n=t("./models/PeriodTimeTracking"),s=t("../utils/base64"),i=t("../utils/base62ToBlob"),e.exports=(c=angular.module("reports-app",["ui.bootstrap",t("./showSpinner"),t("./data/dsDataService"),t("./data/teamwork/TWPeriodTimeTracking")])).name,a="Без задачи",u=function(t){return null===t?t:t.replace(/"/g,'""')},p=function(t){var e,o,r,n,i,s,c,p,l;return l=t.getStyleSheet(),n=l.createFormat({font:{bold:!0}}),o=l.createFormat({font:{bold:!0},alignment:{horizontal:"right"}}),p=l.createFormat({format:"0"}),i=l.createFormat({format:"0.00"}),s=l.createFormat({format:"0.00"}),c=l.createFormat({format:"0.00",font:{bold:!0}}),r=l.createFormat({font:{color:"002A00FF"}}),e=function(){function t(t){var e,o,r,n,i,s;for(this.topRow=null!=(n=t.topRow)?n:0,e=t.data,this.rows=[],this.projectLine(e.project),this.peopleLine(e.people),this.ratesLine(),i=e.tasks,o=0,r=i.length;o<r;o++)s=i[o],this.taskLine(s.task,s.hours);this.totalHoursLine(),this.totalMoneyLine(),this.addRow()}return t.prototype.addRow=function(){this.rows.push(this.currRow=[])},t.prototype.skip=function(){this.currRow.push(null)},t.prototype.rate=function(){this.currRow.push({value:0,metadata:{style:p.id}})},t.prototype.hours=function(t){this.currRow.push({value:t,metadata:{style:i.id}})},t.prototype.sumHoursVert=function(t){var e;e=String.fromCharCode(65+this.currRow.length),this.currRow.push({value:"SUM("+e+(this.topRow+4)+":"+e+(this.topRow+this.rows.length-1)+")",metadata:{type:"formula",style:i.id}})},t.prototype.sumHoursHoriz=function(t){var e,o;e=String.fromCharCode(65+this.currRow.length+1),o=String.fromCharCode(65+this.currRow.length+this.peopleCount),this.currRow.push({value:"SUM("+e+(this.topRow+this.rows.length)+":"+o+(this.topRow+this.rows.length)+")",metadata:{type:"formula",style:i.id}})},t.prototype.sumMoneyHoriz=function(t){var e,o;e=String.fromCharCode(65+this.currRow.length+1),o=String.fromCharCode(65+this.currRow.length+this.peopleCount),this.currRow.push({value:"SUM("+e+(this.topRow+this.rows.length)+":"+o+(this.topRow+this.rows.length)+")",metadata:{type:"formula",style:c.id}})},t.prototype.multHoursByRate=function(t){var e;e=String.fromCharCode(65+this.currRow.length),this.currRow.push({value:""+e+(this.topRow+3)+"*"+e+(this.topRow+this.rows.length-1),metadata:{type:"formula",style:s.id}})},t.prototype.totalByTaskTitle=function(){this.currRow.push({value:"Всего часов",metadata:{style:n.id}})},t.prototype.ratesTitle=function(){this.currRow.push({value:"Стоимость часа (руб):",metadata:{style:o.id}})},t.prototype.totalHoursTitle=function(){this.currRow.push({value:"Итого часов:",metadata:{style:o.id}})},t.prototype.totalMoneyTitle=function(){this.currRow.push({value:"Сумма (руб):",metadata:{style:o.id}})},t.prototype.person=function(t){this.currRow.push({value:'HYPERLINK("http://teamwork.webprofy.ru/people/'+t.id+'", "'+(t.missing?t.id:u(t.name))+'")',metadata:{type:"formula",style:r.id}})},t.prototype.project=function(t){this.currRow.push({value:'HYPERLINK("http://teamwork.webprofy.ru/projects/'+t.id+'/tasks", "'+u(t.name)+'")',metadata:{type:"formula",style:r.id}})},t.prototype.task=function(t){this.currRow.push(null===t.id?a:""+t.name)},t.prototype.taskLink=function(t){this.currRow.push(null===t.id?"":{value:'HYPERLINK("http://teamwork.webprofy.ru/tasks/'+t.id+'", "<<")',metadata:{type:"formula",style:r.id}})},t.prototype.projectLine=function(t){this.addRow(),this.project(t)},t.prototype.peopleLine=function(t){var e,o,r;for(this.addRow(),this.skip(),this.skip(),this.totalByTaskTitle(),e=0,o=t.length;e<o;e++)r=t[e],this.person(r);this.peopleCount=t.length},t.prototype.ratesLine=function(){var t,e,o;for(this.addRow(),this.skip(),this.ratesTitle(),this.skip(),t=e=0,o=this.peopleCount;0<=o?e<o:e>o;t=0<=o?++e:--e)this.rate()},t.prototype.taskLine=function(t,e){var o,r,n;for(this.addRow(),this.taskLink(t),this.task(t),this.sumHoursHoriz(),r=0,n=e.length;r<n;r++)o=e[r],this.hours(o)},t.prototype.totalHoursLine=function(){var t,e,o;for(this.addRow(),this.skip(),this.totalHoursTitle(),this.sumHoursVert(),t=e=0,o=this.peopleCount;0<=o?e<o:e>o;t=0<=o?++e:--e)this.sumHoursVert()},t.prototype.totalMoneyLine=function(){var t,e,o;for(this.addRow(),this.skip(),this.totalMoneyTitle(),this.sumMoneyHoriz(),t=e=0,o=this.peopleCount;0<=o?e<o:e>o;t=0<=o?++e:--e)this.multHoursByRate()},t}()},c.directive("reports",["TWPeriodTimeTracking","dsDataService","config","$http","$rootScope",function(t,e,o,s,a){return{restrict:"A",scope:!0,link:function(t,o,s){t.progressMessage=null,t.period=moment().startOf("month").add(-1,"month").toDate(),t.selectPeriod=!1,t.generateReport=function(){var o,s,u,c,d,f;o=p(f=window.ExcelBuilder.createWorkbook()),t.progressMessage="Идет загрузка данных...",s=moment(t.period),c=moment(s).add(1,"month"),u=e.findDataSet(l,{type:n,mode:"original",from:s,to:c}),d=u.watchStatus(l,function(n,s){var c,p,h,m,y,_,v,g,w,S,O,b,D,P,k,T,$,j,R,A,C,M,E,x;if("ready"===s){d(),k={},R=[],_=0,T=u.items;for(m in T)x=T[m],((c=k[g=x.project.name]||(k[g]={}))[v=x.taskName]||(c[v]=[])).push(x);for($=Object.keys(k).sort(),h=0,y=$.length;h<y;h++){P=$[h],E=k[P],S={};for(m in E)A=E[m],S[A[0].person.name]=A[0].person;w=function(){var t,e,o,r;for(o=Object.keys(S).sort(),r=[],t=0,e=o.length;t<e;t++)b=o[t],r.push(S[b]);return r}(),_=Math.max(_,w.length),M=function(){var t,e,o;o=[];for(C in E){for(A=E[C],D=A[0].project,p=function(){var t,e,o;for(o=[],x=t=0,e=w.length;t<e;x=t+=1)o.push(null);return o}(),t=0,e=A.length;t<e;t++)j=A[t],O=w.indexOf(j.person),null===p[O]?p[O]=j.totalMin/60:p[O]+=j.totalMin/60;o.push({task:{id:A[0].taskId,name:C},lastReport:A[A.length-1].lastReport,hours:p})}return o}().sort(function(t,e){return null===t.task.id?-1:null===e.task.id?1:t.lastReport.valueOf()-e.lastReport.valueOf()}),R=R.concat(new o({topRow:R.length,data:{project:D,people:w,tasks:M}}).rows)}t.progressMessage="Формируем MS Excel файл ...",a.$$phase||a.$digest(),t.$evalAsync(function(){var o,n,s,c,p,d,h;for(n=[{width:4},{width:30},{width:20}],c=p=0,d=_;p<d;c=p+=1)n.push({width:30});h=f.createWorksheet({name:"По людям "+moment(t.period).format("MM.YYYY")}),h.setData(R),h.setColumns(n),f.addWorksheet(h),s=window.ExcelBuilder.createFile(f),o=i(s,"application/vnd.ms-excel",512),r.saveAs(o,"Часы по людям по проектам за "+moment(t.period).format("MM.YYYY")+".xlsx"),u.release(l),e.refresh(),t.progressMessage=null,a.$$phase||a.$digest()})}})}}}}])},{"../../static/libs/FileSaver.js/FileSaver":35,"../dscommon/util":25,"../utils/base62ToBlob":33,"../utils/base64":34,"./data/dsDataService":26,"./data/teamwork/TWPeriodTimeTracking":27,"./models/PeriodTimeTracking":29,"./showSpinner":31}],31:[function(t,e,o){var r,n;e.exports=(r=angular.module("showSpinner",[])).name,n={lines:13,length:1,radius:8,color:"#000",opacity:.2},r.directive("showSpinner",[function(){return{restrict:"A",link:function(t,e,o){var r;r=new Spinner(n).spin(),e[0].appendChild(r.el),t.$on("$destroy",function(){r.stop()})}}}])},{}],32:[function(t,e,o){!function(t,e,o){"use strict";function r(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var n=e.isDefined,i=e.isUndefined,s=e.isNumber,a=e.isObject,u=e.isArray,c=e.extend,p=e.toJson,l=e.fromJson,d=e.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,o,d){var f,h=this,m=h.prefix,y=h.cookie,_=h.notify,v=h.storageType;o?o[0]&&(o=o[0]):o=document,"."!==m.substr(-1)&&(m=m?m+".":"");var g=function(t){return m+t},w=function(){try{var o=v in e&&null!==e[v],r=g("__"+Math.round(1e7*Math.random()));return o&&(f=e[v],f.setItem(r,""),f.removeItem(r)),o}catch(n){return v="cookie",t.$broadcast("LocalStorageModule.notification.error",n.message),!1}}(),S=function(e,o){if(i(o)?o=null:(a(o)||u(o)||s(+o||o))&&(o=p(o)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),_.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:o,storageType:"cookie"}),T(e,o);try{(a(o)||u(o))&&(o=p(o)),f&&f.setItem(g(e),o),_.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:o,storageType:h.storageType})}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.message),T(e,o)}return!0},O=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),$(e);var o=f?f.getItem(g(e)):null;return o&&"null"!==o?"{"===o.charAt(0)||"["===o.charAt(0)||r(o)?l(o):o:null},b=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),_.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),j(e);try{f.removeItem(g(e)),_.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),j(e)}return!0},D=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,o=[];for(var r in f)if(r.substr(0,e)===m)try{o.push(r.substr(e))}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.Description),[]}return o},P=function(e){e=e||"";var o=m.slice(0,-1),r=new RegExp(o+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),R();var n=m.length;for(var i in f)if(r.test(i))try{b(i.substr(n))}catch(s){return t.$broadcast("LocalStorageModule.notification.error",s.message),R()}return!0},k=function(){try{return e.navigator.cookieEnabled||"cookie"in o&&(o.cookie.length>0||(o.cookie="test").indexOf.call(o.cookie,"test")>-1)}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),T=function(e,r){if(i(r))return!1;if((u(r)||a(r))&&(r=p(r)),!k)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var n="",s=new Date,c="";if(null===r?(s.setTime(s.getTime()+-864e5),n="; expires="+s.toGMTString(),r=""):0!==y.expiry&&(s.setTime(s.getTime()+24*y.expiry*60*60*1e3),n="; expires="+s.toGMTString()),e){var l="; path="+y.path;y.domain&&(c="; domain="+y.domain),o.cookie=g(e)+"="+encodeURIComponent(r)+n+l+c}}catch(d){return t.$broadcast("LocalStorageModule.notification.error",d.message),!1}return!0},$=function(e){if(!k)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var r=o.cookie&&o.cookie.split(";")||[],n=0;n<r.length;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(g(e)+"=")){var s=decodeURIComponent(i.substring(m.length+e.length+1,i.length));try{var a=JSON.parse(s);return l(a)}catch(u){return s}}}return null},j=function(t){T(t,null)},R=function(){for(var t=null,e=m.length,r=o.cookie.split(";"),n=0;n<r.length;n++){for(t=r[n];" "===t.charAt(0);)t=t.substring(1,t.length);var i=t.substring(e,t.indexOf("="));j(i)}},A=function(){return v},C=function(t,e,o,r){r=r||e;var i=O(r);return null===i&&n(o)?i=o:a(i)&&a(o)&&(i=c(o,i)),d(e).assign(t,i),t.$watch(e,function(t){S(r,t)},a(t[e]))},M=function(){for(var t=0,o=e[v],r=0;r<o.length;r++)0===o.key(r).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:A,set:S,add:S,get:O,keys:D,remove:b,clearAll:P,bind:C,deriveKey:g,length:M,cookie:{isSupported:k,set:T,add:T,get:$,remove:j,clearAll:R}}}]})}(window,window.angular)},{}],33:[function(t,e,o){e.exports=function(t,e,o){var r,n,i,s,a,u,c,p;for(e=e||"",o=o||512,s=atob(t),i=[],c=0;c<s.length;){for(p=s.slice(c,c+o),a=new Array(p.length),u=0;u<p.length;)a[u]=p.charCodeAt(u),u++;n=new Uint8Array(a),i.push(n),c+=o}return r=new Blob(i,{type:e})}},{}],34:[function(t,e,o){var r;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,o,n,i,s,a,u,c,p;for(p="",e=void 0,o=void 0,n="",i=void 0,s=void 0,a=void 0,u="",c=0;;)if(e=t.charCodeAt(c++),o=t.charCodeAt(c++),n=t.charCodeAt(c++),i=e>>2,s=(3&e)<<4|o>>4,a=(15&o)<<2|n>>6,u=63&n,isNaN(o)?a=u=64:isNaN(n)&&(u=64),p=p+r.charAt(i)+r.charAt(s)+r.charAt(a)+r.charAt(u),e=o=n="",i=s=a=u="",!(c<t.length))break;return p},decode:function(t){var e,o,n,i,s,a,u,c,p,l;for(l="",o=void 0,n=void 0,i="",s=void 0,a=void 0,u=void 0,c="",p=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(s=r.indexOf(t.charAt(p++)),a=r.indexOf(t.charAt(p++)),u=r.indexOf(t.charAt(p++)),c=r.indexOf(t.charAt(p++)),o=s<<2|a>>4,n=(15&a)<<4|u>>2,i=(3&u)<<6|c,l+=String.fromCharCode(o),64!==u&&(l+=String.fromCharCode(n)),64!==c&&(l+=String.fromCharCode(i)),o=n=i="",s=a=u=c="",!(p<t.length))break;return l}}},{}],35:[function(t,e,o){var r=r||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,o=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,i=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},s=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),a=t.webkitRequestFileSystem,u=t.requestFileSystem||a||t.mozRequestFileSystem,c=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},p="application/octet-stream",l=0,d=500,f=function(e){var r=function(){"string"==typeof e?o().revokeObjectURL(e):e.remove()};t.chrome?r():setTimeout(r,d)},h=function(t,e,o){e=[].concat(e);for(var r=e.length;r--;){var n=t["on"+e[r]];if("function"==typeof n)try{n.call(t,o||t)}catch(i){c(i)}}},m=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t},y=function(e,c,d){d||(e=m(e));var y,_,v,g=this,w=e.type,S=!1,O=function(){h(g,"writestart progress write writeend".split(" "))},b=function(){if(_&&s&&"undefined"!=typeof FileReader){var r=new FileReader;return r.onloadend=function(){var t=r.result;_.location.href="data:attachment/file"+t.slice(t.search(/[,;]/)),g.readyState=g.DONE,O()},r.readAsDataURL(e),void(g.readyState=g.INIT)}if(!S&&y||(y=o().createObjectURL(e)),_)_.location.href=y;else{var n=t.open(y,"_blank");void 0==n&&s&&(t.location.href=y)}g.readyState=g.DONE,O(),f(y)},D=function(t){return function(){if(g.readyState!==g.DONE)return t.apply(this,arguments)}},P={create:!0,exclusive:!1};return g.readyState=g.INIT,c||(c="download"),n?(y=o().createObjectURL(e),void setTimeout(function(){r.href=y,r.download=c,i(r),O(),f(y),g.readyState=g.DONE})):(t.chrome&&w&&w!==p&&(v=e.slice||e.webkitSlice,e=v.call(e,0,e.size,p),S=!0),a&&"download"!==c&&(c+=".download"),(w===p||a)&&(_=t),u?(l+=e.size,void u(t.TEMPORARY,l,D(function(t){t.root.getDirectory("saved",P,D(function(t){var o=function(){t.getFile(c,P,D(function(t){t.createWriter(D(function(o){o.onwriteend=function(e){_.location.href=t.toURL(),g.readyState=g.DONE,h(g,"writeend",e),f(t)},o.onerror=function(){var t=o.error;t.code!==t.ABORT_ERR&&b()},"writestart progress write abort".split(" ").forEach(function(t){o["on"+t]=g["on"+t]}),o.write(e),g.abort=function(){o.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),b)}),b)};t.getFile(c,{create:!1},D(function(t){t.remove(),o()}),D(function(t){t.code===t.NOT_FOUND_ERR?o():b()}))}),b)}),b)):void b())},_=y.prototype,v=function(t,e,o){return new y(t,e,o)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,o){return o||(t=m(t)),navigator.msSaveOrOpenBlob(t,e||"download")}:(_.abort=function(){var t=this;t.readyState=t.DONE,h(t,"abort")},_.readyState=_.INIT=0,_.WRITING=1,_.DONE=2,_.error=_.onwritestart=_.onprogress=_.onwrite=_.onabort=_.onerror=_.onwriteend=null,v)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof e&&e.exports?e.exports.saveAs=r:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return r})},{}]},{},[30]);