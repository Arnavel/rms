!function t(e,r,o){function n(s,a){if(!r[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[s]={exports:{}};e[s][0].call(p.exports,function(t){var r=e[s][1][t];return n(r?r:t)},p,p.exports,t,e,r,o)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(t,e,r){var o,n,i,s,a,c,u,p,l=function(t,e){function r(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("../dscommon/util").assert,p=t("../dscommon/util").validate,u=t("../dscommon/util").serviceOwner,o=t("../dscommon/DSObject"),n=t("./models/Person"),t("../utils/angular-local-storage.js"),e.exports=(c=angular.module("config",["LocalStorageModule"])).name,c.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),c.run(["$rootScope","config",function(t,e){t.config=e}]),i=1,s=1,c.factory("config",["$http","localStorageService",function(t,e){var r,a,c,d,f,h,m,y,v,_,g,w;if(r=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return l(r,t),r.begin("Config"),r.propStr("token",null,p.trimString),r.propStr("teamwork","http://teamwork.webprofy.ru/"),r.propCalc("hasRoles",function(){return"http://teamwork.webprofy.ru/"===this.teamwork}),r.propCalc("hasTimeReports",function(){return"http://teamwork.webprofy.ru/"===this.teamwork||"http://delightsoft.teamworkpm.net/"===this.teamwork}),r.propConst("planTag","План"),r.propConst("teamleadRole","Teamlead"),r.propNum("hResizer"),r.propNum("vResizer"),r.propStr("currentUserId"),r.propDoc("currentUser",n),r.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),r.propStr("selectedRole"),r.propNum("selectedCompany"),r.propNum("selectedLoad"),r.propNum("histStart",-1),r.onAnyPropChange(function(t,r,o,n){"currentUserId"!==r&&"currentUser"!==r&&(("teamwork"===r||"token"===r)&&this.set("histStart",-1),"undefined"!=typeof o?e.set(r,o):e.remove(r))}),r.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},r.end(),r}(o),a=u.add(new r(u,"config")),d=!0,f=!0,_=1,g=0,"string"==typeof(v=e.get("ver"))&&((w=v.split(".")).length=2)&&(_=parseInt(w[0]),g=parseInt(w[1])),f=(d=_===i)?g===s:!1,f||e.set("ver",i+"."+s),d){m=r.prototype.__props;for(h in m)c=m[h],(f||"teamwork"===h||"token"===h)&&(c.readonly||"undefined"==typeof(y=e.get(h))||y&&a.set(h,y))}return a}])},{"../dscommon/DSObject":13,"../dscommon/util":18,"../utils/angular-local-storage.js":25,"./models/Person":5}],2:[function(t,e,r){var o,n,i,s,a,c,u,p,l,d=function(t,e){function r(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(l=angular.module("data/PeopleWithJson",[])).name,u=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,s=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),o=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),n=t("../../dscommon/DSDataServiceBase"),c=t("../models/Person"),l.factory("PeopleWithJson",["DSDataSource","config","$rootScope","$http","$q",function(t,e,r,l,f){var h;return h=function(t){function h(){return h.__super__.constructor.apply(this,arguments)}return d(h,t),h.begin("PeopleWithJson"),h.addPool(),h.propDoc("teamworkPeople",s),h.propObj("cancel",null),h.propSet("people",c),h.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),h.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},h.prototype.init=function(t){var o,s,d,h;u&&(t instanceof n||p.invalidArg("dsDataService")),(h=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:c,source:!0})))).release(this),d=this.get("peopleSet"),s=function(t){return function(e,r){r||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),o=function(t){return function(){var o;t._startLoad()&&(o=t.set("cancel",f.defer()),l.get("data/people.json?t="+(new Date).getTime(),o).then(function(o){200===o.status?(t.set("cancel",null),i.block(function(){var n,i,s,c,u,p,l,f,m,y,v,_,g;if(l=r.peopleRoles=o.data.roles,g=e.get("selectedRole"))for(i=0,c=l.length;c>i;i++)n=l[i],n.role===g&&(r.selectedRole=n);for(v=o.data.people,s=0,u=v.length;u>s;s++)m=v[s],h.items.hasOwnProperty(y=""+m.id)&&h.items[y].set("roles",new a(m.role));p={},_=h.items;for(y in _)f=_[y],p[y]=f,f.addRef(t);d.merge(t,p),t._endLoad(!0)})):s(o,0===o.status)},s))}}(this),this._unwatchA=h.watchStatus(this,function(t){return function(e,r){var n;if(r!==(n=t.get("status")))switch(r){case"ready":i.block(o);break;case"update":i.block(o);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},h.end(),h}(o)}])},{"../../dscommon/DSData":7,"../../dscommon/DSDataServiceBase":8,"../../dscommon/DSDigest":10,"../../dscommon/DSSet":16,"../../dscommon/DSTags":17,"../../dscommon/util":18,"../models/Person":5}],3:[function(t,e,r){var o,n,i,s,a,c,u=function(t,e){function r(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataTeamworkPaged",[])).name,s=t("../../../dscommon/util").assert,a=t("../../../dscommon/util").error,o=t("../../../dscommon/DSData"),n=t("../../../dscommon/DSDigest"),i=500,c.factory("DSDataTeamworkPaged",["DSDataSource","$rootScope","$q",function(t,e,r){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return u(a,e),a.begin("DSDataTeamworkPaged"),a.propDoc("source",t),a.propObj("cancel",null),a.propEnum("method",["httpGet","httpPost","httpPut"]),a.propStr("request"),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),a.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},a.prototype.load=function(){var t,e,o,a,c;if(s){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(c=this.get("request"))&&c.length>0))throw new Error("load(): Request is not specified")}this._startLoad()&&(e=this.set("cancel",r.defer()),o=function(t){return function(e,r){r||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),t=function(t,e){return""+e+(-1===e.indexOf("?")?"?":"&")+"page="+t+"&pageSize="+i},(a=function(r){return function(s){var c;return function(){switch(c=this.get("method")){case"httpGet":return this.get("source").httpGet(t(s,this.get("request")),e);case"httpPost":return this.get("source").httpPost(t(s,this.get("request")),this.params.json,e);case"httpPut":return this.get("source").httpPut(t(s,this.get("request")),this.params.json,e)}}.call(r).then(function(t){if(200===t.status){if(r.set("cancel",null),r.importResponse(t.data,t.status)===i)return void a(s+1);n.block(function(){return r.finalizeLoad()}),r._endLoad(!0)}else o(t,0===t.status)},o)}}(this))(1))},a.end(),a}(o)}])},{"../../../dscommon/DSData":7,"../../../dscommon/DSDigest":10,"../../../dscommon/util":18}],4:[function(t,e,r){var o,n,i,s,a=function(t,e){function r(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWPeople",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,n=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../models/Person"),s.factory("TWPeople",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,r,n){var i;return i=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return a(r,t),r.begin("TWPeople"),r.addPool(),r.propSet("people",o),r.ds_dstr.push(function(){this.__unwatch2()}),r.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null,this.peopleMap={}},r.prototype.importResponse=function(t){var e,r,n,i,s,a;for(e=0,a=t.people,r=0,i=a.length;i>r;r++)n=a[r],++e,s=o.pool.find(this,""+n.id,this.peopleMap),s.set("id",+n.id),s.set("name",(n["last-name"]+" "+n["first-name"].charAt(0).toUpperCase()+".").trim()),s.set("firstName",n["first-name"].trim()),s.set("avatar",n["avatar-url"]),s.set("email",n["email-address"]),s.set("companyId",+n["company-id"]),s.set("currentUser",!1);return e},r.prototype.finalizeLoad=function(){this.get("peopleSet").merge(this,this.peopleMap)},r.end(),r}(t)}])},{"../../../dscommon/DSDataSource":9,"../../../dscommon/util":18,"../../models/Person":5,"./DSDataTeamworkPaged":3}],5:[function(t,e,r){var o,n,i,s,a,c=function(t,e){function r(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSDocument"),n=t("../../dscommon/DSTags"),e.exports=i=function(t){function e(){return r.apply(this,arguments)}var r;return c(e,t),e.begin("Person"),n.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propBool("missing"),e.propDuration("contractTime"),r=function(t,e){o.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(o)},{"../../dscommon/DSDocument":11,"../../dscommon/DSTags":17,"../../dscommon/util":18}],6:[function(t,e,r){var o,n,i,s,a=function(t,e){function r(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propStr("status"),e.propObj("people"),e.end(),e}(o)},{"../../dscommon/DSObject":13,"../../dscommon/util":18}],7:[function(t,e,r){var o,n,i,s,a,c,u=function(t,e){function r(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,c=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,n=t("./DSObject"),e.exports=o=function(t){function e(){return r.apply(this,arguments)}var r;return u(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var r,o,n,i;for(n=this.__proto__.__sets,r=0,o=n.length;o>r;r++)i=n[r],this["_"+i].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void c.remove(this.release(c)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},r=function(t,r,o){if(n.call(this,t,r),i){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof o&&s.invalidArg("params")}this.set("params",o),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&c.add(this.addRef(c))},e.prototype.clear=function(){var t,e,r,o;for(r=this.__proto__.__sets,t=0,e=r.length;e>t;t++)o=r[t],this["_"+o].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;n.end.call(this),this.prototype.__sets=function(){var r,o;r=this.prototype.__props,o=[];for(t in r)e=r[t],"set"===e.type&&o.push(t);return o}.call(this)},e}(n)},{"./DSObject":13,"./util":18}],8:[function(t,e,r){var o,n,i,s,a,c=function(t,e){function r(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,n=t("./DSObject"),i=t("./DSPool"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){s&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,r){var o,i,c,u;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),("object"!=typeof r||null===r)&&a.invalidArg("sources");for(o in r){c=r[o],("object"!=typeof c||null===c)&&a.invalidArg("sources");for(i in c)switch(u=c[i],i){case"name":break;case"type":!u instanceof n&&a.invalidArg("sources");break;case"set":!u instanceof n&&a.invalidArg("sources");break;case"params":("object"!=typeof u||null===u)&&a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(n)},{"./DSObject":13,"./DSPool":15,"./util":18}],9:[function(t,e,r){var o,n,i,s,a,c,u,p,l=function(t,e){function r(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(u=angular.module("dscommon/DSDataSource",[])).name,p=t("./util").serviceOwner,c=t("./util").modeReleaseDataOnReload,i=t("./util").assert,a=t("./util").error,s=t("../utils/base64"),n=t("./DSObject"),o=t("./DSDigest"),u.factory("DSDataSource",["$q","$http",function(t,e){var r;return r=function(t){function r(){return c.apply(this,arguments)}var c;return l(r,t),r.begin("DSDataSource"),r.addDataSource(),r.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,r,n){switch(r){case"ready":o.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},c=function(t,e){n.call(this,t,e),this.cancelDefers=[]},r.prototype.setConnection=function(t,e){var r,o,n,c;if(i&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(c=this.cancelDefers,o=0,n=c.length;n>o;o++)r=c[o],r.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+s.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},r.prototype.refresh=function(){"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},r.prototype.httpGet=function(t,r){var o,n;return this.cancelDefers.push(r),n=function(t){return function(e){return _.remove(t.cancelDefers,r),e}}(this),o={timeout:r.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),e.get(""+this.url+t,o).then(n,n)},r.prototype.httpPost=function(t,r,o){var n,i;return this.cancelDefers.push(o),i=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),n={timeout:o.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),e.post(""+this.url+t,r,n).then(i,i)},r.prototype.httpPut=function(t,r,o){var n,i;return this.cancelDefers.push(o),i=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),n={timeout:o.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),e.put(""+this.url+t,r,n).then(i,i)},r.end(),r}(n)}])},{"../utils/base64":26,"./DSDigest":10,"./DSObject":13,"./util":18}],10:[function(t,e,r){var o,n,i;n=t("./util").assert,i=t("./util").error,e.exports=o=function(){function t(){}var e,r,o,s;return r=0,e=0,o={},s=function(){var t,r,n,i,a,c,u;i=!0;for(a in o){i=!1;break}if(!i){e++,u=o,o={};for(t in u){r=u[t];for(c in r)(n=r[c])(c)}e--,s()}},t.block=function(t){e++;try{return t()}finally{0===--e&&s()}},t.render=function(t,r,s){var a;n&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof r&&r.length>0||i.invalidArg("key"),"function"!=typeof s&&i.invalidArg("func")),0===e?s(r):(a=o.hasOwnProperty(t)?o[t]:o[t]={},a[r]=s)},t.forget=function(t,r){var s;n&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof r&&r.length>0||i.invalidArg("key")),0!==e&&o.hasOwnProperty(t)&&(s=o[t],delete s[r])},t}()},{"./util":18}],11:[function(t,e,r){var o,n,i,s,a,c,u=function(t,e){function r(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,i=t("./DSObjectBase"),n=t("./DSObject"),s=t("./DSSet"),e.exports=o=function(t){function e(){return r.apply(this,arguments)}var r;return u(e,t),e.begin("DSDocument"),r=function(t,r){if(n.call(this,t,r),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")},e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;n.end.call(this),e=this,this.Editable=t=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}var o,p,l,d;u(r,t),r.begin(e.docType+".Editable"),delete r.prototype.$ds_docType,r.ds_editable=!0,r.prototype.__init=null,r.ds_dstr.push(function(){var t,e,r,o,n;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(r in t)e=t[r],(o=e.s)instanceof i&&o.release(this),(n=e.v)instanceof i&&n.release(this)}),r.prototype.init=function(t,r,o){var i,u,p,l,d;if(a&&((null===t||t.__proto__.constructor!==e)&&c.invalidArg("serverDoc"),null!==r&&r instanceof s||c.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof o&&c.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=r,o){p=this.__change=o;for(u in p)i=p[u],(d=i.v)instanceof n&&d.addRef(this),(l=i.s)instanceof n&&l.addRef(this);this.addRef(this),r.add(this,this)}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},r.prototype.__onChange=function(t,e,r,o){var n,s,a,c,u,p,l,d,f,h;if((n=this.__change)&&n.hasOwnProperty(e)&&t.__props[e].equal(h=(l=n[e]).v,r)){for(this.$ds_chg.$ds_hist.setSameAsServer(this,e),(f=l.s)instanceof i&&f.release(this),h instanceof i&&h.release(this),delete n[e],s=!0,a=0,u=n.length;u>a;a++)if(e=n[a],"__error"!==e&&"__refreshView"!==e){s=!1;break}s&&(delete this.__change,this.$ds_chg.remove(this))}else if(this.$ds_evt)for(d=this.$ds_evt,c=d.length-1;c>=0;c+=-1)p=d[c],p.__onChange.call(p,this,e,r,o)},l=r.prototype.__props=e.prototype.__props,r.prototype.get=function(t){return a&&(l.hasOwnProperty(t)||c.invalidProp(this,t)),this[t]},r.prototype.set=function(t,e){return a&&(l.hasOwnProperty(t)||c.invalidProp(this,t)),this[t]=e},d=e.prototype.__props;for(o in d)p=d[o],p.noneditable||!function(t,e,i){var s;return Object.defineProperty(r.prototype,t,{get:s=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(r){var u,p,l,d,f,h,m,y,v,_,g,w;if(a&&"undefined"==typeof(r=e(w=r))&&c.invalidValue(this,t,w),!i(m=s.call(this),r)){if(r instanceof n&&r.addRef(this),u=this.__change)if(i(g=this.$ds_doc[t],r)){this.$ds_chg.$ds_hist.add(this,t,void 0,(p=u[t]).v),(w=p.v)instanceof n&&w.release(this),(_=p.s)instanceof n&&_.release(this),delete u[t],l=!0;for(o in u)if("__error"!==o&&"__refreshView"!==o){l=!1;break}if(l){if(this.$ds_evt)for(y=this.$ds_evt,d=y.length-1;d>=0;d+=-1)h=y[d],h.__onChange.call(h,this,t,r,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(p=u[t])?(this.$ds_chg.$ds_hist.add(this,t,r,p.v),(w=p.v)instanceof n&&w.release(this),p.v=r):(g instanceof n&&g.addRef(this),u[t]={v:r,s:g},this.$ds_chg.$ds_hist.add(this,t,r,void 0));else u=this.__change={},m instanceof n&&m.addRef(this),u[t]={v:r,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,r,void 0);if(this.$ds_evt)for(v=this.$ds_evt,f=v.length-1;f>=0;f+=-1)h=v[f],h.__onChange.call(h,this,t,r,m)}}})}(p.name,p.valid,p.equal);return n.end.call(r),r}(e)},e}(n)},{"./DSObject":13,"./DSObjectBase":14,"./DSSet":16,"./util":18}],12:[function(t,e,r){var o,n,i,s,a,c,u,p=function(t,e){function r(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;u=t("./util"),i=t("./util").assert,c=t("./util").traceRefs,a=t("./util").totalReleaseVerb,s=t("./util").error,n=t("./DSObjectBase"),e.exports=o=function(t){function e(){return r.apply(this,arguments)}var r;return p(e,t),e.begin("DSList"),r=function(t,e,r){n.call(this,t,e),i&&!r instanceof n&&s.notDSObjectClass(r),this.type=r,this.items=[]},e.ds_dstr.push(function(){var t,e,r,o;for(r=this.items,t=0,e=r.length;e>t;t++)o=r[t],o.release(this)}),e.prototype.merge=function(t,e){var r,o,p,l,d,f,h,m,y,v;for(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),_.isArray(e)||s.invalidArg("newList")),l=this.items,v=this.type,d=0,h=l.length;h>d;d++)p=l[d],p.release(this);for(l.length=0,r=f=0,m=e.length;m>f;r=++f)p=e[r],!p instanceof v&&s.invalidListValue(this,r,p),c&&(y=p.$ds_referries,0===y.length?console.error(n.desc(DSDitem)+": Empty $ds_referries"):(o=y.lastIndexOf(t))<0?console.error(n.desc(this)+": Referry not found: "+n.desc(t)):(a&&(console.info(++u.serviceOwner.msgCount+": transfer: "+n.desc(p)+", refs: "+this.$ds_ref+", from: "+n.desc(t)+", to: "+n.desc(this)),u.serviceOwner.msgCount===window.totalBreak),y[o]=this)),l.push(p);return l},e.end(),e}(n)},{"./DSObjectBase":14,"./util":18}],13:[function(t,e,r){var o,n,i,s,a,c,u,p,l,d=function(t,e){function r(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f={}.hasOwnProperty;c=t("./util").assert,p=t("./util").serviceOwner,l=t("./util").totalRelease,p=t("./util").serviceOwner,u=t("./util").error,i=t("./DSObjectBase"),a=t("./DSSet"),o=t("./DSList"),s=t("./DSPool"),e.exports=n=function(t){function e(){return r.apply(this,arguments)}var r;return d(e,t),e.desc=i.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof o||t instanceof s?l?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:l?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===p?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},r=function(t,e){if(i.call(this,t,e),c&&this.__proto__.constructor===i)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){l?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new s(p,e.docType+".pool",e,t),p.clearPool(function(){e.__pool.release(p),delete e.__pool})),e.__pool}}(this)}):this.pool=new s(p,this.docType+".pool",this,t)},e.propPool=function(t,e,r){var o,n;return c&&(i.isAssignableFrom(e)||u.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this),delete this[o]}),(n=this.prop({name:t,type:"pool",init:function(){return new s(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,r)},readonly:!0})).itemType=e,n},e.propSet=function(t,e){var r,o;return c&&(i.isAssignableFrom(e)||u.invalidArg("itemType")),r="_"+t,this.ds_dstr.push(function(){this[r].release(this)}),(o=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[r].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[r].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[r]}}),o},e.propList=function(t,e){var r,n;return c&&(i.isAssignableFrom(e)||u.invalidArg("itemType")),r="_"+t,this.ds_dstr.push(function(){this[r].release(this)}),(n=this.prop({name:t,type:"list",init:function(){return new o(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[r].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[r]}}),n},e}(i)},{"./DSList":12,"./DSObjectBase":14,"./DSPool":15,"./DSSet":16,"./util":18}],14:[function(t,e,r){var o,n,i,s,a,c,u,p,l;l=t("./util"),n=t("./util").assert,u=t("./util").traceData,s=t("./util").serviceOwner,p=t("./util").traceRefs,a=t("./util").totalRelease,c=t("./util").totalReleaseVerb,i=t("./util").error,e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,r,o,s,d,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&i.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=r=null,(window.totalReleaseReset=function(){r=0,window.totalPool=h={},l.serviceOwner.start(),l.serviceOwner.msgCount=0})(),window.totalRelease=function(){return l.serviceOwner.stop(),h}),e=function(e,o){var s,u,d;if(n){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBаse directly");"object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry"),"string"!=typeof o&&i.invalidArg("key")}if(this.$ds_key=o,this.$ds_ref=1,a&&(h[this.$ds_globalId=++r]=this,c&&(console.info(++l.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),l.serviceOwner.msgCount===window.totalBreak)),p&&(this.$ds_referries=[e]),s=this.__proto__.__init)for(u in s)d=s[u],this[u]="function"==typeof d?d.call(this):d;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(n&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),0===this.$ds_ref)throw new Error("addRef() on already fully released object");return p&&this.$ds_referries.push(e),this.$ds_ref++,c&&(console.info(++l.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),l.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var r,o;if(n&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),c&&(console.info(++l.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),l.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(p&&((r=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(r,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((o=this.$ds_pool).watchOn&&(n&&(_.find(this.$ds_evt,function(t){return function(t){return t===o}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,o)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+":"+this.$ds_key+("object"==typeof this.$ds_pool?"@"+this.$ds_pool:"")},t.prototype.writeMap=function(){var t,e,r,o;o={},r=this.__proto__.__props;for(e in r)t=r[e],t.hasOwnProperty("write")&&(o[e]=t.write(this["_"+e]));return o},t.prototype.readMap=function(t){var e,r,o,n;o=this.__proto__.__props;for(r in t)n=t[r],o.hasOwnProperty(r)&&(e=o[r]).hasOwnProperty("read")?this[r]=e.read(n):console.error("Unexpected property "+r)},t.begin=function(t){var e;n&&"string"!=typeof t&&i.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,r,o;for(r=0,o=t.length;o>r;r++)e=t[r],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,r;for(r=e.length-1;r>=0;r+=-1)t=e[r],t.call(this)})},t.prop=function(t){var e,r,o,s,a,c,u,p,l,d;if(n){if("object"!=typeof t&&i.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(o=t.init)?o():o))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set")}if(this.prototype.hasOwnProperty("__init")?n&&this.prototype.__props.hasOwnProperty(t.name)&&i.duplicatedProperty(this,t.name):(this.prototype.__init=(p=this.__super__.__init)?_.clone(p):{},u=this.prototype.__props=(l=this.__super__.__props)?_.clone(l):{},this.prototype.get=function(t){return n&&(u.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return n&&(u.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e}),c=this.prototype.__props[t.name]={name:t.name,type:t.type,write:t.write||function(t){return null===t?null:t.valueOf()},read:t.read||function(t){return t},equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){
return null===t?"":t.toString()},readonly:t.readonly||!1},t.hasOwnProperty("init"))d=c.valid=t.valid,c.init=this.prototype.__init[s="_"+(a=t.name)]=t.init,Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[s]},set:t.set||(t.readonly?function(t){i.propIsReadOnly(this,a)}:function(t){var r,o,n,c,u;if("undefined"==typeof(t=d(u=t))&&i.invalidValue(this,a,u),!e(c=this[s],t)&&(this[s]=t,r=this.$ds_evt))for(o=r.length-1;o>=0;o+=-1)n=r[o],n.__onChange.call(n,this,a,t,c)})});else if(t.hasOwnProperty("value"))c.value=t.value,c.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");c.func=r=t.func,c.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return r.call(this)},set:t.set||function(t){i.propIsReadOnly(this,a)}})}return c},t.propSimple=function(t,e,r,o){var s;return n&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&i.invalidArg("type"),o&&"function"!=typeof o&&i.invalidArg("valid"),"undefined"!=typeof r&&null!==r&&typeof r!==t&&i.invalidArg("init")),o=(s=o)?function(e){return null!==e&&typeof e!==t||void 0===(e=s(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop({name:e,type:t,init:"undefined"==typeof r?null:"object"!==t?r:function(){return _.clone(r)},valid:o,write:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()}})},t.propNum=function(t,e,r){this.propSimple("number",t,e,r)},t.propBool=function(t,e,r){return this.propSimple("boolean",t,e,r)},t.propStr=function(t,e,r){return this.propSimple("string",t,e,r)},t.propObj=function(t,e,r){return this.propSimple("object",t,e,r)},t.propDoc=function(e,r,o){var s,a;return n&&(o&&"function"!=typeof o&&i.invalidArg("valid"),"function"!=typeof r&&i.invalidArg("type"),!r instanceof t&&i.notDSObjectClass(r)),o=(a=o)?function(t){return(null===t||t instanceof r)&&void 0!==(t=a(t))?t:void 0}:function(t){return null===t||t instanceof r?t:void 0},s="_"+e,this.ds_dstr.push(function(){this[s]&&this[s].release(this)}),this.prop({name:e,type:r,init:null,valid:o,write:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof r.str?r.str:function(t){return null===t?"":t.$ds_key},set:function(t){var r,n,a,c,u;if("undefined"==typeof(t=o(u=t))&&i.invalidValue(this,e,u),(c=this[s])!==t){if(this[s]=t,t&&t.addRef(this),r=this.$ds_evt)for(n=r.length-1;n>=0;n+=-1)a=r[n],a.__onChange.call(a,this,e,t,c);c&&c.release(this)}}})},t.propCalc=function(t,e){return n&&(e&&"function"==typeof e||i.invalidArg("func")),this.prop({name:t,type:"calc",func:e})},t.propConst=function(t,e){return n&&"undefined"==typeof e&&i.invalidArg("value"),this.prop({name:t,type:"const",value:e})},t.propEnum=function(t,e){var r,o,s,a,c,u;if(n)for(_.isArray(e)&&0!==e.length||i.invalidArg("values"),r=0,o=e.length;o>r;r++)c=e[r];return u=(a=u)?function(t){return(null===t||e.indexOf(t)>=0)&&a(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},s="_"+t,this.prop({name:t,type:"enum",init:e[0],valid:u,set:function(e){var r,o,n,a,c;if("undefined"==typeof(e=u(c=e))&&i.invalidValue(this,t,c),(n=this[s])!==e&&(this[s]=e,this.$ds_evt))for(a=this.$ds_evt,r=a.length-1;r>=0;r+=-1)o=a[r],o.__onChange.call(o,this,t,e,n)}})},t.propMoment=function(t,e){var r;return n&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(r=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&r(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null})},t.propDuration=function(t,e){var r;return n&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(r=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&r(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null})},t.onAnyPropChange=function(t){n&&"function"!=typeof t&&i.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],d=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,r,o,s,a;for(n&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||i.invalidArg("sources")),o=-1,e=0,r=t.length;r>e;e++)a=t[e],a&&o<(s=d.indexOf(a.get("status")))&&(o=s);return-1===o?"nodata":d[o]},u&&(s=0,o=0),t.addDataSource=function(e){var r,a;if(n){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&i.invalidArg("onStatusChange")}this.ds_dataSource=!0,u&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++s,console.info(++o+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++o+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},r=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(r){var n,s,c,p,l;if("undefined"==typeof(r=a(l=r))&&i.invalidValue(this,"status",l),(c=this._status)!==r)for(u&&(console.info(++o+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+r+", old: "+c),o===window.sourceBreak),this._status=r,null!=e&&e.call(this,r,c),p=this.$ds_statusWatchers,n=p.length-1;n>=0;n+=-1)s=p[n],s.lst(this,r,c,s.unwatch)}}),r.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var r,o,s,a;return n&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("referry"),"function"!=typeof e&&i.invalidArg("listener")),(a=this.$ds_statusWatchers).push(s={lst:e}),this.addRef(t),s.unwatch=o=function(e){return function(r){return function(){r||(e.release(t),_.remove(a,s),r=!0)}}}(this)(!1),r=this.get("status"),"update"===r?(e(this,"ready","nodata",o),_.find(a,s)&&e(this,"update","ready",o)):e(this,r,"nodata",o),o}},t}()},{"./util":18}],15:[function(t,e,r){var o,n,i,s,a,c,u=function(t,e){function r(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,c=t("./util").traceWatch,n=t("./DSObjectBase"),o=t("./DSDigest"),e.exports=i=function(t){function e(){return r.apply(this,arguments)}var r,i;return u(e,t),e.begin("DSPool"),e.ds_dstr.push(function(){_.isEmpty(this.items)||console.error("Pool "+n.desc(this)+" is not empty. Items: ",this.items)}),r=function(t,e,r,o){var i;n.call(this,t,e),s&&(n.isAssignableFrom(r)||a.notDSObjectClass(r)),i=this.items={},this.type=r,o&&(this.watchOn=!0,this.evt=[])},i=function(t){var e,r,o,n,i;if((n=this.items).hasOwnProperty(t))for(o=n[t],i=this.evt,r=i.length-1;r>=0;r+=-1)e=i[r],e.lst(o)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&o.render(this.$ds_key,t.$ds_key,function(t){return function(e){i.call(t,e)}}(this))},e.prototype.find=function(t,e,r){var o,n;return s&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof r||"object"==typeof r&&null!==r||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(n=e)),r&&r.hasOwnProperty(e)?r[e]:(this.items.hasOwnProperty(e)?(o=this.items[e]).addRef(t):(o=this.items[e]=new this.type(t,e,n),o.$ds_pool=this,this.evt&&(o.hasOwnProperty("$ds_evt")?(s&&_.find(o.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),o.$ds_evt.push(this)):o.$ds_evt=[this],this.__onChange(o))),r?r[e]=o:o)},e.prototype.enableWatch=function(t){if(s&&!this.evt)throw new Error("Pool '"+n.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var r,o,i,u,p;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(i in e)if(u=e[i],"change"!==i&&"add"!==i&&"remove"!==i)throw new Error("Unexpected event listener: "+i);if(c&&(e.owner=t),!this.evt)throw new Error("Pool '"+n.desc(this)+"' watch functionality is not enabled")}return(o=this.evt).push(p={lst:e}),this.addRef(t),r=!0,function(e){return function(){r&&(r=!1,e.release(t),_.remove(o,p))}}(this)},e.end(),e}(n)},{"./DSDigest":10,"./DSObjectBase":14,"./util":18}],16:[function(t,e,r){var o,n,i,s,a,c,u,p,l,d=function(t,e){function r(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f={}.hasOwnProperty;l=t("./util"),i=t("./util").assert,u=t("./util").traceRefs,p=t("./util").traceWatch,c=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,s=t("./util").error,o=t("./DSObjectBase"),e.exports=n=function(t){function e(){return a.apply(this,arguments)}var r,n,a;return d(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,r,o;r=t=this.items;for(e in r)o=r[e],o.release(this),delete t[e]}),a=function(t,e,r,n){o.call(this,t,e),i&&(!r instanceof o&&s.notDSObjectClass(r),"object"!=typeof n&&void 0!==n&&s.invalidArg("data")),this.data=n,this.type=r,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,r,o;for(r=this.evt,e=r.length-1;e>=0;e+=-1)t=r[e],null!=(o=t.change)&&o.apply(t,arguments)},e.prototype.merge=function(t,e){var o,a,c;i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("newMap")),c=this.items;for(a in c)o=c[a],e.hasOwnProperty(a)||n.call(this,o);for(a in e){if(o=e[a],i&&a!==o.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+o.$ds_key);r.call(this,t,o)}return this.items},e.prototype.reset=function(){var t,e,r,o,n;for(t=this.evt,_.forEach(r=this.items,function(e){return function(r){var o,n,i;for(n=0,i=t.length;i>n;n++)o=t[n],"function"==typeof o.remove&&o.remove(r);r.release(e)}}(this)),e=0,n=r.length;n>e;e++)o=r[e],delete r[o]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&n.call(this,t)},n=function(t){var e,r,o;for(t.hasOwnProperty("$ds_evt")&&(i&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],o=this.evt,r=o.length-1;r>=0;r+=-1)e=o[r],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=r=function(t,e){var r,n,a,p,d,f;if(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),e instanceof this.type||s.invalidMapElementType(this,e)),(p=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(i&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],p[e.$ds_key]=e,u&&(f=e.$ds_referries,0===f.length?console.error(o.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(o.desc(this)+": Referry not found: "+o.desc(t)):(c&&(console.info(++l.serviceOwner.msgCount+": transfer: "+o.desc(e)+", refs: "+this.$ds_ref+", from: "+o.desc(t)+", to: "+o.desc(this)),l.serviceOwner.msgCount===window.totalBreak),f[a]=this)),d=this.evt,n=d.length-1;n>=0;n+=-1)r=d[n],"function"==typeof r.add&&r.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,r){var o,n,a,c;if(i){"object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("listener");for(a in e)if(c=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);p&&(e.owner=t)}return _.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(n=this.evt).push(e),r?void 0:(this.addRef(t),o=!0,function(r){return function(){o&&(o=!1,r.release(t),_.remove(n,function(t){return t===e}))}}(this))},e.prototype.addRef=function(t){var r;return 1===this.$ds_ref&&(r=this.data)&&1===++r.__busySets&&r.addRef(r.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var r;return e.__super__.release.call(this,t),1===this.$ds_ref&&(r=this.data)&&0===--r.__busySets&&r.release(r.__backRef),this},e.end(),e}(o)},{"./DSObjectBase":14,"./util":18}],17:[function(t,e,r){var o,n,i,s,a=function(t,e){function r(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,o=t("./DSObjectBase"),e.exports=n=function(t){function e(){return r.apply(this,arguments)}var r;return a(e,t),e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(r,o){var n;return i&&o&&"function"!=typeof o&&s.invalidArg("valid"),o=(n=o)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&n(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},t.prop({name:r,type:"DSTags",valid:o,read:function(t){return null!==t?new e(t):null},str:function(t){return t.value},init:null})}},e.ds_dstr.push(function(){var t,e;(function(){var r,n;r=this.map,n=[];for(t in r)e=r[t],n.push(e instanceof o);return n}).call(this)&&e.release(this)}),r=function(t){var r,n,a,c,u,p,l,d,f,h;if(i&&(1===arguments.length&&"object"==typeof(d=arguments[0])||"string"!=typeof t&&s.invalidArg("enums")),1===arguments.length&&"object"==typeof(d=arguments[0])){d.__proto__===e.prototype?(this.map=_.clone(d.map),this.value=d.value):(this.map=u=_.clone(t),this.value=_.sortBy(function(){var t;t=[];for(n in u)t.push(n);return t}()).join(", ")),p=this.map;for(a in p)h=p[a],h instanceof o&&h.addRef(this)}else{if(this.map=u={},"string"==typeof t)for(l=t.split(","),r=0,c=l.length;c>r;r++)f=l[r],u[f.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(n in u)t.push(n);return t}()).join(", ")}},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.clone=function(){return new e(this)},e.prototype.set=function(t,e){var r,n,a,c;return i&&("string"!=typeof t&&s.invalidArg("enumValue"),"undefined"==typeof e&&s.invalidArg("value")),e?(r=!(a=this.map).hasOwnProperty(t),e instanceof o&&e.addRef(this),(c=a[t])instanceof o&&c.release(this),a[t]=e,r||(this.value=_.sortBy(function(){var t;t=[];for(n in a)t.push(n);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((c=a[t])instanceof o&&c.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(n in a)t.push(n);return t}()).join(", ")),this},e.prototype.get=function(t){return i&&"string"!=typeof t&&s.invalidArg("enumValue"),this.map.hasOwnProperty(t)?this.map[t]:!1},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.diff=function(t){var r,o,n;return i&&("object"!=typeof t||t.__proto__!==e.prototype)&&s.invalidArg("src"),n=t.map,function(){var t;t=[];for(r in o=this.map)n.hasOwnProperty(r)||t.push("+"+r);return t}.call(this).concat(function(){var t;t=[];for(r in n)o.hasOwnProperty(r)||t.push("-"+r);return t}()).join(", ")},e.end(),e}(o)},{"./DSObjectBase":14,"./util":18}],18:[function(t,e,r){var o,n;e.exports=n={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,r,o,n,i,s,a;for(i=this.services,e=0,o=i.length;o>e;e++)a=i[e],a.release(this);if(this.poolCleaners)for(s=this.poolCleaners,r=0,n=s.length;n>r;r++)(t=s[r])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,r){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+r+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,r){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+r+"'")}}}},{}],19:[function(t,e,r){var o,n,i,s,a,c,u,p,l,d=function(t,e){function r(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(p=angular.module("data/dsDataService",[t("../../dscommon/DSDataSource"),t("../../app/config"),t("../../dscommon/DSDataSource"),t("../../app/data/teamwork/TWPeople"),t("../../app/data/PeopleWithJson"),t("./teamwork/TWProjects"),t("./teamwork/TWPeriodTimeTracking")])).name,a=t("../../dscommon/util").assert,l=t("../../dscommon/util").serviceOwner,u=t("../../dscommon/util").error,c=t("../../utils/base64"),o=t("../../dscommon/DSDataServiceBase"),i=t("../../app/models/Person"),s=t("../../app/models/Project"),n=t("../models/PeriodTimeTracking"),p.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),p.factory("dsDataService",["TWPeriodTimeTracking","PeopleWithJson","TWPeople","TWProjects","DSDataSource","config","$http","$rootScope","$q",function(t,e,r,a,u,p,f,h,m){var y;return y=function(l){function y(){var t;o.apply(this,arguments),this.set("dataSource",new u(this,"dataSource")).release(this),t=null,this.__unwatch2=h.$watch(function(){return[p.get("teamwork"),p.get("token")]},function(e){return function(r){var o,n,i;return n=r[0],i=r[1],n&&i?(t&&(t.resolve(),t=null),o=function(r,o){o||(console.error("error: ",r),t=null),e.get("dataSource").setConnection(null,null)},f.get(n+"authenticate.json",{timeout:(t=m.defer()).promise,headers:{Authorization:"Basic "+c.encode(i)}}).then(function(r){200===r.status?(t=null,p.set("currentUserId",r.data.account.userId),e.get("dataSource").setConnection(n,i)):o(r,0===r.status)},o),void 0):e.get("dataSource").setConnection(null,null)}}(this),!0)}return d(y,l),y.begin("DSDataService"),y.propDoc("dataSource",u),y.propSet("peopleSet",i),y.propSet("projectsSet",s),y.propSet("periodTimeTrackingSet",n),y.ds_dstr.push(function(){this.__unwatch2()}),y.prototype.refresh=function(){this.get("dataSource").refresh()},y.prototype.findDataSet=function(n,i){var s,c,u,p,l,d;switch(o.prototype.findDataSet.call(this,n,i),i.type.docType){case"Person":return i.source?(delete i.source,"function"==typeof(s=l=r.pool.find(this,i)).init&&s.init(this),(d=l.get("peopleSet")).addRef(n),l.release(this)):("function"==typeof(c=l=e.pool.find(this,i)).init&&c.init(this),(d=l.get("peopleSet")).addRef(n),l.release(this)),d;case"Project":return"function"==typeof(u=l=a.pool.find(this,i)).init&&u.init(this),(d=l.get("projectsSet")).addRef(n),l.release(this),d;case"PeriodTimeTracking":return"function"==typeof(p=l=t.pool.find(this,i)).init&&p.init(this),(d=l.get("timeTrackingSet")).addRef(n),l.release(this),d}},y.prototype.requestSources=function(t,e,r){throw o.prototype.requestSources.call(this,t,e,r),new Error("requestSources() is not implemented for reports.  It's not expected that DSView will be used")},y.end(),y}(o),l.add(new y(l,"dataService"))}])},{"../../app/config":1,"../../app/data/PeopleWithJson":2,"../../app/data/teamwork/TWPeople":4,"../../app/models/Person":5,"../../app/models/Project":6,"../../dscommon/DSDataServiceBase":8,"../../dscommon/DSDataSource":9,"../../dscommon/util":18,"../../utils/base64":26,"../models/PeriodTimeTracking":22,"./teamwork/TWPeriodTimeTracking":20,"./teamwork/TWProjects":21}],20:[function(t,e,r){var o,n,i,s,a,c,u,p,l,d,f,h,m=function(t,e){function r(){this.constructor=t}for(var o in e)y.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWPeriodTimeTracking",[t("../../../dscommon/DSDataSource")])).name,d=t("../../../dscommon/util").assert,f=t("../../../dscommon/util").error,i=t("../../../dscommon/DSObject"),o=t("../../../dscommon/DSData"),s=t("../../../dscommon/DSSet"),n=t("../../../dscommon/DSDigest"),u=t("../../../app/models/Person"),p=t("../../../app/models/Project"),c=t("../../models/PeriodTimeTracking"),l=500,a=50,h.factory("TWPeriodTimeTracking",["DSDataSource","$rootScope","$q",function(t,e,r){var f;return f=function(e){function f(){return f.__super__.constructor.apply(this,arguments)}return m(f,e),f.begin("LoadPeriodTimeTracking"),f.addPool(),f.propDoc("source",t),f.propDoc("people",s),f.propDoc("projects",s),f.propSet("timeTracking",c),f.propObj("cancel",null),f.ds_dstr.push(function(){this.__unwatchA(),this.__unwatch1(),this.__unwatch2()}),f.prototype.clear=function(){var t;"function"==typeof this.__unwatch1&&this.__unwatch1(),this.__unwatchA=null,"function"==typeof this.__unwatch2&&this.__unwatch2(),this.__unwatchB=null,o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},f.prototype.init=function(e){var r,o;if(!moment.isMoment(r=this.get("params").from))throw new Error("Missing params.from");if(!moment.isMoment(o=this.get("params").to))throw new Error("Missing params.to");if(!(o>r))throw new Error("Params.to is less or equal to params.from");this.set("people",e.findDataSet(this,{type:u,mode:"original"})).release(this),this.set("projects",e.findDataSet(this,{type:p,mode:"original"})).release(this),this.__unwatchA=t.setLoadAndRefresh.call(this,e),this.init=null},f.prototype.load=function(){var t,e,o,s;if(d&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(s=[e=this.get("people"),o=this.get("projects")],t=function(t){return function(){var p,d,f,h,m,y,v,_,g,w,S,D,O,b,P;if("ready"===i.integratedStatus(s)){t.__unwatch1(),t.__unwatch2(),D=c.pool.items;for(S in D)O=D[S],O.set("totalMin",0);w={},y={},h=t.get("params").from,b=t.get("params").to,m=function(r){var n,i,s,a,p,d,f,m,v,_;for(i=0,a=r.length;a>i;i++)if(s=r[i],(n=moment(s.date))>=h){if(_=s.id,m=parseInt(s["person-id"]),v=parseInt(s["project-id"]),p=60*parseInt(s.hours)+parseInt(s.minutes),n>=b)return!1;d=c.pool.find(t,m+"-"+v,w),(f=e.items[m])||(f=u.pool.find(t,"missing-"+m,y),f.set("id",m),f.set("missing",!0)),d.set("person",f),d.set("project",o.items[v]),d.set("totalMin",d.get("totalMin")+p)}return r.length===l},d=function(){var e,r;t.get("timeTrackingSet").merge(t,w);for(e in y)r=y[e],r.release(t);t._endLoad(!0)},v=function(e,r){var o,n;r||(console.error("error: ",e),t.set("cancel",null));for(o in taskTimeTrackingMap)n=taskTimeTrackingMap[o],n.release(t);t._endLoad(!1)},g={},_=function(e){g.hasOwnProperty(e)?n.block(function(){return m(g[e])})?_(e+1):d():t.get("source").httpGet("time_entries.json?page="+e+"&pageSize="+l,t.set("cancel",r.defer())).then(function(r){var o;200===r.status?(t.set("cancel",null),(o=r.data["time-entries"])?moment(o[o.length-1].date)<h?o.length===l?_(e+1):d():n.block(function(){return m(o)})?_(e+1):d():d()):v(r,0===r.status)},v)},P=1,p=a,(f=function(e){t.get("source").httpGet("time_entries.json?page="+e+"&pageSize="+l,t.set("cancel",r.defer())).then(function(r){var o,i;200===r.status?(t.set("cancel",null),(o=r.data["time-entries"])?moment(o[0].date)>=h?P===e?(config.set("histStart",e),n.block(function(){return m(o)})?_(e+1):d()):(g[e]=o,f(P+Math.floor(((p=e)-P)/2))):moment(o[o.length-1].date)<h?p===e?(i=[p,p+a],P=i[0],p=i[1],f(p)):p===e+1?d():(P=e+1,f(P+Math.floor((p-P)/2))):n.block(function(){return m(o)})?_(e+1):d():f(P+Math.floor(((p=e)-P)/2))):v(r,0===r.status)},v)})(p)}}}(this),this.__unwatch1=e.watchStatus(this,t),this.__unwatch2=o.watchStatus(this,t))},f.end(),f}(o)}])},{"../../../app/models/Person":5,"../../../app/models/Project":6,"../../../dscommon/DSData":7,"../../../dscommon/DSDataSource":9,"../../../dscommon/DSDigest":10,"../../../dscommon/DSObject":13,"../../../dscommon/DSSet":16,"../../../dscommon/util":18,"../../models/PeriodTimeTracking":22}],21:[function(t,e,r){var o,n,i,s,a=function(t,e){function r(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWProjects",[t("../../../dscommon/DSDataSource"),t("../../../app/data/teamwork/DSDataTeamworkPaged")])).name,n=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../../app/models/Project"),s.factory("TWProjects",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,r,n){var i;return i=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return a(r,t),r.begin("TWProjects"),r.addPool(),r.propSet("projects",o),r.ds_dstr.push(function(){this.__unwatch2()}),r.prototype.init=function(t){this.set("request","projects.json?status=ALL"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null,this.projectsMap={}},r.prototype.importResponse=function(t){var e,r,n,i,s,a;for(e=0,a=t.projects,r=0,i=a.length;i>r;r++)n=a[r],++e,s=o.pool.find(this,""+n.id,this.projectsMap),s.set("id",parseInt(n.id)),s.set("name",n.name),s.set("status",n.status);return e},r.prototype.finalizeLoad=function(){this.get("projectsSet").merge(this,this.projectsMap)},r.end(),r}(t)}])},{"../../../app/data/teamwork/DSDataTeamworkPaged":3,"../../../app/models/Project":6,"../../../dscommon/DSDataSource":9,"../../../dscommon/util":18}],22:[function(t,e,r){var o,n,i,s,a=function(t,e){function r(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../dscommon/DSObject"),i=t("../../app/models/Person"),s=t("../../app/models/Project"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("PeriodTimeTracking"),e.addPool(),e.propDoc("person",i),e.propDoc("project",s),e.propNum("totalMin",0),e.end(),e}(o)},{"../../app/models/Person":5,"../../app/models/Project":6,"../../dscommon/DSObject":13}],23:[function(t,e,r){var o,n,i,s,a,c;o=t("../../static/libs/FileSaver.js/FileSaver"),c=t("../dscommon/util").serviceOwner,n=t("./models/PeriodTimeTracking"),e.exports=(a=angular.module("reports-app",["ui.bootstrap",t("./showSpinner"),t("./data/dsDataService"),t("./data/teamwork/TWPeriodTimeTracking")])).name,s=function(){function t(t){this.name=t,this.range={s:{c:1e7,r:1e7},e:{c:0,r:0}},this.ws={}}var e;return e=new Date(Date.UTC(1899,11,30)),t.prototype.set=function(t,r,o,n){var i,s,a,c,u;(c=this.range).s.r>r&&(c.s.r=r),c.s.c>t&&(c.s.c=t),c.e.r<r&&(c.e.r=r),c.e.c<t&&(c.e.c=t),s=XLSX.utils.encode_cell({c:t,r:r}),null===u?delete this.ws[s]:(a=moment.isMoment(u))||u instanceof Date?(a&&(u=u.asDate()),this.ws[s]={v:(o.getTime-e)/864e5,t:"n",z:XLSX.SSF._table[14]}):(i=this.ws[s]={v:o,t:"number"==typeof o?"n":"boolean"==typeof o?"b":"s"},"number"==typeof n&&(i.z=XLSX.SSF._table[n]))},t.prototype.build=function(){this.ws["!ref"]=XLSX.utils.encode_range(this.range)},t}(),i=function(){function t(){this.sheets=[]}var e;return t.prototype.addSheet=function(t){var e;if(!("string"==typeof t&&t.length>0))throw new Error("Invalid argument 'name'");return this.sheets.push(e=new s(t)),e},t.prototype.build=function(){var t;return{SheetNames:function(){var e,r,o,n;for(o=this.sheets,n=[],e=0,r=o.length;r>e;e++)t=o[e],n.push(t.name);return n}.call(this),Sheets:function(e){return function(){var r,o,n,i;for(i={},n=e.sheets,r=0,o=n.length;o>r;r++)t=n[r],t.build(),i[t.name]=t.ws;return i}}(this)()}},e=function(t){var e,r,o;for(e=new ArrayBuffer(t.length),o=new Uint8Array(e),r=0;r!==t.length;)o[r]=255&t.charCodeAt(r),++r;return e},t.prototype.saveFromBrowser=function(t,r){var n,i;if(!("string"==typeof t&&t.length>0))throw new Error("Invalid argument 'filename'");if("undefined"!=typeof r&&"function"!=typeof r)throw new Error("Invalid argument 'beforeSave'");i={bookType:"xlsx",bookSST:!1,type:"binary"},n=XLSX.write(this.build(),i),"function"==typeof r&&r(),o.saveAs(new Blob([e(n)],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t)},t}(),a.directive("reports",["TWPeriodTimeTracking","dsDataService","$rootScope",function(t,e,r){return{restrict:"A",scope:!0,link:function(t,o,s){t.progressMessage=null,t.period=moment().startOf("month").add(-1,"month").toDate(),t.selectPeriod=!1,t.generateReport=function(){var o,s,a,u;t.progressMessage="Идет загрузка данных...",o=moment(t.period),a=moment(o).add(1,"month"),s=e.findDataSet(c,{type:n,mode:"original",from:o,to:a}),u=s.watchStatus(c,function(e,o){var n,a,c,p,l,d,f,h,m,y,v;if("ready"===o){u(),c={},m={},y=s.items;for(n in y)v=y[n],c.hasOwnProperty(l=(p=v.get("person")).get("id"))||(c[l]=p),m.hasOwnProperty(f=(d=v.get("project")).get("id"))||(m[f]=d);a=function(){var t;t=[];for(l in c)p=c[l],t.push(p);return t}().sort(function(t,e){var r,o,n,i;if((r=t.get("missing"))!==(n=e.get("missing")))return r?1:-1;if(!r){if((o=t.get("name"))<(i=e.get("name")))return-1;if(o>i)return 1}return t.get("id")<e.get("id")?-1:1}),h=function(){var t;t=[];for(f in m)d=m[f],t.push(d);return t}().sort(function(t,e){var r,o;return(r=t.get("name"))<(o=e.get("name"))?-1:r>o?1:t.get("id")<e.get("id")?-1:1}),t.progressMessage="Формируем MS Excel файл ...",r.$$phase||r.$digest(),t.$evalAsync(function(){var e,o,n,c,u,l,f,m,y,_;for(_=new i,y=_.addSheet(moment(t.period).format("MM.YYYY")),e=n=0,c=a.length;c>n;e=++n)p=a[e],y.set(1+e,0,p.get("missing")?p.get("id"):p.get("name"));for(e=f=0,u=h.length;u>f;e=++f)for(d=h[e],y.set(0,1+e,d.get("name")),o=m=0,l=a.length;l>m;o=++m)p=a[o],(v=s.items[p.get("id")+"-"+d.get("id")])&&y.set(1+o,1+e,v.get("totalMin")/60,2);_.saveFromBrowser("Часы по людям по проектам за "+moment(t.period).format("MM.YYYY")+".xlsx",function(){t.progressMessage=null,r.$$phase||r.$digest()})})}})}}}}])},{"../../static/libs/FileSaver.js/FileSaver":27,"../dscommon/util":18,"./data/dsDataService":19,"./data/teamwork/TWPeriodTimeTracking":20,"./models/PeriodTimeTracking":22,"./showSpinner":24}],24:[function(t,e,r){var o,n;e.exports=(o=angular.module("showSpinner",[])).name,n={lines:13,length:1,radius:8,color:"#000",opacity:.2},o.directive("showSpinner",[function(){return{restrict:"A",link:function(t,e,r){var o;o=new Spinner(n).spin(),e[0].appendChild(o.el),t.$on("$destroy",function(){o.stop()})}}}])},{}],25:[function(t,e,r){!function(t,e,r){"use strict";function o(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var n=e.isDefined,i=e.isUndefined,s=e.isNumber,a=e.isObject,c=e.isArray,u=e.extend,p=e.toJson,l=e.fromJson,d=e.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,r,d){var f,h=this,m=h.prefix,y=h.cookie,v=h.notify,_=h.storageType;r?r[0]&&(r=r[0]):r=document,
"."!==m.substr(-1)&&(m=m?m+".":"");var g=function(t){return m+t},w=function(){try{var r=_ in e&&null!==e[_],o=g("__"+Math.round(1e7*Math.random()));return r&&(f=e[_],f.setItem(o,""),f.removeItem(o)),r}catch(n){return _="cookie",t.$broadcast("LocalStorageModule.notification.error",n.message),!1}}(),S=function(e,r){if(i(r)?r=null:(a(r)||c(r)||s(+r||r))&&(r=p(r)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:r,storageType:"cookie"}),k(e,r);try{(a(r)||c(r))&&(r=p(r)),f&&f.setItem(g(e),r),v.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:r,storageType:h.storageType})}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),k(e,r)}return!0},D=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),T(e);var r=f?f.getItem(g(e)):null;return r&&"null"!==r?"{"===r.charAt(0)||"["===r.charAt(0)||o(r)?l(r):r:null},O=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),A(e);try{f.removeItem(g(e)),v.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.message),A(e)}return!0},b=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,r=[];for(var o in f)if(o.substr(0,e)===m)try{r.push(o.substr(e))}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.Description),[]}return r},P=function(e){e=e||"";var r=m.slice(0,-1),o=new RegExp(r+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),j();var n=m.length;for(var i in f)if(o.test(i))try{O(i.substr(n))}catch(s){return t.$broadcast("LocalStorageModule.notification.error",s.message),j()}return!0},$=function(){try{return e.navigator.cookieEnabled||"cookie"in r&&(r.cookie.length>0||(r.cookie="test").indexOf.call(r.cookie,"test")>-1)}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),!1}}(),k=function(e,o){if(i(o))return!1;if((c(o)||a(o))&&(o=p(o)),!$)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var n="",s=new Date,u="";if(null===o?(s.setTime(s.getTime()+-864e5),n="; expires="+s.toGMTString(),o=""):0!==y.expiry&&(s.setTime(s.getTime()+24*y.expiry*60*60*1e3),n="; expires="+s.toGMTString()),e){var l="; path="+y.path;y.domain&&(u="; domain="+y.domain),r.cookie=g(e)+"="+encodeURIComponent(o)+n+l+u}}catch(d){return t.$broadcast("LocalStorageModule.notification.error",d.message),!1}return!0},T=function(e){if(!$)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=r.cookie&&r.cookie.split(";")||[],n=0;n<o.length;n++){for(var i=o[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(g(e)+"=")){var s=decodeURIComponent(i.substring(m.length+e.length+1,i.length));try{var a=JSON.parse(s);return l(a)}catch(c){return s}}}return null},A=function(t){k(t,null)},j=function(){for(var t=null,e=m.length,o=r.cookie.split(";"),n=0;n<o.length;n++){for(t=o[n];" "===t.charAt(0);)t=t.substring(1,t.length);var i=t.substring(e,t.indexOf("="));A(i)}},R=function(){return _},E=function(t,e,r,o){o=o||e;var i=D(o);return null===i&&n(r)?i=r:a(i)&&a(r)&&(i=u(r,i)),d(e).assign(t,i),t.$watch(e,function(t){S(o,t)},a(t[e]))},C=function(){for(var t=0,r=e[_],o=0;o<r.length;o++)0===r.key(o).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:R,set:S,add:S,get:D,keys:b,remove:O,clearAll:P,bind:E,deriveKey:g,length:C,cookie:{isSupported:$,set:k,add:k,get:T,remove:A,clearAll:j}}}]})}(window,window.angular)},{}],26:[function(t,e,r){var o;o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,r,n,i,s,a,c,u,p;for(p="",e=void 0,r=void 0,n="",i=void 0,s=void 0,a=void 0,c="",u=0;;)if(e=t.charCodeAt(u++),r=t.charCodeAt(u++),n=t.charCodeAt(u++),i=e>>2,s=(3&e)<<4|r>>4,a=(15&r)<<2|n>>6,c=63&n,isNaN(r)?a=c=64:isNaN(n)&&(c=64),p=p+o.charAt(i)+o.charAt(s)+o.charAt(a)+o.charAt(c),e=r=n="",i=s=a=c="",!(u<t.length))break;return p},decode:function(t){var e,r,n,i,s,a,c,u,p,l;for(l="",r=void 0,n=void 0,i="",s=void 0,a=void 0,c=void 0,u="",p=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(s=o.indexOf(t.charAt(p++)),a=o.indexOf(t.charAt(p++)),c=o.indexOf(t.charAt(p++)),u=o.indexOf(t.charAt(p++)),r=s<<2|a>>4,n=(15&a)<<4|c>>2,i=(3&c)<<6|u,l+=String.fromCharCode(r),64!==c&&(l+=String.fromCharCode(n)),64!==u&&(l+=String.fromCharCode(i)),r=n=i="",s=a=c=u="",!(p<t.length))break;return l}}},{}],27:[function(t,e,r){var o=o||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,r=function(){return t.URL||t.webkitURL||t},o=e.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in o,i=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},s=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),a=t.webkitRequestFileSystem,c=t.requestFileSystem||a||t.mozRequestFileSystem,u=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},p="application/octet-stream",l=0,d=500,f=function(e){var o=function(){"string"==typeof e?r().revokeObjectURL(e):e.remove()};t.chrome?o():setTimeout(o,d)},h=function(t,e,r){e=[].concat(e);for(var o=e.length;o--;){var n=t["on"+e[o]];if("function"==typeof n)try{n.call(t,r||t)}catch(i){u(i)}}},m=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t},y=function(e,u,d){d||(e=m(e));var y,v,_,g=this,w=e.type,S=!1,D=function(){h(g,"writestart progress write writeend".split(" "))},O=function(){if(v&&s&&"undefined"!=typeof FileReader){var o=new FileReader;return o.onloadend=function(){var t=o.result;v.location.href="data:attachment/file"+t.slice(t.search(/[,;]/)),g.readyState=g.DONE,D()},o.readAsDataURL(e),void(g.readyState=g.INIT)}if((S||!y)&&(y=r().createObjectURL(e)),v)v.location.href=y;else{var n=t.open(y,"_blank");void 0==n&&s&&(t.location.href=y)}g.readyState=g.DONE,D(),f(y)},b=function(t){return function(){return g.readyState!==g.DONE?t.apply(this,arguments):void 0}},P={create:!0,exclusive:!1};return g.readyState=g.INIT,u||(u="download"),n?(y=r().createObjectURL(e),void setTimeout(function(){o.href=y,o.download=u,i(o),D(),f(y),g.readyState=g.DONE})):(t.chrome&&w&&w!==p&&(_=e.slice||e.webkitSlice,e=_.call(e,0,e.size,p),S=!0),a&&"download"!==u&&(u+=".download"),(w===p||a)&&(v=t),c?(l+=e.size,void c(t.TEMPORARY,l,b(function(t){t.root.getDirectory("saved",P,b(function(t){var r=function(){t.getFile(u,P,b(function(t){t.createWriter(b(function(r){r.onwriteend=function(e){v.location.href=t.toURL(),g.readyState=g.DONE,h(g,"writeend",e),f(t)},r.onerror=function(){var t=r.error;t.code!==t.ABORT_ERR&&O()},"writestart progress write abort".split(" ").forEach(function(t){r["on"+t]=g["on"+t]}),r.write(e),g.abort=function(){r.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),O)}),O)};t.getFile(u,{create:!1},b(function(t){t.remove(),r()}),b(function(t){t.code===t.NOT_FOUND_ERR?r():O()}))}),O)}),O)):void O())},v=y.prototype,_=function(t,e,r){return new y(t,e,r)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,r){return r||(t=m(t)),navigator.msSaveOrOpenBlob(t,e||"download")}:(v.abort=function(){var t=this;t.readyState=t.DONE,h(t,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,_)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof e&&e.exports?e.exports.saveAs=o:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return o})},{}]},{},[23]);