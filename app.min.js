!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";function r(t,e,n,r){this.array=t,this.start=e||0,this.stop=n||1/0,this.step=r||1}var o=t("./iteration");e.exports=r,r.prototype.next=function(){var t;return this.start<Math.min(this.array.length,this.stop)?(t=new o(this.array[this.start],(!1),this.start),this.start+=this.step):t=new o((void 0),(!0)),t}},{"./iteration":2}],2:[function(t,e,n){"use strict";function r(t,e,n){this.value=t,this.done=e,this.index=n}e.exports=r,r.prototype.equals=function(t){return"object"==typeof t&&t.value===this.value&&t.done===this.done&&t.index===this.index}},{}],3:[function(t,e,n){"use strict";function r(t,e,n,r){this.object=t,this.keysIterator=new i(Object.keys(t),e,n,r)}var o=t("./iteration"),i=t("./array-iterator");e.exports=r,r.prototype.next=function(){var t=this.keysIterator.next();if(t.done)return t;var e=t.value;return new o(this.object[e],(!1),e)}},{"./array-iterator":1,"./iteration":2}],4:[function(t,e,n){"use strict";function r(t,e,n,r){if(t){if(Array.isArray(t))return new o(t,e,n,r);if("function"==typeof t.next)return t;if("function"==typeof t.iterate)return t.iterate(e,n,r);if("object"==typeof t)return new i(t);throw new TypeError("Can't iterate "+t)}return empty}var o=t("./array-iterator"),i=t("./object-iterator");e.exports=r},{"./array-iterator":1,"./object-iterator":3}],5:[function(t,e,n){function r(t){if(c===setTimeout)return setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function i(){h&&d&&(h=!1,d.length?f=d.concat(f):m=-1,f.length&&s())}function s(){if(!h){var t=r(i);h=!0;for(var e=f.length;e;){for(d=f,f=[];++m<e;)d&&d[m].run();m=-1,e=f.length}d=null,h=!1,o(t)}}function a(t,e){this.fun=t,this.array=e}function u(){}var c,l,p=e.exports={};!function(){try{c=setTimeout}catch(t){c=function(){throw new Error("setTimeout is not defined")}}try{l=clearTimeout}catch(t){l=function(){throw new Error("clearTimeout is not defined")}}}();var d,f=[],h=!1,m=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f.push(new a(t,e)),1!==f.length||h||r(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],6:[function(t,e,n){"use strict";function r(){if(u.length)throw u.shift()}function o(t){var e;e=a.length?a.pop():new i,e.task=t,s(e)}function i(){this.task=null}var s=t("./raw"),a=[],u=[],c=s.makeRequestCallFromTimer(r);e.exports=o,i.prototype.call=function(){try{this.task.call()}catch(t){o.onerror?o.onerror(t):(u.push(t),c())}finally{this.task=null,a[a.length]=this}}},{"./raw":7}],7:[function(t,e,n){(function(t){"use strict";function n(t){a.length||(s(),u=!0),a[a.length]=t}function r(){for(;c<a.length;){var t=c;if(c+=1,a[t].call(),c>l){for(var e=0,n=a.length-c;e<n;e++)a[e]=a[e+c];a.length-=c,c=0}}a.length=0,c=0,u=!1}function o(t){var e=1,n=new p(t),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){e=-e,r.data=e}}function i(t){return function(){function e(){clearTimeout(n),clearInterval(r),t()}var n=setTimeout(e,0),r=setInterval(e,50)}}e.exports=n;var s,a=[],u=!1,c=0,l=1024,p=t.MutationObserver||t.WebKitMutationObserver;s="function"==typeof p?o(r):i(r),n.requestFlush=s,n.makeRequestCallFromTimer=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(t,e,n){(function(n){"use strict";function r(t){return t===Object(t)}function o(t,e){if(R&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&t.stack.indexOf(W)===-1){for(var n=[],r=e;r&&q.get(r);r=q.get(r).became)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var o=n.join("\n"+W+"\n");t.stack=i(o)}}function i(t){if(f.isIntrospective)return t;for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var o=e[r];u(o)||s(o)||!o||n.push(o)}return n.join("\n")}function s(t){return t.indexOf("(module.js:")!==-1||t.indexOf("(node.js:")!==-1}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function u(t){var e=a(t);if(!e)return!1;var n=e[0],r=e[1];return n===E&&r>=V&&r<=G}function c(){if(R)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=a(n);if(!r)return;return E=r[0],r[1]}}function l(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&(n?console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack):console.warn(e+" is deprecated.",new Error("").stack)),t.apply(this,arguments)}}function p(t){var e=q.get(t);return e&&e.became?(e=d(e),q.set(t,e),e):e}function d(t){return t.became?(t.became=d(t.became),t.became):t}function f(t){return T(t)?t:O(t)?(U.has(t)||U.set(t,new D(new L(t))),U.get(t)):new D(new j(t))}function h(t){return new D(new A(t))}function m(){var t=new x,e=new D(t),n=new $(e);if(f.longStackSupport&&R)try{throw new Error}catch(r){e.stack=r.stack.substring(r.stack.indexOf("\n")+1)}return n}function y(t){function e(){a=-(1/0);for(var t=0;t<s.length;t++)s[t]>a&&(a=s[t])}if(T(t))return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("Q.all no longer directly unwraps a promise. Use Q(array).all()"),f(t).all();var n,r=0,o=m(),i=Array(t.length),s=[],a=-(1/0);return Array.prototype.forEach.call(t,function(u,c){var l;T(u)&&"fulfilled"===(l=p(u)).state?i[c]=l.value:(++r,u=f(u),u.then(function(t){i[c]=t,0===--r&&o.resolve(i)},o.reject),u.observeEstimate(function(r){var i=s[c];s[c]=r,r>a?a=r:i===a&&r<=a&&e(),s.length===t.length&&a!==n&&(o.setEstimate(a),n=a)}))}),0===r&&o.resolve(i),o.promise}function g(t){return T(t)?("undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("Q.allSettled no longer directly unwraps a promise. Use Q(array).allSettled()"),f(t).allSettled()):y(t.map(function(t){function e(){return t.inspect()}return t=f(t),t.then(e,e)}))}function v(t,e,n){return f(t).spread(e,n)}function _(t){return new D(function(e){t.forEach(function(t){f(t).then(e.resolve,e.reject)})})}function w(t){return function(){for(var e=new Array(arguments.length),n=0;n<arguments.length;n++)e[n]=arguments[n];return f(t).apply(this,e)}}function k(t){return function(){function e(t,e){var i;try{i=n[t](e)}catch(s){return h(s)}return i.done?f(i.value):f(i.value).then(r,o)}var n=t.apply(this,arguments),r=e.bind(e,"next"),o=e.bind(e,"throw");return r()}}function S(t){k(t)().done()}function D(t){if(!(this instanceof D))return new D(t);if("function"==typeof t){var e=t,n=m();t=p(n.promise);try{e(n.resolve,n.reject,n.setEstimate)}catch(r){n.reject(r)}}q.set(this,t)}function b(t){return f(t)}function T(t){return r(t)&&!!q.get(t)}function O(t){return r(t)&&"function"==typeof t.then}function P(t){throw t}function $(t){this.promise=t,F.set(this,t);var e=this,n=this.resolve;this.resolve=function(t){n.call(e,t)};var r=this.reject;this.reject=function(t){r.call(e,t)}}function j(t){this.value=t,this.estimate=Date.now()}function A(t){this.reason=t,this.estimate=1/0}function x(){this.messages=[],this.observers=[],this.estimate=1/0}function L(t){this.thenable=t,this.became=null,this.estimate=1/0}function C(t){this.promise=t}var R=!1;try{throw new Error}catch(M){R=!!M.stack}var E,V=c(),I=t("weak-map"),N=t("pop-iterate"),B=t("asap"),W="From previous event:",q=new I,z=new Error("Can't resolve a promise with itself"),J=h(z),Y=p(J),U=new I;e.exports=f,f.longStackSupport=!1,f.reject=h,f.defer=m,f.when=function(t,e,n,r){return f(t).then(e,n,r)},f.all=y,f.allSettled=g,f.delay=function(t,e){return void 0===e&&(e=t,t=void 0),f(t).delay(e)},f.timeout=function(t,e,n){return f(t).timeout(e,n)},f.spread=v,f.join=function(t,e){return f.spread([t,e],function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},f.race=_,f["try"]=function(t){return f(t).dispatch("call",[[]])},f["function"]=w,f.promised=function(t){return function(){for(var e=new Array(arguments.length),n=0;n<arguments.length;n++)e[n]=arguments[n];return v([this,y(e)],function(e,n){return t.apply(e,n)})}},f.passByCopy=f.push=function(t){return Object(t)!==t||T(t)||H.set(t,!0),t},f.isPortable=function(t){return Object(t)===t&&H.has(t)};var H=new I;f.async=k,f.spawn=S,f.Promise=D,D.all=y,D.race=_,D.resolve=b,D.reject=h,f.isPromise=T,D.prototype.inspect=function(){return p(this).inspect()},D.prototype.isPending=function(){return"pending"===p(this).state},D.prototype.isFulfilled=function(){return"fulfilled"===p(this).state},D.prototype.isRejected=function(){return"rejected"===p(this).state},D.prototype.toBePassed=function(){return"passed"===p(this).state},D.prototype.toString=function(){return"[object Promise]"},D.prototype.then=function(t,e,n){var r,o=this,i=m();r="function"==typeof t?function(e){try{i.resolve(t.call(void 0,e))}catch(n){i.reject(n)}}:i.resolve;var s;if(s="function"==typeof e?function(t){try{i.resolve(e.call(void 0,t))}catch(n){i.reject(n)}}:i.reject,this.done(r,s),void 0!==n){var a=function(){i.setEstimate(o.getEstimate()+n)};this.observeEstimate(a),a()}return i.promise},D.prototype.done=function(t,e){var r=this,i=!1;B(function(){var s;"function"==typeof t&&(s=f.onerror?function(e){if(!i){i=!0;try{t.call(void 0,e)}catch(n){(f.onerror||P)(n)}}}:function(e){i||(i=!0,t.call(void 0,e))});var a;a="function"==typeof e&&f.onerror?function(t){if(!i){i=!0,o(t,r);try{e.call(void 0,t)}catch(n){(f.onerror||P)(n)}}}:"function"==typeof e?function(t){i||(i=!0,o(t,r),e.call(void 0,t))}:f.onerror||P,"object"==typeof n&&n.domain&&(a=n.domain.bind(a)),p(r).dispatch(s,"then",[a])})},D.prototype.thenResolve=function(t){return t=f(t),y([this,t]).then(function(){return t},null,0)},D.prototype.thenReject=function(t){return this.then(function(){throw t},null,0)},D.prototype.all=function(){return this.then(y)},D.prototype.allSettled=function(){return this.then(g)},D.prototype["catch"]=function(t){return this.then(void 0,t)},D.prototype["finally"]=function(t,e){return t?(t=f(t),this.then(function(e){return t.call().then(function(){return e})},function(e){return t.call().then(function(){throw e})},e)):this},D.prototype.observeEstimate=function(t){return this.rawDispatch(null,"estimate",[t]),this},D.prototype.getEstimate=function(){return p(this).estimate},D.prototype.dispatch=function(t,e){var n=m();return this.rawDispatch(n.resolve,t,e),n.promise},D.prototype.rawDispatch=function(t,e,n){var r=this;B(function(){p(r).dispatch(t,e,n)})},D.prototype.get=function(t){return this.dispatch("get",[t])},D.prototype.invoke=function(t){for(var e=new Array(arguments.length-1),n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this.dispatch("invoke",[t,e])},D.prototype.apply=function(t,e){return this.dispatch("call",[e,t])},D.prototype.call=function(t){for(var e=new Array(Math.max(0,arguments.length-1)),n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this.dispatch("call",[e,t])},D.prototype.bind=function(t){for(var e=this,n=new Array(Math.max(0,arguments.length-1)),r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(){for(var r=n.slice(),o=0;o<arguments.length;o++)r[r.length]=arguments[o];return e.dispatch("call",[r,t])}},D.prototype.keys=function(){return this.dispatch("keys",[])},D.prototype.iterate=function(){return this.dispatch("iterate",[])},D.prototype.spread=function(t,e,n){return this.all().then(function(e){return t.apply(void 0,e)},e,n)},D.prototype.timeout=function(t,e){var n=m(),r=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)}),n.promise},D.prototype.delay=function(t){return this.then(function(e){var n=m();return n.setEstimate(Date.now()+t),setTimeout(function(){n.resolve(e)},t),n.promise},null,t)},D.prototype.pull=function(){return this.dispatch("pull",[])},D.prototype.pass=function(){return this.toBePassed()?this:new D(new C(this))};var F=new I;$.prototype.resolve=function(t){var e=p(F.get(this));e.messages&&e.become(f(t))},$.prototype.reject=function(t){var e=p(F.get(this));e.messages&&e.become(h(t))},$.prototype.setEstimate=function(t){if(t=+t,t!==t&&(t=1/0),t<1e12&&t!==-(1/0))throw new Error("Estimate values should be a number of miliseconds in the future");var e=p(F.get(this));e.setEstimate&&e.setEstimate(t)},j.prototype.state="fulfilled",j.prototype.inspect=function(){return{state:"fulfilled",value:this.value}},j.prototype.dispatch=function(t,e,n){var r;if("then"===e||"get"===e||"call"===e||"invoke"===e||"keys"===e||"iterate"===e||"pull"===e)try{r=this[e].apply(this,n)}catch(o){r=h(o)}else if("estimate"===e)n[0].call(void 0,this.estimate);else{var i=new Error("Fulfilled promises do not support the "+e+" operator");r=h(i)}t&&t(r)},j.prototype.then=function(){return this.value},j.prototype.get=function(t){return this.value[t]},j.prototype.call=function(t,e){return this.callInvoke(this.value,t,e)},j.prototype.invoke=function(t,e){return this.callInvoke(this.value[t],e,this.value)},j.prototype.callInvoke=function(t,e,n){for(var r,o=0;o<e.length;o++)T(e[o])&&e[o].toBePassed()&&(r=r||[],r.push(e[o]));if(r){var i=this;return y(r).then(function(){return i.callInvoke(t,e.map(function(t){return T(t)&&t.toBePassed()?t.inspect().value:t}),n)})}return t.apply(n,e)},j.prototype.keys=function(){return Object.keys(this.value)},j.prototype.iterate=function(){return N(this.value)},j.prototype.pull=function(){var t;if(Object(this.value)===this.value){t=Array.isArray(this.value)?[]:{};for(var e in this.value)t[e]=this.value[e]}else t=this.value;return f.push(t)},A.prototype.state="rejected",A.prototype.inspect=function(){return{state:"rejected",reason:this.reason}},A.prototype.dispatch=function(t,e,n){var r;r="then"===e?this.then(t,n[0]):this,t&&t(r)},A.prototype.then=function(t,e){return e?e(this.reason):this},x.prototype.state="pending",x.prototype.inspect=function(){return{state:"pending"}},x.prototype.dispatch=function(t,e,n){if(this.messages.push([t,e,n]),"estimate"===e){this.observers.push(n[0]);var r=this;B(function(){n[0].call(void 0,r.estimate)})}},x.prototype.become=function(t){this.became=Y;var e=p(t);this.became=e,q.set(t,e),this.promise=void 0,this.messages.forEach(function(e){B(function(){var n=p(t);n.dispatch.apply(n,e)})}),this.messages=void 0,this.observers=void 0},x.prototype.setEstimate=function(t){if(this.observers){var e=this;e.estimate=t,this.observers.forEach(function(e){B(function(){e.call(void 0,t)})})}},L.prototype.state="thenable",L.prototype.inspect=function(){return{state:"pending"}},L.prototype.cast=function(){if(!this.became){var t=m(),e=this.thenable;B(function(){try{e.then(t.resolve,t.reject)}catch(n){t.reject(n)}}),this.became=p(t.promise)}return this.became},L.prototype.dispatch=function(t,e,n){this.cast().dispatch(t,e,n)},C.prototype.state="passed",C.prototype.inspect=function(){return this.promise.inspect()},C.prototype.dispatch=function(t,e,n){return this.promise.rawDispatch(t,e,n)},f.ninvoke=function(t,e){for(var n=new Array(Math.max(0,arguments.length-1)),r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=f.defer();return n[r-2]=o.makeNodeResolver(),f(t).dispatch("invoke",[e,n])["catch"](o.reject),o.promise},D.prototype.ninvoke=function(t){for(var e=new Array(arguments.length),n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=f.defer();return e[n-1]=r.makeNodeResolver(),this.dispatch("invoke",[t,e])["catch"](r.reject),r.promise},f.denodeify=function(t,e){return function(){for(var n=new Array(arguments.length+1),r=0;r<arguments.length;r++)n[r]=arguments[r];var o=f.defer();return n[r]=o.makeNodeResolver(e),f(t).apply(this,n)["catch"](o.reject),o.promise}},$.prototype.makeNodeResolver=function(t){var e=this.resolve;return t===!0?function(t){if(t)e(h(t));else{for(var n=new Array(Math.max(0,arguments.length-1)),r=1;r<arguments.length;r++)n[r-1]=arguments[r];e(n)}}:t?function(n){if(n)e(h(n));else{for(var r={},o=0;o<t.length;o++)r[t[o]]=arguments[o+1];e(r)}}:function(t,n){e(t?h(t):n)}},D.prototype.nodeify=function(t){return t?void this.done(function(e){t(null,e)},t):this},f.nextTick=l(B,"nextTick","asap package"),f.resolve=l(f,"resolve","Q"),f.fulfill=l(f,"fulfill","Q"),f.isPromiseAlike=l(O,"isPromiseAlike","(not supported)"),f.fail=l(function(t,e){return f(t)["catch"](e)},"Q.fail","Q(value).catch"),f.fin=l(function(t,e){return f(t)["finally"](e)},"Q.fin","Q(value).finally"),f.progress=l(function(t){return t},"Q.progress","no longer supported"),f.thenResolve=l(function(t,e){return f(t).thenResolve(e)},"thenResolve","Q(value).thenResolve"),f.thenReject=l(function(t,e){return f(t).thenResolve(e)},"thenResolve","Q(value).thenResolve"),f.isPending=l(function(t){return f(t).isPending()},"isPending","Q(value).isPending"),f.isFulfilled=l(function(t){return f(t).isFulfilled()},"isFulfilled","Q(value).isFulfilled"),f.isRejected=l(function(t){return f(t).isRejected()},"isRejected","Q(value).isRejected"),f.master=l(function(t){return t},"master","no longer necessary"),f.makePromise=function(){throw new Error("makePromise is no longer supported")},f.dispatch=l(function(t,e,n){return f(t).dispatch(e,n)},"dispatch","Q(value).dispatch"),f.get=l(function(t,e){return f(t).get(e)},"get","Q(value).get"),f.keys=l(function(t){return f(t).keys()},"keys","Q(value).keys"),f.post=l(function(t,e,n){return f(t).post(e,n)},"post","Q(value).invoke (spread arguments)"),f.mapply=l(function(t,e,n){return f(t).post(e,n)},"post","Q(value).invoke (spread arguments)"),f.send=l(function(t,e){return f(t).post(e,Array.prototype.slice.call(arguments,2))},"send","Q(value).invoke"),f.set=function(){throw new Error("Q.set no longer supported")},f["delete"]=function(){throw new Error("Q.delete no longer supported")},f.nearer=l(function(t){return T(t)&&t.isFulfilled()?t.inspect().value:t},"nearer","inspect().value (+nuances)"),f.fapply=l(function(t,e){return f(t).dispatch("call",[e])},"fapply","Q(callback).apply(thisp, args)"),f.fcall=l(function(t){return f(t).dispatch("call",[Array.prototype.slice.call(arguments,1)])},"fcall","Q(callback).call(thisp, ...args)"),f.fbind=l(function(t){var e=f(t),n=Array.prototype.slice.call(arguments,1);return function(){return e.dispatch("call",[n.concat(Array.prototype.slice.call(arguments)),this])}},"fbind","bind with thisp"),f.promise=l(D,"promise","Promise"),D.prototype.fapply=l(function(t){return this.dispatch("call",[t])},"fapply","apply with thisp"),D.prototype.fcall=l(function(){return this.dispatch("call",[Array.prototype.slice.call(arguments)])},"fcall","try or call with thisp"),D.prototype.fail=l(function(t){return this["catch"](t)},"fail","catch"),D.prototype.fin=l(function(t){return this["finally"](t)},"fin","finally"),D.prototype.set=function(){throw new Error("Promise set no longer supported")},D.prototype["delete"]=function(){throw new Error("Promise delete no longer supported")},$.prototype.notify=l(function(){},"notify","no longer supported"),D.prototype.progress=l(function(){return this},"progress","no longer supported"),D.prototype.mapply=l(function(t,e){return this.dispatch("invoke",[t,e])},"mapply","invoke"),D.prototype.fbind=l(function(){return f.fbind.apply(f,[void 0].concat(Array.prototype.slice.call(arguments)))},"fbind","bind(thisp, ...args)"),D.prototype.send=l(function(){return this.dispatch("invoke",[name,Array.prototype.slice.call(arguments,1)])},"send","invoke"),D.prototype.mcall=l(function(){return this.dispatch("invoke",[name,Array.prototype.slice.call(arguments,1)])},"mcall","invoke"),D.prototype.passByCopy=l(function(t){return t},"passByCopy","Q.passByCopy"),f.nfapply=l(function(t,e){var n=f.defer(),r=Array.prototype.slice.call(e);return r.push(n.makeNodeResolver()),f(t).apply(this,r)["catch"](n.reject),n.promise},"nfapply"),D.prototype.nfapply=l(function(t){return f.nfapply(this,t)},"nfapply"),f.nfcall=l(function(t){var e=Array.prototype.slice.call(arguments,1);return f.nfapply(t,e)},"nfcall"),D.prototype.nfcall=l(function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;e++)t[e]=arguments[e];return f.nfapply(this,t)},"nfcall"),f.nfbind=l(function(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.concat(Array.prototype.slice.call(arguments)),r=f.defer();return n.push(r.makeNodeResolver()),f(t).apply(this,n)["catch"](r.reject),r.promise}},"nfbind","denodeify (with caveats)"),D.prototype.nfbind=l(function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;e++)t[e]=arguments[e];return f.nfbind(this,t)},"nfbind","denodeify (with caveats)"),f.nbind=l(function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){function r(){return t.apply(e,arguments)}var o=n.concat(Array.prototype.slice.call(arguments)),i=f.defer();return o.push(i.makeNodeResolver()),f(r).apply(this,o)["catch"](i.reject),i.promise}},"nbind","denodeify (with caveats)"),f.npost=l(function(t,e,n){var r=f.defer();return n.push(r.makeNodeResolver()),f(t).dispatch("invoke",[e,n])["catch"](r.reject),r.promise},"npost","ninvoke (with spread arguments)"),D.prototype.npost=l(function(t,e){return f.npost(this,t,e)},"npost","Q.ninvoke (with caveats)"),f.nmapply=l(f.nmapply,"nmapply","q/node nmapply"),D.prototype.nmapply=l(D.prototype.npost,"nmapply","Q.nmapply"),f.nsend=l(f.ninvoke,"nsend","q/node ninvoke"),f.nmcall=l(f.ninvoke,"nmcall","q/node ninvoke"),D.prototype.nsend=l(D.prototype.ninvoke,"nsend","q/node ninvoke"),D.prototype.nmcall=l(D.prototype.ninvoke,"nmcall","q/node ninvoke");var G=c()}).call(this,t("_process"))},{_process:5,asap:6,"pop-iterate":4,"weak-map":17}],9:[function(t,e,n){"use strict";function r(t,e,n){var r=this;s.call(r,t,e,n)}function o(t){return 200===t.status||0===t.status&&t.responseText}var i=t("q"),s=t("./common-system");e.exports=r,r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.load=s.load,r.prototype.read=function(t,e,n){function r(){o(a)?u.resolve(a.responseText):s()}function s(){var e=new Error("Can't XHR "+JSON.stringify(t));404!==a.status&&0!==a.status||(e.code="ENOENT",e.notFound=!0),u.reject(e)}var a=new XMLHttpRequest,u=i.defer();try{a.open("GET",t,!0),n&&a.overrideMimeType&&a.overrideMimeType(n),a.onreadystatechange=function(){4===a.readyState&&r()},a.onload=a.load=r,a.onerror=a.error=s,a.send()}catch(c){u.reject(c)}return u.promise}},{"./common-system":11,q:8}],10:[function(t,e,n){"use strict";var r=document.querySelector("head"),o=document.createElement("base"),i=document.createElement("a");o.href="",n.resolve=function(t,e){var n=r.querySelector("base");if(n||(r.appendChild(o),n=o),t=String(t),!/^[\w\-]+:/.test(t))throw new Error("Can't resolve from a relative location: "+JSON.stringify(t)+" "+JSON.stringify(e));var s=n.href;n.href=t,i.href=e;var a=i.href;return n.href=s,n===o&&r.removeChild(n),a}},{}],11:[function(t,e,n){"use strict";function r(t,e,n){var r=this;n=n||{},e=e||{},r.name=e.name||"",r.location=t,r.description=e,r.dependencies={},r.main=null,r.resources=n.resources||{},r.modules=n.modules||{},r.systemLocations=n.systemLocations||{},r.systems=n.systems||{},r.systemLoadedPromises=n.systemLoadedPromises||{},r.buildSystem=n.buildSystem,r.analyzers={js:r.analyzeJavaScript},r.compilers={js:r.compileJavaScript,json:r.compileJson},r.translators={},r.internalRedirects={},r.externalRedirects={},r.node=!!n.node,r.browser=!!n.browser,r.parent=n.parent,r.root=n.root||r,r.systems[r.name]=r,r.systemLocations[r.name]=r.location,r.systemLoadedPromises[r.name]=o(r),null!=n.name&&n.name!==e.name&&console.warn("Package loaded by name "+JSON.stringify(n.name)+" bears name "+JSON.stringify(e.name)),r.main=e.main||"index.js",r.internalRedirects[".js"]="./"+s.resolve(r.main,""),n.browser&&r.overlayBrowser(e),n.node&&r.overlayNode(e),e.dependencies&&r.addDependencies(e.dependencies),r.root===r&&e.devDependencies&&r.addDependencies(e.devDependencies),e.redirects&&r.addRedirects(e.redirects),e.translators&&r.addTranslators(e.translators),e.analyzers&&r.addAnalyzers(e.analyzers),e.compilers&&r.addCompilers(e.compilers)}var o=t("q"),i=t("./url"),s=t("./identifier"),a=t("./module"),u=t("./resource"),c=t("./parse-dependencies"),l=t("./compile"),p=Object.prototype.hasOwnProperty;e.exports=r,r.load=function(t,e){var n=this;return n.prototype.loadSystemDescription(t).then(function(r){return new n(t,r,e)})},r.prototype["import"]=function(t,e){var n=this;return n.load(t,e).then(function(){return n.root.main=n.lookup(t,e),n.require(t,e)})},r.prototype.require=function(t,e){var n=this,r=s.resolve(t,e);if(s.isAbsolute(t)){if(n.externalRedirects[r]===!1)return{};if(n.externalRedirects[r])return n.require(n.externalRedirects[r],r);var o=s.head(t),i=s.tail(t);if(n.dependencies[o])return n.getSystem(o,e).requireInternalModule(i,e);if(n.modules[o])return n.requireInternalModule(t,e,n.modules[t]);var a=e?" via "+JSON.stringify(e):"";throw new Error("Can't require "+JSON.stringify(t)+a+" in "+JSON.stringify(n.name))}return n.requireInternalModule(t,e)},r.prototype.requireInternalModule=function(t,e,n){var r=this,o=s.resolve(t,e),i=r.normalizeIdentifier(o);if(r.internalRedirects[i])return r.require(r.internalRedirects[i],i);if(n=n||r.lookupInternalModule(i),n.error){var a=n.error,u=e?" via "+JSON.stringify(e):"";throw a.message="Can't require module "+JSON.stringify(n.id)+u+" in "+JSON.stringify(r.name||r.location)+" because "+a.message,a}if(null!=n.exports)return n.exports;if("function"!=typeof n.factory)throw new Error("Can't require module "+JSON.stringify(n.filename)+". No exports. No exports factory.");return n.require=r.makeRequire(n.id,r.root.main),n.exports={},n.factory.call(null,n.require,n.exports,n,n.filename,n.dirname),n.exports},r.prototype.makeRequire=function(t,e){function n(e){return r.require(e,t)}var r=this;return n.main=e,n},r.prototype.getSystem=function(t,e){var n=this,r=n.dependencies[t];if(!r){var o=e?" via "+JSON.stringify(e):"";throw new Error("Can't get dependency "+JSON.stringify(t)+" in package named "+JSON.stringify(n.name)+o)}var i=n.systems[t];if(!i){var o=e?" via "+JSON.stringify(e):"";throw new Error("Can't get dependency "+JSON.stringify(t)+" in package named "+JSON.stringify(n.name)+o)}return i},r.prototype.loadSystem=function(t,e){var n=this,r=n.systemLoadedPromises[t];return r||(r=n.actuallyLoadSystem(t,e),n.systemLoadedPromises[t]=r),r},r.prototype.loadSystemDescription=function(t){var e=this,n=i.resolve(t,"package.json");return e.read(n,"utf-8","application/json").then(function(t){try{return JSON.parse(t)}catch(e){throw e.message=e.message+" in "+JSON.stringify(n),e}},function(e){throw e.message="Can't load package "+JSON.stringify(name)+" at "+JSON.stringify(t)+" because "+e.message,e})},r.prototype.actuallyLoadSystem=function(t,e){var n=this,r=n.constructor,i=n.systemLocations[t];if(!i){var s=e?" via "+JSON.stringify(e):"";throw new Error("Can't load package "+JSON.stringify(t)+s+" because it is not a declared dependency")}var a;return n.buildSystem&&(a=n.buildSystem.actuallyLoadSystem(t,e)),o.all([n.loadSystemDescription(i),a]).spread(function(e,o){var s=new r(i,e,{parent:n,root:n.root,name:t,resources:n.resources,modules:n.modules,systems:n.systems,systemLocations:n.systemLocations,systemLoadedPromises:n.systemLoadedPromises,buildSystem:o,browser:n.browser,node:n.node});return n.systems[s.name]=s,s})},r.prototype.getBuildSystem=function(){var t=this;return t.buildSystem||t},r.prototype.normalizeIdentifier=function(t){var e=this,n=s.extension(t);return p.call(e.translators,n)||p.call(e.compilers,n)||"js"===n||"json"===n||(t+=".js"),t},r.prototype.load=function(t,e,n){var r=this,i=s.resolve(t,e);if(s.isAbsolute(t)){if(r.externalRedirects[i])return r.load(r.externalRedirects[i],i,n);var a=s.head(t),u=s.tail(t);return r.dependencies[a]?r.loadSystem(a,e).invoke("loadInternalModule",u,"",n):o()}return r.loadInternalModule(t,e,n)},r.prototype.loadInternalModule=function(t,e,n){function r(t){var r=s.resolve("./index.js",a);return l.redirect=r,!t||t.notFound&&""===c?i.loadInternalModule(r,e,n)["catch"](function(e){l.redirect=null,l.error=t||e}):void(l.error=t)}var i=this,a=s.resolve(t,e),u=i.normalizeIdentifier(a);if(i.internalRedirects[u])return i.load(i.internalRedirects[u],"",n);var c=s.extension(a),l=i.lookupInternalModule(u,e);return n=n||{},n[l.key]?o():(n[l.key]=!0,l.loadedPromise?l.loadedPromise:(l.loadedPromise=o["try"](function(){if(null==l.factory&&null==l.exports)return i.read(l.location,"utf-8").then(function(t){return l.text=t,i.finishLoadingModule(l,n)},r)}),l.loadedPromise))},r.prototype.finishLoadingModule=function(t,e){var n=this;return o["try"](function(){return n.translate(t)}).then(function(){return n.analyze(t)}).then(function(){return o.all(t.dependencies.map(function(r){return n.load(r,t.id,e)}))}).then(function(){return n.compile(t)})["catch"](function(e){t.error=e})},r.prototype.lookup=function(t,e){var n=this,r=s.resolve(t,e);if(s.isAbsolute(t)){if(n.externalRedirects[r])return n.lookup(n.externalRedirects[r],r);var o=s.head(r),i=s.tail(r);if(n.dependencies[o])return n.getSystem(o,e).lookupInternalModule(i,"");if(n.modules[o]&&!i)return n.modules[o];var a=e?" via "+JSON.stringify(e):"";throw new Error("Can't look up "+JSON.stringify(t)+a+" in "+JSON.stringify(n.location)+" because there is no external module or dependency by that name")}return n.lookupInternalModule(t,e)},r.prototype.lookupInternalModule=function(t,e){var n=this,r=s.resolve(t,e),o=n.normalizeIdentifier(r);if(n.internalRedirects[o])return n.lookup(n.internalRedirects[o],r);var u=n.name+"/"+o,c=u.toLowerCase(),l=n.modules[c];return l&&l.redirect?n.lookupInternalModule(l.redirect):(l||(l=new a,l.id=o,l.extension=s.extension(o),l.location=i.resolve(n.location,o),l.filename=u,l.dirname=s.dirname(u),l.key=c,l.system=n,l.modules=n.modules,n.modules[c]=l),l.filename!==u&&(l.error=new Error("Can't refer to single module with multiple case conventions: "+JSON.stringify(u)+" and "+JSON.stringify(l.filename))),l)},r.prototype.translate=function(t){var e=this;if(null!=t.text&&null!=t.extension&&e.translators[t.extension])return e.translators[t.extension](t)},r.prototype.addTranslators=function(t){for(var e=this,n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],i=t[o];e.addTranslator(o,i)}},r.prototype.addTranslator=function(t,e){var n=this;n.translators[t]=n.makeTranslator(e)},r.prototype.makeTranslator=function(t){var e=this;return function(n){return e.getBuildSystem()["import"](t).then(function(e){if("function"!=typeof e)throw new Error("Can't translate "+JSON.stringify(n.id)+" because "+JSON.stringify(t)+" did not export a function");return n.extension="js",e(n)})}},r.prototype.analyze=function(t){var e=this;if(null!=t.text&&null!=t.extension&&e.analyzers[t.extension])return e.analyzers[t.extension](t)},r.prototype.analyzeJavaScript=function(t){t.dependencies.push.apply(t.dependencies,c(t.text))},r.prototype.compile=function(t){var e=this;if(null==t.factory&&null==t.redirect&&null==t.exports&&null!=t.extension&&e.compilers[t.extension])return e.compilers[t.extension](t)},r.prototype.compileJavaScript=function(t){return l(t)},r.prototype.compileJson=function(t){
t.exports=JSON.parse(t.text)},r.prototype.addCompilers=function(t){for(var e=this,n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],i=t[o];e.addCompiler(o,i)}},r.prototype.addCompiler=function(t,e){var n=this;n.compilers[t]=n.makeCompiler(e)},r.prototype.makeCompiler=function(t){var e=this;return function(n){return e.getBuildSystem()["import"](t).then(function(t){return t(n)})}},r.prototype.getResource=function(t,e){var n=this;if(s.isAbsolute(t)){var r=s.head(t),o=s.tail(t);return n.getSystem(r,e).getInternalResource(o)}return n.getInternalResource(s.resolve(t,e))},r.prototype.locateResource=function(t,e){var n=this;if(s.isAbsolute(t)){var r=s.head(t),i=s.tail(t);return n.loadSystem(r,e).then(function(t){return t.getInternalResource(i)})}return o(n.getInternalResource(s.resolve(t,e)))},r.prototype.getInternalResource=function(t){var e=this,n=e.name+"/"+t,r=n.toLowerCase(),o=e.resources[r];return o||(o=new u,o.id=t,o.filename=n,o.dirname=s.dirname(n),o.key=r,o.location=i.resolve(e.location,t),o.system=e,e.resources[r]=o),o},r.prototype.addDependencies=function(t){for(var e=this,n=Object.keys(t),r=0;r<n.length;r++){var o=n[r];if(e.dependencies[o]=!0,!e.systemLocations[o]){var s=i.resolve(e.location,"node_modules/"+o+"/");e.systemLocations[o]=s}}},r.prototype.addRedirects=function(t){for(var e=this,n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],i=t[o];e.addRedirect(o,i)}},r.prototype.addRedirect=function(t,e){var n=this;s.isAbsolute(t)?n.externalRedirects[t]=e:(t=n.normalizeIdentifier(s.resolve(t)),n.internalRedirects[t]=e)},r.prototype.overlayBrowser=function(t){var e=this;"string"==typeof t.browser?e.addRedirect("",t.browser):t.browser&&"object"==typeof t.browser&&e.addRedirects(t.browser)},r.prototype.inspect=function(){var t=this;return{type:"system",location:t.location}}},{"./compile":12,"./identifier":13,"./module":14,"./parse-dependencies":15,"./resource":16,"./url":10,q:8}],12:[function(t,e,n){(function(t){"use strict";function n(t){var e=t.filename.replace(/[^\w\d]|^\d/g,"_");try{t.factory=r("(function "+e+"(require, exports, module, __filename, __dirname) {"+t.text+"//*/\n})\n//# sourceURL="+t.system.location+t.id)}catch(n){throw n.message=n.message+" in "+t.filename,n}t.factory.displayName=t.filename}e.exports=n;var r=eval;t.navigator&&t.navigator.userAgent.indexOf("Firefox")>=0&&(r=new Function("_","return eval(_)"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(t,e,n){"use strict";function r(t){return""!==t&&t.lastIndexOf("./",0)<0&&t.lastIndexOf("../",0)<0}function o(t){var e=t.lastIndexOf("/");return t.indexOf(".",e)<0}function i(t){var e=t.indexOf("/");return e<0?t:t.slice(0,e)}function s(t){var e=t.indexOf("/");return e<0?"":t.slice(e+1)}function a(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf(".");return n<=e?"":t.slice(n+1)}function u(t){var e=t.lastIndexOf("/");return e<0?t:t.slice(0,e)}function c(t){var e=t.lastIndexOf("/");return e<0?t:t.slice(e+1)}function l(t,e){e=e||"";var n,r=t.split("/"),o=[];(r.length&&"."===r[0]||".."===r[0])&&(n=e.split("/"),n.pop(),r.unshift.apply(r,n));for(var i=0;i<r.length;i++)".."===r[i]?o.length&&o.pop():""!==r[i]&&"."!==r[i]&&o.push(r[i]);return o.join("/")}n.isAbsolute=r,n.isBare=o,n.head=i,n.tail=s,n.extension=a,n.dirname=u,n.basename=c,n.resolve=l},{}],14:[function(t,e,n){"use strict";function r(){this.id=null,this.extension=null,this.system=null,this.key=null,this.filename=null,this.dirname=null,this.exports=null,this.redirect=null,this.text=null,this.factory=null,this.dependencies=[],this.loadedPromise=null,this.index=null,this.bundled=!1}e.exports=r},{}],15:[function(t,e,n){"use strict";function r(t){var e={};return String(t).replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(t,n){e[n]=!0}),Object.keys(e)}e.exports=r},{}],16:[function(t,e,n){"use strict";function r(){this.id=null,this.filename=null,this.dirname=null,this.key=null,this.location=null,this.system=null}e.exports=r},{}],17:[function(t,e,n){!function(){"use strict";function t(e){e.permitHostObjects___&&e.permitHostObjects___(t)}function n(t){return!(t.substr(0,f.length)==f&&"___"===t.substr(t.length-3))}function r(t){if(t!==Object(t))throw new TypeError("Not an object: "+t);var e=t[h];if(e&&e.key===t)return e;if(d(t)){e={key:t};try{return p(t,h,{value:e,writable:!1,enumerable:!1,configurable:!1}),e}catch(n){return}}}function o(t){return t.prototype=null,Object.freeze(t)}function i(){v||"undefined"==typeof console||(v=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=t);var s=!1;if("function"==typeof WeakMap){var a=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var u=new a,c=Object.freeze({});if(u.set(c,1),1===u.get(c))return void(e.exports=WeakMap);s=!0}}var l=(Object.prototype.hasOwnProperty,Object.getOwnPropertyNames),p=Object.defineProperty,d=Object.isExtensible,f="weakmap:",h=f+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var m=new ArrayBuffer(25),y=new Uint8Array(m);crypto.getRandomValues(y),h=f+"rand:"+Array.prototype.map.call(y,function(t){return(t%36).toString(36)}).join("")+"___"}if(p(Object,"getOwnPropertyNames",{value:function(t){return l(t).filter(n)}}),"getPropertyNames"in Object){var g=Object.getPropertyNames;p(Object,"getPropertyNames",{value:function(t){return g(t).filter(n)}})}!function(){var t=Object.freeze;p(Object,"freeze",{value:function(e){return r(e),t(e)}});var e=Object.seal;p(Object,"seal",{value:function(t){return r(t),e(t)}});var n=Object.preventExtensions;p(Object,"preventExtensions",{value:function(t){return r(t),n(t)}})}();var v=!1,_=0,w=function(){function t(t,e){var n,o=r(t);return o?c in o?o[c]:e:(n=a.indexOf(t),n>=0?u[n]:e)}function e(t){var e=r(t);return e?c in e:a.indexOf(t)>=0}function n(t,e){var n,o=r(t);return o?o[c]=e:(n=a.indexOf(t),n>=0?u[n]=e:(n=a.length,u[n]=e,a[n]=t)),this}function s(t){var e,n,o=r(t);return o?c in o&&delete o[c]:(e=a.indexOf(t),!(e<0)&&(n=a.length-1,a[e]=void 0,u[e]=u[n],a[e]=a[n],a.length=n,u.length=n,!0))}this instanceof w||i();var a=[],u=[],c=_++;return Object.create(w.prototype,{get___:{value:o(t)},has___:{value:o(e)},set___:{value:o(n)},delete___:{value:o(s)}})};w.prototype=Object.create(Object.prototype,{get:{value:function(t,e){return this.get___(t,e)},writable:!0,configurable:!0},has:{value:function(t){return this.has___(t)},writable:!0,configurable:!0},set:{value:function(t,e){return this.set___(t,e)},writable:!0,configurable:!0},"delete":{value:function(t){return this.delete___(t)},writable:!0,configurable:!0}}),"function"==typeof a?!function(){function n(){function e(t,e){return l?c.has(t)?c.get(t):l.get___(t,e):c.get(t,e)}function n(t){return c.has(t)||!!l&&l.has___(t)}function r(t){var e=!!c["delete"](t);return l?l.delete___(t)||e:e}this instanceof w||i();var u,c=new a,l=void 0,p=!1;return u=s?function(t,e){return c.set(t,e),c.has(t)||(l||(l=new w),l.set(t,e)),this}:function(t,e){if(p)try{c.set(t,e)}catch(n){l||(l=new w),l.set___(t,e)}else c.set(t,e);return this},Object.create(w.prototype,{get___:{value:o(e)},has___:{value:o(n)},set___:{value:o(u)},delete___:{value:o(r)},permitHostObjects___:{value:o(function(e){if(e!==t)throw new Error("bogus call to permitHostObjects___");p=!0})}})}s&&"undefined"!=typeof Proxy&&(Proxy=void 0),n.prototype=w.prototype,e.exports=n,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),e.exports=w)}}()},{}],18:[function(t,e,n){toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:300,hideDuration:1e3,timeOut:5e3,extendedTimeOut:1e3,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},window.JSONLint=t("../../static/libs/jsonlint/jsonlint.js"),t("./ng-app"),moment.locale("ru")},{"../../static/libs/jsonlint/jsonlint.js":93,"./ng-app":44}],19:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;a=t("../dscommon/util").assert,p=t("../dscommon/util").validate,l=t("../dscommon/util").serviceOwner,r=t("../dscommon/DSObject"),o=t("./models/Person"),t("../utils/angular-local-storage.js"),e.exports=(c=angular.module("config",["LocalStorageModule"])).name,c.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),c.run(["$rootScope","config",function(t,e){t.config=e}]),i=1,s=1,u=function(t){return(t=/https?:\/\/.*?($|\/)/.exec(t)[0])?("/"!==t.charAt(t.length-1)&&(t+="/"),t):null},c.factory("config",["$http","localStorageService",function(t,e){var n,a,c,f,h,m,y,g,v,_,w,k;if(n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return d(n,t),n.begin("Config"),n.propStr("token",{valid:p.trimString}),n.propStr("teamwork",{init:"http://teamwork.webprofy.ru/",valid:u}),n.propCalc("hasRoles",function(){return this.teamwork.indexOf("://teamwork.webprofy.ru/")>0||this.teamwork.indexOf("://delightsoft.teamworkpm.net/")>0}),n.propCalc("hasTimeReports",function(){return this.teamwork.indexOf("://teamwork.webprofy.ru/")>0||this.teamwork.indexOf("://delightsoft.teamworkpm.net/")>0}),n.propConst("planTag","План"),n.propConst("teamleadRole","Teamlead"),n.propNum("hResizer"),n.propNum("vResizer"),n.propStr("currentUserId"),n.propDoc("currentUser",o),n.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propStr("selectedRole"),n.propNum("selectedCompany",{init:-1}),n.propStr("selectedManager"),n.propNum("selectedLoad"),n.propNum("activeSidebarTab",{init:0}),n.propNum("refreshPeriod"),n.propNum("autosave",{init:0}),n.propNum("view3GroupByPerson",{init:0}),n.propNum("view3HidePeopleWOTasks",{init:0}),n.propStr("view3FilterByPerson",{init:""}),n.propStr("view3FilterByProject",{init:""}),n.propStr("view3FilterByTask",{init:""}),n.propNum("histStart",{init:-1}),n.onAnyPropChange(function(t,n,r,o){"currentUserId"!==n&&"currentUser"!==n&&("teamwork"!==n&&"token"!==n||this.set("histStart",-1),"undefined"!=typeof r?e.set(n,r):e.remove(n))}),n.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},n.end(),n}(r),a=l.add(new n(l,"config")),f=!0,h=!0,_=1,w=0,"string"==typeof(v=e.get("ver"))&&((k=v.split(".")).length=2)&&(_=parseInt(k[0]),w=parseInt(k[1])),h=(f=_===i)&&w===s,h||e.set("ver",i+"."+s),f){y=n.prototype.__props;for(m in y)c=y[m],(h||"teamwork"===m||"token"===m)&&(c.readonly||null===(g=e.get(m))||a.set(m,g))}return a}])},{"../dscommon/DSObject":84,"../dscommon/util":90,"../utils/angular-local-storage.js":91,"./models/Person":34}],20:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(p=angular.module("data/PeopleWithJson",[])).name,c=t("../../dscommon/util").assert,l=t("../../dscommon/util").error,s=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),r=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),o=t("../../dscommon/DSDataServiceBase"),u=t("../models/Person"),p.factory("PeopleWithJson",["DSDataSource","config","$rootScope","$http","$q",function(t,e,n,p,f){var h;return h=function(t){function h(){return h.__super__.constructor.apply(this,arguments)}return d(h,t),h.begin("PeopleWithJson"),h.addPool(),h.propDoc("teamworkPeople",s),h.propObj("cancel",{init:null}),h.propSet("people",u),h.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),h.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},h.prototype.init=function(t){var r,s,d,h;c&&(t instanceof o||l.invalidArg("dsDataService")),(h=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:u,source:!0})))).release(this),d=this.get("peopleSet"),s=function(t){return function(e,n){n||(e.hasOwnProperty("status")?toastr.error("Failed to load <i>data/people.json</i>:<br/><br/> "+e.status+" "+e.statusText,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}):toastr.error("Invalid <i>data/people.json</i>:<br/><br/> "+e.message,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}),t.set("cancel",null)),t._endLoad(!1)}}(this),r=function(t){return function(){var r;t._startLoad()&&(r=t.set("cancel",f.defer()),p.get("data/people.json?t="+(new Date).getTime(),{timeout:r,transformResponse:function(t,e,n){if(200===n)return JSONLint.parse(t)}}).then(function(r){200===r.status?(t.set("cancel",null),i.block(function(){var o,i,s,u,c,l,p,f,m,y,g,v,_,w,k,S,D,b,T,O,P,$,j,A;if(_=n.peopleRoles=r.data.roles,j=n.selectedRole=e.get("selectedRole"))for(u=0,p=_.length;u<p;u++)if(s=_[u],s.role===j){n.selectedRole=s;break}for(i=n.filterManagers=[{name:"All",$ds_key:null}],T=r.data.people,c=0,f=T.length;c<f;c++)if(k=T[c],h.items.hasOwnProperty(S=""+k.id)&&((A=h.items[S]).set("roles",o=new a(t,k.role)),o.release(t),k.hasOwnProperty("projects")))if(Array.isArray(k.projects))try{for(A.projects=b={},O=k.projects,l=0,m=O.length;l<m;l++)D=O[l],b[D]=!0;i.push(A)}catch(x){console.error("Person "+k.name+": Invalid prop 'projects'")}else console.error("Person "+k.name+": Invalid prop 'projects'");if($=n.selectedManager=e.get("selectedManager"))for(g=0,y=i.length;g<y;g++)if(s=i[g],s.$ds_key===$){n.selectedManager=s;break}v={},P=h.items;for(S in P)w=P[S],v[S]=w,w.addRef(t);d.merge(t,v),t._endLoad(!0)})):s(r,0===r.status)},s))}}(this),this._unwatchA=h.watchStatus(this,function(t){return function(e,n){var o;if(n!==(o=t.get("status")))switch(n){case"ready":i.block(r);break;case"update":i.block(r);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},h.end(),h}(r)}])},{"../../dscommon/DSData":75,"../../dscommon/DSDataServiceBase":78,"../../dscommon/DSDigest":80,"../../dscommon/DSSet":87,"../../dscommon/DSTags":88,"../../dscommon/util":90,"../models/Person":34}],21:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h=function(t,e){function n(){this.constructor=t}for(var r in e)m.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty;e.exports=(f=angular.module("data/PersonDayStatData",[])).name,p=t("../../dscommon/util").assert,d=t("../../dscommon/util").error,s=t("../../dscommon/DSDocument"),o=t("../../dscommon/DSDataServiceBase"),r=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),a=t("../../dscommon/DSSet"),u=t("../models/Person"),l=t("../models/Task"),c=t("../models/PersonDayStat"),f.factory("PersonDayStatData",[function(){var t;return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.begin("PersonDayStatData"),e.addPool(),e.propDoc("tasks",a),e.propDoc("people",a),e.propSet("personDayStats",c),e.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),e.prototype.clear=function(){r.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},e.prototype.init=function(t){var e,n,r,a,f,h,m,y;p&&(t instanceof o||d.invalidArg("dsDataService")),(h=this.set("tasks",t.findDataSet(this,_.assign({},this.params,{type:l,filter:"assigned"})))).release(this),m=h.items,(n=this.set("people",t.findDataSet(this,{type:u,mode:this.params.mode}))).release(this),r=n.items,a=this.get("personDayStats"),e=function(t){return function(){var e,o,s,l,f,y,g,v,w,k,S,D,b,T,O;if(t._startLoad()){O=_.groupBy(m,function(t){return t.get("responsible").$ds_key}),f=moment.duration((g=t.params.endDate).diff(b=t.params.startDate)).asDays(),s=b,l=function(){var t,e,n;for(n=[],v=t=0,e=f;0<=e?t<=e:t>=e;v=0<=e?++t:--t)n.push(((s=moment(D=s)).add(1,"day"),D));return n}(),e=function(t){var e,n,r,o,i,a,u,c,p,d,f,h,m,y,g,_,w,k,S,D,T,P,$;if(D=function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)s=l[t],n.push(0);return n}(),T=function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)s=l[t],n.push(moment.duration(0));return n}(),n=t.get("dayStats"),O.hasOwnProperty(m=(h=t.get("person")).$ds_key))for(y=O[m],i=0,c=y.length;i<c;i++)if(S=y[i],null!==(r=S.duedate))if(null!==(w=S.get("split")))for(g=k=w.list,v=a=0,p=g.length;a<p;v=a+=2)s=g[v],f=Math.floor(moment(r).add(s).diff(b)/864e5),0<=f&&f<n.length&&(T[f].add(k[v+1]),D[f]++);else f=Math.floor((r.valueOf()-b.valueOf())/864e5),0<=f&&f<n.length&&(null!==(o=S.get("estimate"))&&T[f].add(o),D[f]++);for(e=h.get("contractTime"),P=moment.duration(0),v=u=0,d=n.length;u<d;v=++u)_=n[v],_.set("tasksCount",D[v]),_.set("contract",e),_.set("tasksTotal",$=T[v]),_.set("timeLeft",moment.duration(e).subtract($)),P.add($);t.set("totalPeriodTime",P)},T={};for(k in r)w=r[k],e(T[k]=new c(t,w.$ds_key,w,l));t.get("personDayStatsSet").merge(t,T),y=function(t){a.hasOwnProperty(t)&&e(a[t])},S=function(e){p&&(e instanceof u||d.invalidArg("person")),i.render(t.$ds_key,e.$ds_key,y)},t._unwatch1=h.watch(t,{change:o=function(t,e,n,r){"estimate"===e||"split"===e||"duedate"===e?null!==(w=t.get("responsible"))&&null!==t.get("duedate")&&S(w):"responsible"===e&&(null!==r&&O.hasOwnProperty(k=r.$ds_key)&&_.remove(O[k],t).length>0&&S(r),null!==n&&(h=O.hasOwnProperty(k=n.$ds_key)?O[k]:O[k]=[],_.find(h,t)||(h.push(t),S(n))))},add:function(t){o(t,"responsible",t.get("responsible"),null)},remove:function(t){null!==(w=t.get("responsible"))&&O.hasOwnProperty(k=w.$ds_key)&&(_.remove(O[k],t),S(w))}}),t._unwatch2=n.watch(t,{add:function(e){var n,r;r=new c(t,n=e.$ds_key,e,l),r.get("dayStatsList").merge(t,function(){var t,e,n;for(n=[],v=t=0,e=l.length;t<e;v=++t)s=l[v],n.push(((D=new c.DayStat(this,"personKey_"+v)).set("day",s),D));return n}.call(t)),t.get("personDayStatsSet").add(t,r),S(e)},remove:function(e){t.get("personDayStatsSet").remove(t.get("personDayStats")[e.$ds_key])},change:function(t,e,n,r){"contractTime"===e&&S(t)}}),t._endLoad(!0)}}}(this),f=[h,n],y=function(t){return function(n,r){var o,a;if((o=s.integratedStatus(f))!==(a=t.get("status")))switch(o){case"ready":i.block(e);break;case"update":t._startLoad()&&t._endLoad(!0);break;case"nodata":t.set("status","nodata")}}}(this),this._unwatchA=n.watchStatus(this,y),this._unwatchB=h.watchStatus(this,y),this.init=null},e.end(),e}(r)}])},{"../../dscommon/DSData":75,"../../dscommon/DSDataServiceBase":78,"../../dscommon/DSDigest":80,"../../dscommon/DSDocument":81,"../../dscommon/DSSet":87,"../../dscommon/util":90,"../models/Person":34,"../models/PersonDayStat":35,"../models/Task":39}],22:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(d=angular.module("data/TasksWithTimeTracking",[])).name,l=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,s=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),r=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),o=t("../../dscommon/DSDataServiceBase"),u=t("../models/Task"),c=t("../models/TaskTimeTracking"),d.factory("TasksWithTimeTracking",["DSDataSource","$rootScope","$http","$q",function(t,e,n,i){var a;return a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.begin("TasksWithTimeTracking"),e.addPool(),e.propDoc("srcTasks",s),e.propDoc("srcTasksTimeTracking",s),e.propObj("cancel",{init:null}),e.propSet("tasks",u),e.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),e.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},e.prototype.init=function(t){var e,n,r;l&&(t instanceof o||p.invalidArg("dsDataService")),(e=this.set("srcTasks",t.findDataSet(this,{mode:"original",type:u,filter:"all",source:!0}))).release(this),(n=this.set("srcTasksTimeTracking",t.findDataSet(this,{mode:"original",type:c}))).release(this),r=this.get("tasksSet"),this.__unwatchA=e.watch(this,{add:function(t){var e;null===t.get("timeTracking")&&(e=c.pool.find(this,t.$ds_key))&&(t.set("timeTracking",e),e.release(this)),r.add(this,t.addRef(this))},remove:function(t){r.remove(t)}}),this.__unwatchB=e.watchStatus(this,function(t){return function(e,n){t.set("status",n)}}(this)),this.init=null},e.end(),e}(r)}])},{"../../dscommon/DSData":75,"../../dscommon/DSDataServiceBase":78,"../../dscommon/DSDigest":80,"../../dscommon/DSSet":87,"../../dscommon/DSTags":88,"../../dscommon/util":90,"../models/Task":39,"../models/TaskTimeTracking":41}],23:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m,y,g,v=function(t,e){function n(){this.constructor=t}for(var r in e)w.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(y=angular.module("data/dsDataChanges",["LocalStorageModule",t("../../dscommon/DSDataSource")])).name,h=t("../../dscommon/util").assert,g=t("../../dscommon/util").serviceOwner,m=t("../../dscommon/util").error,a=t("../../dscommon/DSDigest"),i=t("../../dscommon/DSChangesBase"),s=t("../../dscommon/DSDataEditable"),c=t("../../dscommon/DSTags"),u=t("../../dscommon/DSSet"),l=t("../models/Person"),d=t("../models/Tag"),f=t("../models/Task"),o=t("../models/types/Comments"),p=t("../utils/RMSData"),y.run(["dsChanges","$rootScope",function(t,e){e.changes=t}]),r=1,y.factory("dsChanges",["DSDataSource","config","localStorageService","$rootScope","$http","$timeout","$q",function(t,e,n,u,h,m,y){var w;return w=function(h){function g(t,e){i.call(this,t,e)}var w,k,S,D;return v(g,h),g.begin("DSChanges"),g.propSet("tasks",f.Editable),g.propObj("dataService"),g.propDoc("source",t),g.propObj("cancel",{init:null}),g.ds_dstr.push(function(){var t;this.__unwatch2(),this.__unwatch3(),"function"==typeof this.__unwatch4&&this.__unwatch4(),"function"==typeof this.__unwatchStatus1&&this.__unwatchStatus1(),"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),"function"==typeof this.__unwatchStatus3&&this.__unwatchStatus3(),(t=this.get("cancel"))&&t.resolve()}),g.prototype.init=function(t){var n;this.set("dataService",t),this.set("source",t.get("dataSource")),f.prototype.__props.tags.read=function(t){var e,r,o,i,s;if(null===t)return null;for(s=null,o=t.split(","),e=0,r=o.length;e<r;e++)i=o[e],n.items.hasOwnProperty(i=i.trim())&&((s||(s={}))[i]=n.items[i]);return null===s?null:new c(this,s)},n=t.findDataSet(this,{type:d,mode:"original"}),this.__unwatch2=n.watchStatus(this,function(t){return function(e,n){switch(n){case"ready":a.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this)),n.release(this),this.__unwatch3=u.$watch(function(){return e.get("autosave")},function(t){return function(e){var n;e?t.__unwatch4=t.get("tasksSet").watch(t,{add:n=function(){return u.$evalAsync(function(){t.save()})},change:n}):("function"==typeof t.__unwatch4&&t.__unwatch4(),t.__unwatch4=null)}}(this))},g.prototype.clear=function(){"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),delete this.__unwatchStatus2,this.reset()},g.prototype.load=function(){var t,o,i;if("ready"!==this.get("status")){if(!this._startLoad())return;t=s(f.Editable).$u,(o=n.get("changes"))?o.ver===r&&o.source.url===e.get("teamwork")&&o.source.token===e.get("token")?(i=this.get("dataService").findDataSet(this,{type:l,mode:"original"}),this.__unwatchStatus2=i.watchStatus(this,function(e){return function(n,r,s,u){var c;"ready"===r&&(u(),c=e.get("dataService").findDataSet(e,{type:f,mode:"original",filter:"all"}),e.__unwatchStatus3=c.watchStatus(e,function(n,r,s,u){"ready"===r&&(u(),a.block(function(){var n,r,s,a,u,l,p,d,h,m,y,g,v,_,w,k;f.pool.enableWatch(!1),m=e.mapToChanges(o.changes),p=m.load.Person;for(l in p)if(a=p[l],i.items.hasOwnProperty(l))for(u=i.items[l],r=0,s=a.length;r<s;r++)(n=a[r])(u);else console.error("Person #{personKey} missing in server data");k=(w=e.get("tasksSet")).$ds_pool,h={},d=m.changes.tasks;for(_ in d)g=d[_],c.items.hasOwnProperty(_)&&!(y=c.items[_]).get("completed")&&((v=k.find(e,_,h)).init(y,w,g),v.$u=t,v.hasOwnProperty("__change")||(delete h[v.$ds_key],v.release(e)),y.release(e));w.merge(e,h),f.pool.enableWatch(!0),e._endLoad(!0)}))}),c.release(e))}}(this)),i.release(this)):(n.remove("changes"),this._endLoad(!0)):this._endLoad(!0)}},g.prototype.persist=function(){this.hasOwnProperty("__persist")||(this.__persist=m(function(t){return function(){delete t.__persist,t.saveToLocalStorage()}}(this)))},g.prototype.saveToLocalStorage=function(){var t,o;this.anyChange()?(t=this.changesToMap(),o={},n.set("changes",{ver:r,changes:t,source:{url:e.get("teamwork"),token:e.get("token")}})):n.remove("changes")},g.prototype.removeChanges=w=function(t){var e;(e=t.$ds_chg.$ds_hist).startBlock();try{a.block(function(){var e,n,r;r=t.__change;for(n in r)e=r[n],"__error"!==n&&"__refreshView"!==n&&t.set(n,t.$ds_doc.get(n))})}finally{e.endBlock()}},D=function(t){return t.length>60?t.substr(0,60)+"...":t},S=function(t){e.get("autosave")&&toastr.success("Task '"+D(t.get("title"))+"' updated","Update task",{timeOut:2e3})},k=function(t,n){e.get("autosave")&&toastr.error("Task '"+D(n.get("title"))+"' update failed. Reason: "+t,"Update task",{positionClass:"toast-top-center",newestOnTop:!0}),w(n)},g.prototype.save=function(t){return function(n){var r,i,s,u,c,l,d,f,h,m,g,v,D,b,T,O,P,$,j,A,x,L,C,R;if(t&&!n)return t.promise;if(n||(t=y.defer(),n=function(){var t,e;t=this.get("tasks"),e=[];for(L in t)x=t[L],e.push(x.addRef(this));return e}.call(this)),h=null,R={"todo-item":C={}},!(x=n.shift())){if((n=function(){var t,e;t=this.get("tasks"),e=[];for(L in t)x=t[L],x.__change.__error||e.push(x.addRef(this));return e}.call(this)).length>0)return void this.save(n);i=!0;for(f in this.get("tasks")){i=!1;break}return t.resolve(i),v=t.promise,t=null,v}s=_.clone(x.__change),C.content=x.get("title"),c=!1;for(b in s)if(D=s[b],"__error"!==b&&"__refreshView"!==b)switch(b){case"title":break;case"comments":break;case"description":s.hasOwnProperty("split")||(C.description=x.get("description"));break;case"split":C.description=p.put(x.get("description"),(P=D.v)?{split:D.v.valueOf()}:null),C["start-date"]=null===P||null===(d=x.get("duedate"))?"":P.firstDate(d).format("YYYYMMDD");break;case"duedate":C["due-date"]=l=D.v?D.v.format("YYYYMMDD"):"",null!==($=x.get("startDate"))&&$>x.get("duedate")&&(C["start-date"]=l);break;case"estimate":C["estimated-minutes"]=D.v?Math.floor(D.v.asMinutes()):"0";break;case"responsible":C["responsible-party-id"]=(h=D.v)?[D.v.get("id")]:[];break;case"tags":C.tags=(A=null!=(T=x.get("tags"))?T.map:void 0)?function(){var t;t=[];for(j in A)t.push(j);return t}().join():"";break;case"plan":u=null===(u=x.get("comments"))?new o:u.clone(),u.unshift(D.v?"Поставлено в план на "+x.get("duedate").format("DD.MM.YYYY"):"Снято с плана.  Причина:"),x.set("comments",u);break;default:console.error("change.save(): Property "+b+" not expected to be changed")}return r=function(n){return function(r,o){var i;o||(e.get("autosave")?(k(r,x),w(x)):(x.__change.__error=r,"function"==typeof(i=x.__change).__refreshView&&i.__refreshView()),n.set("cancel",null)),x.release(n),t.reject(),t=null}}(this),O=function(t){return function(){return t.get("source").httpPut("tasks/"+x.get("id")+".json",R,t.set("cancel",y.defer())).then(function(o){var i,c,l;if(t.set("cancel",null),200===o.status)if(delete s.__error,a.block(function(){for(b in s)D=s[b],"__refreshView"!==b&&x.$ds_doc.set(b,D.v)}),null!==(u=x.get("comments"))){for(l="";c=u.shift();)l+="<p>"+c+"</p>";R={comment:{"content-type":"html",body:l,isprivate:!1}},t.get("source").httpPost("tasks/"+x.get("id")+"/comments.json",R,t.set("cancel",y.defer())).then(function(e){t.set("cancel",null),201===e.status?(x.$ds_chg.$ds_hist.setSameAsServer(x,"comments"),S(x),x.release(t),t.save(n)):r(e,0===e.status)},r)}else S(x),x.release(t),t.save(n);else e.get("autosave")?k(o.data.MESSAGE,x):(x.__change.__error=o.data.MESSAGE,"function"==typeof(i=x.__change).__refreshView&&i.__refreshView()),x.release(t),t.save(n)},r)}}(this),null===h?O():null===(g=(m=x.get("project")).get("people"))?this.get("source").httpGet("projects/"+m.get("id")+"/people.json",this.set("cancel",y.defer())).then(function(t){return function(e){var n,o,i,s;if(t.set("cancel",null),200===e.status){for(m.set("people",g={}),s=e.data.people,n=0,o=s.length;n<o;n++)i=s[n],g[i.id]=!0;t.addPersonToProject(m,h,O,r)}else r(e,0===e.status)}}(this),r):g.hasOwnProperty(h.get("id"))?O():this.addPersonToProject(m,h,O),t.promise}}(null),g.prototype.addPersonToProject=function(t,e,n,r){this.get("source").httpPost("projects/"+t.get("id")+"/people/"+e.get("id")+".json",null,this.set("cancel",y.defer())).then(function(o){return function(i){o.set("cancel",null),200===i.status||409===i.status?(t.get("people")[e.get("id")]=!0,n()):r(i,0===i.status)}}(this),r)},g.end(),g}(i),g.add(new w(g,"dataChanges"))}])},{"../../dscommon/DSChangesBase":74,"../../dscommon/DSDataEditable":76,"../../dscommon/DSDataSource":79,"../../dscommon/DSDigest":80,"../../dscommon/DSSet":87,"../../dscommon/DSTags":88,"../../dscommon/util":90,"../models/Person":34,"../models/Tag":38,"../models/Task":39,"../models/types/Comments":42,"../utils/RMSData":73}],24:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m,y,g,v=function(t,e){function n(){this.constructor=t}for(var r in e)w.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(y=angular.module("data/dsDataService",[t("./PeopleWithJson"),t("./TasksWithTimeTracking"),t("./teamwork/TWPeople"),t("./teamwork/TWProjects"),t("./teamwork/TWTaskLists"),t("./teamwork/TWTasks"),t("./teamwork/TWTags"),t("./teamwork/TWTimeTracking"),t("./PersonDayStatData"),t("./dsChanges"),t("../../dscommon/DSDataSource"),t("../config")])).name,f=t("../../dscommon/util").assert,g=t("../../dscommon/util").serviceOwner,m=t("../../dscommon/util").error,h=t("../../utils/base64"),a=t("../../dscommon/DSObject"),s=t("../../dscommon/DSDataServiceBase"),r=t("../../dscommon/DSChangesBase"),o=t("../../dscommon/DSDataEditable"),i=t("../../dscommon/DSDataFiltered"),u=t("../models/Person"),l=t("../models/Tag"),p=t("../models/Task"),d=t("../models/TaskTimeTracking"),c=t("../models/PersonTimeTracking"),y.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),y.factory("dsDataService",["TWPeople","TWTasks","TWProjects","TWTaskLists","TWTags","TWTimeTracking","PeopleWithJson","TasksWithTimeTracking","PersonDayStatData","DSDataSource","dsChanges","config","$http","$rootScope","$q",function(t,e,n,a,l,d,m,y,w,k,S,D,b,T,O){var P;return P=function(g){function P(){return $.apply(this,arguments)}var $;return v(P,g),P.begin("DSDataService"),P.propDoc("dataSource",k),P.propPool("editedPeople",o(u.Editable)),P.propPool("editedTasks",o(p.Editable)),P.propPool("tasksPool",i(p)),P.propPool("personTimeTrackingPool",i(c)),P.propBool("showTimeSpent",{init:!1}),P.propDoc("changes",r),P.propSet("emptyPersonTimeTracking",c),P.ds_dstr.push(function(){this.__unwatch2()}),$=function(){var t;s.apply(this,arguments),this.set("dataSource",new k(this,"dataSource")).release(this),t=null,this.__unwatch2=T.$watch(function(){
return[D.get("teamwork"),D.get("token")]},function(e){return function(n){var r,o,i;return o=n[0],i=n[1],o&&i?(t&&(t.resolve(),t=null),r=function(n,r){T.connected=!1,r||(console.error("error: ",n),t=null),e.get("dataSource").setConnection(null,null)},T.connected=null,b.get(o+"authenticate.json",{timeout:(t=O.defer()).promise,headers:{Authorization:"Basic "+h.encode(i)}}).then(function(n){200===n.status?(T.connected=!0,t=null,D.set("currentUserId",n.data.account.userId),e.get("dataSource").setConnection(o,i)):r(n,0===n.status)},r),void 0):(T.connected=!1,e.get("dataSource").setConnection(null,null))}}(this),!0),this.set("changes",S).init(this)},P.prototype.refresh=function(){this.get("dataSource").refresh()},P.prototype.findDataSet=function(r,o){var i,f,h,g,v,k,S,b,T,O,P,$;switch(s.prototype.findDataSet.call(this,r,o),o.type.docType){case"Tag":return"function"==typeof(i=T=l.pool.find(this,{})).init&&i.init(this),(P=T.get("tagsSet")).addRef(r),T.release(this),P;case"PersonDayStat":return"function"==typeof(f=T=w.pool.find(this,o)).init&&f.init(this),(P=T.get("personDayStatsSet")).addRef(r),T.release(this),P;case"TaskTimeTracking":return(T=d.pool.find(this,{})).init&&T.init(this),(P=T.get("taskTimeTrackingSet")).addRef(r),T.release(this),P;case"PersonTimeTracking":return o.hasOwnProperty("showTimeSpent")&&!o.showTimeSpent?(P=this.get("emptyPersonTimeTrackingSet")).addRef(r):o.hasOwnProperty("startDate")?((T=this.get("personTimeTrackingPool").find(this,o)).init&&(T.init(O=this.findDataSet(this,{type:c,mode:o.mode}),d.filterPersonTimeTracking(o)),O.release(this)),(P=T.get("itemsSet")).addRef(r),T.release(this)):((T=d.pool.find(this,{})).init&&T.init(this),(P=T.get("personTimeTrackingSet")).addRef(r),T.release(this)),P}switch(o.mode){case"edited":switch($=o.type.docType){case"Person":return this.findDataSet(r,_.assign({},o,{mode:"original"}));case"Task":return(T=this.get("editedTasks").find(this,o)).init&&(T.init(O=this.findDataSet(this,_.assign({},o,{mode:"original"})),b=this.findDataSet(this,_.assign({},o,{mode:"changes"})),e.filter(o)),O.release(this),b.release(this)),(P=T.get("itemsSet")).addRef(r),T.release(this),P;default:throw new Error("Not supported model type (1): "+$)}break;case"changes":switch($=o.type.docType){case"Task":return(P=this.get("changes").get("tasksSet")).addRef(r);default:throw new Error("Not supported model type (2): "+$)}break;case"original":switch(($=o.type)!==u?$.docType:!D.get("hasRoles")||o.source?u.docType:"PeopleWithJson"){case"PeopleWithJson":return"function"==typeof(h=T=m.pool.find(this,o)).init&&h.init(this),(P=T.get("peopleSet")).addRef(r),T.release(this),P;case"Person":return delete o.source,"function"==typeof(g=T=t.pool.find(this,o)).init&&g.init(this),(P=T.get("peopleSet")).addRef(r),T.release(this),P;case"Project":return delete o.source,"function"==typeof(v=T=n.pool.find(this,o)).init&&v.init(this),(P=T.get("projectsSet")).addRef(r),T.release(this),P;case"TaskList":return delete o.source,"function"==typeof(k=T=a.pool.find(this,o)).init&&k.init(this),(P=T.get("taskListsSet")).addRef(r),T.release(this),P;case"Task":return"all"!==o.filter||o.hasOwnProperty("startDate")?((T=this.get("tasksPool").find(this,o)).init&&(T.init(O=this.findDataSet(this,{type:p,mode:"original",filter:"all"}),e.filter(o)),O.release(this)),(P=T.get("itemsSet")).addRef(r),T.release(this)):(!D.get("hasTimeReports")||o.source?(delete o.source,"function"==typeof(S=T=e.pool.find(this,o)).init&&S.init(this)):(T=y.pool.find(this,{})).init&&T.init(this),(P=T.get("tasksSet")).addRef(r),T.release(this)),P;default:throw new Error("Not supported model type (3): "+$)}}},P.prototype.requestSources=function(t,e,n){var r,o,i,a,u,c,l,p,d;s.prototype.requestSources.call(this,t,e,n);for(o in n){switch(d=n[o],l=_.assign({},d.params,e),u={type:p=d.type,mode:i=l.mode},r=p.docType){case"Tag":case"Person":case"Project":break;case"TaskList":u.project=l.project;break;case"PersonDayStat":u.startDate=l.startDate,u.endDate=l.endDate;break;case"PersonTimeTracking":u.showTimeSpent=l.showTimeSpent,u.startDate=l.startDate,u.endDate=l.endDate;break;case"Task":if("changes"!==i){if(f&&!("string"==typeof l.filter&&0<=["all","assigned","notassigned","overdue","noduedate","clipboard"].indexOf(l.filter)))throw new Error("Unexpected filter: "+l.filter);u.filter=l.filter,"all"!==l.filter&&"assigned"!==l.filter&&"notassigned"!==l.filter||(u.startDate=l.startDate,u.endDate=l.endDate),l.manager&&(u.manager=l.manager)}break;default:throw new Error("Not supported model type (4): "+r)}a=this.findDataSet(t,u),"undefined"==typeof(c=d.set)||c!==a?d.newSet=a:a.release(t)}},P.end(),P}(s),g.add(new P(g,"dataService"))}])},{"../../dscommon/DSChangesBase":74,"../../dscommon/DSDataEditable":76,"../../dscommon/DSDataFiltered":77,"../../dscommon/DSDataServiceBase":78,"../../dscommon/DSDataSource":79,"../../dscommon/DSObject":84,"../../dscommon/util":90,"../../utils/base64":92,"../config":19,"../models/Person":34,"../models/PersonTimeTracking":36,"../models/Tag":38,"../models/Task":39,"../models/TaskTimeTracking":41,"./PeopleWithJson":20,"./PersonDayStatData":21,"./TasksWithTimeTracking":22,"./dsChanges":23,"./teamwork/TWPeople":27,"./teamwork/TWProjects":28,"./teamwork/TWTags":29,"./teamwork/TWTaskLists":30,"./teamwork/TWTasks":31,"./teamwork/TWTimeTracking":32}],25:[function(t,e,n){var r,o,i,s;o=t("../../dscommon/util").assert,s=t("../../dscommon/util").serviceOwner,r=t("../models/Task.coffee"),e.exports=(i=angular.module("data/persistClipboard",[t("./dsDataService.coffee")])).name,i.factory("clipboardTasks",["localStorageService",function(t){var e,n,r,o,i;if(o={},null!==(i=t.get("clipboardTasks")))for(e=0,r=i.length;e<r;e++)n=i[e],o[n]=!0;return o}]),i.run(["dsDataService","localStorageService",function(t,e){var n,o;n=s.add(t.findDataSet(s,{type:r,mode:"original",filter:"clipboard"})),o=s.add(n.watchStatus(s,function(t,r){var i;"ready"===r&&(o(),(i=function(){var t;e.set("clipboardTasks",function(){var e;e=[];for(t in n.items)e.push(t);return e}())})(),s.add(n.watch(s,{add:i,remove:i})))}))}])},{"../../dscommon/util":90,"../models/Task.coffee":39,"./dsDataService.coffee":24}],26:[function(t,e,n){var r,o,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(u=angular.module("dscommon/DSDataTeamworkPaged",[])).name,s=t("../../../dscommon/util").assert,a=t("../../../dscommon/util").error,r=t("../../../dscommon/DSData"),o=t("../../../dscommon/DSDigest"),i=500,u.factory("DSDataTeamworkPaged",["DSDataSource","$rootScope","$q",function(t,e,n){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return c(a,e),a.begin("DSDataTeamworkPaged"),a.propDoc("source",t),a.propObj("cancel",{init:null}),a.propEnum("method",["httpGet","httpPost","httpPut"]),a.propStr("request"),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),a.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},a.prototype.load=function(){var t,e,r,a,u;if(s){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(u=this.get("request"))&&u.length>0))throw new Error("load(): Request is not specified")}this._startLoad()&&(e=this.set("cancel",n.defer()),r=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),t=function(t,e){return""+e+(e.indexOf("?")===-1?"?":"&")+"page="+t+"&pageSize="+i},this.startLoad(),(a=function(n){return function(s){var u;return function(){switch(u=this.get("method")){case"httpGet":return this.get("source").httpGet(t(s,this.get("request")),e);case"httpPost":return this.get("source").httpPost(t(s,this.get("request")),this.params.json,e);case"httpPut":return this.get("source").httpPut(t(s,this.get("request")),this.params.json,e)}}.call(n).then(function(t){var e;if(200===t.status){if(n.set("cancel",null),n.importResponse(t.data,t.status)===i)return void a(s+1);e=o.block(function(){return n.finalizeLoad()}),"object"==typeof e&&null!==e&&"then"in e?e.then(function(){n._endLoad(!0)}):n._endLoad(!0)}else r(t,0===t.status)},r)}}(this))(1))},a.end(),a}(r)}])},{"../../../dscommon/DSData":75,"../../../dscommon/DSDigest":80,"../../../dscommon/util":90}],27:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWPeople",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,o=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../models/Person"),s.factory("TWPeople",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,o){var i;return i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWPeople"),n.addPool(),n.propSet("people",r),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.peopleMap={}},n.prototype.importResponse=function(t){var e,n,o,i,s,a;for(e=0,a=t.people,n=0,i=a.length;n<i;n++)o=a[n],++e,s=r.pool.find(this,""+o.id,this.peopleMap),s.set("id",+o.id),s.set("name",(o["last-name"]+" "+o["first-name"].charAt(0).toUpperCase()+".").trim()),s.set("firstName",o["first-name"].trim()),s.set("avatar",o["avatar-url"]),s.set("email",o["email-address"]),s.set("companyId",+o["company-id"]),s.set("currentUser",!1);return e},n.prototype.finalizeLoad=function(){this.get("peopleSet").merge(this,this.peopleMap),delete this.peopleMap},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":79,"../../../dscommon/util":90,"../../models/Person":34,"./DSDataTeamworkPaged":26}],28:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWProjects",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,o=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../models/Project"),s.factory("TWProjects",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,o){var i;return i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWProjects"),n.addPool(),n.propSet("projects",r),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","projects.json?status=ACTIVE"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.projectsMap={}},n.prototype.importResponse=function(t){var e,n,o,i,s,a;for(e=0,a=t.projects,n=0,i=a.length;n<i;n++)o=a[n],++e,s=r.pool.find(this,""+o.id,this.projectsMap),s.set("id",parseInt(o.id)),s.set("name",o.name);return e},n.prototype.finalizeLoad=function(){this.get("projectsSet").merge(this,this.projectsMap),delete this.projectsMap},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":79,"../../../dscommon/util":90,"../../models/Project":37,"./DSDataTeamworkPaged":26}],29:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWTags",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,o=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../models/Tag"),s.factory("TWTags",["DSDataTeamworkPaged","DSDataSource","$rootScope","$http","$q",function(t,e,n,o,i){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWTags"),n.addPool(),n.propObj("cancel",{init:null}),n.propSet("tags",r),n.ds_dstr.push(function(){this.__unwatch()}),n.prototype.init=function(t){this.set("request","tags.json"),this.__unwatch=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){var t;this.tagsMap={},t=function(t){return function(e,n){return n||(e.hasOwnProperty("status")?toastr.error("Failed to load <i>data/tags.json</i>:<br/><br/> "+e.status+" "+e.statusText,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}):toastr.error("Invalid <i>data/tags.json</i>:<br/><br/> "+e.message,null,{positionClass:"toast-top-center",newestOnTop:!0,timeOut:-1}),t.set("cancel",null)),[]}}(this),this.tagsJson=o.get("data/tags.json?t="+(new Date).getTime(),{timeout:this.set("cancel",i.defer()),transformResponse:function(t,e,n){if(200===n)return JSONLint.parse(t)}}).then(function(e){return function(n){var r,o,i,s,a,u;if(200!==n.status)return t(n,0===n.status);if(e.set("cancel",null),u=n.data,!Array.isArray(u))return console.error("invalid tags.json"),[];for(r=!1,o=i=0,s=u.length;i<s;o=++i)a=u[o],"string"==typeof a.name&&a.name.length>=0||(r=!0,console.error("invalid tags.json: invalid 'name'",a)),a.hasOwnProperty("priority")?"number"!=typeof a.priority&&(r=!0,console.error("invalid tags.json: invalid 'priority'",a)):a.priority=o,!a.hasOwnProperty("color")||"string"==typeof a.color&&a.color.length>=0||(r=!0,console.error("invalid tags.json: invalid 'color'",a)),!a.hasOwnProperty("border")||"string"==typeof a.border&&a.border.length>=0||(r=!0,console.error("invalid tags.json: invalid 'border'",a));return r?[]:u}}(this),t)},n.prototype.importResponse=function(t){var e,n,o,i,s,a,u,c;for(e=0,a=t.tags,n=0,i=a.length;n<i;n++)o=a[n],++e,s=r.pool.find(this,c=o.name,this.tagsMap),s.set("id",parseInt(o.id)),s.set("name",c),s.set("color",u=o.color),s.set("twColor",u);return e},n.prototype.finalizeLoad=function(){return this.tagsJson.then(function(t){return function(e){var n,r,o,i;for(t.tagsJson=null,n=0,r=e.length;n<r;n++)o=e[n],t.tagsMap.hasOwnProperty(o.name)&&(i=t.tagsMap[o.name],i.set("name",o.name),o.hasOwnProperty("priority")&&i.set("priority",o.priority),o.color&&i.set("color",o.color),o.border&&i.set("border",o.border));t.get("tagsSet").merge(t,t.tagsMap),delete t.tagsMap}}(this))},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":79,"../../../dscommon/util":90,"../../models/Tag":38,"./DSDataTeamworkPaged":26}],30:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("data/teamwork/TWTaskLists",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,r=t("../../models/Project"),o=t("../../models/TaskList"),a.factory("TWTaskLists",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,i){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return u(n,t),n.begin("TWTaskLists"),n.addPool(),n.propSet("taskLists",o),n.propDoc("project",r),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){var n;this.set("project",n=this.get("params").project),this.set("request","projects/"+this.project.get("id")+"/tasklists.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.taskListsMap={}},n.prototype.importResponse=function(t){var e,n,r,i,s,a,u;for(e=0,s=this.get("project"),a=t.tasklists,n=0,i=a.length;n<i;n++)r=a[n],++e,u=o.pool.find(this,""+r.id,this.taskListsMap),u.set("id",parseInt(r.id)),u.set("name",r.name),u.set("project",s),u.set("position",r.position);return e},n.prototype.finalizeLoad=function(){this.get("taskListsSet").merge(this,this.taskListsMap),delete this.taskListsMap},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":79,"../../../dscommon/util":90,"../../models/Project":37,"../../models/TaskList":40,"./DSDataTeamworkPaged":26}],31:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m,y,g,v,_=function(t,e){function n(){this.constructor=t}for(var r in e)w.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(g=angular.module("data/teamwork/TWTasks",[t("../../../dscommon/DSDataSource"),t("./TWTags")])).name,m=t("../../../dscommon/util").assert,y=t("../../../dscommon/util").error,v=t("../../ui/time"),p=t("../../models/Task"),l=t("../../models/Tag"),s=t("../../models/Person"),d=t("../../models/TaskList"),u=t("../../models/Project"),h=t("../../models/TaskTimeTracking"),a=t("../../models/PersonTimeTracking"),r=t("../../../dscommon/DSData"),o=t("../../../dscommon/DSDigest"),i=t("../../../dscommon/DSTags"),f=t("../../models/types/TaskSplit"),c=t("../../utils/RMSData"),g.factory("TWTasks",["TWTags","DSDataSource","dsChanges","config","$injector","$http","$q",function(t,e,n,y,g,w,k){var S;return S=function(t){function w(){return S.apply(this,arguments)}var S,D,b,T,O,P;return _(w,t),p.TWTask=w,p.planTag=y.planTag,w.begin("TWTasks"),w.addPool(),w.propDoc("source",e),w.propStr("request"),w.propSet("tasks",p),w.propPool("completedTasksPool",p),w.propObj("cancel",{init:null}),w.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),this.__unwatch1(),this.__unwatch2()}),D=w,w.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},w.propObj("visiblePersonTTracking",{init:{}}),S=function(){var t,e,n,o;r.apply(this,arguments),this.peopleMap={},this.projectMap={},this.taskListMap={},m&&a.prototype.hasOwnProperty("setVisible")&&console.error("TWTasks:ctor: setVisible expects that their will be only one instance of TWTasks object"),o=this.get("visiblePersonTTracking"),t=this.get("completedTasksPool"),n=this.get("tasksSet"),e=this,a.prototype.setVisible=function(r){var i,s;r?1===(this.__visCount=(this.__visCount||0)+1)&&(o[this.$ds_key]=this,null===(i=this.get("task"))&&((i=n.items[s=this.get("taskId")])?this.set("task",i):(this.set("task",i=t.find(this,""+s)),null===i.get("timeTracking")&&(i.set("id",s),i.set("timeTracking",h.pool.find(this,i.$ds_key)),O.call(e)),i.release(this))),i.setVisible(!0)):0===--this.__visCount&&(delete o[this.$ds_key],this.get("task").setVisible(!1))}},T=function(t,e){var n,r,o;return null!==(n=e.get("duedate"))&&(null===(o=e.get("split"))?t.startDate<=(r=e.get("duedate"))&&r<=t.endDate:t.startDate<=o.lastDate(n=e.get("duedate"))&&o.firstDate(n)<=t.endDate)},w.filter=function(t){var e,n;switch(n=[],t.filter){case"all":moment.isMoment(t.startDate)?n.push(function(e){return T(t,e)}):n.push(function(t){return!0});break;case"assigned":n.push(function(e){return null!==e.get("responsible")&&T(t,e)});break;case"notassigned":n.push(function(e){return null===e.get("responsible")&&T(t,e)});break;case"overdue":n.push(function(t){var e;return null!==(e=t.get("duedate"))&&e<v.today});break;case"noduedate":n.push(function(t){return null===t.get("duedate")});break;case"clipboard":n.push(function(t){return t.get("clipboard")});break;default:throw new Error("Not supported filter: "+t.filter)}return t.manager&&(e=s.pool.items[t.manager].projects)&&n.push(function(t){return e.hasOwnProperty(t.get("project").get("id"))}),1===n.length?n[0]:function(t){var e,r,o;for(e=0,r=n.length;e<r;e++)if(o=n[e],!o(t))return!1;return!0}},w.prototype.init=function(t){var e,n,r,i;this.set("source",t.get("dataSource")),this.set("request",function(){switch((n=this.get("params")).filter){case"all":return moment.isMoment(n.startDate)?"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&getSubTasks=no":"tasks.json?getSubTasks=no";case"assigned":return"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&responsible-party-ids=-1&getSubTasks=no";case"notassigned":return"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&responsible-party-ids=0&getSubTasks=no";case"overdue":return"tasks.json?filter=overdue&getSubTasks=no";case"noduedate":return"tasks.json?filter=nodate&include=noduedate&getSubTasks=no";default:throw new Error("Unexpected filter: "+n.filter)}}.call(this)),e=w.filter(this.params),i=this.get("tasksSet"),this.__unwatch1=p.pool.watch(this,function(t){return function(n){e(n)?i.items.hasOwnProperty(n.$ds_key)||i.add(t,n.addRef(t)):i.items.hasOwnProperty(n.$ds_key)&&i.remove(n)}}(this)),r=t.findDataSet(this,{type:l,mode:"original"}),this.__unwatch2=r.watchStatus(this,function(t){return function(e,n){switch(n){case"ready":o.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this)),r.release(this),this.init=null},P=function(){var t,e,n,r,o;e=this.peopleMap;for(t in e)o=e[t],o.release(this),delete this.peopleMap[t];n=this.taskListMap;for(t in n)o=n[t],o.release(this),delete this.taskListMap[t];r=this.projectMap;for(t in r)o=r[t],o.release(this),delete this.projectMap[t]},b=function(t,e){var n,r,o,a,p,h,m,y,g,v,_,w,k,S,D,b,T,O,P;if(g=s.pool.find(this,""+e["creator-id"],this.peopleMap),v=u.pool.find(this,""+e["project-id"],this.projectMap),T=d.pool.find(this,""+e["todo-list-id"],this.taskListMap),T.set("project",v),t.set("creator",g),t.set("project",v),t.set("taskList",T),t.set("title",e.content),t.set("estimate",(p=e["estimated-minutes"])?moment.duration(p,"minutes"):null),t.set("duedate",(a=e["due-date"])?moment(a,"YYYYMMDD"):null),t.set("startDate",(r=e["start-date"])?moment(r,"YYYYMMDD"):null),t.set("completed",e.completed),t.set("isReady",!0),(O=e.timeIsLogged)&&t.set("firstTimeEntryId",O),o=e.description,n=c.get(o),null!==n&&(o=c.clear(o),n.hasOwnProperty("split")&&null!==a&&t.set("split",k=new f(n.split))),t.set("description",o),e["responsible-party-ids"]&&t.set("responsible",(w=e["responsible-party-ids"].split(",")).length>0?s.pool.find(this,""+w[0],this.peopleMap):null),g.set("id",parseInt(e["creator-id"])),e.hasOwnProperty("tags")){for(b=null,_=e.tags,h=0,y=_.length;h<y;h++)S=_[h],D=(null!=b?b:b={})[S.name]=l.pool.find(this,S.name),D.set("id",S.id),D.set("name",S.name),D.set("color",D.set("twColor",S.color)),(b||(b={}))[S.name]=D;if(null===b)t.set("tags",null);else{t.set("tags",new i(this,b)).release(this);for(m in b)P=b[m],P.release(this)}}else t.set("tags",null),t.set("plan",!1);T.set("id",parseInt(e["todo-list-id"])),T.set("name",e["todo-list-name"]),v.set("id",parseInt(e["project-id"])),v.set("name",e["project-name"])},w.prototype.load=function(){var t,e,r,i,s,a,u;if(m&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(r=null,g.invoke(["clipboardTasks",function(t){r=t}]),u={},i=function(t){return function(e){var n,o,i,s,a,c,l;p.pool.enableWatch(!1);try{for(s=l=e["todo-items"],n=0,i=s.length;n<i;n++)o=s[n],a=p.pool.find(t,c=""+o.id,u),a.set("id",parseInt(o.id)),b.call(t,a,o),r.hasOwnProperty(c)&&(a.clipboard=!0)}finally{p.pool.enableWatch(!0)}return 250===l.length}}(this),s=function(t){return function(e,n){var r,o;n||(console.error("error: ",e),t.set("cancel",null));for(r in u)o=u[r],o.release(t);P.call(t),t._endLoad(!1)}}(this),(t=this.get("cancel"))&&t.resolve(),(a=function(t){this.get("source").httpGet(this.get("request")+"&page="+t+"&pageSize=250",this.set("cancel",k.defer())).then(function(n){return function(r){200===r.status?(n.set("cancel",null),o.block(function(){return i(r.data,r.status)})?a.call(n,t+1):(o.block(function(){e.call(n),n.get("tasksSet").merge(n,u),P.call(n)}),n._endLoad(!0),O.call(n))):s(r,0===r.status)}}(this),s)}).call(this,1),e=function(){var t,e,r;t=n.tasks;for(r in t)e=t[r],u.hasOwnProperty(r)||e._clearChanges()})},O=function(){var t,e,n,r,i,s;if(null===this.get("cancel")){i=null,n=this.get("visiblePersonTTracking");for(t in n)if(s=n[t],!(r=s.get("task")).get("isReady")){i=r;break}null!==i&&(e=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),i.release(t),P.call(t)}}(this),this.get("source").httpGet("/tasks/"+i.id+".json",this.set("cancel",k.defer())).then(function(t){return function(n){200===n.status?(t.set("cancel",null),o.block(function(){b.call(t,i,n.data["todo-item"]),P.call(t),O.call(t)})):e(n,0===n.status)}}(this),e))}},w.tasksSortRule=function(t,e){var n,r,o,i,s,a;return(r=t.get("priority"))!==(a=e.get("priority"))?r-a:(n=null!=(o=t.get("estimate"))?o.valueOf():void 0)!==(s=null!=(i=e.get("estimate"))?i.valueOf():void 0)?void 0===n?1:void 0===s?-1:s-n:t.get("id")-e.get("id")},w.end(),w}(r)}])},{"../../../dscommon/DSData":75,"../../../dscommon/DSDataSource":79,"../../../dscommon/DSDigest":80,"../../../dscommon/DSTags":88,"../../../dscommon/util":90,"../../models/Person":34,"../../models/PersonTimeTracking":36,"../../models/Project":37,"../../models/Tag":38,"../../models/Task":39,"../../models/TaskList":40,"../../models/TaskTimeTracking":41,"../../models/types/TaskSplit":43,"../../ui/time":58,"../../utils/RMSData":73,"./TWTags":29}],32:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m,y=function(t,e){function n(){this.constructor=t}for(var r in e)g.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWTimeTracking",[t("../../config"),t("../../../dscommon/DSDataSource"),t("../../db")])).name,d=t("../../../dscommon/util").assert,f=t("../../../dscommon/util").error,m=t("../../ui/time"),u=t("../../models/Task"),l=t("../../models/TaskTimeTracking"),s=t("../../models/PersonTimeTracking"),r=t("../../../dscommon/DSData"),o=t("../../../dscommon/DSDigest"),c=t("../../models/types/TaskSplit"),a=t("../../utils/RMSData"),p=500,i=50,h.factory("TWTimeTracking",["DSDataSource","$q","db","config",function(t,e,n,a){var u;return u=function(n){function u(){return c.apply(this,arguments)}var c;return y(u,n),u.begin("TWTimeTracking"),u.addPool(),u.propDoc("source",t),u.propSet("taskTimeTracking",l),u.propSet("personTimeTracking",s),u.propObj("cancel",null),u.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),u.propObj("visibleTTracking",{init:{}}),c=function(){var t;r.apply(this,arguments),d&&l.prototype.hasOwnProperty("setVisible")&&console.error("TWTimeTracking:ctor: setVisible expects that their will be only one instance of TWTimeTracking object"),t=this.get("visibleTTracking"),l.prototype.setVisible=function(e){e?1!==(this.__visCount=(this.__visCount||0)+1)||this.get("isReady")||(t[this.$ds_key]=this):0===--this.__visCount&&delete t[this.$ds_key]}},u.prototype.clear=function(){var t;r.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchB&&this.__unwatchB()},u.filterPersonTimeTracking=function(t){return function(e){var n;return t.startDate<=(n=moment(e.get("date").startOf("day")))&&n<=t.endDate}},u.prototype.init=function(e){this.__unwatchA=t.setLoadAndRefresh.call(this,e),this.init=null},u.prototype.load=function(){var t,n,r,u,c,f,h,y,g,v,_,w,k,S,D,b;if(d&&!this.get("source"))throw new Error("load(): Source is not specified");if(this._startLoad()){"function"==typeof this.__unwatchB&&this.__unwatchB(),s.pool.enableWatch(!1),l.pool.enableWatch(!1),_=l.pool.items;for(k in _)D=_[k],D.set("isReady",!1),D.set("totalMin",0),D.set("priorTodayMin",0),D.set("timeEntries",{});w=s.pool.items;for(g in w)D=w[g],D.set("timeMin",0);v={},S={},c=function(t){return function(e){var n,r,o,i,a,u,c,d,f,h,y,g;for(r=0,i=e.length;r<i;r++)o=e[r],moment(o.date)>=m.historyLimit&&(f=parseInt(h=o["todo-item-id"]))&&(g=o.id,u=parseInt(c=o["person-id"]),a=60*parseInt(o.hours)+parseInt(o.minutes),n=moment(o.date).startOf("day"),d=s.pool.find(t,c+"-"+f+"-"+n.valueOf(),v),d.set("personId",u),d.set("date",n),d.set("taskId",f),d.set("timeMin",d.get("timeMin")+a),S.hasOwnProperty(h)?y=S[h]:(y=l.pool.find(t,h,S),y.set("taskId",f)),y.set("totalMin",y.get("totalMin")+a),y.get("timeEntries")[g]=!0,n<m.today&&y.set("priorTodayMin",y.get("priorTodayMin")+a));return e.length===p}}(this),n=function(t){return function(){o.block(function(){var e,n;e=l.pool.items;for(k in e)n=e[k],n.set("isReady",!0);t.__unwatchB||(t.__unwatchB=l.pool.watch(t,function(t){t.set("isReady",!0)})),s.pool.enableWatch(!0),t.get("personTimeTrackingSet").merge(t,v),l.pool.enableWatch(!0),t.get("taskTimeTrackingSet").merge(t,S)}),t._endLoad(!0)}}(this),f=function(t){return function(e,n){var r,o;n||(console.error("error: ",e),t.set("cancel",null));for(r in S)o=S[r],o.release(t);t._endLoad(!1)}}(this),y={},h=function(t){return function(r){y.hasOwnProperty(r)?o.block(function(){return c(y[r])})?h(r+1):n():t.get("source").httpGet("time_entries.json?page="+r+"&pageSize="+p,t.set("cancel",e.defer())).then(function(e){var i;200===e.status?(t.set("cancel",null),(i=e.data["time-entries"])&&0!==i.length?moment(i[i.length-1].date)<m.historyLimit?(a.set("histStart",r+1),i.length===p?h(r+1):n()):o.block(function(){return c(i)})?h(r+1):n():n()):f(e,0===e.status)},f)}}(this),b=1,t=i,(u=a.get("histStart"))>=0?h(u):(r=function(s){return function(u){s.get("source").httpGet("time_entries.json?page="+u+"&pageSize="+p,s.set("cancel",e.defer())).then(function(e){var l,p;200===e.status?(s.set("cancel",null),(l=e.data["time-entries"])&&0!==l.length?moment(l[0].date)>=m.historyLimit?b===u?(a.set("histStart",u),o.block(function(){return c(l)})?h(u+1):n()):(y[u]=l,r(b+Math.floor(((t=u)-b)/2))):moment(l[l.length-1].date)<m.historyLimit?t===u?(p=[t,t+i],b=p[0],t=p[1],r(t)):t===u+1?n():(b=u+1,r(b+Math.floor((t-b)/2))):(a.set("histStart",u),o.block(function(){return c(l)})?h(u+1):n()):r(b+Math.floor(((t=u)-b)/2))):f(e,0===e.status)},f)}}(this))(t)}},u.end(),u}(r)}])},{"../../../dscommon/DSData":75,"../../../dscommon/DSDataSource":79,"../../../dscommon/DSDigest":80,"../../../dscommon/util":90,"../../config":19,"../../db":33,"../../models/PersonTimeTracking":36,"../../models/Task":39,"../../models/TaskTimeTracking":41,"../../models/types/TaskSplit":43,"../../ui/time":58,"../../utils/RMSData":73}],33:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=t("../dscommon/util").assert,s=t("../dscommon/util").serviceOwner,r=t("../dscommon/DSObject"),e.exports=(i=angular.module("db",[])).name,i.factory("db",["$q",function(t){var e,n;return n=null,e=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return a(r,e),r.begin("DB"),r.propConst("name","RMS"),r.propConst("ver",4),r.prototype.logQuota=function(){},r.prototype.openDB=function(){var e;return window.indexedDB?(n||(n=t.defer(),e=window.indexedDB.open(this.get("name"),this.get("ver")),e.onsuccess=function(t){console.info("IndexedDB.openDB: Success"),n.resolve(t.target.result)},e.onerror=function(t){console.warn("IndexedDB.openDB: Error",t),n.reject()},e.onupgradeneeded=function(t){var e,r,o;console.info("IndexedDB.openDB: Upgrade",t),e=t.target.result;try{e.deleteObjectStore("timetracking")}catch(o){r=o}e.createObjectStore("timetracking",{keyPath:"page"}),n.resolve(e)}),n.promise):(console.warn("IndexedDB.openDB: Missing window.indexedDB, so there will be no local time tracking info"),void n.reject())},r.end(),r}(r),s.add(new e(s,"db"))}])},{"../dscommon/DSObject":84,"../dscommon/util":90}],34:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=t("../../dscommon/DSDocument"),o=t("../../dscommon/DSTags"),e.exports=i=function(t){function e(){return n.apply(this,arguments)}var n;return u(e,t),e.begin("Person"),
o.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propBool("missing"),e.propDuration("contractTime"),n=function(t,e){r.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(r)},{"../../dscommon/DSDocument":81,"../../dscommon/DSTags":88,"../../dscommon/util":90}],35:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=t("../../dscommon/DSObject"),o=t("./Person"),e.exports=i=function(t){function e(){return i.apply(this,arguments)}var n,i;return u(e,t),e.begin("PersonDayStat"),e.DayStat=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DayStat"),e.propMoment("day"),e.propNum("tasksCount"),e.propDuration("contract"),e.propDuration("tasksTotal"),e.propDuration("timeLeft"),e.propDuration("timeSpent"),e.end(),e}(r),i=function(t,e,i,u){var c,l,p,d,f;if(r.call(this,t,e),s)for(i instanceof o||a.invalidArg("person"),Array.isArray(u)||a.invalidArg("days"),p=0,f=u.length;p<f;p++)c=u[p],moment.isMoment(c)||a.invalidArg("days");this.set("person",i),d=0,this.get("dayStatsList").merge(this,function(){var t,e,r;for(r=[],t=0,e=u.length;t<e;t++)c=u[t],r.push(((l=new n(this,""+d++)).set("day",c),l));return r}.call(this))},e.propDoc("person",o),e.propList("dayStats",n),e.propDuration("totalPeriodTime"),e.end(),e}(r)},{"../../dscommon/DSObject":84,"../../dscommon/util":90,"./Person":34}],36:[function(t,e,n){var r,o,i,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=t("../../dscommon/DSObject"),i=t("../models/Task"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("PersonTimeTracking"),e.addPool(!0),e.propNum("personId",{init:0}),e.propMoment("date"),e.propNum("taskId",{init:0}),e.propDoc("task",i),e.propNum("timeMin",{init:0}),e.end(),e}(r)},{"../../dscommon/DSObject":84,"../models/Task":39}],37:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,r=t("../../dscommon/DSObject"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("status"),e.propObj("people"),e.end(),e}(r)},{"../../dscommon/DSObject":84,"../../dscommon/util":90}],38:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,r=t("../../dscommon/DSDocument"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Tag"),e.addPool(),e.propNum("id",{init:0}),e.propStr("name"),e.propStr("color"),e.propStr("twColor"),e.propStr("border"),e.propNum("priority",{init:1e3}),e.end(),e}(r)},{"../../dscommon/DSDocument":81,"../../dscommon/util":90}],39:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m,y=function(t,e){function n(){this.constructor=t}for(var r in e)g.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty;f=t("../../dscommon/util").assert,h=t("../../dscommon/util").error,m=t("../ui/time"),o=t("../../dscommon/DSDocument"),a=t("./Project"),s=t("./Person"),l=t("./TaskList"),d=t("./TaskTimeTracking"),u=t("./Tag"),i=t("../../dscommon/DSTags"),r=t("./types/Comments"),p=t("./types/TaskSplit"),e.exports=c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var n,o,c,f,h;return y(e,t),e.begin("Task"),r.addPropType(e),p.addPropType(e),i.addPropType(e),e.defaultTag=n={name:"[default]",priority:1e3},e.addPool(!0),h=function(t,r){var o,i,s,a,u,c;if(t.set("plan",!(!r||!r.get(e.planTag))),null!==r){u=1e6,c=null,o=r.map;for(s in o)i=o[s],(a=i.get("priority"))<u&&(c=i,u=a);t.__setCalcPriority(c.priority),t.__setCalcStyle(c)}else t.__setCalcPriority(n.priority),t.__setCalcStyle(n)},c={__onChange:function(t,n,r,o){var s,a,c;switch(n){case"plan":c=t.get("tags"),c?(c=c.clone(this),r?c.get(e.planTag)||(c.set(e.planTag,a=u.pool.find(this,e.planTag)),a.release(this),t.set("tags",c)):c.get(e.planTag)&&(c.set(e.planTag,!1),t.set("tags",c.empty()?null:c)),c.release(this)):r&&((s={})[e.planTag]=a=u.pool.find(this,e.planTag),c=new i(this,s),t.set("tags",c),c.release(this));break;case"tags":h(t,r)}}},f={__onChange:function(t,e,n,r){"tags"===e&&h(t,n)}},e.ds_ctor.push(function(){this.__proto__.constructor.ds_editable?this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(c):this.$ds_evt=[c]:this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(f):this.$ds_evt=[f]}),e.str=function(t){return null===t?"":t.get("title")},e.propNum("id",{init:0}),e.propStr("title"),e.propDuration("estimate").str=function(t){var e,n,r;return e=Math.floor(t.asHours()),n=t.minutes(),r=e?e+"h":"",n&&(r+=" "+n+"m"),r||(r="0"),r},e.propMoment("duedate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propMoment("startDate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propDoc("creator",s),e.propDoc("responsible",s),e.propDoc("taskList",l),e.propDoc("project",a),e.propTaskRelativeSplit("split"),e.propStr("description",{str:function(t){return t&&0!==t.length?t.length<=20?t:t.substr(0,20)+"...":""}}),e.propComments("comments"),e.propDoc("timeTracking",d,{write:null}),e.propStr("firstTimeEntryId",{write:null}),e.propBool("completed"),e.propBool("isReady",{write:null}),e.propBool("plan",{write:null,read:null}),e.propDSTags("tags"),e.propNum("priority",{init:n.priority,calc:!0}),e.propObj("style",{init:function(){return n},calc:!0}),e.propBool("clipboard",{init:!1,common:!0}),e.prototype.isOverdue=function(){var t;return null!==(t=this.get("duedate"))&&t<m.today},e.prototype.timeWithinEstimate=function(){var t;return null===(t=this.get("estimate"))?0:Math.min(100,Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))},e.prototype.timeAboveEstimate=function(){var t,e;return null===(t=this.get("estimate"))?0:(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))<=100?0:e>200?100:e-100},e.prototype.timeReported=function(){var t,e;return null===(t=this.get("estimate"))?"":(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))>200?e+" %":""},e.prototype.grade=function(){var t;return null===(t=this.get("estimate"))?"":t.asMinutes()<60?"easy":t.asMinutes()>=60&&t.asMinutes()<240?"medium":t.asMinutes()>=240&&t.asMinutes()<480?"hard":t.asMinutes()>=480?"complex":void 0},e.prototype.setVisible=function(t){var e,n;t?1===(this.__visCount=(this.__visCount||0)+1)&&null!=(e=this.get("timeTracking"))&&e.setVisible(!0):0===--this.__visCount&&null!=(n=this.get("timeTracking"))&&n.setVisible(!1)},e.end(),o=e.Editable.prototype.init,e.Editable.prototype.init=function(){o.apply(this,arguments),h(this,this.get("tags"))},e}(o)},{"../../dscommon/DSDocument":81,"../../dscommon/DSTags":88,"../../dscommon/util":90,"../ui/time":58,"./Person":34,"./Project":37,"./Tag":38,"./TaskList":40,"./TaskTimeTracking":41,"./types/Comments":42,"./types/TaskSplit":43}],40:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=t("../../dscommon/DSObject"),o=t("./Project"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskList"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propDoc("project",o),e.propNum("position"),e.end(),e}(r)},{"../../dscommon/DSObject":84,"../../dscommon/util":90,"./Project":37}],41:[function(t,e,n){var r,o,i=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("../../dscommon/DSObject"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("TaskTimeTracking"),e.addPool(!0),e.propNum("taskId",{init:0}),e.propBool("isReady"),e.propNum("totalMin",{init:0}),e.propNum("priorTodayMin",{init:0}),e.propObj("timeEntries",{init:{}}),e.end(),e}(r)},{"../../dscommon/DSObject":84}],42:[function(t,e,n){var r,o,i,s;i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,o=t("../../../dscommon/DSDocument"),e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propComments=function(n,r){var o;return i&&r&&"function"!=typeof r&&s.invalidArg("valid"),r=(o=r)?function(t){return(null===t||Array.isArray(t))&&o(t)?t:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"comments",valid:r,read:function(e){return null!==e?new t(e):null},str:function(t){var e;return 0===t.list.length?"":(e=t.list[0]).length<=20?e:e.substr(0,20)+"..."},equal:function(t,e){var n,r,o,i,s;if(null===t||null===e)return t===e;if(t.list.length!==e.list.length)return!1;for(s=t.list,n=r=0,o=s.length;r<o;n=++r)if(i=s[n],i!==e.list[n])return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,r,o,a;if(i)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(n=0,r=e.length;n<r;n++)a=e[n],"string"!=typeof a&&s.invalidArg("persisted");1===arguments.length&&"object"==typeof(o=arguments[0])&&o.__proto__===t.prototype?this.list=o.list.slice():this.list=e||[]},t.prototype.clone=function(){return new t(this)},t.prototype.add=function(t){this.list.push(t)},t.prototype.unshift=function(t){this.list.unshift(t)},t.prototype.shift=function(){return this.list.shift()},t.prototype.valueOf=function(){return this.list},t.prototype.clear=function(){this.list=[]},t}()},{"../../../dscommon/DSDocument":81,"../../../dscommon/util":90}],43:[function(t,e,n){var r,o,i,s;i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,r=t("../../../dscommon/DSDocument"),e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propTaskRelativeSplit=function(n,r){var o;return i&&r&&"function"!=typeof r&&s.invalidArg("valid"),r=(o=r)?function(e){return(null===e||"object"==typeof e&&e instanceof t)&&o(e)?e:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"taskRelativeSplit",valid:r,read:function(e){return null!==e?new t(e):null},str:function(t){return t?"split":""},equal:function(t,e){var n,r,o,i,s,a;if(null===t||null===e)return t===e;if((o=null!=t?t.list:void 0).length!==(s=null!=e?e.list:void 0).length)return!1;for(n=r=0,i=o.length;r<i;n=r+=2)if(a=o[n],a!==s[n]||o[n+1].valueOf()!==s[n+1].valueOf())return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,r,o,a,u,c,l,p,d;if(i)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(e.length%2!==0&&s.invalidArg("persisted"),o=0,u=e.length;o<u;o++)d=e[o],"number"!=typeof d&&s.invalidArg("persisted");if(1===arguments.length&&"object"==typeof(p=arguments[0])&&p.__proto__===t.prototype)this.list=p.list.slice();else if(this.list=l=[],Array.isArray(e))for(r=a=0,c=e.length;a<c;r=a+=2)n=e[r],l.push(moment.duration(n,"day").valueOf()),l.push(moment.duration(e[r+1],"minute"))},t.prototype.clone=function(){return new t(this)},t.prototype.set=function(t,e,n){var r,o,a,u,c,l,p;for(i&&(moment.isMoment(t)||s.invalidArg("duedate"),moment.isMoment(e)||s.invalidArg("date"),null===n||moment.isDuration(n)||s.invalidArg("estimate")),o=e.diff(t),p=l=this.list,a=u=0,c=p.length;u<c;a=u+=2){if(r=p[a],r===o){if(null!==n&&0!==n.valueOf()){if(l[a+1].valueOf()===n.valueOf())return;l[a+1]=n}else l.splice(a,2);return void delete this.value}if(o<r)return 0!==(null!=n?n.valueOf():void 0)&&l.splice(a,0,o,n),void delete this.value}return 0!==(null!=n?n.valueOf():void 0)&&(delete this.value,l.push(o),l.push(n)),this},t.prototype.get=function(t,e){var n,r,o,a,u,c,l;for(i&&(moment.isMoment(t)||s.invalidArg("duedate"),moment.isMoment(e)||s.invalidArg("date")),r=e.diff(t),l=c=this.list,o=a=0,u=l.length;a<u;o=a+=2)if(n=l[o],n===r)return c[o+1];return null},t.prototype.day=function(t,e){var n;return i&&(moment.isMoment(e)||s.invalidArg("date")),Object.defineProperty(n={},"val",{get:function(n){return function(){return n.get(t(),e)}}(this),set:function(n){return function(r){return n.set(t(),e,r)}}(this)}),n},t.prototype.valueOf=function(){var t,e,n,r,o,i,s,a,u;if(u=this.value)return u;for(this.value=s=[],i=o=this.list,e=n=0,r=i.length;n<r;e=n+=2)a=i[e],t=o[e+1],s.push(moment.duration(a).asDays()),s.push(t.asMinutes());return s},t.prototype.shift=function(t,e){var n,r,o,a,u,c,l;if(i)switch(arguments.length){case 1:"number"!=typeof t&&s.invalidArg("diff");break;case 2:moment.isMoment(t)||s.invalidArg("newDuedate"),moment.isMoment(e)||s.invalidArg("oldDuedate");break;default:throw new Error("Invalid arguments")}if(delete this.value,n="number"==typeof t?t:t.diff(e),0!==n)for(c=u=this.list,r=o=0,a=c.length;o<a;r=o+=2)l=c[r],u[r]-=n},t.prototype.firstDate=function(t){var e;return i&&(moment.isMoment(t)||s.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[0]):null},t.prototype.lastDate=function(t){var e;return i&&(moment.isMoment(t)||s.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[e.length-2]):null},t.prototype.clear=function(){delete this.value,this.list=[]},t.prototype.fixEstimate=function(t){var e,n,r,o,i,s;if(t>0)this.list[this.list.length-1].add(t);else if(t<0)for(i=o=this.list.slice(1),e=n=0,r=i.length;n<r;e=n+=2)if(s=i[e],(t+=s.valueOf())>0){this.list[e+1]=moment.duration(t),this.list=this.list.slice(e);break}},Object.defineProperty(t.prototype,"total",{get:function(){var t,e,r,o,i,s;if(0===(r=this.list).length)return n;if(1===r.length)return r[1];for(i=moment.duration(r[1]),o=r.slice(3),t=0,e=o.length;t<e;t+=2)s=o[t],i.add(s);return i}}),t}()},{"../../../dscommon/DSDocument":81,"../../../dscommon/util":90}],44:[function(t,e,n){var r;e.exports=(r=angular.module("app",["ui.router","ui.select",t("./ui/ui"),t("./data/dsDataService"),t("./data/persistClipboard"),t("./svc/emails/emails"),t("./db")])).name,r.run(["config","$rootScope","db",function(t,e,n){e.Math=Math,e.taskModal={},e.startDateVal=null,e.view3ActiveTab=null,e.connnected=null}]),r.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(t,e,n){n.html5Mode(!0),t.otherwise("/")}])},{"./data/dsDataService":24,"./data/persistClipboard":25,"./db":33,"./svc/emails/emails":45,"./ui/ui":59}],45:[function(t,e,n){var r,o,i,s,a;i=t("../../../utils/base64"),o=t("../../models/Task"),r=t("../../models/Person"),e.exports=(a=angular.module("svc-emails",[t("../../data/dsDataService")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,r){e.state({name:"emails",url:"/emails",templateUrl:function(){return"./svc/emails/main.html"},controller:s})}]),s=["$scope","$http","$sce","config","dsDataService",function(t,e,n,s,a){var u,c;t.dateCheck="",t.isDateCheckOk=function(){return!!/\d{1,2}\.\d{2}\.\d{4}/.test(t.dateCheck)&&moment(t.dateCheck,"DD.MM.YYYY").startOf("day").valueOf()===moment().startOf("day").valueOf()},t.state="notStarted",t.data=null,t.formatDuration=u=function(t){var e,n,r;return e=Math.floor(t.asHours()),n=t.minutes(),r=e?e+" ч.":"",n&&(r&&(r+=" "),r+=n+" мин."),r},t.prepare=function(){var e,i,s,c,l,p,d,f,h;c=a.findDataSet(this,{type:r,mode:"original"}),p=a.findDataSet(this,{type:o,mode:"original",filter:"assigned",startDate:l=moment().startOf("week"),endDate:i=moment(l).add(6,"days")}),s=function(t){var e,r,o;return r=u(t.planHours),e=u(t.optHours),o=r,e&&(o&&(o+=" + "),o+="<span style='background-color:rgb(255,153,0)'>"+e+"</span>"),t.hours=n.trustAsHtml(o),t},e=function(){var e,n,r,o,a,d,f,h,m,y,g,v,w,k,S,D,b,T,O;for(console.info("compute started..."),t.emails=o=[],k=h=_.sortBy(_.map(c.items),function(t){return t.get("name")}),d=0,f=k.length;d<f;d++)if(m=k[d],null!==m.get("roles")){w={},S=p.items;for(T in S)if(b=S[T],b.get("responsible")===m&&null!==b.get("estimate")&&462667!==b.get("taskList").get("id"))if((v=w[g=(y=b.get("project")).$ds_key])||(v=w[g]={id:y.get("id"),name:y.get("name"),planHours:moment.duration(),optHours:moment.duration(),manager:""}),a=b.get("title").toLowerCase().indexOf("бронь")!==-1||b.get("taskList").get("name").toLowerCase().indexOf("бронь")!==-1?v.optHours:v.planHours,D=b.get("split"))for(n=b.get("duedate"),e=moment(l);e<=i;)null!==(r=D.get(n,e))&&a.add(r),e.add(1,"day");else a.add(b.get("estimate"));O=moment.duration(),(w=_.map(w,function(t){return O.add(t.planHours),O.add(t.optHouras),s(t)})).length>0&&(w=_.sortBy(w,function(t){return t.name}),o.push({person:m,toName:m.get("firstName"),startDate:l.format("DD.MM"),endDate:i.format("DD.MM.YYYY"),totalHours:u(O),projects:w,status:"notSent"}))}console.info("compute finished: ",o)},h=function(){"ready"===c.status&&"ready"===p.status&&(e(),d(),f())},d=c.watchStatus(this,h),f=p.watchStatus(this,h),c.release(this),p.release(this)},c=function(n){var r,o,s,a,u;o=t.emails[n],s=template({email:o}),a=o.person.get("roles"),u=o.person.get("email"),r="managers@webprofy.ru",(a.get("Designer")||a.get("Jr. Designer"))&&(r+=", a.shevtsov@webprofy.ru, a.kolesnikov@webprofy.ru"),a.get("Markuper")&&(r+=", n.skinteev@webprofy.ru, s.yastrebov@webprofy.ru"),console.info("to: ",u),console.info("cc: ",r),e({method:"POST",url:"https://thawing-chamber-8269.herokuapp.com/https://api.mailgun.net/v3/webprofy.ru/messages",data:$.param({to:o.person.get("email"),cc:r,from:"Татьяна Верхотурова <t.verkhoturova@webprofy.ru>",subject:o.title,html:s}),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+i.encode("api:key-3ccadef54df260c8a2903da328ebb165")}}).then(function(e){console.info("ok: ",e),o.status="sent",n+1===t.emails.length?t.state="completed":c(n+1)},function(e){console.error("error: ",e),t.state="error"})},t.sendOut=function(){t.state="inProgress",c(0)}}]},{"../../../utils/base64":92,"../../data/dsDataService":24,"../../models/Person":34,"../../models/Task":39}],46:[function(t,e,n){var r;e.exports=(r=angular.module("ui/account/rmsAccount",[t("../../config")])).name,r.run(["$rootScope",function(t){t.isShowAccount=!1,t.showAccount=function(){t.isShowAccount=!t.isShowAccount}}]),r.directive("rmsAccount",["config","$rootScope",function(t,e){return{restrict:"A",scope:!0,link:function(n,r,o){var i;n.$evalAsync(function(){$($("input",r)[1]).select()}),n.url=t.teamwork,n.token=t.token,n.refreshPeriod=t.refreshPeriod,n.autosave=!!t.autosave,n.save=function(){var e,r;r=n.url.trim(),e=n.token.trim(),t.teamwork=r,t.token=e,t.refreshPeriod=n.refreshPeriod,t.autosave=n.autosave?1:0,i()},n.close=i=function(){e.isShowAccount=!1}}}}])},{"../../config":19}],47:[function(t,e,n){var r,o,i,s,a;o=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,r=t("../../dscommon/DSObject"),e.exports=(a=angular.module("ui/filters",[])).name,i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a.run(["$rootScope",function(t){t.filter={calendarHeader:function(t,e){var n,a,u,c,l;if(o&&(t instanceof r||s.invalidArg("doc"),(c=t.__proto__.__props).hasOwnProperty(e)||s.invalidArg("prop"),"moment"!==(l=c[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+l);if(!(n=t.get(e)))throw new Error("Non null date expected in the header");return a=moment(n).format("YYYYMMDD"),u=n.month()+1,u<10&&(u="0"+u),i[n.day()]+" "+n.date()+"/<small>"+u+"</small>"},shortDate:function(t,e){var n,i,a;if(o&&(t instanceof r||s.invalidArg("doc"),(i=t.__proto__.__props).hasOwnProperty(e)||s.invalidArg("prop"),"moment"!==(a=i[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+a);return n=t.get(e),n?n.format("DD.MM"):""},taskPeriod:function(e,n,i){var a,u,c,l,p,d;if(o&&e&&(null===e||e instanceof r||s.invalidArg("doc"),null===n||(l=e.__proto__.__props).hasOwnProperty(n)||s.invalidArg("prop"),"duration"!==(d=l[n].type)))throw new Error("Expected property with type 'duration', but property '"+n+"' has type "+d);return p="",i?(moment.isDuration(i)?(u=Math.floor(i.asHours()),c=i.minutes()):(u=Math.floor((i=i.get("timeMin"))/60),c=i%60),u||c?(p+=u?u+"h ":"",c&&(p+=c+"m")):p+="0"):null===typeof i&&(p+="0"),e&&(a=e.get(n))&&("undefined"!=typeof i&&t.dataService.showTimeSpent&&(p+=" / "),u=Math.floor(a.asHours()),c=a.minutes(),p+=u?u+"h":"",u&&c&&(p+=" "),c&&(p+=c+"m"),p||(p+="0")),p},taskPeriodLight:function(t){var e,n,r;return o&&(moment.isDuration(t)||s.invalidArg("duration")),t?(e=Math.floor(t.asHours()),n=t.minutes(),r=e?e+"h":"",n&&(r+=" "+n+"m"),r||(r="0"),r):""},periodDiff:function(t){var e,n,r,i;return o&&(null===t||moment.isDuration(t)||s.invalidArg("diff")),t&&null!==(i=t.valueOf())?(r=i<0?(t=moment.duration(-i),"- "):"+ ",e=Math.floor(t.asHours()),n=t.minutes(),r+=e+"h",n&&(r+=" "+n+"m"),r||(r="0"),r):""},timeLeft:function(t){var e,n,r,i;return o&&(null===t||moment.isDuration(t)||s.invalidArg("diff")),t&&null!==(i=t.valueOf())?(r=i<0?(t=moment.duration(-i),"- "):"",e=Math.floor(t.asHours()),n=t.minutes(),r+=e+"h "+(n<10?"0"+n:n)+"m"):""},taskEditDueDate:function(t){return o&&t&&!moment.isMoment(t)&&s.invalidArg("date"),t?t.format("DD.MM.YYYY"):""},splitDuration:function(e,n){var r,o,i;return i="",n?(r=Math.floor((n=n.get("timeMin"))/60),o=n%60,r||o?(i+=r?r+"h ":"",o&&(i+=o+"m")):i+="0"):null===typeof n&&(i+="0"),e&&("undefined"!=typeof n&&t.dataService.showTimeSpent&&(i+=" / "),r=Math.floor(e.asHours()),o=e.minutes(),i=r?r+"h":"",o&&(i+=" "+o+"m"),i||(i="0")),i}}}])},{"../../dscommon/DSObject":84,"../../dscommon/util":90}],48:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m;l=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,e.exports=(f=angular.module("ui/layout",[])).name,s=140,a=730,u=10,c=10,m=900,h=s+c,d=44,i=440,o=440,f.directive("uiLayout",["config","$window","$rootScope",function(t,e,n){return e=$(e),{restrict:"A",controller:["$scope",function(r){var o;r.layout=this,this.area1={},this.area2={},this.area3={},this.width=e.width(),this.area3.height=this.height=e.height()-d,o=function(){n.$digest(),n.$broadcast("layout-update")},(this.setVResizer=function(e,n){var r;r=this.area1.width=this.area2.width=this.vResizer=Math.min(Math.max(Math.round(e),a),this.width-c),this.area3.width=this.width-r,t.set("vResizer",this.area1.width/this.width),n||o()}).call(this,this.width*(t.get("vResizer")||.68),!0),(this.setHResizer=function(e,n){var r;r=this.area1.height=this.hResizer=Math.min(Math.max(Math.round(e),s),this.height-u),this.area2.height=this.height-r,t.set("hResizer",this.area1.height/this.height),n||o()}).call(this,this.height*(t.get("hResizer")||.68),!0),this.setSize=function(t,e,n){var r,i,s;e-=d,r=!1,(s=this.width)!==t&&(r=!0,this.setVResizer(this.vResizer*((this.width=Math.max(t,m))/s),!0)),(i=this.height)!==e&&(r=!0,this.setHResizer(this.hResizer*((this.height=Math.max(e,h))/i),!0),this.area3.height=e),r&&!n&&o()}}],link:function(t,n,r,o){var i;e.on("resize",i=function(){o.setSize(e.width(),e.height())}),t.$on("$destroy",function(){e.off("resize",i)})}}}]),f.directive("uiLayoutResizer",["$document",function(t){return{restrict:"A",require:"^uiLayout",link:function(e,n,r,o){var i,s,a,u;i="horizontal"===r.uiLayoutResizer,n.on("mousedown",u=function(e){e.preventDefault(),t.on("mousemove",s),t.on("mouseup",a)}),s=i?function(t){o.setHResizer(t.pageY-d)}:function(t){o.setVResizer(t.pageX)},a=function(e){t.off("mousemove",s),t.off("mouseup",a)},e.$on("$destroy",function(){t.off("mousedown",u),a()})}}}]),r=function(){function t(){return e.apply(this,arguments)}var e;return e=function(t){this.elem=t},t.prototype.innerHeight=function(){return this.elem.innerHeight()},t}(),f.directive("uiLayoutContainer",["$document",function(t){return{restrict:"A",link:function(t,e,n){t.uiContainer=new r(e)}}}])},{"../../dscommon/util":90}],49:[function(t,e,n){var r,o,i;r=t("../../dscommon/util").assert,o=t("../../dscommon/util").error,e.exports=(i=angular.module("ui/noDrag",[])).name,i.directive("noDrag",function(){return{link:function(t,e){var n;n=e[0],n.addEventListener("dragstart",function(t){return t.preventDefault(),!1})}}})},{"../../dscommon/util":90}],50:[function(t,e,n){var r,o,i,s,a;r=t("../../dscommon/util").assert,o=t("../../dscommon/util").error,e.exports=(i=angular.module("ui/sameHeight",[])).name,s=10,a=10,i.directive("sameHeight",function(){return{scope:!0,controller:["$scope",function(t){this.height=0,this.update=[],this.scope=t}],link:function(t,e,n,r){n.sameHeight&&t.$watch(n.sameHeight,function(){return t.resizeInProgress()})}}}),i.directive("sameHeightSrc",function(){return{require:"^sameHeight",scope:!1,link:function(t,e,n,r){var o,i;i=null,o=!1,r.scope.resizeInProgress=function(){var t,n,u,c;o||(o=!0,n=e.height(),u=null,c=a,t=!1,i=setInterval(function(){var s,l,p,d,f,h,m,y;if(t)if(y=u,y===(u=e.height()))0===--c&&(clearInterval(i),o=!1);else{for(m=r.update,p=0,f=m.length;p<f;p++)(s=m[p])(u);c=a}else if(n!==(u=e.height()))for(t=!0,h=r.update,l=0,d=h.length;l<d;l++)(s=h[l])(u)},s))},r.scope.$on("$destroy",function(){clearInterval(i)}),t.$evalAsync(function(){var t,n,o,i,s,a;for(a=e.height(),i=r.update,s=[],n=0,o=i.length;n<o;n++)t=i[n],s.push(t(a));return s})}}}),i.directive("sameHeightDest",function(){return{require:"^sameHeight",scope:!1,link:function(t,e,n,r){r.update.push(function(t){e.height(t)})}}})},{"../../dscommon/util":90}],51:[function(t,e,n){var r,o,i,s,a;r=t("../../dscommon/util").assert,o=t("../../dscommon/util").error,e.exports=(i=angular.module("ui/sameWidth",[])).name,s=30,a=10,i.directive("sameWidth",function(){return{scope:!0,controller:["$scope",function(t){this.width=0,this.update=[],this.scope=t}],link:function(t,e,n,r){n.sameWidth&&t.$watch(n.sameWidth,function(){return t.resizeInProgress()})}}}),i.directive("sameWidthSrc",function(){return{require:"^sameWidth",scope:!1,link:function(t,e,n,r){var o,i,u;u=null,i=!1,o=e[0],r.scope.resizeInProgress=function(){var t,e,n,c;i||(i=!0,e=o.clientWidth,n=null,c=a,t=!1,u=setInterval(function(){var s,l,p,d,f,h,m,y;if(t)if(y=n,y===(n=o.clientWidth))0===--c&&(clearInterval(u),i=!1);else{for(m=r.update,p=0,f=m.length;p<f;p++)(s=m[p])(n);c=a}else if(e!==(n=o.clientWidth))for(t=!0,h=r.update,l=0,d=h.length;l<d;l++)(s=h[l])(n)},s))},r.scope.$on("$destroy",function(){clearInterval(u)}),t.$evalAsync(function(){var t,e,n,i,s,a;for(a=o.clientWidth,i=r.update,s=[],e=0,n=i.length;e<n;e++)t=i[e],s.push(t(a));return s})}}}),i.directive("sameWidthDest",function(){return{require:"^sameWidth",scope:!1,link:function(t,e,n,r){r.update.push(function(t){e.width(t)})}}})},{"../../dscommon/util":90}],52:[function(t,e,n){var r,o,i,s,a,u,c,l,p=function(t,e){function n(){this.constructor=t}for(var r in e)d.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("ui/tasks/TaskSplitWeekView",[t("../../../dscommon/DSView")])).name,u=t("../../../dscommon/util").assert,r=t("../../../dscommon/DSObject"),a=t("../../models/types/TaskSplit"),s=t("../../models/Task"),o=t("../../models/Person"),i=t("../../models/PersonDayStat"),l=t("../time"),c.factory("TaskSplitWeekView",["DSView","$log",function(t,e){var n,s;return n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.begin("DayModel"),e.ds_dstr.push(function(){"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2()}),e.propDuration("timeLeft"),e.propDuration("timeLeftShow"),e.propObj("plan"),e.propDuration("initPlan"),e.propBool("select"),e.end(),e}(r),s=function(e){function r(){return s.apply(this,arguments)}var s;return p(r,e),r.begin("TaskSplitWeekView"),a.addPropType(r),r.propData("personDayStat",i,{mode:"edited"}),r.propList("days",n),r.propMoment("monday"),r.propDoc("responsible",o),r.propMoment("today"),r.propMoment("duedate"),r.propTaskRelativeSplit("split"),s=function(e,r,o,i,s){var c,p,d,f,h,m;u&&(!i instanceof a&&error.invalidArg("split"),moment.isMoment(s)||error.invalidArg("monday")),t.call(this,e,r),this.set("split",i),this.set("monday",s),e.$watch("edit.responsible",function(t){return function(e){t.set("responsible",e),t.__dirty++}}(this)),this.dataUpdate({startDate:s,endDate:moment(s).endOf("week"),mode:e.mode}),h=e.edit.split,m=e.edit.splitDuedate,p=moment(s),this.get("daysList").merge(this,f=function(){var t,r,s;for(t=function(t){return function(t,n){var r;return t.set("initPlan",r=null===h?null:h.get(m,n)),t.set("plan",i.day(o,n)),n.valueOf()===l.today?t.set("select",!0):n>l.today&&(t.__unwatch1=e.$watch("edit.duedate",function(e){t.set("select",null!==e&&n<=e)})),t.__unwatch2=e.$watch(function(){var n,r,o;return[null!=(n=e.$eval("edit.responsible"))?n.$ds_key:void 0,null!=(r=t.get("plan"))?r.val:void 0,null!=(o=t.get("timeLeft"))?o.valueOf():void 0]},function(n){var o,i,s,a,u;a=n[0],i=n[1],u=n[2],"number"!=typeof u?t.set("timeLeftShow",null):(o=moment.duration(u),null!==r&&null!==(s=e.task.get("responsible"))&&s.$ds_key===a&&o.add(r),moment.isDuration(i)&&o.subtract(i),t.set("timeLeftShow",o))},!0)}}(this),s=[],c=r=0;r<7;c=++r)d=new n(this,""+c),t(d,p),(p=moment(p)).add(1,"day"),s.push(d);return s}.call(this))},r.prototype.render=function(){var t,e,n,r,o,i,s,a,c,l,p;if(null===(l=this.get("responsible"))||"ready"!==(p=this.data.get("personDayStatStatus"))&&"update"!==p)for(c=this.get("days"),o=0,s=c.length;o<s;o++)t=c[o],t.set("timeLeft",null);else{if(u&&!this.data.get("personDayStat").hasOwnProperty(l.$ds_key))throw new Error("Missing person");for(e=this.data.get("personDayStat")[l.$ds_key].get("dayStats"),a=this.get("days"),n=r=0,i=a.length;r<i;n=++r)t=a[n],t.set("timeLeft",e[n].get("timeLeft"))}},r.end(),r}(t)}])},{"../../../dscommon/DSObject":84,"../../../dscommon/DSView":89,"../../../dscommon/util":90,"../../models/Person":34,"../../models/PersonDayStat":35,"../../models/Task":39,"../../models/types/TaskSplit":43,"../time":58}],53:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("../../../dscommon/util").assert,c=t("../../../dscommon/util").error,p=t("../../../dscommon/util").serviceOwner,s=t("../../../dscommon/DSObject"),i=t("../../../dscommon/DSDocument"),o=t("../../../dscommon/DSDigest"),r=t("../../models/types/Comments"),a=t("../../models/Person"),e.exports=(l=angular.module("ui/tasks/addCommentAndSave",[t("../../config"),t("../../data/dsDataService"),t("../../data/dsChanges")])).name,l.run(["$rootScope",function(t){t.AddCommentAndSave=null}]),l.factory("addCommentAndSave",["dsDataService","dsChanges","config","$rootScope","$q",function(t,e,n,a,l){var f,h;return f=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return d(n,t),n.begin("AddCommentAndSave"),n.propDoc("document",i),
n.propList("documents",i),n.propObj("changes"),n.propStr("reason",{init:""}),n.propBool("plansChange"),n.prototype.show=function(t,e,n){var r,o,s,p,d,f,h,m,y,g,v,_,w,k,S,D;if(u&&(null!==t&&(Array.isArray(t)&&t.length>0&&t[0]instanceof i||t instanceof i)||c.invalidArg("document"),"boolean"!=typeof e&&c.invalidArg("showDialog"),null!==n&&"object"==typeof n||c.invalidArg("changes")),this.__deferred=l.defer(),n.hasOwnProperty("duedate")&&!n.hasOwnProperty("clipboard")&&(null!=(_=(Array.isArray(t)?t[0]:t).get("duedate"))?_.valueOf():void 0)!==(null!=(w=n.duedate)?w.valueOf():void 0)&&(n.clipboard=!1),n.hasOwnProperty("plan")&&!n.plan)if(Array.isArray(t)){for(s=0,d=t.length;s<d;s++)if(o=t[s],o.get("plan")){m=this.set("plansChange",!0);break}}else t.get("plan")&&(m=this.set("plansChange",!0));if(Array.isArray(t)){for(p=0,f=t.length;p<f;p++)o=t[p],o.addRef(this);this.get("documentsList").merge(this,t),t=this.set("document",t[0])}else this.set("document",t);h=[],r=!1,k=t.__props;for(v in k)if(g=k[v],n.hasOwnProperty(v)){if(!(null!=(S=t.$u)?S.hasOwnProperty(v):void 0)){console.error("Doc "+t.toString()+": Prop "+v+": Property is not editable");continue}if("undefined"==typeof g.valid(D=n[v])){console.error("Doc "+t.toString()+": Prop "+v+": Invalid value '"+D+"'");continue}g.equal(t.get(v),D=n[v])||(r=!0,h.push({propName:v,value:D,text:null===D?"-":g.str(D)})),delete n[v]}for(v in n)console.error("Doc "+t.toString()+": Has no property '"+v+"'");return y=this.__deferred.promise,r?(this.set("changes",h),e||m?a.addCommentAndSave=this:(this.saveWOComment(),this.freeDocs())):(this.set("document",null),this.get("documentsList").merge(this,[]),this.__deferred.resolve(!0),delete this.__deferred),y},n.prototype.save=function(){this.addCommentAndSave(),a.addCommentAndSave=null},n.prototype.cancel=function(){this.freeDocs(),a.addCommentAndSave=null,this.__deferred.resolve(!1),delete this.__deferred},n.prototype.freeDocs=function(){this.set("reason",""),this.set("document",null),this.get("documentsList").merge(this,[]),this.set("changes",null)},n.prototype.addCommentAndSave=function(){o.block(function(t){return function(){var n,o,i,s,a,u,c,l,p,d,f,h,m;(a=e.get("hist")).startBlock();try{for(i=t.get("document"),0===(s=t.get("documents")).length&&(s=null),h=t.get("changes"),u=0,p=h.length;u<p;u++)if(n=h[u],s)for(c=0,d=s.length;c<d;c++)i=s[c],i.set(n.propName,n.value);else i.set(n.propName,n.value);if((o=t.get("reason").trim()).length>0)if(m=function(t){var e;e=null===(e=t.get("comments"))?new r:e.clone(),e.add(o),t.set("comments",e)},s)for(l=0,f=s.length;l<f;l++)i=s[l],m(i);else m(i)}finally{a.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.prototype.saveWOComment=function(){o.block(function(t){return function(){var n,r,o,i,s,a,u,c,l;(i=e.get("hist")).startBlock();try{for(r=t.get("document"),0===(o=t.get("documents")).length&&(o=null),l=t.get("changes"),s=0,u=l.length;s<u;s++)if(n=l[s],o)for(a=0,c=o.length;a<c;a++)r=o[a],r.set(n.propName,n.value);else r.set(n.propName,n.value)}finally{i.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.end(),n}(s),h=p.add(new f(p,"addCommentAndSave")),function(t,e,n){return h.show(t,e,n)}}])},{"../../../dscommon/DSDigest":80,"../../../dscommon/DSDocument":81,"../../../dscommon/DSObject":84,"../../../dscommon/util":90,"../../config":19,"../../data/dsChanges":23,"../../data/dsDataService":24,"../../models/Person":34,"../../models/types/Comments":42}],54:[function(t,e,n){var r;e.exports=(r=angular.module("ui/tasks/rmsTask",[])).name,r.run(["$rootScope",function(t){t.modal={type:null}}]),r.directive("rmsTask",["$rootScope","$timeout",function(t,e){return{restrict:"A",require:"ngModel",link:function(e,n,r,o){var i,s,a,u;n.on("click",function(e){var r;e.stopPropagation(),"task-edit"!==(r=t.modal).type?(t.modal={type:"task-edit",task:o.$viewValue,pos:n.offset()},t.$digest()):r.task!==o.$viewValue&&(t.modal={type:null},t.$digest(),t.$evalAsync(function(){t.modal={type:"task-edit",task:o.$viewValue,pos:n.offset()}},0))}),n.on("mouseover",function(e){e.stopPropagation(),0<=["task-info",null].indexOf(t.modal.type)&&(t.modal={type:"task-info",task:o.$viewValue,pos:n.offset()},t.$digest())}),n.on("mouseleave",function(e){e.stopPropagation(),0<=["task-info"].indexOf(t.modal.type)&&(t.modal={type:null},t.$digest())}),u=void 0,"taskView.time.task"!==r.rmsTask&&e.$watch(r.rmsTask+".style",function(t){n.css("background-color",t.color?t.color:""),n.css("border",t.border?t.border:"")}),s=u=function(o){var i;return t.modal={type:"drag-start",task:i=e.$eval(r.rmsTask),scope:e},t.$digest(),n.addClass("drag-start"),o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("task",i),o.dataTransfer.setDragImage($("#task-drag-ghost")[0],20,20),!0},i=function(e){return t.modal={type:null},n.removeClass("drag-start"),t.$digest(),!0},a=n[0],e.$watch(r.rmsTask+".$u",function(t){t?(a.draggable=!0,a.addEventListener("dragstart",s),a.addEventListener("dragend",i)):(a.draggable=!1,a.removeEventListener("dragstart",s),a.removeEventListener("dragend",i))})}}}]),r.directive("setTaskVisible",[function(){return{restrict:"A",link:function(t,e,n){var r;r=n.setTaskVisible,t.$eval(r+".setVisible(true)"),t.$on("$destroy",function(){t.$eval(r+".setVisible(false)")})}}}])},{}],55:[function(t,e,n){var r;e.exports=(r=angular.module("ui/tasks/rmsTaskAdd",[])).name,r.directive("rmsTaskAdd",["$rootScope",function(t){return{link:function(e,n){var r,o,i,s,a,u;for(e.addTask=function(){return t.modal={type:"task-edit"}},o=function(t){return n.addClass("drag-start"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("new",!0),t.dataTransfer.setDragImage(n[0],20,20),!0},r=function(t){return n.removeClass("drag-start"),!0},u=$("*",n).addBack(),s=0,a=u.length;s<a;s++)i=u[s],i.draggable=!0,i.addEventListener("dragstart",o),i.addEventListener("dragend",r)}}}])},{}],56:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m,y,g;e.exports=(m=angular.module("ui/tasks/rmsTaskEdit",[t("../../data/dsChanges"),t("../../data/dsDataService"),t("./TaskSplitWeekView"),t("./addCommentAndSave")])).name,h=t("../../../dscommon/util").assert,g=t("../../ui/time"),o=t("../../../dscommon/DSDigest"),i=t("../../../dscommon/DSTags"),r=t("../../../dscommon/DSDataEditable"),c=t("../../models/Tag"),l=t("../../models/Task"),d=t("../../models/TaskList"),s=t("../../models/Person"),u=t("../../models/Project"),f=t("../../models/types/TaskSplit"),a=t("../../models/PersonDayStat"),p=r(l.Editable).$u,y=3,m.directive("rmsTaskEdit",["TaskSplitWeekView","dsDataService","dsChanges","addCommentAndSave","$rootScope","$window","$timeout",function(t,e,n,r,o,l,m){return{restrict:"A",scope:!0,link:function(n,l,m){var v,w,k,S,D,b,T,O,P,j,A,x,L,C,R,M,E,V,I;return O=o.modal,n.edit=S={},E=null,j=function(e){return new t(n,"TaskSplitWeekView "+e.format(),function(){return S.splitDuedate},S.split,e)},T=function(){var t,e,r;t=S.firstWeek,S.splitView=function(){var n,o,i;for(i=[],r=n=0,o=y;0<=o?n<o:n>o;r=0<=o?++n:--n)e=j(t),(t=moment(t)).add(1,"week"),i.push(e);return i}(),E=n.$watch(function(){var t;return null!=(t=S.split.lastDate(S.splitDuedate))?t.valueOf():void 0},function(t){var e;S.split.shift(e=moment(t),S.splitDuedate),S.splitDuedate=e})},x=function(){var t,e,r,o;for(r=S.splitView,t=0,e=r.length;t<e;t++)o=r[t],o.release(n);S.splitView=null,E()},n.$evalAsync(function(){$($("input",l)[1]).select()}),n.people=_.map(s.pool.items,function(t){return t}),n.task=C=O.task,n.$watch(function(){return g.today.valueOf()},function(){return n.today=g.today}),n.$on("$destroy",function(){"function"==typeof n._unwatch&&n._unwatch(),"function"==typeof n._unwatch2&&n._unwatch2(),"function"==typeof n._unwatch3&&n._unwatch3(),"function"==typeof n._unwatch4&&n._unwatch4(),S.tags&&S.tags!==C.get("tags")&&S.tags.release(n)}),(S.newTask=P=void 0===C)?(A=o.newTaskValues,S.project=(null!=A?A.project:void 0)||null,S.taskList=(null!=A?A.taskList:void 0)||null,S.responsible=(null!=A?A.taskList:void 0)||null,S.title=null,S.description=null,S.duedate=k=(null!=A?A.duedate:void 0)?moment(A.duedate):null,S.estimate=(null!=A?A.estimate:void 0)?moment.duration(A.estimate):null,S.tags=(null!=A?A.tags:void 0)?new i(n,A.tags):null,M=null,v=e.findDataSet(n,{type:u,mode:"original"}),v.watchStatus(n,function(t,r,o,i){var s,a,u,c,l;if(n._unwatch3=function(){var t,e,r,o;for("function"==typeof M&&M(),i(),v.release(n),o=n.projectsList,t=0,e=o.length;t<e;t++)r=o[t],r.release(n);n.projectsList=null},"ready"===r){for(i(),n._unwatch3=null,l=n.projectsList=function(){var t,e;t=v.items,e=[];for(c in t)u=t[c],e.push(u);return e}().sort(function(t,e){return t.get("name").localeCompare(e.get("name"))}),s=0,a=l.length;s<a;s++)u=l[s],u.addRef(n);M||(M=n.$watch(function(){var t;return null!=(t=S.project)?t.$ds_key:void 0},function(t){var r,o,i,s,a,c,l,p;if(n.taskListsList=null,S.taskList=null,t){if(n.taskListsList){for(c=n.taskListsList,o=0,s=c.length;o<s;o++)p=c[o],p.release(n);n.taskListsList=null}r=e.findDataSet(n,{type:d,mode:"original",project:S.project}),r.watchStatus(n,function(t,e,o,i){var s,a,c,l,d;if(n._unwatch4=function(){var t,e,o;if(i(),r.release(n),n.taskLists){for(o=n.taskLists,t=0,e=o.length;t<e;t++)p=o[t],p.release(n);n.taskLists=null}},"ready"===e){for(i(),n._unwatch4=null,c=n.taskListsList=function(){var t,e;t=r.items,e=[];for(d in t)l=t[d],e.push(l);return e}().sort(function(t,e){return t.get("position")-e.get("position")}),s=0,a=c.length;s<a;s++)u=c[s],u.addRef(n);return r.release(n)}})}else if(n.taskLists){for(l=n.taskLists,i=0,a=l.length;i<a;i++)p=l[i],p.release(n);n.taskLists=null}})),v.release(n)}}),n.task=C={$u:p,get:function(t){switch(t){case"split":case"duedate":case"responsible":case"tags":return null;default:throw new Error("Unexpected prop: "+t)}}}):(S.project=C.get("project"),S.taskList=C.get("taskList"),S.title=C.get("title"),S.duedate=k=C.get("duedate"),S.estimate=C.get("estimate"),S.responsible=C.get("responsible"),S.description=C.get("description"),S.tags=C.get("tags")),n.$watch(function(){return S.tags},function(t){var e,r;n.orderedTags=t?function(){var n,o;n=t.map,o=[];for(r in n)e=n[r],o.push(e);return o}().sort(function(t,e){var n;return 0!==(n=t.get("priority")-e.get("priority"))?n:t.get("name").localeCompare(e.get("name"))}):[]}),(V=function(){var t;t=e.findDataSet(n,{type:c,mode:"original"}),t.watchStatus(n,function(e,r,o,i){var s,a;n._unwatch2=i,"ready"===r&&(i(),n._unwatch2=null,n.tagsToSelect=function(){var e,n,r;e=t.items,r=[];for(a in e)s=e[a],(null!=(n=S.tags)?n.get(a):void 0)||r.push(s);return r}().sort(function(t,e){var n;return 0!==(n=t.get("priority")-e.get("priority"))?n:t.get("name").localeCompare(e.get("name"))}),t.release(n))})})(),S.tagsSelected=null,n.$watch(function(){return S.tagsSelected},function(){var t,e;S.tagsSelected&&(e=(t=S.tags)?S.tags.clone(n):new i(n),e.set(S.tagsSelected.name,S.tagsSelected),S.tags=e,t&&C.get("tags")!==t&&t.release(n),S.tagsSelected=null,V())}),n.tagsRemove=function(t){var e,r;Object.keys((e=S.tags).map).length>1?(r=e.clone(n),r.set(t.name,!1),S.tags=r):S.tags=null,e&&C.get("tags")!==e&&e.release(n),V()},S.splitDiff=null,S.firstWeek=R=moment().startOf("week"),S.splitDuedate=null!==k?k:moment().startOf("day"),(S.isSplit=null!==(S.split=null!==(L=C.get("split"))?L.clone():null)&&null!==S.duedate&&null!==S.estimate)?(D=moment(L.firstDate(k)).startOf("week"),b=moment(L.lastDate(k)).startOf("week"),(I=moment.duration(b.diff(D)).asWeeks())<y?D.isBefore(R)?S.firstWeek=D:moment.duration(b.diff(R)).asWeeks()<=y||(S.firstWeek=b.subtract(y-1,"week")):S.firstWeek=D,T()):S.splitView=null,(n.viewonly=!C.$u||_.isEmpty(C.$u))||(n.changes=!1,n.$watch(function(){var t,e,n,r,o,i,s;return n=[null===(e=S.project)?null:e.$ds_key,null===(i=S.taskList)?null:i.$ds_key,S.title,S.description,null===(k=S.duedate)?null:k.valueOf(),null===(t=S.estimate)?null:t.valueOf(),null===(r=S.responsible)?null:r.$ds_key,null===(o=S.tags)?null:o.valueOf()],null!==(L=S.split)&&(s=L.valueOf()).length>0&&(n=n.concat(s)),n},function(t,e){n.changes=t!==e,null!==t[4]&&null!==t[5]||(S.isSplit=!1)},!0),n.$watch(function(){return S.isSplit},function(t,e){var r;t?(null===S.split&&(S.split=new f),null===S.splitView&&T()):null!==S.splitView&&x(),t!==e&&(null!=(r=S.split)?r.valueOf().length:void 0)>0&&(n.changes=!0)}),n.$watch(function(){var t;return null!=(t=S.duedate)?t.valueOf():void 0},function(t,e){t!==e&&(n.changes=!0,null!==S.split&&null!==t&&null!==e&&S.splitDuedate.add(t-e))}),n.$watch(function(){var t;return[null!=(t=S.estimate)?t.valueOf():void 0,S.isSplit,S.split]},function(t){var e,n,r,o,i,s;e=t[0],n=t[1],i=t[2],"number"==typeof e&&n&&null!==i?(o=(r=moment.duration(i.total).subtract(e)).valueOf(),S.splitDiff=0===o||null!==(s=S.splitDiff)&&s.valueOf()===o?null:r):S.splitDiff=null},!0)),n.splitPrevWeek=function(){var t;S.firstWeek=t=moment(S.firstWeek).subtract(1,"week"),S.splitView.unshift(j(t)),S.splitView.pop().release(n)},n.splitNextWeek=function(){var t;t=moment(S.firstWeek.add(1,"week")).add(y-1,"week"),S.splitView.push(j(t)),S.splitView.shift().release(n)},n.close=w=function(){o.modal={type:null}},n.save=function(t,e){var n,o,i,s;h&&"undefined"!=typeof e&&"boolean"!=typeof e&&error.invalidArg("plan"),S.isSplit&&S.split.list.length>0&&(S.duedate=S.splitDuedate,i=L.total,null===(o=S.estimate)?S.estimate=i:0!==(n=o.valueOf()-i.valueOf())&&L.fixEstimate(n)),s={title:S.title,duedate:S.duedate,estimate:S.estimate,responsible:S.responsible,split:S.isSplit&&S.split.valueOf().length>0?S.split:null,tags:S.tags,description:S.description},"boolean"==typeof e&&(s.plan=e),r(C,t.shiftKey,s).then(function(t){t&&w()})},n.showTimeLeft=function(t){var e,r,o,i,s,a,u,c;return null===(u=t.get("timeLeft"))?"":(s=t.get("plan"),o=t.get("initPlan"),e=moment.duration(u),null!==o&&n.task.get("responsible")===S.responsible&&e.add(o),null!==(c=s.val)&&e.subtract(c),a=(c=e.valueOf())<0?(e=moment.duration(-c),"- "):"",r=Math.floor(e.asHours()),i=e.minutes(),a+=r+"h "+(i<10?"0"+i:i)+"m")},n.autoSplitInProgress=!1,n.autoSplit=function(){var t,r,o,i,s,u,c,l;if(h){if(!(null!==S.duedate&&g.today<=S.duedate))throw new Error("Invalid duedate: "+(null!=(s=S.duedate)?s.format():void 0));if(null===S.responsible)throw new Error("Invalid value 'edit.responsible': "+S.responsible);if(!(null!==S.estimate&&S.estimate>0))throw new Error("Invalid value 'edit.estimate': "+(null!=(u=S.estimate)?u.valueOf():void 0))}n.autoSplitInProgress=!0,c=S.responsible.$ds_key,t=moment(k=S.duedate),r=moment.duration(S.estimate),(L=S.split).clear(),S.splitDuedate=moment(t),o=n.task.get("duedate"),i=null!==o&&S.responsible===n.task.get("responsible")?n.task.get("split"):null,(l=function(){var s,u;s=e.findDataSet(n,{type:a,mode:"edited",startDate:u=moment(t).startOf("week"),endDate:moment(t).endOf("week")}),n._unwatch=s.watchStatus(n,function(e,s,a,p){var d,f,h,m,y;if("ready"===s){for(f=e.items[c].get("dayStats");r>0&&g.today<=t&&u<=t;)y=(d=f[moment.duration(t.diff(u)).asDays()]).timeLeft,null!==i&&null!==(m=i.get(o,t))&&(y=moment.duration(y)).add(m),y>0&&(L.set(k,t,h=moment.duration(Math.min(y.valueOf(),r.valueOf()))),r.subtract(h)),t.subtract(1,"day");p(),delete n._unwatch,r>0&&g.today<=t?(t.subtract(2,"days"),l()):n.autoSplitInProgress=!1}}),s.release(n)})()}}}}])},{"../../../dscommon/DSDataEditable":76,"../../../dscommon/DSDigest":80,"../../../dscommon/DSTags":88,"../../../dscommon/util":90,"../../data/dsChanges":23,"../../data/dsDataService":24,"../../models/Person":34,"../../models/PersonDayStat":35,"../../models/Project":37,"../../models/Tag":38,"../../models/Task":39,"../../models/TaskList":40,"../../models/types/TaskSplit":43,"../../ui/time":58,"./TaskSplitWeekView":52,"./addCommentAndSave":53}],57:[function(t,e,n){var r,o,i,s;e.exports=(s=angular.module("ui/tasks/rmsTaskInfo",[])).name,o=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../../dscommon/DSObject"),s.directive("rmsTaskInfo",["$rootScope","$window",function(t,e){return{restrict:"A",scope:!0,link:function(e,n,r){var o,i,s,a,u;o=t.modal,$(window).height()>o.pos.top+150?e.top=Math.ceil(o.pos.top+50):e.top=Math.ceil(o.pos.top-100),$(window).width()-$("#sidebar").innerWidth()>o.pos.left?e.left=Math.ceil(o.pos.left+95):e.left=Math.ceil(o.pos.left-300),e.task=u=o.task,e.orderedTags=(a=u.get("tags"))?function(){var t,e;t=a.map,e=[];for(s in t)i=t[s],e.push(i);return e}().sort(function(t,e){var n;return 0!==(n=t.get("priority")-e.get("priority"))?n:t.get("name").localeCompare(e.get("name"))}):[]}}}])},{"../../../dscommon/DSObject":84,"../../../dscommon/util":90}],58:[function(t,e,n){var r,o;e.exports=r={today:moment().startOf("day"),historyLimit:moment().startOf("week").subtract(2,"weeks")},(o=function(){setTimeout(function(){r.today=moment().startOf("day"),o()},moment().startOf("day").add(1,"day").add(20,"seconds").valueOf()-(new Date).getTime())})()},{}],59:[function(t,e,n){var r,o,i,s,a,u,c;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,u=t("../../dscommon/util").totalRelease,r=t("../../dscommon/DSObjectBase"),o=t("../models/PersonDayStat"),e.exports=(a=angular.module("ui/ui",["ui.router","ngSanitize",t("./views/view1/View1"),t("./views/view2/View2"),t("./views/view3/View3"),t("./views/changes/ViewChanges"),t("./account/rmsAccount"),t("./widgets/widgetDate"),t("./widgets/widgetDuration"),t("./tasks/rmsTask"),t("./tasks/rmsTaskEdit"),t("./tasks/TaskSplitWeekView"),t("./tasks/rmsTaskInfo"),t("./tasks/rmsTaskAdd"),t("./tasks/addCommentAndSave"),t("./layout"),t("./filters"),t("./noDrag"),t("./sameHeight"),t("./sameWidth")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,r){e.state({name:"/",url:"/",templateUrl:function(){return"./ui/main.html"},controller:c}),u&&e.state({name:"totalRelease",url:"/totalRelease",templat:"<div/>"})}]),u&&a.run(["$state","$rootScope",function(t,e){var n;return n=window.totalRelease,window.totalRelease=function(){t.go("totalRelease"),e.$evalAsync(function(){n(),setTimeout(function(){console.info(window.totalPool)},1e3)})}}]),c=["$rootScope","$scope",function(t,e){e.mode="edited",e.setMode=function(t){e.mode=t},e.taskSummaryColor=function(t){var e;return i&&(t instanceof o.DayStat||s.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?"red":e/t.get("contract").valueOf()<=.2?"green":"light-yellow"},e.dayTaskWidth=function(t){var e;return i&&(t instanceof o.DayStat||s.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?100:Math.round(100*(1-e/t.get("contract").valueOf()))},e.taskViewExpand=function(t){e.period.people[t].tasks.expand=!e.period.people[t].tasks.expand}}]},{"../../dscommon/DSObjectBase":85,"../../dscommon/util":90,"../models/PersonDayStat":35,"./account/rmsAccount":46,"./filters":47,"./layout":48,"./noDrag":49,"./sameHeight":50,"./sameWidth":51,"./tasks/TaskSplitWeekView":52,"./tasks/addCommentAndSave":53,"./tasks/rmsTask":54,"./tasks/rmsTaskAdd":55,"./tasks/rmsTaskEdit":56,"./tasks/rmsTaskInfo":57,"./views/changes/ViewChanges":60,"./views/view1/View1":62,"./views/view2/View2":66,"./views/view3/View3":67,"./widgets/widgetDate":71,"./widgets/widgetDuration":72}],60:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("ui/views/changes/ViewChanges",[t("../../../data/dsChanges"),t("../../../../dscommon/DSView")])).name,u=t("../../../../dscommon/util").assert,i=t("../../../../dscommon/DSObject"),o=t("../../../../dscommon/DSDigest"),a=t("../../../models/Task"),s=t("../../../models/Person"),r=t("./models/Change"),c.run(["$rootScope",function(t){t.showChanges=function(){t.modal="changes"!==t.modal.type?{type:"changes"}:{type:null}}}]),c.controller("ViewChanges",["$scope","ViewChanges","dsChanges","$rootScope",function(t,e,n,r){t.view=new e(t,"viewChanges"),t.save=function(){n.save().then(function(t){t&&(r.modal={type:null})})},t.reset=function(){n.reset(),r.modal={type:null}}}]),c.directive("viewChangesFix",[function(){return{restrict:"A",link:function(t,e,n){var r,o;o=$(".main-table.header",e),r=$(".main-table.data",e),o.width(r.width())}}}]),c.factory("ViewChanges",["DSView","dsChanges","$log",function(t,e,n){var o;return o=function(n){function o(){return i.apply(this,arguments)}var i;return l(o,n),o.begin("ViewChange"),o.propData("tasks",a,{mode:"changes"}),o.propPool("poolChanges",r),o.propList("changes",r),o.propNum("renderVer",0),i=function(e,n){t.call(this,e,n),this.dataUpdate({})},o.ds_dstr.push(function(){var t,e,n;t=this.get("data").get("tasksSet").items;for(n in t)e=t[n],delete e.__change.__refreshView}),o.prototype.render=function(){var t,n,r,o,i,s,a,u,c,l,p,d,f,h,m,y,g,v,_;if("ready"!==(v=this.get("data").get("tasksStatus"))&&"update"!==v)return void this.get("changesList").merge(this,[]);s=this.get("poolChanges"),n=[],l=(g=this.get("data").get("tasksSet")).type.prototype.__props,o=!1,f=function(t){return function(){t.__dirty++}}(this),p=g.items;for(y in p){m=p[y],o=!o,i=!0,m.__change.__refreshView=f,h=function(t){return function(){e.removeChanges(t),f()}}(m),d=m.__change;for(c in d)u=d[c],"__error"!==c&&"__refreshView"!==c&&"clipboard"!==c&&(a=l[c],n.push(t=s.find(this,m.$ds_key+"."+c)),t.set("isDark",o),i&&(i=!1,t.set("doc",m)),t.set("prop",c),t.set("value",null===(_=u.v)?" -":a.str(u.v)),t.set("conflict",a.equal(r=m.$ds_doc.get(c),u.s)?null:null===r?" -":a.str(r)),h&&(t.remove=h,h=null));m.__change.__error&&(n.push(t=s.find(this,m.$ds_key+".__error")),t.set("isDark",o),t.set("error",m.__change.__error))}this.get("changesList").merge(this,n),this.set("renderVer",this.get("renderVer")+1)},o.end(),o}(t)}])},{"../../../../dscommon/DSDigest":80,"../../../../dscommon/DSObject":84,"../../../../dscommon/DSView":89,"../../../../dscommon/util":90,"../../../data/dsChanges":23,"../../../models/Person":34,"../../../models/Task":39,"./models/Change":61}],61:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../../../../dscommon/util").assert,a=t("../../../../../dscommon/util").error,i=t("../../../../../dscommon/DSObject"),o=t("../../../../../dscommon/DSDocument"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("Change"),e.propDoc("doc",o),e.propStr("prop"),e.propStr("value"),e.propStr("conflict"),e.propStr("error"),e.propBool("isDark"),e.end(),e}(i)},{"../../../../../dscommon/DSDocument":81,"../../../../../dscommon/DSObject":84,"../../../../../dscommon/util":90}],62:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f,h,m=function(t,e){function n(){this.constructor=t}for(var r in e)y.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(f=angular.module("ui/views/view1/View1",[t("../../../config"),t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,d=t("../../../../dscommon/util").assert,r=t("../../../../dscommon/DSDigest"),l=t("../../../models/Task"),c=t("../../../models/Tag"),i=t("../../../models/Person"),s=t("../../../models/PersonDayStat"),a=t("../../../models/PersonTimeTracking"),o=t("./models/Day"),u=t("./models/Row"),p=t("./models/TaskView"),h=t("../../../../dscommon/util").serviceOwner,f.controller("View1",["$scope","View1","$rootScope",function(t,e,n){n.view1=t.view=new e(t,"view1"),t.$on("$destroy",function(){delete n.view1}),t.expandedHeight=function(t){return t.expand?_.isEmpty(t.tasks)?"height:100px":"height:"+(65*_.maxBy(t.tasks,"y").y+98)+"px":""}}]),f.factory("View1",["DSView","config","$rootScope","$log","TWTasks",function(t,e,n,r,c){var p;return p=function(r){function p(){return d.apply(this,arguments)}var d,f,h;return m(p,r),p.begin("View1"),p.propData("people",i,{watch:["roles","companyId"]}),p.propData("tasks",l,{filter:"assigned",watch:["responsible","duedate","split","estimate","priority"]}),p.propData("personDayStat",s,{}),p.propData("personTimeTracking",a,{watch:[]}),p.propMoment("startDate"),p.propList("days",o),p.propPool("poolRows",u),p.propList("rows",u),p.propNum("renderVer",0),p.propObj("hiddenPeople",{init:{}}),p.propNum("hiddenPeopleCount",{init:0}),p.ds_dstr.push(function(){this.__unwatchA(),this.__unwatchB(),this.__unwatchC()}),d=function(r,o){var i,s,a,u,c,l,p,d,f;if(t.call(this,r,o),this.scope=r,this.set("startDate",moment().startOf("week")),r.filterLoad=[r.selectedLoad={id:0,name:"All"},{id:-1,name:"Underload"},{id:1,name:"Overload"}],f=e.get("selectedLoad"))for(l=r.filterLoad,s=0,u=l.length;s<u;s++)i=l[s],i.id===f&&(r.selectedLoad=i);if(e.hasRoles)for(r.filterCompanies=[{id:-1,name:"All"},r.selectedCompany={id:23872,name:"WebProfy"},{id:50486,name:"Freelancers"}],d=e.get("selectedCompany"),p=r.filterCompanies,a=0,c=p.length;a<c;a++)if(i=p[a],i.id===d){r.selectedCompany=i;break}this.__unwatchA=r.$watch(function(t){return function(){var e,n;return[null!=(e=t.get("startDate"))?e.valueOf():void 0,r.mode,r.dataService.showTimeSpent,null!=(n=r.selectedManager)?n.$ds_key:void 0]}}(this),function(t){return function(e){var n,r,o,i;i=e[0],n=e[1],o=e[2],r=e[3],t.dataUpdate({startDate:moment(i),endDate:moment(i).add(6,"days"),mode:n,showTimeSpent:o,manager:r?r:null})}}(this),!0),this.__unwatchB=r.$watch(function(){return[r.selectedRole,r.selectedCompany,r.selectedManager,r.selectedLoad]},function(t){return function(o){var i,s,a,u;return u=o[0],i=o[1],a=o[2],s=o[3],n.peopleRoles&&(e.set("selectedRole",u?u.role:null),(null!=u?u.role:void 0)||(r.selectedRole=null)),n.filterManagers&&(e.set("selectedManager",a?a.$ds_key:null),(null!=a?a.$ds_key:void 0)||(r.selectedManager=null)),e.set("selectedCompany",i?i.id:null),e.set("selectedLoad",s?s.id:0),t.__dirty++}}(this),!0),this.__unwatchC=r.$watch(function(t){return function(){return[e.get("currentUserId"),t.get("data").get("peopleStatus")]}}(this),function(t){return function(n){var r,o;return r=n[0],o=n[1],null===r||"ready"!==o&&"update"!==o?void e.set("currentUser",null):void e.set("currentUser",t.get("data").get("people")[r])}}(this),!0)},p.prototype.periodChange=function(t){this.set("startDate",this.startDate.add(t,"week"))},p.prototype.hideRow=function(t){this.get("hiddenPeople")[t.$ds_key]=!0,this.hiddenPeopleCount++,this.__dirty++},p.prototype.unhideAll=function(){this.set("hiddenPeople",{}),this.hiddenPeopleCount=0,this.__dirty++},p.prototype.render=function(){var t,n,r,i,s,a,u,c,l,d,f,h,m,y,g,v,w,k,S,D,b,T,O,P,$,j,A,x,L,C,R,M,E;if("ready"!==(m=this.get("data").get("peopleStatus"))&&"update"!==m)return void this.get("rowsList").merge(this,[]);L=this.get("startDate"),n=this.get("daysList").merge(this,_.map([0,1,2,3,4,5,6],function(t){return function(e,n){var r,i;return r=moment(L).add(e,"days"),i=new o(t,r.format()),i.set("date",r),i.set("index",n),i.set("x",e),i}}(this))),u=function(){return!0},c=this.get("hiddenPeople");for(d in c){u=function(t){return!c.hasOwnProperty(t.$ds_key)};break}if(e.get("hasRoles")){if((null!=(D=this.scope.selectedCompany)?D.id:void 0)!==-1?(t=this.scope.selectedCompany.id,i=u,u=function(e){return i(e)&&e.get("companyId")===t}):i=u,null!=(b=this.scope.selectedRole)?b.role:void 0)if(x=this.scope.selectedRole,s=u,x.hasOwnProperty("roles")){for($={},T=x.roles.split(","),l=0,f=T.length;l<f;l++)S=T[l],$[S.trim()]=!0;u=function(t){var e;return s(t)&&(null!=(e=t.get("roles"))?e.any($):void 0)}}else if(x.hasOwnProperty("special"))switch(x.special){case"notSupervisors":u=function(t){var e;return s(t)&&(null===(e=t.get("roles"))||!e.get("Manager"))};break;default:console.error("Unexpected role.special value: "+P.special,x)}else P=x.role,u=function(t){var e;return s(t)&&(null!=(e=t.get("roles"))?e.get(P):void 0)};if(0!==(null!=(O=this.scope.selectedLoad)?O.id:void 0)){if("ready"!==(g=this.get("data").get("personDayStatStatus"))&&"update"!==g)return;y=this.get("data").get("personDayStat"),h=1===this.scope.selectedLoad.id?function(t){var e,n,r,o;for(o=y[t.$ds_key].get("dayStats"),n=0,r=o.length;n<r;n++)if(e=o[n],e.get("timeLeft")<0)return!0;return!1}:function(t){var e,n,r,o;for(o=y[t.$ds_key].get("dayStats"),n=0,r=o.length;n<r;n++)if(e=o[n],e.get("timeLeft").valueOf()/e.get("contract").valueOf()>.2)return!0;return!1},a=u,u=function(t){return a(t)&&h(t)}}}A=_.filter(this.data.get("people"),u),A.sort(function(t,e){var n,r;return(n=t.name.toLowerCase())<(r=e.name.toLowerCase())?-1:n>r?1:0}),k=this.get("poolRows"),j=this.get("rowsList").merge(this,_.map(A,function(t){return function(e){var n;return n=k.find(t,e.$ds_key),n.set("person",e),n}}(this))),r=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),E=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),"ready"!==(R=this.get("data").get("tasksStatus"))&&"update"!==R||"ready"!==(g=this.get("data").get("personDayStatStatus"))&&"update"!==g?_.forEach(j,function(t){return function(e){e.get("tasksList").merge(t,[]),e.set("personDayStat",null)}}(this)):(C=_.groupBy(this.data.tasks,function(t){return t.get("responsible").$ds_key}),M=null,"ready"!==(w=this.data.personTimeTrackingStatus)&&"update"!==w||(E=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),M=_.groupBy(v=this.data.personTimeTracking,function(t){return t.get("personId")})),_.forEach(j,function(t){return function(e){var n,o,i,s,a,u,c,l,d,f,h,m,g,w,k,S,D,b,T,O,P,$,j,A;for(e.set("personDayStat",y=t.data.get("personDayStat")[e.$ds_key]),k=o=y.get("dayStats"),u=c=0,l=k.length;c<l;u=++c)s=k[u],r[u].add(s.get("tasksTotal"));if(P=e.get("tasksPool"),b={},O=_.map(C[e.$ds_key],function(n){var r,o,i,s,a,u,c,l,p,d;if(p=P.find(t,n.$ds_key),p.set("task",n),M)if(c=n.get("split"))for(o=n.get("duedate"),l=(i=c.firstDate(o))<=L?0:moment.duration(i.diff(L)).asDays(),u=t.get("days").slice(l,7),a=0,s=u.length;a<s;a++)r=u[a],(d=v[e.$ds_key+"-"+n.$ds_key+"-"+r.get("date").valueOf()])&&(b[d.$ds_key]=!0);else(d=v[e.$ds_key+"-"+n.$ds_key+"-"+n.get("duedate").valueOf()])?(b[d.$ds_key]=!0,p.set("time",d)):p.set("time",null);return p}),M&&(j=M[e.$ds_key])){for(m=0,d=j.length;m<d;m++)$=j[m],b[$.$ds_key]||(O.push(T=P.find(t,$.$ds_key)),T.set("time",$));for(A=_.groupBy(j,function(t){return t.get("date").valueOf()}),S=y.get("dayStats"),u=g=0,f=S.length;g<f;u=++g)n=S[u],(i=A[n.get("day").valueOf()])?E[u].add(n.set("timeSpent",_.reduce(i,function(t,e){return t.add(e.get("timeMin"),"m")},moment.duration()))):n.set("timeSpent",null)}else for(D=y.get("dayStats"),w=0,h=D.length;w<h;w++)n=D[w],n.set("timeSpent",null);e.get("tasksList").merge(t,O),a=null,M&&(a=function(t,n){return($=v[e.$ds_key+"-"+t.get("task").$ds_key+"-"+n.valueOf()])?$:null}),p.layoutTaskView(L,O,a)}}(this))),_.forEach(n,function(t,e){t.set("workTime",r[e]),t.set("timeSpent",0===E[e].valueOf()?null:E[e])}),this.set("renderVer",this.get("renderVer")+1)},p.taskViewsSortRule=h=function(t,e){var n,r;return n=t.get("task"),r=e.get("task"),null===n&&null===r?e.get("time").get("taskId")-t.get("time").get("taskId"):null===n?1:null===r?-1:c.tasksSortRule(n,r)},f=function(t,e,n,r,o){var i,s,a,u,c,l,p,d,f,h,m,y,g,v,_,w;if(e.set("x",r),s=t[r],0===r)w=s.length;else for(w=u=0,p=s.length;u<p&&(v=s[w],"undefined"!=typeof v);w=++u);if(e.set("y",w),null===(y=e.get("task"))||null===(m=y.get("split")))e.set("split",null),e.set("len",1),w===s.length&&s.length++,s[w]=!0;else for(l=e.set("len",Math.min(moment.duration(moment(m.lastDate(y.get("duedate"))).diff(n)).asDays()+1,7-r)),_=e.set("split",[]),h=c=0,f=l;0<=f?c<f:c>f;h=0<=f?++c:--c)i=0===h?n:moment(n).add(h,"day"),g=o?o(e,i):null,null===(d=m.get(y.duedate,i))&&null===g||_.push({x:h,plan:d,time:g}),(a=t[r+h]).length<=w&&(a.length=w),a[w]=!0;return w},p.layoutTaskView=function(t,e,n){var r,o,i,s,a,u,c,l,p,d,m,y;if(c=0,_.some(e,function(t){var e;return null!=(e=t.get("task"))?e.get("split"):void 0;
}))for(m=_.groupBy(e,function(t){var e,n,r;return(r=t.get("task"))?(e=r.get("duedate"),(null!==(n=r.get("split"))?n.firstDate(e):e).valueOf()):t.get("time").get("date").valueOf()}),l=function(){var t,e;for(e=[],s=t=0;t<=6;s=++t)e.push([]);return e}(),i=function(){var t;t=[];for(p in m)t.push(parseInt(p));return t}().sort(),a=0,u=i.length;a<u;a++)r=i[a],(y=m[r]).sort(h),o=moment.duration((d=moment(r)).diff(t)).asDays(),o<0&&(o=0,d=t),_.forEach(y,function(t){c=Math.max(c,f(l,t,d,o,n))});else m=_.groupBy(e,function(t){var e;return((e=t.get("time"))?e.get("date"):t.get("task").get("duedate")).valueOf()}),_.forEach(m,function(e,n){var r,o;e.sort(h),o=moment.duration(((r=e[0].get("time"))?r.get("date"):e[0].get("task").get("duedate")).diff(t)).asDays(),_.forEach(e,function(t,e){t.set("x",o),c=Math.max(c,t.set("y",e)),t.set("len",1),t.set("split",null)})});return c+1},p.end(),p}(t)}]),f.factory("getDropTasksGroup",["dsDataService","$rootScope",function(t,e){var n;return n=h.add(t.findDataSet(h,{type:l,mode:"edited",filter:"all"})),function(){var t,r,o,i,s,a;return t=e.modal.task.get("duedate").valueOf(),s=e.modal.task.get("responsible"),o=e.modal.task.get("project"),i=function(){var e,i,u;e=n.items,u=[];for(r in e)a=e[r],a.plan||a.split||a.get("responsible")!==s||(null!=(i=a.get("duedate"))?i.valueOf():void 0)!==t||a.get("project")!==o||u.push(a);return u}(),0===i.length?[e.modal.task]:i}}]),f.directive("rmsView1DropTask",["View1","$rootScope","dsChanges","addCommentAndSave","getDropTasksGroup",function(t,e,n,r,o){return{restrict:"A",scope:!0,link:function(t,n,i){var s;return s=n[0],s.addEventListener("dragover",function(t){return t.preventDefault(),!0}),s.addEventListener("drop",function(i){var s,a,u;return i.dataTransfer.getData("task")&&(s=_.findIndex($(".drop-zone",n),function(t){var e;return e=$(t),e.offset().left+e.width()>=i.clientX}),u=!i.ctrlKey||(a=e.modal).task.split||null===a.task.duedate?[e.modal.task]:o(),s<0?r(u,i.shiftKey,{responsible:t.row.get("person"),plan:!1}):r(u,i.shiftKey,{responsible:t.row.get("person"),duedate:t.view.get("days")[s].get("date"),plan:!1})),e.$digest(),i.stopPropagation(),!1})}}}]),f.directive("rmsView1MouseOverWeekChange",["View1","$rootScope","dsChanges","addCommentAndSave",function(t,e,n,r){return{restrict:"A",link:function(t,n,r){var o,i,s;o=t.$eval(r.rmsView1MouseOverWeekChange),s=0,i=n[0],i.addEventListener("dragover",function(t){return t.timeStamp>s&&(s=t.timeStamp+3e3,e.view1.periodChange(o),e.$digest()),t.preventDefault(),!0})}}}])},{"../../../../dscommon/DSDigest":80,"../../../../dscommon/DSView":89,"../../../../dscommon/util":90,"../../../config":19,"../../../data/dsChanges":23,"../../../data/dsDataService":24,"../../../data/teamwork/TWTasks":31,"../../../models/Person":34,"../../../models/PersonDayStat":35,"../../../models/PersonTimeTracking":36,"../../../models/Tag":38,"../../../models/Task":39,"../../tasks/addCommentAndSave":53,"./models/Day":63,"./models/Row":64,"./models/TaskView":65}],63:[function(t,e,n){var r,o,i=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("../../../../../dscommon/DSObject"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("Day"),e.propMoment("date"),e.propNum("index"),e.propNum("x"),e.propDuration("workTime"),e.propDuration("timeSpent"),e.end(),e}(r)},{"../../../../../dscommon/DSObject":84}],64:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;u=t("../../../../../dscommon/util").assert,c=t("../../../../../dscommon/util").error,r=t("../../../../../dscommon/DSObject"),o=t("../../../../models/Person"),i=t("../../../../models/PersonDayStat"),a=t("./TaskView"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.begin("Row"),e.propPool("tasksPool",a),e.propDoc("person",o),e.propDoc("personDayStat",i),e.propList("tasks",a),e.propBool("expand",{init:!1}),e.end(),e}(r)},{"../../../../../dscommon/DSObject":84,"../../../../../dscommon/util":90,"../../../../models/Person":34,"../../../../models/PersonDayStat":35,"./TaskView":65}],65:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;r=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,i=t("../../../../models/Task"),o=t("../../../../models/PersonTimeTracking"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskView"),e.propDoc("task",i),e.propDoc("time",o),e.propNum("x",{init:0,valid:a.required}),e.propNum("y",{init:0,valid:a.required}),e.propNum("len",{init:1,valid:a.required}),e.propObj("split"),e.end(),e}(r)},{"../../../../../dscommon/DSObject":84,"../../../../../dscommon/util":90,"../../../../models/PersonTimeTracking":36,"../../../../models/Task":39}],66:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("ui/views/view2/View2",[t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../view1/View1"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,s=t("../../../../dscommon/util").assert,r=t("../../../../dscommon/DSDigest"),o=t("../../../models/Task"),i=t("../view1/models/TaskView"),a.controller("View2",["$scope","View2",function(t,e){t.view=new e(t,"view2"),t.tasksHeight=function(t){return!t.expand||_.isEmpty(t.tasks)?"":"height:"+(52*_.maxBy(t.tasks,"y").y+100)+"px"}}]),a.factory("View2",["View1","DSView","$rootScope","$log","TWTasks",function(t,e,n,r,s){var a;return a=function(n){function r(){return a.apply(this,arguments)}var a,c;return u(r,n),r.begin("View2"),r.propData("tasksOverdue",o,{filter:"overdue",watch:["duedate","plan","estimate","priority"]}),r.propData("tasksNotAssigned",o,{filter:"notassigned",watch:["duedate","split","plan","estimate","priority"]}),r.propList("tasksOverdue",o),r.propPool("poolTasksNotassignedViews",i),r.propList("tasksNotAssigned",i),r.propNum("tasksNotAssignedHeight",{init:0}),r.propNum("renderVer",0),r.ds_dstr.push(function(){this.__unwatchA()}),a=function(t,n){e.call(this,t,n),this.__unwatchA=t.$watch(function(){var e,n;return[null!=(e=t.$parent.view.startDate)?e.valueOf():void 0,t.mode,null!=(n=t.selectedManager)?n.$ds_key:void 0]},function(t){return function(e){var n,r,o;o=e[0],n=e[1],r=e[2],t.dataUpdate({startDate:moment(o),endDate:moment(o).add(6,"days"),mode:n,manager:r?r:null})}}(this),!0)},c=function(t,e){var n,r;return n=t.get("task"),r=e.get("task"),s.tasksSortRule(n,r)},r.prototype.render=function(){var e,n,r,o,i;n=this.__scope.$parent.view.startDate,"ready"!==(r=this.get("data").get("tasksOverdueStatus"))&&"update"!==r?this.get("tasksOverdueList").merge(this,[]):(i=_.map(this.get("data").get("tasksOverdue"),function(t){return function(e){return e.addRef(t),e}}(this)),i.sort(s.tasksSortRule),this.get("tasksOverdueList").merge(this,i)),"ready"!==(r=this.get("data").get("tasksNotAssignedStatus"))&&"update"!==r?(this.get("tasksNotAssignedList").merge(this,[]),this.set("tasksNotAssignedHeight",0)):(e=this.get("poolTasksNotassignedViews"),o=this.get("tasksNotAssignedList").merge(this,_.map(this.get("data").get("tasksNotAssigned"),function(t){return function(n){var r;return r=e.find(t,n.$ds_key),r.set("task",n),r}}(this)).sort(c)),this.set("tasksNotAssignedHeight",t.layoutTaskView(n,o))),this.set("renderVer",this.get("renderVer")+1)},r.end(),r}(e)}]),a.directive("rmsView2DayDropTask",["dsChanges","$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,n,r){return{restrict:"A",scope:!0,link:function(t,o,i){var s,a;s=o[0],a=function(t){var e,n;return e=_.findIndex($(".vertical-lines > .col",o),function(e){var n;return n=$(e),n.offset().left+n.width()>=t.clientX}),-1<=(n=--e)&&n<=6?e:-2},s.addEventListener("dragover",function(t){return a(t)!==-2&&(t.preventDefault(),!0)}),s.addEventListener("drop",function(o){var i,s,u;return o.dataTransfer.getData("task")&&(i=a(o),u=!o.ctrlKey||(s=e.modal).task.split||null===s.task.duedate?[e.modal.task]:r(),n(u,o.shiftKey,{responsible:null,duedate:i===-1?null:t.view1.get("days")[i].get("date"),plan:!1})),e.$digest(),o.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSDigest":80,"../../../../dscommon/DSView":89,"../../../../dscommon/util":90,"../../../data/dsChanges":23,"../../../data/dsDataService":24,"../../../data/teamwork/TWTasks":31,"../../../models/Task":39,"../../tasks/addCommentAndSave":53,"../view1/View1":62,"../view1/models/TaskView":65}],67:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d,f=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(d=angular.module("ui/views/view3/View3",[t("../../../config"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,l=t("../../../../dscommon/util").assert,p=t("../../../../dscommon/util").error,a=t("../../../models/Task"),u=t("../../../models/TaskList"),o=t("../../../models/Project"),r=t("./models/PersonView"),i=t("./models/ProjectView"),c=t("./models/TaskListView"),s=t("../view1/models/Row"),d.controller("View3",["$scope","View3",function(t,e){t.view=new e(t,"view3")}]),d.factory("View3",["DSView","config","$rootScope","$log","TWTasks",function(t,e,n,s,c){var d;return d=function(s){function d(o,s){t.call(this,o,s),this.scope=o,this.expandedProj={},this.expandedRows={},this.__unwatchA=o.$watch(function(){var t;return[o.mode,e.activeSidebarTab,null!=(t=o.selectedManager)?t.$ds_key:void 0]},function(t){return function(r){var i,s,a;switch(s=r[0],i=r[1],a=r[2],n.view3ActiveTab=i,a||(a=null),i){case-1:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"clipboard",mode:s,manager:a});break;case 0:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"noduedate",mode:s,manager:a});break;case 1:t.__unwatchB=o.$watch(function(){var t;return null!=(t=o.$parent.view.startDate)?t.valueOf():void 0},function(r){var o,i;n.startDateVal=r,"number"!=typeof r?e.activeSidebarTab=0:(i=moment(r).add(1,"week"),o=moment(i).endOf("week"),t.dataUpdate({filter:"all",mode:s,startDate:i,endDate:o,manager:a}))});break;case 2:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"all",mode:s,manager:a})}}}(this),!0),this.__unwatchC=o.$watch(function(){return[e.view3GroupByPerson,e.view3HidePeopleWOTasks,e.view3FilterByPerson,e.view3FilterByProject,e.view3FilterByTask]},function(t){return function(){clearTimeout(t.__timer1),t.__timer1=setTimeout(function(){t.__dirty++,o.$digest()},300)}}(this),!0),o.notAssignedExpanded=!0,o.toggleProjectExpanded=function(t){return function(n){var r,o,s,a,u;return l&&(n instanceof i||p.invalidArg("project")),a=(o=t.expandedProj).hasOwnProperty(r=e.activeSidebarTab)?o[r]:o[r]=u={},a.hasOwnProperty(s=n.$ds_key)?a[s]=!a[s]:a[s]=!(2!==r)}}(this),o.isProjectExpanded=function(t){return function(n){var r,o,s,a;return l&&(n instanceof i||p.invalidArg("project")),(o=t.expandedProj).hasOwnProperty(r=e.activeSidebarTab)&&(a=o[r]).hasOwnProperty(s=n.$ds_key)?a[s]:2!==r}}(this),o.togglePersonExpanded=function(t){return function(n){var o,i,s,a,u;return l&&(n instanceof r||p.invalidArg("personView")),a=(i=t.expandedRows).hasOwnProperty(o=e.activeSidebarTab)?i[o]:i[o]=u={},a.hasOwnProperty(s=n.$ds_key)?a[s]=!a[s]:a[s]=!1}}(this),o.isPersonExpended=function(t){return function(n){var o,i,s,a;return l&&(n instanceof r||p.invalidArg("personView")),!(i=t.expandedRows).hasOwnProperty(o=e.activeSidebarTab)||!(a=i[o]).hasOwnProperty(s=n.$ds_key)||a[s]}}(this)}var h;return f(d,s),d.begin("View3"),d.propData("tasks",a,{watch:["duedate","priority","clipboard"]}),d.propPool("poolPeople",r),d.propList("people",r),d.propPool("poolProjects",i),d.propList("projects",i),d.ds_dstr.push(function(){this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB(),this.__unwatchС(),"function"==typeof this.__unwatchD&&this.__unwatchD(),clearTimeout(this.__timer1)}),h=function(t,e){return"null"===t?"not assigned tasks".indexOf(e)>=0:t.person.name.toLowerCase().indexOf(e)>=0||t.person.firstName.toLowerCase().indexOf(e)>=0||t.person.email.toLowerCase().indexOf(e)>=0},d.prototype.render=function(){var t,n,r,i,s,a,l,p,d,f,m,y,g,v,w,k,S,D,b,T,O,P,$,j;if("ready"!==(b=this.get("data").get("tasksStatus"))&&"update"!==b)return void this.get("projectsList").merge(this,[]);if(T=this.get("data").get("tasks"),(null!=(g=r=e.view3FilterByTask)?g.length:void 0)>0&&(r=r.trim().toLowerCase(),T=_.filter(T,function(t){return t.get("title").toLowerCase().indexOf(r)>=0})),0===e.view3GroupByPerson){if($=_.groupBy(T,function(t){return t.get("taskList").$ds_key}),P=_.groupBy($,function(t){return t[0].get("project").$ds_key}),(null!=(v=n=e.view3FilterByProject)?v.length:void 0)>0){n=n.trim().toLowerCase();for(s in P)j=P[s],o.pool.items[s].get("name").toLowerCase().indexOf(n)>=0||delete P[s]}f=this.get("poolProjects"),m=this.get("projectsList").merge(this,_.map(P,function(t){return function(e,n){var r;return r=f.find(t,n),r.set("project",o.pool.items[n]),r.get("taskListsList").merge(t,_.map(e,function(e){var n,o;return n=e[0].get("taskList").$ds_key,o=r.poolTaskLists.find(t,n),o.set("taskList",u.pool.items[n]),o.set("tasksCount",_.size(e)),o.set("totalEstimate",_.reduce(e,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),o.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)}).sort(c.tasksSortRule)),o})),r}}(this)).sort(function(t,e){var n,r;return(n=t.get("project").get("name").toLowerCase())<(r=e.get("project").get("name").toLowerCase())?-1:n>r?1:0})),this.get("peopleList").merge(this,[]),this.__unwatchD&&(this.__unwatchD(),this.__unwatchD=null,this.__src.tasks.watch.length=this.__src.tasks.watch.length-1)}else{for(this.__unwatchD||(this.__unwatchD=this.scope.$watch(function(t){return function(){var e,n,r,o,i;for(o=t.scope.view1.rows,i=[],e=0,n=o.length;e<n;e++)r=o[e],i.push(r.$ds_key);return i}}(this),function(t){return function(e,n){e!==n&&t.__dirty++}}(this),!0),this.__src.tasks.watch.push("responsible")),d=this.get("poolPeople"),(null!=(w=t=e.view3FilterByPerson)?w.length:void 0)>0&&(t=t.trim().toLowerCase()),(null!=(k=n=e.view3FilterByProject)?k.length:void 0)>0&&(n=n.trim().toLowerCase()),O=_.groupBy(T,function(t){var e;return(e=t.get("responsible"))?e.$ds_key:"null"}),D=this.scope.view1.rows,O.hasOwnProperty("null")&&(D=D.concat("null")),S=[],i=0,a=D.length;i<a;i++)if(y=D[i],!t||h(y,t))if(O.hasOwnProperty(p="null"!==y?y.$ds_key:"null")){if($=_.groupBy(O[p],function(t){return t.get("taskList").$ds_key}),P=_.groupBy($,function(t){return t[0].get("project").$ds_key}),n)for(s in P)j=P[s],o.pool.items[s].get("name").toLowerCase().indexOf(n)>=0||delete P[s];if(0===Object.keys(P).length)continue;S.push(l=d.find(this,p)),"null"!==y&&l.set("row",y),f=l.get("poolProjects"),l.get("projectsList").merge(this,_.map(P,function(t){return function(e,n){var r;return r=f.find(t,n),r.set("project",o.pool.items[n]),r.get("taskListsList").merge(t,_.map(e,function(e){var n,o;return n=e[0].get("taskList").$ds_key,o=r.poolTaskLists.find(t,n),o.set("taskList",u.pool.items[n]),o.set("tasksCount",_.size(e)),o.set("totalEstimate",_.reduce(e,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),o.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)}).sort(c.tasksSortRule)),o})),r}}(this)).sort(function(t,e){var n,r;return(n=t.get("project").get("name").toLowerCase())<(r=e.get("project").get("name").toLowerCase())?-1:n>r?1:0}))}else e.get("view3HidePeopleWOTasks")||(S.push(l=d.find(this,p)),"null"!==y&&l.set("row",y),l.get("projectsList").merge(this,[]));this.get("peopleList").merge(this,S),this.get("projectsList").merge(this,[])}},d.end(),d}(t)}]),d.directive("rmsView3DropTask",["$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,n){return{restrict:"A",scope:!0,link:function(r,o,i){var s,a;a=o[0],s=i.rmsView3DropTask.length>0?function(t){return function(){return t}}(parseInt(i.rmsView3DropTask)):function(){return t.view3ActiveTab},a.addEventListener("dragover",function(t){return t.preventDefault(),2===s()}),a.addEventListener("drop",function(r){var o,i,a;if(r.dataTransfer.getData("task")){switch(a=!r.ctrlKey||(i=t.modal).task.split||null===i.task.duedate?[t.modal.task]:n(),o={plan:!1},s()){case-1:o.duedate=null,o.clipboard=!0;break;case 0:o.duedate=null;break;case 1:o.duedate=moment(t.startDateVal).add(1,"week")}e(a,r.shiftKey,o)}return t.$digest(),r.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSView":89,"../../../../dscommon/util":90,"../../../config":19,"../../../data/dsDataService":24,"../../../data/teamwork/TWTasks":31,"../../../models/Project":37,"../../../models/Task":39,"../../../models/TaskList":40,"../../tasks/addCommentAndSave":53,"../view1/models/Row":64,"./models/PersonView":68,"./models/ProjectView":69,"./models/TaskListView":70}],68:[function(t,e,n){var r,o,i,s,a,u,c,l,p=function(t,e){function n(){this.constructor=t}for(var r in e)d.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;r=t("../../../../../dscommon/DSObject"),l=t("../../../../../dscommon/util").validate,o=t("../../../../models/Person"),s=t("../../../../models/Project"),a=t("./ProjectView"),c=t("./TaskListView"),u=t("../../view1/models/Row"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.begin("PersonView"),e.propDoc("row",u),e.propPool("poolProjects",a),e.propList("projects",c),e.end(),e}(r)},{"../../../../../dscommon/DSObject":84,"../../../../../dscommon/util":90,"../../../../models/Person":34,"../../../../models/Project":37,"../../view1/models/Row":64,"./ProjectView":69,"./TaskListView":70}],69:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;r=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,o=t("../../../../models/Project"),s=t("./TaskListView"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("ProjectView"),e.propDoc("project",o),e.propPool("poolTaskLists",s),e.propList("taskLists",s),e.end(),e}(r)},{"../../../../../dscommon/DSObject":84,"../../../../../dscommon/util":90,"../../../../models/Project":37,"./TaskListView":70}],70:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;r=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,o=t("../../../../models/Task"),i=t("../../../../models/TaskList"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskListView"),e.propDoc("taskList",i),e.propList("tasks",o),e.propNum("tasksCount",{init:0}),e.propDuration("totalEstimate"),e.propBool("isExpand",{init:!0}),e.end(),e}(r)},{"../../../../../dscommon/DSObject":84,"../../../../../dscommon/util":90,"../../../../models/Task":39,"../../../../models/TaskList":40}],71:[function(t,e,n){var r;e.exports=(r=angular.module("ui/widgets/widgetDate",[])).name,$.datepicker.regional.ru={dateFormat:"dd.mm.yy",firstDay:1},$.datepicker.setDefaults($.datepicker.regional.ru),$.timepicker.regional.ru={},$.timepicker.setDefaults($.timepicker.regional.ru),r.directive("widgetDate",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(n,r,o,i){var s;s=$("input",r),e(function(){s.datepicker(),s.change(function(){var e;i.$setViewValue((e=s.datetimepicker("getDate"))?moment(e.getTime()):null),t.$digest()}),(i.$render=function(){s.datetimepicker("setDate",i.$viewValue?new Date(i.$viewValue.valueOf()):null)})()},0)}}}])},{}],72:[function(t,e,n){var r,o,i;e.exports=(i=angular.module("ui/widgets/widgetDuration",[])).name,r=36e5,o=6e4,i.directive("widgetDuration",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(e,n,i,s){var a,u,c,l;l=$("input",n),u=$(l[0]),c=$(l[1]),(s.$render=function(){var t,e,n;(n=s.$viewValue)?(t=Math.floor(n.valueOf()/r),e=Math.floor(n.valueOf()%r/o),u.val(t),c.val(e<10?"0"+e:e)):(u.val(""),c.val(""))})(),a=function(){var e,n,r;n=parseInt(u.val()),r=parseInt(c.val()),e=moment.duration(0),isNaN(n)||e.add(n,"hours"),isNaN(r)||e.add(r,"minutes"),s.$setViewValue(0===e.valueOf()?null:e),t.$digest()},u.on("input",a),c.on("input",a)}}}])},{}],73:[function(t,e,n){var r,o,i,s,a,u,c;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=/RMS\s*Data\s*\(DO NOT CHANGE!?\)/i,r=/}\s*END/i,u=function(t){var e,n,r,o;for(n=r=o=t.length-1;r>=0&&("\r"===(e=t.charAt(n))||"\n"===e||" "===e||"\t"===e);n=r+=-1);return n>=0?t.substr(0,n+1):""},c=function(t){var e,n,r,o,i;for(n=-1,r=o=0,i=t.length;o<i;r=o+=1)if("\n"===(e=t.charAt(r)))n=r;else if("\r"!==e&&" "!==e&&"\t"!==e)break;return n===-1?t:r<t.length?t.substr(n+1):""},s=function(t){var e,n,i,a;return(i=t.search(o))===-1?t:(e=t.search(r))!==-1&&i<e?(a=u(t.substr(0,i)),n=c(t.substr(t.substr(i).search(/end/i)+3+i)),s(a.length>0?n.length>0?a+"\r\n\r\n"+n:a:n)):u(t.substr(0,i-1))},e.exports={clear:s,get:function(t){var e,n,s,u,c;if(i&&null!==t&&"string"!=typeof t&&a.invalidArg("description"),null===t||(c=t.search(o))===-1)return null;if((e=t.search(r))!==-1&&c<e&&(u=t.indexOf("{",c))!==-1&&u<e)try{return JSON.parse(t.substr(u,e-u+1).trim())}catch(n){s=n,console.error("ex: ",s)}return console.error("Corrupted RMS Data: ",t),null},put:function(t,e){return i&&(null!==t&&"string"!=typeof t&&a.invalidArg("description"),null!==e&&"object"!=typeof e&&a.invalidArg("data")),t=null===t?"":s(t),null===e||0===_.size(e)?t:(0===t.length?"":""+t)+("\r\n\r\nRMS Data (DO NOT CHANGE!) "+JSON.stringify(e)+" END")}}},{"../../dscommon/util":90}],74:[function(t,e,n){var r,o,i,s,a,u,c,l,p=function(t,e){function n(){this.constructor=t}for(var r in e)d.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;c=t("./util").assert,l=t("./util").error,a=t("./DSHistory"),u=t("./DSPool"),o=t("./DSData"),s=t("./DSDocument"),i=t("./DSDigest"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n,r;return p(e,t),e.begin("DSChangesBase"),e.noCache(),e.propDoc("hist",a),e.propNum("count",{init:0}),n=function(t,e){var n,r,i,s,c,l,p,d;for(o.call(this,t,e,{}),(r=this.set("hist",new a(this,e+".hist"))).release(this),n={add:function(t){return function(){t.count++,t.persist()}}(this),change:function(t){return function(){t.persist()}}(this),remove:function(t){return function(){t.count--,t.persist()}}(this)},this.__unwatch2=d=[],c=this.__proto__.__sets,i=0,s=c.length;i<s;i++)p=c[i],(l=this["_"+p]).$ds_hist=r,(l.$ds_pool=new u(this,e+"."+p+".pool",l.type)).release(this),l.watch(this,n,!0)},e.prototype.saveToLocalStorage=_.noop,e.prototype.persist=function(){},e.prototype.anyChange=function(){return this.get("count")>0},e.prototype.reset=function(){i.block(function(t){return function(){var e,n,r,o,i,s,a,u,c,l,p,d;(e=t.get("hist")).startReset();try{for(c=t.__proto__.__sets,n=0,i=c.length;n<i;n++)for(p=c[n],l=_.map((d=t["_"+p]).items,function(t){return t}),o=0,s=l.length;o<s;o++){r=l[o],a=r.$ds_doc;for(u in r.__change)"__error"!==u&&"__refreshView"!==u&&r.set(u,a.get(u))}}finally{e.endReset()}}}(this))},e.prototype.changesToMap=function(){var t,e,n,r,o,i,s,a,u,c,l,p,d,f,h,m;for(p={},u=this.__proto__.__sets,t=0,o=u.length;t<o;t++){h=u[t],a=(f=this["_"+h]).type.prototype.__props,p[h]=d={},c=f.items;for(r in c){e=c[r],d[r]=n={},l=e.__change;for(s in l)i=l[s],"__error"!==s&&"__refreshView"!==s&&(m=a[s].write)&&(n[s]={v:null===i.v?null:m(i.v),s:null===i.s?null:m(i.s)})}}return p},r=function(t,e,n,r,o){var i,s,a;a=e.hasOwnProperty(i=n.docType)?e[i]:e[i]={},a[t[o]]=s=a.hasOwnProperty(t[o])?a[t[o]]:a[t[o]]=[],s.push(function(t,e,n){return function(r){c&&(null!==r&&r.__proto__.constructor===t&&r.$ds_key===e||l.invalidArg("doc")),n[o]=r}}(n,t[o],r))},e.prototype.mapToChanges=function(t){var e,n,o,i,s,a,u,c,l,p,d,f,h,m,y,g,v,_,w;for(g={load:c={},changes:n={}},m=this.__proto__.__sets,o=0,u=m.length;o<u;o++){_=m[o],f=this["_"+_].type.prototype.__props,n[_]=v={},y=t[_];for(a in y){i=y[a],v[a]=s={};for(d in i)p=i[d],s[d]=function(){if("function"==typeof(w=(l=f[d]).type))return e={v:null,s:null},p.v&&r(p,c,w,e,"v"),p.s&&r(p,c,w,e,"s"),e;if(h=l.read)return{v:null===p.v?null:h.call(this,p.v),s:null===p.s?null:h.call(this,p.s)};throw new Error("Unsupported type "+w)}.call(this)}}return g},e.end(),c&&(e.end=function(){var t,e,n;o.end.call(this),e=this.prototype.__props;for(t in e)if(n=e[t],"set"===n.type&&!n.itemType.ds_editable)throw new Error("Type '"+this.name+"': propSet '"+t+"' has non-editable item type")}),e}(o)},{"./DSData":75,"./DSDigest":80,"./DSDocument":81,"./DSHistory":82,"./DSPool":86,"./util":90}],75:[function(t,e,n){var r,o,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,u=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,o=t("./DSObject"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n;return c(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var n,r,o,i;for(o=this.__proto__.__sets,n=0,r=o.length;n<r;n++)i=o[n],this["_"+i].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void u.remove(this.release(u)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},n=function(t,n,r){if(o.call(this,t,n),i){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof r&&s.invalidArg("params")}this.set("params",r),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&u.add(this.addRef(u))},e.prototype.clear=function(){var t,e,n,r;for(n=this.__proto__.__sets,t=0,e=n.length;t<e;t++)r=n[t],this["_"+r].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;o.end.call(this),this.prototype.__sets=function(){var n,r;n=this.prototype.__props,r=[];for(t in n)e=n[t],"set"===e.type&&r.push(t);return r}.call(this)},e}(o)},{"./DSObject":84,"./util":90}],76:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,i=t("./DSDocument"),r=t("./DSData"),o=t("./DSDigest"),s=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(null!==t&&t.ds_editable||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.name]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var u,p;l(n,e),n.begin("DSDataEditable<"+t.docType+">"),n.propDoc("original",s),n.propDoc("changes",s),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),n.prototype.clear=function(){r.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},n.$u=u={};for(p in t.__super__.__props)u[p]=!0;return n.prototype.init=function(e,n,r){var l,p,d,f,h,m,y,g;if(a){if(n instanceof s||c.invalidArg("changes"),e instanceof s||c.invalidArg("original"),"function"!=typeof r&&"undefined"!=typeof r&&c.invalidArg("filter"),e.type.ds_editable)throw new Error("'original' expected to have non DSDocument.Editable items");if(t!==n.type)throw new Error("'itemType' and 'changes' must have same DSDocument.Editable type");if(e.type.Editable!==n.type)throw new Error("'original' and 'changes' must base on same DSDocument type");if(!n.hasOwnProperty("$ds_pool"))throw new Error("'changes' must be set instantiated as a field of DSChanges object")}this.set("original",e),this.set("changes",n),f=this.get("itemsSet"),d=f.items,p=n.$ds_pool,m=e.items,l=n.items,h=function(t){return function(){var i,s,c,h,y;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null,"function"==typeof t._unwatch2&&t._unwatch2(),t._unwatch2=null,h=function(t){if(a&&!p.items.hasOwnProperty(t.$ds_key))throw new Error("Missing editable item");return p.items[t.$ds_key]},c=function(e){var r;return(r=p.find(t,e.$ds_key)).init&&(r.init(e,n),r.$u=u),r},r?(_.forEach(m,function(e){var n;l.hasOwnProperty(n=e.$ds_key)||f.add(t,c(e))}),_.forEach(l,function(e){r.call(t,e)&&f.add(t,e.addRef(t))}),y=function(t){if(a&&!l.hasOwnProperty(t))throw new Error("Missing edtItem");i(l[t])},i=function(e){r.call(t,e)?d.hasOwnProperty(e.$ds_key)||f.add(t,e.addRef(t)):d.hasOwnProperty(e.$ds_key)&&f.remove(e)},s=function(t){return!!l.hasOwnProperty(t.$ds_key)&&(i(h(t)),!0)},t._unwatch1=e.watch(t,{add:function(e){s(e)||f.add(t,c(e))},remove:function(e){s(e)||(f.remove(h(e)),o.forget(t.$ds_key,e.$ds_key))}}),t._unwatch2=n.watch(t,{add:function(e){o.render(t.$ds_key,e.$ds_key,y)},change:function(e){o.render(t.$ds_key,e.$ds_key,y)},remove:function(e){i.call(t,e),o.forget(t.$ds_key,e.$ds_key)}})):(_.forEach(m,function(e){f.add(t,c(e))}),t._unwatch1=e.watch(t,{add:function(e){f.add(t,c(e))},remove:function(t){f.remove(h(t))}})),t._endLoad(!0)}}(this),y=[e,n],g=function(t){return function(e,n){var r,s,a;if(r=!1,(s=i.integratedStatus(y))!==(a=t.get("status")))switch(s){case"ready":r?(r=!1,t._endLoad(!0)):o.block(h);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(r=!0);break;case"nodata":r?(r=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this),this._unwatchA=e.watchStatus(this,g),this._unwatchB=n.watchStatus(this,g),this.init=null},n.end(),n}(r)}},{"./DSData":75,"./DSDigest":80,"./DSDocument":81,"./DSSet":87,"./util":90}],77:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,i=t("./DSObject"),r=t("./DSData"),o=t("./DSDigest"),s=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(i.isAssignableFrom(t)||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.docType]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var i,u;l(n,e),n.begin("DSDataFiltered<"+t.docType+">"),n.propDoc("original",s),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatch1&&this._unwatch1();
}),n.prototype.clear=function(){r.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1},n.$u=i={};for(u in t.__super__.__props)i[u]=!0;return n.prototype.init=function(e,n){var r,i,u,l;if(a&&(e instanceof s||c.invalidArg("original"),"function"!=typeof n&&c.invalidArg("filter"),t!==e.type))throw new Error("'itemType' and 'original' must have same DSObject type");this.set("original",e),i=this.get("itemsSet"),r=i.items,l=e.items,u=function(t){return function(){var s,a,u;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null;for(a in l)s=l[a],n(s)&&(s.addRef(t),i.add(t,s));u=function(e){r.hasOwnProperty(e)?n(s=l[e])||i.remove(s):n(s=l[e])&&(s.addRef(t),i.add(t,s))},t._unwatch1=e.watch(t,{add:function(e){o.render(t.$ds_key,e.$ds_key,u)},change:function(e){o.render(t.$ds_key,e.$ds_key,u)},remove:function(e){i.remove(e),o.forget(t.$ds_key,e.$ds_key)}}),t._endLoad(!0)}}(this),this._unwatchA=e.watchStatus(this,function(t){return function(n,r){var i,s,a;if(i=!1,(s=e.get("status"))!==(a=t.get("status")))switch(s){case"ready":i?(i=!1,t._endLoad(!0)):o.block(u);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(i=!0);break;case"nodata":i?(i=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this)),this.init=null},n.end(),n}(r)}},{"./DSData":75,"./DSDigest":80,"./DSObject":84,"./DSSet":87,"./util":90}],78:[function(t,e,n){var r,o,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,o=t("./DSObject"),i=t("./DSPool"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){s&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,n){var r,i,u,c;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),"object"==typeof n&&null!==n||a.invalidArg("sources");for(r in n){u=n[r],"object"==typeof u&&null!==u||a.invalidArg("sources");for(i in u)switch(c=u[i],i){case"name":break;case"type":!c instanceof o&&a.invalidArg("sources");break;case"set":!c instanceof o&&a.invalidArg("sources");break;case"params":"object"==typeof c&&null!==c||a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(o)},{"./DSObject":84,"./DSPool":86,"./util":90}],79:[function(t,e,n){var r,o,i,s,a,u,c,l,p=function(t,e){function n(){this.constructor=t}for(var r in e)d.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataSource",[])).name,l=t("./util").serviceOwner,u=t("./util").modeReleaseDataOnReload,i=t("./util").assert,a=t("./util").error,s=t("../utils/base64"),o=t("./DSObject"),r=t("./DSDigest"),c.factory("DSDataSource",["config","$rootScope","$q","$http",function(t,e,n,u){var c;return c=function(n){function c(){return l.apply(this,arguments)}var l;return p(c,n),c.begin("DSDataSource"),c.addDataSource(),c.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,n,o){switch(n){case"ready":r.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},l=function(n,r){o.call(this,n,r),this.cancelDefers=[],this._lastRefresh=null,this._refreshTimer=null,e.$watch(function(){return t.refreshPeriod},function(t){return function(e){t._setNextRefresh()}}(this))},c.prototype.setConnection=function(t,e){var n,r,o,u;if(i&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(u=this.cancelDefers,r=0,o=u.length;r<o;r++)n=u[r],n.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+s.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},c.prototype._setNextRefresh=function(){var e,n,r;null!==this._refreshTimer&&clearTimeout(this._refreshTimer),null!==t.refreshPeriod&&(r=null===this._lastRefresh?0:(n=this._lastRefresh.add(t.refreshPeriod,"minutes"),e=moment(),n>=e?n-e:0),this._refreshTimer=setTimeout(function(t){return function(){t.refresh()}}(this),r))},c.prototype.refresh=function(){this._lastRefresh=moment(),this._setNextRefresh(),"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},c.prototype.httpGet=function(t,e){var n,r;return this.cancelDefers.push(e),r=function(t){return function(n){return _.remove(t.cancelDefers,e),n}}(this),n={timeout:e.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),u.get(""+this.url+t,n).then(r,r)},c.prototype.httpPost=function(t,e,n){var r,o;return this.cancelDefers.push(n),o=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),r={timeout:n.promise},this.authHeader&&(r.headers={Authorization:this.authHeader}),u.post(""+this.url+t,e,r).then(o,o)},c.prototype.httpPut=function(t,e,n){var r,o;return this.cancelDefers.push(n),o=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),r={timeout:n.promise},this.authHeader&&(r.headers={Authorization:this.authHeader}),u.put(""+this.url+t,e,r).then(o,o)},c.end(),c}(o)}])},{"../utils/base64":92,"./DSDigest":80,"./DSObject":84,"./util":90}],80:[function(t,e,n){var r,o,i;o=t("./util").assert,i=t("./util").error,e.exports=r=function(){function t(){}var e,n,r,s;return n=0,e=0,r={},s=function(){var t,n,o,i,a,u,c;i=!0;for(a in r){i=!1;break}if(!i){e++,c=r,r={};for(t in c){n=c[t];for(u in n)(o=n[u])(u)}e--,s()}},t.block=function(t){e++;try{return t()}finally{0===--e&&s()}},t.render=function(t,n,s){var a;o&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||i.invalidArg("key"),"function"!=typeof s&&i.invalidArg("func")),0===e?s(n):(a=r.hasOwnProperty(t)?r[t]:r[t]={},a[n]=s)},t.forget=function(t,n){var s;o&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||i.invalidArg("key")),0!==e&&r.hasOwnProperty(t)&&(s=r[t],delete s[n])},t}()},{"./util":90}],81:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,u=t("./util").error,c=t("./util").traceRefs,i=t("./DSObjectBase"),o=t("./DSObject"),s=t("./DSSet"),e.exports=r=function(t){function e(t,n){if(e.__super__.constructor.call(this,t,n),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")}return l(e,t),e.begin("DSDocument"),e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;o.end.call(this),e=this,this.Editable=t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var r,p,d,f,h,m,y;l(n,t),n.begin(e.docType+".Editable"),delete n.prototype.$ds_docType,n.ds_editable=!0,r=null,h=n.__super__.__init;for(p in h)y=h[p],e.prototype.__props[p.substr(1)].calc&&((r||(r={}))[p]=y);n.prototype.__init=r,n.ds_dstr.push(function(){var t,e,n,r;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(n in t)e=t[n],(r=e.s)instanceof i&&r.release(this),(y=e.v)instanceof i&&y.release(this)}),n.prototype.init=function(t,n,r){var o,l,p,d,f,h,m,y,g,v;if(a&&(null!==t&&t.__proto__.constructor===e||u.invalidArg("serverDoc"),null!==n&&n instanceof s||u.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof r&&u.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=n,this.__change=r){m=!1;for(g in r)y=r[g],this.__props[g].equal(t.get(g),y.v)?delete r[g]:m=!0;if(m){if(c){h=[];for(g in r)o=r[g],o.v instanceof i&&h.push(o.v),o.s instanceof i&&h.push(o.s);for(l=0,f=h.length;l<f;l++)d=h[l],v=d.$ds_referries,0===v.length?console.error(i.desc(d)+": Empty $ds_referries"):(p=v.lastIndexOf(owner))<0?(console.error(i.desc(this)+": Referry not found: "+i.desc(owner)),totalReleaseVerb):(totalReleaseVerb&&(console.info(++util.serviceOwner.msgCount+": transfer: "+i.desc(d)+", refs: "+this.$ds_ref+", from: "+i.desc(owner)+", to: "+i.desc(this)),util.serviceOwner.msgCount===window.totalBreak),v[p]=this)}this.addRef(this),n.add(this,this)}else delete this.__change}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},n.prototype.__onChange=function(t,e,n,r){var o,s,a,u,c,l,p,d,f,h,m,y;if((d=t.__props[e]).common){if(this.$ds_evt)for(f=this.$ds_evt,a=f.length-1;a>=0;a+=-1)p=f[a],p.__onChange.call(p,this,e,n,r)}else if((o=this.__change)&&o.hasOwnProperty(e)){if(d.equal(y=(d=o[e]).v,n)){for((m=d.s)instanceof i&&m.release(this),y instanceof i&&y.release(this),delete o[e],s=!0,u=0,l=o.length;u<l;u++)if(e=o[u],"__error"!==e&&"__refreshView"!==e){s=!1;break}s&&(delete this.__change,this.$ds_chg.remove(this))}}else if(this.$ds_evt)for(h=this.$ds_evt,c=h.length-1;c>=0;c+=-1)p=h[c],p.__onChange.call(p,this,e,n,r)},n.prototype._clearChanges=function(){var t,e,n,r,o,s,a;if(t=this.__change){for(o in t){if(r=t[o],this.$ds_evt)for(s=this.$ds_evt,e=s.length-1;e>=0;e+=-1)n=s[e],n.__onChange.call(n,this,o,this.$ds_doc[o],r.v);(a=r.s)instanceof i&&a.release(this),(y=r.v)instanceof i&&y.release(this)}delete this.__change,this.$ds_chg.remove(this)}},f=n.prototype.__props=e.prototype.__props,n.prototype.get=function(t){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]},n.prototype.set=function(t,e){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]=e},m=e.prototype.__props;for(p in m)d=m[p],d.calc||!function(t,e,r){var o;return d.common?Object.defineProperty(n.prototype,t,{get:function(){return this.$ds_doc[t]},set:function(e){var n;(n=this.$ds_doc[t])!==e&&(this.$ds_doc[t]=e,this.$ds_chg.$ds_hist.add(this,t,e,n))}}):Object.defineProperty(n.prototype,t,{get:o=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(n){var s,c,l,d,f,h,m,g,v,_,w;if(a&&"undefined"==typeof(n=e(y=n))&&u.invalidValue(this,t,y),!r(m=o.call(this),n)){if(n instanceof i&&n.addRef(this),s=this.__change)if(r(w=this.$ds_doc[t],n)){this.$ds_chg.$ds_hist.add(this,t,n,(c=s[t]).v),(y=c.v)instanceof i&&y.release(this),(_=c.s)instanceof i&&_.release(this),delete s[t],l=!0;for(p in s)if("__error"!==p&&"__refreshView"!==p){l=!1;break}if(l){if(this.$ds_evt)for(g=this.$ds_evt,d=g.length-1;d>=0;d+=-1)h=g[d],h.__onChange.call(h,this,t,n,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(c=s[t])?(this.$ds_chg.$ds_hist.add(this,t,n,c.v),(y=c.v)instanceof i&&y.release(this),c.v=n):(w instanceof i&&w.addRef(this),s[t]={v:n,s:w},this.$ds_chg.$ds_hist.add(this,t,n,m));else s=this.__change={},m instanceof i&&m.addRef(this),s[t]={v:n,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,n,m);if(this.$ds_evt)for(v=this.$ds_evt,f=v.length-1;f>=0;f+=-1)h=v[f],h.__onChange.call(h,this,t,n,m)}}})}(d.name,d.valid,d.equal);return o.end.call(n),n}(e)},e}(o)},{"./DSObject":84,"./DSObjectBase":85,"./DSSet":87,"./util":90}],82:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;u=t("./util").assert,c=t("./util").error,a=t("./DSObjectBase"),s=t("./DSObject"),r=t("./DSDigest"),o=t("./DSDocument"),e.exports=i=function(t){function e(){return p.apply(this,arguments)}var n,o,i,p,d,f;return l(e,t),e.begin("DSHistory"),e.ds_dstr.push(function(){n.call(this)}),p=function(t,e){s.call(this,t,e),this.hist=[],this.histTop=0},n=function(){var t,e,n,r,o;for(r=this.hist,e=0,n=r.length;e<n;e++)t=r[e],t.i.release(this),"object"==typeof(o=t.o)&&o instanceof a&&o.release(this),"object"==typeof(o=t.n)&&o instanceof a&&o.release(this);this.hist=[],this.histTop=0},f=!1,i=null,o=0,e.prototype.startBlock=function(){i=++o},e.prototype.endBlock=function(){i=null},e.prototype.startReset=function(){f=!0,n.call(this)},e.prototype.endReset=function(){f=!1},e.prototype.add=function(t,e,n,r){var o,s,l,p,d,h,m,y,g,v,_;if(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop"),0<=["string","number","boolean","object","undefined"].indexOf(typeof n)||c.invalidArg("newVal"),0<=["string","number","boolean","object","undefined"].indexOf(typeof r)||c.invalidArg("oldVal")),!f){if((p=this.hist).length>this.histTop){for(g=p.slice(this.histTop),h=0,m=g.length;h<m;h++)l=g[h],l.i.release(this),"object"==typeof(_=l.o)&&_ instanceof a&&_.release(this),"object"==typeof(_=l.n)&&_ instanceof a&&_.release(this);p.length=this.histTop}if(t.addRef(this),n instanceof a&&n.addRef(this),r instanceof a&&r.addRef(this),p.push(y={i:t,p:e,n:n,o:r}),i&&(y.b=i),(this.histTop=d=p.length)>200){for(s=-1;;){for(o=p[++s].b;++s<d&&(l=p[s]).b===o;)(v=l.n)instanceof a&&v.release(this),(v=l.o)instanceof a&&v.release(this);if(d-s<=200)break}this.hist=p=p.slice(s),this.histTop=p.length}}},e.prototype.setSameAsServer=function(t,e){var n,r,o,i,s;for(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop")),i=this.hist.slice(0,this.histTop),r=o=i.length-1;o>=0;r=o+=-1)if(n=i[r],n.i===t&&n.p===e){"object"==typeof(s=n.n)&&s instanceof a&&s.release(this),"undefined"==typeof n.o?(t.release(this),this.hist.splice(r,1),this.histTop--):n.n=void 0;break}},e.prototype.hasUndo=function(){return this.histTop>0},e.prototype.undo=function(){var t,e,n,o,i;if((o=this.histTop)>0){f=!0;try{e=(n=this.hist)[this.histTop=--o],"number"!=typeof(t=e.b)||0===o||n[o-1].b!==t?"undefined"==typeof(i=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i):r.block(function(r){return function(){for(;;){if("undefined"==typeof(i=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i),0===o||(e=n[o-1]).b!==t)break;r.histTop=--o}}}(this))}finally{f=!1}}},e.prototype.hasRedo=d=function(){return this.histTop<this.hist.length},e.prototype.redo=function(){var t,e,n,o,i,s;if(f=!0,(o=this.histTop)<(i=(n=this.hist).length)){f=!0;try{e=n[o],this.histTop=++o,"number"!=typeof(t=e.b)||o===i||n[o].b!==t?"undefined"==typeof(s=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s):r.block(function(r){return function(){for(;;){if("undefined"==typeof(s=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s),o===i||(e=n[o]).b!==t)break;r.histTop=++o}}}(this))}finally{f=!1}}},e.end(),e}(s)},{"./DSDigest":80,"./DSDocument":81,"./DSObject":84,"./DSObjectBase":85,"./util":90}],83:[function(t,e,n){var r,o,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=t("./util"),i=t("./util").assert,u=t("./util").traceRefs,a=t("./util").totalReleaseVerb,s=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n;return l(e,t),e.begin("DSList"),n=function(t,e,n){o.call(this,t,e),i&&!n instanceof o&&s.notDSObjectClass(n),this.type=n,this.items=[]},e.ds_dstr.push(function(){var t,e,n,r;for(n=this.items,t=0,e=n.length;t<e;t++)r=n[t],r.release(this)}),e.prototype.merge=function(t,e){var n,r,l,p,d,f,h,m,y,g;for(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),_.isArray(e)||s.invalidArg("newList")),p=this.items,g=this.type,d=0,h=p.length;d<h;d++)l=p[d],l.release(this);for(p.length=0,n=f=0,m=e.length;f<m;n=++f)l=e[n],!l instanceof g&&s.invalidListValue(this,n,l),u&&(y=l.$ds_referries,0===y.length?console.error(o.desc(DSDitem)+": Empty $ds_referries"):(r=y.lastIndexOf(t))<0?console.error(o.desc(this)+": Referry not found: "+o.desc(t)):(a&&(console.info(++c.serviceOwner.msgCount+": transfer: "+o.desc(l)+", refs: "+this.$ds_ref+", from: "+o.desc(t)+", to: "+o.desc(this)),c.serviceOwner.msgCount===window.totalBreak),y[r]=this)),p.push(l);return p},e.end(),e}(o)},{"./DSObjectBase":85,"./util":90}],84:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("./util").assert,l=t("./util").serviceOwner,p=t("./util").totalRelease,l=t("./util").serviceOwner,c=t("./util").error,i=t("./DSObjectBase"),a=t("./DSSet"),r=t("./DSList"),s=t("./DSPool"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return d(e,t),e.desc=i.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof r||t instanceof s?p?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:p?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===l?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},n=function(t,e){if(i.call(this,t,e),u&&this.__proto__.constructor===i)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){p?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new s(l,e.docType+".pool",e,t),l.clearPool(function(){e.__pool.release(l),delete e.__pool})),e.__pool}}(this)}):this.pool=new s(l,this.docType+".pool",this,t)},e.propPool=function(t,e,n){var r,o;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),r="_"+t,this.ds_dstr.push(function(){this[r].release(this),delete this[r]}),(o=this.prop({name:t,type:"pool",init:function(){return new s(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,n)},readonly:!0})).itemType=e,o},e.propSet=function(t,e){var n,r;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(r=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[n].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[n]}}),r},e.propList=function(t,e){var n,o;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(o=this.prop({name:t,type:"list",init:function(){return new r(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[n]}}),o},e}(i)},{"./DSList":83,"./DSObjectBase":85,"./DSPool":86,"./DSSet":87,"./util":90}],85:[function(t,e,n){var r,o,i,s,a,u,c,l,p;p=t("./util"),o=t("./util").assert,c=t("./util").traceData,s=t("./util").serviceOwner,l=t("./util").traceRefs,a=t("./util").totalRelease,u=t("./util").totalReleaseVerb,i=t("./util").error,e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,n,r,s,d,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&i.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=n=null,(window.totalReleaseReset=function(){n=0,window.totalPool=h={},p.serviceOwner.start(),p.serviceOwner.msgCount=0})(),window.totalRelease=function(){return p.serviceOwner.stop(),h}),e=function(e,r){var s,c,d;if(o){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBаse directly");"object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry"),"string"!=typeof r&&i.invalidArg("key")}if(this.$ds_key=r,this.$ds_ref=1,a&&(h[this.$ds_globalId=++n]=this,u&&(console.info(++p.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),p.serviceOwner.msgCount===window.totalBreak)),l&&(this.$ds_referries=[e]),s=this.__proto__.__init)for(c in s)d=s[c],this[c]="function"==typeof d?d.call(this):d;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(o&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),0===this.$ds_ref)throw new Error("addRef() on already fully released object");return l&&this.$ds_referries.push(e),this.$ds_ref++,u&&(console.info(++p.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),p.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var n,r;if(o&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),u&&(console.info(++p.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),p.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(l&&((n=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(n,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((r=this.$ds_pool).watchOn&&(o&&(_.find(this.$ds_evt,function(t){return function(t){return t===r}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,r)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+"@"+this.$ds_key+("object"==typeof this.$ds_pool?" <- "+this.$ds_pool:"")},t.prototype.toJSON=function(){return this.__proto__.$ds_docType+"@"+this.$ds_key},t.prototype.writeMap=function(){var t,e,n,r;r={},n=this.__proto__.__props;for(e in n)t=n[e],t.write&&(r[e]=t.write(this["_"+e]));return r},t.prototype.readMap=function(e){var n,r,o,i,s;o=this.__proto__.__props;for(r in e)s=e[r],o.hasOwnProperty(r)&&(n=o[r]).read?(this[r]=i=n.read.call(this,s),i instanceof t&&i.release(this)):console.error("Unexpected property "+r)},t.begin=function(t){var e;o&&"string"!=typeof t&&i.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,n,r;for(n=0,r=t.length;n<r;n++)e=t[n],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,n;for(n=e.length-1;n>=0;n+=-1)t=e[n],t.call(this)})},t.prop=function(t){var e,n,r,s,a,u,c,l,p,d;if(o){if("object"!=typeof t&&i.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if("undefined"!=typeof t.calc&&"boolean"!=typeof t.calc)throw new Error("Invalid value of opts.calc");if("undefined"!=typeof t.common&&"boolean"!=typeof t.common)throw new Error("Invalid value of opts.common");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.calc&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(r=t.init)?r():r))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&t.write&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&t.read&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("calc")&&t.calc)throw new Error("Ambiguous opts.readonly and opts.calc");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.readonly and opts.common");if(t.hasOwnProperty("calc")&&t.calc&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.calc and opts.common")}if(this.prototype.hasOwnProperty("__init")?o&&this.prototype.__props.hasOwnProperty(t.name)&&i.duplicatedProperty(this,t.name):(this.prototype.__init=(l=this.__super__.__init)?_.clone(l):{},c=this.prototype.__props=(p=this.__super__.__props)?_.clone(p):{},this.prototype.get=function(t){return o&&(c.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return o&&(c.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e}),u=this.prototype.__props[t.name]={name:t.name,type:t.type,write:t.write||(t.hasOwnProperty("write")&&!t.write||t.calc||t.common?null:function(t){return null===t?null:t.valueOf()}),read:t.read||(t.hasOwnProperty("read")&&!t.read||t.calc||t.common?null:function(t){return t}),equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){return null===t?"":t.toString()},readonly:t.readonly||!1,calc:t.calc||!1,common:t.common||!1},t.hasOwnProperty("init"))d=u.valid=t.valid,u.init=this.prototype.__init[s="_"+(a=t.name)]=t.init,t.calc&&(t.readonly===!0,this.prototype["__setCalc"+(a.substr(0,1).toUpperCase()+a.substr(1))]=function(t){var n,r,o,u,c;if("undefined"==typeof(t=d(c=t))&&i.invalidValue(this,a,c),!e(u=this[s],t)&&(this[s]=t,n=this.$ds_evt))for(r=n.length-1;r>=0;r+=-1)o=n[r],o.__onChange.call(o,this,a,t,u)}),Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[s]},set:t.set||(t.readonly?function(t){i.propIsReadOnly(this,a)}:function(t){var n,r,o,u,c;if("undefined"==typeof(t=d(c=t))&&i.invalidValue(this,a,c),!e(u=this[s],t)&&(this[s]=t,n=this.$ds_evt))for(r=n.length-1;r>=0;r+=-1)o=n[r],o.__onChange.call(o,this,a,t,u)})});else if(t.hasOwnProperty("value"))u.value=t.value,u.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");u.func=n=t.func,u.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return n.call(this)},set:t.set||function(t){i.propIsReadOnly(this,a)}})}return u},t.propSimple=function(t,e,n){var r,s;return o&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&i.invalidArg("type"),"string"!=typeof e&&i.invalidArg("name")),s=(r=s)?function(e){return null!==e&&typeof e!==t||void 0===(e=r(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop(_.assign({name:e,type:t,init:"undefined"==typeof init||null===init?null:"function"==typeof init||"object"!==t?init:function(){return _.clone(init)},valid:s,write:n&&(n.calc||n.common)?null:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()}},n))},t.propNum=function(t,e){this.propSimple("number",t,e)},t.propBool=function(t,e){return this.propSimple("boolean",t,e)},t.propStr=function(t,e){return this.propSimple("string",t,e)},t.propObj=function(t,e){return this.propSimple("object",t,e)},t.propDoc=function(e,n,r){var s,a,u;return o&&(u&&"function"!=typeof u&&i.invalidArg("valid"),"function"!=typeof n&&i.invalidArg("type"),!n instanceof t&&i.notDSObjectClass(n)),u=(a=u)?function(t){return(null===t||t instanceof n)&&void 0!==(t=a(t))?t:void 0}:function(t){return null===t||t instanceof n?t:void 0},s="_"+e,this.ds_dstr.push(function(){this[s]&&this[s].release(this)}),this.prop(_.assign({name:e,type:n,init:null,valid:u,write:r&&(r.calc||r.common)?null:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof n.str?n.str:function(t){return null===t?"":t.$ds_key},set:function(t){var n,r,o,a,c;if("undefined"==typeof(t=u(c=t))&&i.invalidValue(this,e,c),(a=this[s])!==t){if(this[s]=t,t&&t.addRef(this),n=this.$ds_evt)for(r=n.length-1;r>=0;r+=-1)o=n[r],o.__onChange.call(o,this,e,t,a);a&&a.release(this)}}},r))},t.propCalc=function(t,e,n){return o&&(e&&"function"==typeof e||i.invalidArg("func")),this.prop(_.assign({name:t,type:"calc",func:e},n))},t.propConst=function(t,e,n){return o&&"undefined"==typeof e&&i.invalidArg("value"),this.prop(_.assign({name:t,type:"const",value:e},n))},t.propEnum=function(t,e,n){var r,s,a,u,c,l;if(o)for(_.isArray(e)&&0!==e.length||i.invalidArg("values"),r=0,s=e.length;r<s;r++)c=e[r];return l=(u=l)?function(t){return(null===t||e.indexOf(t)>=0)&&u(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},a="_"+t,this.prop(_.assign({name:t,type:"enum",init:e[0],valid:l,set:function(e){var n,r,o,s,u;if("undefined"==typeof(e=l(u=e))&&i.invalidValue(this,t,u),(o=this[a])!==e&&(this[a]=e,this.$ds_evt))for(s=this.$ds_evt,n=s.length-1;n>=0;n+=-1)r=s[n],r.__onChange.call(r,this,t,e,o)}},n))},t.propMoment=function(t,e,n){var r;return o&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(r=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&r(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop(_.assign({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null},n))},t.propDuration=function(t,e,n){var r;return o&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(r=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&r(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop(_.assign({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null},n))},t.onAnyPropChange=function(t){o&&"function"!=typeof t&&i.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],
d=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,n,r,s,a;for(o&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||i.invalidArg("sources")),r=-1,e=0,n=t.length;e<n;e++)a=t[e],a&&r<(s=d.indexOf(a.get("status")))&&(r=s);return r===-1?"nodata":d[r]},c&&(s=0,r=0),t.addDataSource=function(e){var n,a;if(o){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&i.invalidArg("onStatusChange")}this.ds_dataSource=!0,c&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++s,console.info(++r+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),r===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++r+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),r===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},n=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(n){var o,s,u,l,p;if("undefined"==typeof(n=a(p=n))&&i.invalidValue(this,"status",p),(u=this._status)!==n)for(c&&(console.info(++r+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+n+", old: "+u),r===window.sourceBreak),this._status=n,null!=e&&e.call(this,n,u),l=this.$ds_statusWatchers,o=l.length-1;o>=0;o+=-1)s=l[o],s.lst(this,n,u,s.unwatch)}}),n.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var n,r,s,a;return o&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("referry"),"function"!=typeof e&&i.invalidArg("listener")),(a=this.$ds_statusWatchers).push(s={lst:e}),this.addRef(t),s.unwatch=r=function(e){return function(n){return function(){n||(e.release(t),_.remove(a,s),n=!0)}}}(this)(!1),n=this.get("status"),"update"===n?(e(this,"ready","nodata",r),_.find(a,s)&&e(this,"update","ready",r)):e(this,n,"nodata",r),r}},t}()},{"./util":90}],86:[function(t,e,n){var r,o,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,u=t("./util").traceWatch,o=t("./DSObjectBase"),r=t("./DSDigest"),e.exports=i=function(t){function e(){return n.apply(this,arguments)}var n,i;return c(e,t),e.begin("DSPool"),n=function(t,e,n,r){var i;o.call(this,t,e),s&&(o.isAssignableFrom(n)||a.notDSObjectClass(n)),i=this.items={},this.type=n,r&&(this.watchOn=!0,this.evt=[])},i=function(t){var e,n,r,o,i;if((o=this.items).hasOwnProperty(t))for(r=o[t],i=this.evt,n=i.length-1;n>=0;n+=-1)e=i[n],e.lst(r)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&r.render(this.$ds_key,t.$ds_key,function(t){return function(e){i.call(t,e)}}(this))},e.prototype.find=function(t,e,n){var r,o;return s&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof n||"object"==typeof n&&null!==n||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(o=e)),n&&n.hasOwnProperty(e)?n[e]:(this.items.hasOwnProperty(e)?(r=this.items[e]).addRef(t):(r=this.items[e]=new this.type(t,e,o),r.$ds_pool=this,this.evt&&(r.hasOwnProperty("$ds_evt")?(s&&_.find(r.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),r.$ds_evt.push(this)):r.$ds_evt=[this],this.__onChange(r))),n?n[e]=r:r)},e.prototype.enableWatch=function(t){if(s&&!this.evt)throw new Error("Pool '"+o.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var n,r,i,c,l;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(i in e)if(c=e[i],"change"!==i&&"add"!==i&&"remove"!==i)throw new Error("Unexpected event listener: "+i);if(u&&(e.owner=t),!this.evt)throw new Error("Pool '"+o.desc(this)+"' watch functionality is not enabled")}return(r=this.evt).push(l={lst:e}),this.addRef(t),n=!0,function(e){return function(){n&&(n=!1,e.release(t),_.remove(r,l))}}(this)},e.end(),e}(o)},{"./DSDigest":80,"./DSObjectBase":85,"./util":90}],87:[function(t,e,n){var r,o,i,s,a,u,c,l,p,d=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;p=t("./util"),i=t("./util").assert,c=t("./util").traceRefs,l=t("./util").traceWatch,u=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,s=t("./util").error,r=t("./DSObjectBase"),e.exports=o=function(t){function e(){return a.apply(this,arguments)}var n,o,a;return d(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,n,r;n=t=this.items;for(e in n)r=n[e],r.release(this),delete t[e]}),a=function(t,e,n,o){r.call(this,t,e),i&&(!n instanceof r&&s.notDSObjectClass(n),"object"!=typeof o&&void 0!==o&&s.invalidArg("data")),this.data=o,this.type=n,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,n,r;for(n=this.evt,e=n.length-1;e>=0;e+=-1)t=n[e],null!=(r=t.change)&&r.apply(t,arguments)},e.prototype.merge=function(t,e){var r,a,u;i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("newMap")),u=this.items;for(a in u)r=u[a],e.hasOwnProperty(a)||o.call(this,r);for(a in e){if(r=e[a],i&&a!==r.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+r.$ds_key);n.call(this,t,r)}return this.items},e.prototype.reset=function(){var t,e,n,r,o;for(t=this.evt,_.forEach(n=this.items,function(e){return function(n){var r,o,i;for(o=0,i=t.length;o<i;o++)r=t[o],"function"==typeof r.remove&&r.remove(n);n.release(e)}}(this)),e=0,o=n.length;e<o;e++)r=n[e],delete n[r]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&o.call(this,t)},o=function(t){var e,n,r;for(t.hasOwnProperty("$ds_evt")&&(i&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],r=this.evt,n=r.length-1;n>=0;n+=-1)e=r[n],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=n=function(t,e){var n,o,a,l,d,f;if(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),e instanceof this.type||s.invalidMapElementType(this,e)),(l=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(i&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],l[e.$ds_key]=e,c&&(f=e.$ds_referries,0===f.length?console.error(r.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(r.desc(this)+": Referry not found: "+r.desc(t)):(u&&(console.info(++p.serviceOwner.msgCount+": transfer: "+r.desc(e)+", refs: "+this.$ds_ref+", from: "+r.desc(t)+", to: "+r.desc(this)),p.serviceOwner.msgCount===window.totalBreak),f[a]=this)),d=this.evt,o=d.length-1;o>=0;o+=-1)n=d[o],"function"==typeof n.add&&n.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,n){var r,o,a,u;if(i){"object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("listener");for(a in e)if(u=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);l&&(e.owner=t)}if(_.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(o=this.evt).push(e),!n)return this.addRef(t),r=!0,function(n){return function(){r&&(r=!1,n.release(t),_.remove(o,function(t){return t===e}))}}(this)},e.prototype.addRef=function(t){var n;return 1===this.$ds_ref&&(n=this.data)&&1===++n.__busySets&&n.addRef(n.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var n;return e.__super__.release.call(this,t),1===this.$ds_ref&&(n=this.data)&&0===--n.__busySets&&n.release(n.__backRef),this},e.end(),e}(r)},{"./DSObjectBase":85,"./util":90}],88:[function(t,e,n){var r,o,i,s,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,r=t("./DSObjectBase"),e.exports=o=function(t){function e(t,n){var o,a,u,c,l,p,d,f,h,m;if(e.__super__.constructor.call(this,t,""+ ++e.nextTags),i&&(2===arguments.length&&"object"==typeof(f=arguments[1])||void 0!==n&&"string"!=typeof n&&s.invalidArg("enums")),2===arguments.length&&"object"==typeof(f=arguments[1])){f.__proto__===e.prototype?(this.map=_.clone(f.map),this.value=f.value):(this.map=l=_.clone(n),this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")),p=this.map;for(u in p)m=p[u],m instanceof r&&m.addRef(this)}else{if(this.map=l={},"string"==typeof n)for(d=n.split(","),o=0,c=d.length;o<c;o++)h=d[o],l[h.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")}}return a(e,t),e.nextTags=0,e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(n,r){var o,a;return i&&r&&"function"!=typeof r&&s.invalidArg("valid"),r=(a=r)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&a(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},o="_"+n,this.ds_dstr.push(function(){this[o]&&this[o].release(this)}),t.prop({name:n,type:"DSTags",valid:r,read:function(t){return null!==t?new e(this,t):null},str:function(t){return t.value},init:null,set:function(t){var e,i,a,u,c;if("undefined"==typeof(t=r(c=t))&&s.invalidValue(this,n,c),(u=this[o])!==t){if(this[o]=t,t&&t.addRef(this),e=this.$ds_evt)for(i=e.length-1;i>=0;i+=-1)a=e[i],a.__onChange.call(a,this,n,t,u);u&&u.release(this)}}})}},e.ds_dstr.push(function(){var t,e,n;e=this.map;for(t in e)n=e[t],n instanceof r&&n.release(this)}),e.prototype.clone=function(t){return new e(t,this)},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.set=function(t,e){var n,o,a,u;return i&&("string"!=typeof t&&s.invalidArg("enumValue"),"undefined"==typeof e&&s.invalidArg("value")),e?(n=(a=this.map).hasOwnProperty(t),e instanceof r&&e.addRef(this),(u=a[t])instanceof r&&u.release(this),a[t]=e,n||(this.value=_.sortBy(function(){var t;t=[];for(o in a)t.push(o);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((u=a[t])instanceof r&&u.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(o in a)t.push(o);return t}()).join(", ")),this},e.prototype.get=function(t){return i&&"string"!=typeof t&&s.invalidArg("enumValue"),!!this.map.hasOwnProperty(t)&&this.map[t]},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.empty=function(){var t;for(t in this.map)return!1;return!0},e.prototype.diff=function(t){var n,r,o;return i&&("object"==typeof t&&t.__proto__===e.prototype||s.invalidArg("src")),o=t.map,function(){var t;t=[];for(n in r=this.map)o.hasOwnProperty(n)||t.push("+"+n);return t}.call(this).concat(function(){var t;t=[];for(n in o)r.hasOwnProperty(n)||t.push("-"+n);return t}()).join(", ")},e.end(),e}(r)},{"./DSObjectBase":85,"./util":90}],89:[function(t,e,n){var r,o,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(a=angular.module("dscommon/DSView",[t("../app/data/dsDataService")])).name,u=t("./util").traceView,i=t("./util").assert,s=t("./util").error,r=t("./DSObject"),o=t("./DSSet"),a.factory("DSView",["dsDataService","$log",function(t,e){var n,o;return o=function(){function t(){}return t.prototype.get=function(t){return i&&(this.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]},t.prototype.set=function(t,e){return i&&(this.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]=e},t}(),n=function(e){function n(){return a.apply(this,arguments)}var a,l;return c(n,e),n.begin("DSView"),n.begin=function(t){var e;r.begin.call(this,t),this.prototype.__src=(e=this.__super__.__src)?_.clone(e):{}},n.propData=function(t,e,n){var r,o;if(i){if("undefined"!=typeof this.prototype._src)throw new Error("Duplicate data set name: "+t);"undefined"==typeof n||"object"==typeof n&&null!==n||s.invalidArg("params")}"object"==typeof n&&(n.hasOwnProperty("watch")?(o=n.watch,delete n.watch):o=null,i&&(_.isArray(o)||null===o||s.invalidArg("params.watch"))),this.prototype.__srcLength=(r=_.size(this.prototype.__src))+1,this.prototype.__src[t]={name:t,type:e,watch:o,params:n,index:r}},n.ds_dstr.push(function(){var t,e,n;"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2(),e=this.__src;for(t in e)n=e[t],"function"==typeof n.unwatch&&n.unwatch(),"function"==typeof n.unwatchStatus&&n.unwatchStatus(),n.hasOwnProperty("set")&&n.set.release(this)}),a=function(t,e){var n,o,a,u,c;r.call(this,t,e),i&&"object"!=typeof t&&s.invalidArg("$scope"),this.__unwatch1=(this.__scope=t).$on("$destroy",function(e){return function(){return delete e.__unwatch1,e.release(t)}}(this)),this.__dirty=0,this.__src=_.cloneDeep(this.__proto__.__src),this.__srcList=new Array(__proto__.__srcLength),this.dataStatus="nodata",a=function(t){return function(){t.__dirty++}}(this),o=this.__src;for(n in o)u=o[n],c=u.watch,u.listener={add:a,remove:a,change:c?function(t){return function(e){return function(n,r){e.indexOf(r)!==-1&&t.__dirty++}}}(this)(c):a}},n.prop({name:"data",type:"DSView.data",readonly:!0,init:function(){return new o}}),l=0,n.prototype.dataUpdate=function(e){var n,o,a,c,p,d,f,h,m;"undefined"==typeof e&&(e={}),i&&"object"!=typeof e&&null!==e&&s.invalidArg("params"),t.requestSources(this,e,this.__src),f=this.__src;for(a in f)if(m=f[a],m.hasOwnProperty("newSet")){if(p=m.newSet,m.hasOwnProperty("set")&&(m.set.release(this),m.unwatch(),m.unwatchStatus()),Object.defineProperty(n=this.get("data"),a,{configurable:!0,enumerable:!0,value:p.items}),Object.defineProperty(n,a+"Set",{configurable:!0,get:function(t){return function(){return t}}(p)}),Object.defineProperty(n,a+"Status",{configurable:!0,get:function(t){return function(){return t.get("status")}}(p)}),this.__srcList[m.index]=m.set=p,delete m.newSet,this.__dirty++,m.unwatch=p.watch(this,m.listener),d=!0,null!==m.watch)for(h=m.watch,o=0,c=h.length;o<c;o++){a=h[o],d=!1;break}else d=!1;m.unwatchStatus=function(t){return function(e){return p.watchStatus(t,function(n,o,i){var s;(i=t.dataStatus)!==(s=r.integratedStatus(t.__srcList))&&(t.dataStatus=s,!e&&("ready"===s&&"update"===i||"update"===s&&"ready"===i)||t.__dirty++)})}}(this)(d)}this.hasOwnProperty("__unwatch2")||(this.__unwatch2=this.__scope.$watch(function(t){return function(){return t.__dirty}}(this),function(t){return function(e,n){var o,i,s,a;if(u){i="",o=t.__src;for(a in o)s=o[a],i+=", "+a+": "+s.set.get("status");console.info(++l+":"+r.desc(t)+".render(): dataStatus: "+t.dataStatus+i),l===window.viewBreak}t.render()}}(this)))},n.end(),n}(r)}])},{"../app/data/dsDataService":24,"./DSObject":84,"./DSSet":87,"./util":90}],90:[function(t,e,n){var r,o;e.exports=o={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(r=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,n,r,o,i,s,a;for(i=this.services,e=0,r=i.length;e<r;e++)a=i[e],a.release(this);if(this.poolCleaners)for(s=this.poolCleaners,n=0,o=s.length;n<o;n++)(t=s[n])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")}}}},{}],91:[function(t,e,n){!function(t,e,n){"use strict";function r(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var o=e.isDefined,i=e.isUndefined,s=e.isNumber,a=e.isObject,u=e.isArray,c=e.extend,l=e.toJson,p=e.fromJson,d=e.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,n,d){var f,h=this,m=h.prefix,y=h.cookie,g=h.notify,v=h.storageType;n?n[0]&&(n=n[0]):n=document,"."!==m.substr(-1)&&(m=m?m+".":"");var _=function(t){return m+t},w=function(){try{var n=v in e&&null!==e[v],r=_("__"+Math.round(1e7*Math.random()));return n&&(f=e[v],f.setItem(r,""),f.removeItem(r)),n}catch(o){return v="cookie",t.$broadcast("LocalStorageModule.notification.error",o.message),!1}}(),k=function(e,n){if(i(n)?n=null:(a(n)||u(n)||s(+n||n))&&(n=l(n)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),g.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:"cookie"}),P(e,n);try{(a(n)||u(n))&&(n=l(n)),f&&f.setItem(_(e),n),g.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:h.storageType})}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.message),P(e,n)}return!0},S=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),$(e);var n=f?f.getItem(_(e)):null;return n&&"null"!==n?"{"===n.charAt(0)||"["===n.charAt(0)||r(n)?p(n):n:null},D=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),g.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),j(e);try{f.removeItem(_(e)),g.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.message),j(e)}return!0},b=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,n=[];for(var r in f)if(r.substr(0,e)===m)try{n.push(r.substr(e))}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.Description),[]}return n},T=function(e){e=e||"";var n=m.slice(0,-1),r=new RegExp(n+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),A();var o=m.length;for(var i in f)if(r.test(i))try{D(i.substr(o))}catch(s){return t.$broadcast("LocalStorageModule.notification.error",s.message),A()}return!0},O=function(){try{return e.navigator.cookieEnabled||"cookie"in n&&(n.cookie.length>0||(n.cookie="test").indexOf.call(n.cookie,"test")>-1)}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),P=function(e,r){if(i(r))return!1;if((u(r)||a(r))&&(r=l(r)),!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var o="",s=new Date,c="";if(null===r?(s.setTime(s.getTime()+-864e5),o="; expires="+s.toGMTString(),r=""):0!==y.expiry&&(s.setTime(s.getTime()+24*y.expiry*60*60*1e3),o="; expires="+s.toGMTString()),e){var p="; path="+y.path;y.domain&&(c="; domain="+y.domain),n.cookie=_(e)+"="+encodeURIComponent(r)+o+p+c}}catch(d){return t.$broadcast("LocalStorageModule.notification.error",d.message),!1}return!0},$=function(e){if(!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var r=n.cookie&&n.cookie.split(";")||[],o=0;o<r.length;o++){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(_(e)+"=")){var s=decodeURIComponent(i.substring(m.length+e.length+1,i.length));try{var a=JSON.parse(s);return p(a)}catch(u){return s}}}return null},j=function(t){P(t,null)},A=function(){for(var t=null,e=m.length,r=n.cookie.split(";"),o=0;o<r.length;o++){for(t=r[o];" "===t.charAt(0);)t=t.substring(1,t.length);var i=t.substring(e,t.indexOf("="));j(i)}},x=function(){return v},L=function(t,e,n,r){r=r||e;var i=S(r);return null===i&&o(n)?i=n:a(i)&&a(n)&&(i=c(n,i)),d(e).assign(t,i),t.$watch(e,function(t){k(r,t)},a(t[e]))},C=function(){for(var t=0,n=e[v],r=0;r<n.length;r++)0===n.key(r).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:x,set:k,add:k,get:S,keys:b,remove:D,clearAll:T,bind:L,deriveKey:_,length:C,cookie:{isSupported:O,set:P,add:P,get:$,remove:j,clearAll:A}}}]})}(window,window.angular)},{}],92:[function(t,e,n){var r;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,n,o,i,s,a,u,c,l;for(l="",e=void 0,n=void 0,o="",i=void 0,s=void 0,a=void 0,u="",c=0;;)if(e=t.charCodeAt(c++),n=t.charCodeAt(c++),o=t.charCodeAt(c++),i=e>>2,s=(3&e)<<4|n>>4,a=(15&n)<<2|o>>6,u=63&o,isNaN(n)?a=u=64:isNaN(o)&&(u=64),l=l+r.charAt(i)+r.charAt(s)+r.charAt(a)+r.charAt(u),e=n=o="",i=s=a=u="",!(c<t.length))break;return l},decode:function(t){var e,n,o,i,s,a,u,c,l,p;for(p="",n=void 0,o=void 0,i="",s=void 0,a=void 0,u=void 0,c="",l=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(s=r.indexOf(t.charAt(l++)),a=r.indexOf(t.charAt(l++)),u=r.indexOf(t.charAt(l++)),c=r.indexOf(t.charAt(l++)),n=s<<2|a>>4,o=(15&a)<<4|u>>2,i=(3&u)<<6|c,p+=String.fromCharCode(n),64!==u&&(p+=String.fromCharCode(o)),64!==c&&(p+=String.fromCharCode(i)),n=o=i="",s=a=u=c="",!(l<t.length))break;return p}}},{}],93:[function(t,e,n){(function(r){var o=function(){var t={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,n,r,o,i,s){var a=i.length-1;switch(o){case 1:this.$=t.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\x0B").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(t);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=i[a-1];case 13:this.$={};break;case 14:this.$=i[a-1];break;case 15:this.$=[i[a-2],i[a]];break;case 16:this.$={},this.$[i[a][0]]=i[a][1];break;case 17:this.$=i[a-2],i[a-2][i[a][0]]=i[a][1];break;case 18:this.$=[];break;case 19:this.$=i[a-1];break;case 20:this.$=[i[a]];break;case 21:this.$=i[a-2],i[a-2].push(i[a])}},table:[{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],12:1,13:2,15:7,16:8,17:[1,14],23:[1,15]},{1:[3]},{14:[1,16]},{14:[2,7],18:[2,7],22:[2,7],24:[2,7]},{14:[2,8],18:[2,8],22:[2,8],24:[2,8]},{14:[2,9],18:[2,9],22:[2,9],24:[2,9]},{14:[2,10],18:[2,10],22:[2,10],24:[2,10]},{14:[2,11],18:[2,11],22:[2,11],24:[2,11]},{14:[2,12],18:[2,12],22:[2,12],24:[2,12]},{14:[2,3],18:[2,3],22:[2,3],24:[2,3]},{14:[2,4],18:[2,4],22:[2,4],24:[2,4]},{14:[2,5],18:[2,5],22:[2,5],24:[2,5]},{14:[2,1],18:[2,1],21:[2,1],22:[2,1],24:[2,1]},{14:[2,2],18:[2,2],22:[2,2],24:[2,2]},{3:20,4:[1,12],18:[1,17],19:18,20:19},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:23,15:7,16:8,17:[1,14],23:[1,15],24:[1,21],25:22},{1:[2,6]},{14:[2,13],18:[2,13],22:[2,13],24:[2,13]},{18:[1,24],22:[1,25]},{18:[2,16],22:[2,16]},{21:[1,26]},{14:[2,18],18:[2,18],22:[2,18],24:[2,18]},{22:[1,28],24:[1,27]},{22:[2,20],24:[2,20]},{14:[2,14],18:[2,14],22:[2,14],24:[2,14]},{3:20,4:[1,12],20:29},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:30,15:7,16:8,17:[1,14],23:[1,15]},{14:[2,19],18:[2,19],22:[2,19],24:[2,19]},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:31,15:7,16:8,17:[1,14],23:[1,15]},{18:[2,17],22:[2,17]},{18:[2,15],22:[2,15]},{22:[2,21],24:[2,21]}],defaultActions:{16:[2,6]},parseError:function(t,e){throw new Error(t)},parse:function(t){function e(t){o.length=o.length-2*t,i.length=i.length-t,s.length=s.length-t}function n(){var t;return t=r.lexer.lex()||1,"number"!=typeof t&&(t=r.symbols_[t]||t),t}var r=this,o=[0],i=[null],s=[],a=this.table,u="",c=0,l=0,p=0,d=2,f=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var h=this.lexer.yylloc;s.push(h),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var m,y,g,v,_,w,k,S,D,b={};;){if(g=o[o.length-1],this.defaultActions[g]?v=this.defaultActions[g]:(null==m&&(m=n()),v=a[g]&&a[g][m]),"undefined"==typeof v||!v.length||!v[0]){if(!p){D=[];for(w in a[g])this.terminals_[w]&&w>2&&D.push("'"+this.terminals_[w]+"'");var T="";T=this.lexer.showPosition?"Parse error on line "+(c+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+D.join(", ")+", got '"+this.terminals_[m]+"'":"Parse error on line "+(c+1)+": Unexpected "+(1==m?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(T,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:h,expected:D})}if(3==p){if(m==f)throw new Error(T||"Parsing halted.");l=this.lexer.yyleng,u=this.lexer.yytext,c=this.lexer.yylineno,h=this.lexer.yylloc,m=n()}for(;;){if(d.toString()in a[g])break;if(0==g)throw new Error(T||"Parsing halted.");e(1),g=o[o.length-1]}y=m,m=d,g=o[o.length-1],v=a[g]&&a[g][d],p=3}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+m);switch(v[0]){case 1:o.push(m),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),o.push(v[1]),m=null,y?(m=y,y=null):(l=this.lexer.yyleng,u=this.lexer.yytext,c=this.lexer.yylineno,h=this.lexer.yylloc,p>0&&p--);break;case 2:if(k=this.productions_[v[1]][1],b.$=i[i.length-k],b._$={first_line:s[s.length-(k||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(k||1)].first_column,last_column:s[s.length-1].last_column},_=this.performAction.call(b,u,l,c,this.yy,v[1],i,s),"undefined"!=typeof _)return _;k&&(o=o.slice(0,-1*k*2),i=i.slice(0,-1*k),s=s.slice(0,-1*k)),o.push(this.productions_[v[1]][0]),i.push(b.$),s.push(b._$),S=a[o[o.length-2]][o[o.length-1]],o.push(S);break;case 3:return!0}}return!0}},e=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t;var e=t.match(/\n/);return e&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},less:function(t){this._input=this.match.slice(t)+this._input},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n,r,o;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),s=0;s<i.length&&(n=this._input.match(this.rules[i[s]]),!n||e&&!(n[0].length>e[0].length)||(e=n,r=s,this.options.flex));s++);return e?(o=e[0].match(/\n.*/g),o&&(this.yylineno+=o.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:o?o[o.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,i[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:void this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,n,r){switch(n){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},t.rules=[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],t.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}},t}();return t.lexer=e,t}();"undefined"!=typeof t&&"undefined"!=typeof n&&(n.parse=function(){return o.parse.apply(o,arguments)},"undefined"!=typeof e&&t.main===e&&n.main("undefined"!=typeof r?r.argv.slice(1):t("system").args))}).call(this,t("_process"))},{_process:5,system:9}]},{},[18]);