!function t(e,n,o){function r(i,a){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){var n=e[i][1][t];return r(n?n:t)},l,l.exports,t,e,n,o)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(t,e,n){t("./ng-app"),t("./utils/angular-local-storage.js"),moment.locale("ru")},{"./ng-app":41,"./utils/angular-local-storage.js":66}],2:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./dscommon/util").assert,l=t("./dscommon/util").validate,c=t("./dscommon/util").serviceOwner,o=t("./dscommon/DSObject"),r=t("./models/Person"),e.exports=(u=angular.module("config",["LocalStorageModule"])).name,u.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),u.run(["$rootScope","config",function(t,e){t.config=e}]),s=1,i=1,u.factory("config",["$http","localStorageService",function(t,e){var n,a,u,p,f,h,m,g,y,_,v,w;if(n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return d(n,t),n.begin("Config"),n.propStr("token",null,l.trimString),n.propStr("teamwork","http://teamwork.webprofy.ru/"),n.propCalc("hasRoles",function(){return"http://teamwork.webprofy.ru/"===this.teamwork}),n.propCalc("hasTimeReports",function(){return"http://teamwork.webprofy.ru/"===this.teamwork||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propConst("planTag","План"),n.propConst("teamleadRole","Teamlead"),n.propNum("hResizer"),n.propNum("vResizer"),n.propStr("currentUserId"),n.propDoc("currentUser",r),n.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propStr("selectedRole"),n.propNum("selectedCompany"),n.propNum("selectedLoad"),n.propNum("histStart",-1),n.onAnyPropChange(function(t,n,o,r){"currentUserId"!==n&&"currentUser"!==n&&(("teamwork"===n||"token"===n)&&this.set("histStart",-1),"undefined"!=typeof o?e.set(n,o):e.remove(n))}),n.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},n.end(),n}(o),a=c.add(new n(c,"config")),p=!0,f=!0,_=1,v=0,"string"==typeof(y=e.get("ver"))&&((w=y.split(".")).length=2)&&(_=parseInt(w[0]),v=parseInt(w[1])),f=(p=_===s)?v===i:!1,f||e.set("ver",s+"."+i),p){m=n.prototype.__props;for(h in m)u=m[h],(f||"teamwork"===h||"token"===h)&&(u.readonly||"undefined"==typeof(g=e.get(h))||g&&a.set(h,g))}return a}])},{"./dscommon/DSObject":24,"./dscommon/util":30,"./models/Person":31}],3:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(d=angular.module("data/PeopleWithJson",[t("../dscommon/DSDataSimple")])).name,c=t("../dscommon/util").assert,l=t("../dscommon/util").error,i=t("../dscommon/DSSet"),a=t("../dscommon/DSTags"),o=t("../dscommon/DSData"),s=t("../dscommon/DSDigest"),r=t("../dscommon/DSDataServiceBase"),u=t("../models/Person"),d.factory("PeopleWithJson",["DSDataSimple","DSDataSource","config","$rootScope","$http","$q",function(t,e,n,d,f,h){var m;return m=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.begin("PeopleWithJson"),e.addPool(),e.propDoc("teamworkPeople",i),e.propObj("cancel",null),e.propSet("people",u),e.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),e.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},e.prototype.init=function(t){var e,o,i,p;c&&(t instanceof r||l.invalidArg("dsDataService")),(p=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:u,source:!0})))).release(this),i=this.get("peopleSet"),o=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),e=function(t){return function(){var e;t._startLoad()&&(e=t.set("cancel",h.defer()),f.get("data/people.json?t="+(new Date).getTime(),e).then(function(e){200===e.status?(t.set("cancel",null),s.block(function(){var o,r,s,u,c,l,f,h,m,g,y,_,v;if(f=d.peopleRoles=e.data.roles,v=n.get("selectedRole"))for(r=0,u=f.length;u>r;r++)o=f[r],o.role===v&&(d.selectedRole=o);for(y=e.data.people,s=0,c=y.length;c>s;s++)m=y[s],p.items.hasOwnProperty(g=""+m.id)&&p.items[g].set("roles",new a(m.role));l={},_=p.items;for(g in _)h=_[g],l[g]=h,h.addRef(t);i.merge(t,l),t._endLoad(!0)})):o(e,0===e.status)},o))}}(this),this._unwatchA=p.watchStatus(this,function(t){return function(n,o){var r;if(o!==(r=t.get("status")))switch(o){case"ready":s.block(e);break;case"update":s.block(e);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},e.end(),e}(o)}])},{"../dscommon/DSData":14,"../dscommon/DSDataServiceBase":17,"../dscommon/DSDataSimple":18,"../dscommon/DSDigest":20,"../dscommon/DSSet":27,"../dscommon/DSTags":28,"../dscommon/util":30,"../models/Person":31}],4:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h=function(t,e){function n(){this.constructor=t}for(var o in e)m.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty;e.exports=(f=angular.module("data/PersonDayStatData",[])).name,d=t("../dscommon/util").assert,p=t("../dscommon/util").error,i=t("../dscommon/DSDocument"),r=t("../dscommon/DSDataServiceBase"),o=t("../dscommon/DSData"),s=t("../dscommon/DSDigest"),a=t("../dscommon/DSSet"),u=t("../models/Person"),l=t("../models/Task"),c=t("../models/PersonDayStat"),f.factory("PersonDayStatData",[function(){var t;return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.begin("PersonDayStatData"),e.addPool(),e.propDoc("tasks",a),e.propDoc("people",a),e.propSet("personDayStats",c),e.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),e.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},e.prototype.init=function(t){var e,n,o,a,f,h,m,g;d&&(t instanceof r||p.invalidArg("dsDataService")),(h=this.set("tasks",t.findDataSet(this,_.assign({},this.params,{type:l,filter:"assigned"})))).release(this),m=h.items,(n=this.set("people",t.findDataSet(this,{type:u,mode:this.params.mode}))).release(this),o=n.items,a=this.get("personDayStats"),e=function(t){return function(){var e,r,i,l,f,g,y,v,w,S,D,k,b,T,O;if(t._startLoad()){O=_.groupBy(m,function(t){return t.get("responsible").$ds_key}),f=moment.duration((y=t.params.endDate).diff(b=t.params.startDate)).asDays(),i=b,l=function(){var t,e,n;for(n=[],v=t=0,e=f;e>=0?e>=t:t>=e;v=e>=0?++t:--t)n.push(((i=moment(k=i)).add(1,"day"),k));return n}(),e=function(t){var e,n,o,r,s,a,u,c,d,p,f,h,m,g,y,_,w,S,D,k,T,P,$;if(k=function(){var t,e,n;for(n=[],t=0,e=l.length;e>t;t++)i=l[t],n.push(0);return n}(),T=function(){var t,e,n;for(n=[],t=0,e=l.length;e>t;t++)i=l[t],n.push(moment.duration(0));return n}(),n=t.get("dayStats"),O.hasOwnProperty(m=(h=t.get("person")).$ds_key))for(g=O[m],s=0,c=g.length;c>s;s++)if(D=g[s],null!==(o=D.duedate))if(null!==(w=D.get("split")))for(y=S=w.list,v=a=0,d=y.length;d>a;v=a+=2)i=y[v],f=Math.floor(moment(o).add(i).diff(b)/864e5),f>=0&&f<n.length&&(T[f].add(S[v+1]),k[f]++);else f=Math.floor((o.valueOf()-b.valueOf())/864e5),f>=0&&f<n.length&&(null!==(r=D.get("estimate"))&&T[f].add(r),k[f]++);for(e=h.get("contractTime"),P=moment.duration(0),v=u=0,p=n.length;p>u;v=++u)_=n[v],_.set("tasksCount",k[v]),_.set("contract",e),_.set("tasksTotal",$=T[v]),_.set("timeLeft",moment.duration(e).subtract($)),P.add($);t.set("totalPeriodTime",P)},T={};for(S in o)w=o[S],e(T[S]=new c(t,w.$ds_key,w,l));t.get("personDayStatsSet").merge(t,T),g=function(t){a.hasOwnProperty(t)&&e(a[t])},D=function(e){d&&(e instanceof u||p.invalidArg("person")),s.render(t.$ds_key,e.$ds_key,g)},t._unwatch1=h.watch(t,{change:r=function(t,e,n,o){"estimate"===e||"split"===e||"duedate"===e?null!==(w=t.get("responsible"))&&null!==t.get("duedate")&&D(w):"responsible"===e&&(null!==o&&O.hasOwnProperty(S=o.$ds_key)&&_.remove(O[S],t).length>0&&D(o),null!==n&&(h=O.hasOwnProperty(S=n.$ds_key)?O[S]:O[S]=[],_.find(h,t)||(h.push(t),D(n))))},add:function(t){r(t,"responsible",t.get("responsible"),null)},remove:function(t){null!==(w=t.get("responsible"))&&O.hasOwnProperty(S=w.$ds_key)&&(_.remove(O[S],t),D(w))}}),t._unwatch2=n.watch(t,{add:function(e){var n,o;o=new c(t,n=e.$ds_key,e,l),o.get("dayStatsList").merge(t,function(){var t,e,n;for(n=[],v=t=0,e=l.length;e>t;v=++t)i=l[v],n.push(((k=new c.DayStat(this,"personKey_"+v)).set("day",i),k));return n}.call(t)),t.get("personDayStatsSet").add(t,o),D(e)},remove:function(e){t.get("personDayStatsSet").remove(t.get("personDayStats")[e.$ds_key])},change:function(t,e,n,o){"contractTime"===e&&D(t)}}),t._endLoad(!0)}}}(this),f=[h,n],g=function(t){return function(n,o){var r,a;if((r=i.integratedStatus(f))!==(a=t.get("status")))switch(r){case"ready":s.block(e);break;case"update":t._startLoad()&&t._endLoad(!0);break;case"nodata":t.set("status","nodata")}}}(this),this._unwatchA=n.watchStatus(this,g),this._unwatchB=h.watchStatus(this,g),this.init=null},e.end(),e}(o)}])},{"../dscommon/DSData":14,"../dscommon/DSDataServiceBase":17,"../dscommon/DSDigest":20,"../dscommon/DSDocument":21,"../dscommon/DSSet":27,"../dscommon/util":30,"../models/Person":31,"../models/PersonDayStat":32,"../models/Task":36}],5:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f=function(t,e){function n(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(p=angular.module("data/TasksWithTimeTracking",[t("../dscommon/DSDataSimple")])).name,l=t("../dscommon/util").assert,d=t("../dscommon/util").error,i=t("../dscommon/DSSet"),a=t("../dscommon/DSTags"),o=t("../dscommon/DSData"),s=t("../dscommon/DSDigest"),r=t("../dscommon/DSDataServiceBase"),u=t("../models/Task"),c=t("../models/TaskTimeTracking"),p.factory("TasksWithTimeTracking",["DSDataSimple","DSDataSource","$rootScope","$http","$q",function(t,e,n,s,a){var p;return p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.begin("TasksWithTimeTracking"),e.addPool(),e.propDoc("srcTasks",i),e.propDoc("srcTasksTimeTracking",i),e.propObj("cancel",null),e.propSet("tasks",u),e.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),e.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},e.prototype.init=function(t){var e,n,o;l&&(t instanceof r||d.invalidArg("dsDataService")),(e=this.set("srcTasks",t.findDataSet(this,{mode:"original",type:u,filter:"all",source:!0}))).release(this),(n=this.set("srcTasksTimeTracking",t.findDataSet(this,{mode:"original",type:c}))).release(this),o=this.get("tasksSet"),this.__unwatchA=e.watch(this,{add:function(t){null===t.get("timeTracking")&&t.set("timeTracking",c.pool.find(this,t.$ds_key)),o.add(this,t)},remove:function(t){o.remove(t)}}),this.__unwatchB=e.watchStatus(this,function(t){return function(e,n){t.set("status",n)}}(this)),this.init=null},e.end(),e}(o)}])},{"../dscommon/DSData":14,"../dscommon/DSDataServiceBase":17,"../dscommon/DSDataSimple":18,"../dscommon/DSDigest":20,"../dscommon/DSSet":27,"../dscommon/DSTags":28,"../dscommon/util":30,"../models/Task":36,"../models/TaskTimeTracking":37}],6:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m=function(t,e){function n(){this.constructor=t}for(var o in e)g.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty;e.exports=(f=angular.module("data/dsDataChanges",["LocalStorageModule",t("../dscommon/DSDataSource")])).name,d=t("../dscommon/util").assert,h=t("../dscommon/util").serviceOwner,p=t("../dscommon/util").error,a=t("../dscommon/DSDigest"),s=t("../dscommon/DSChangesBase"),i=t("../dscommon/DSDataEditable"),u=t("../models/Person"),l=t("../models/Task"),r=t("../models/types/Comments"),c=t("../utils/RMSData"),f.run(["dsChanges","$rootScope",function(t,e){e.changes=t}]),o=1,f.factory("dsChanges",["DSDataSource","config","localStorageService","$http","$timeout","$q",function(t,e,n,d,p,f){var g;return g=function(d){function h(){return g.apply(this,arguments)}var g;return m(h,d),h.begin("DSChanges"),h.propSet("tasks",l.Editable),h.propObj("dataService"),h.propDoc("source",t),h.propObj("cancel",null),h.ds_dstr.push(function(){var t;this.__unwatch2(),"function"==typeof this.__unwatchStatus1&&this.__unwatchStatus1(),"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),(t=this.get("cancel"))&&t.resolve()}),g=function(t,e){s.call(this,t,e)},h.prototype.init=function(e){this.__unwatch2=t.setLoadAndRefresh.call(this,this.set("dataService",e))},h.prototype.clear=function(){"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),delete this.__unwatchStatus2,this.reset()},h.prototype.load=function(){var t,r,s;if("ready"!==this.get("status")){if(!this._startLoad())return;t=i(l.Editable).$u,(r=n.get("changes"))?r.ver===o&&r.source.url===e.get("teamwork")&&r.source.token===e.get("token")?(s=this.get("dataService").findDataSet(this,{type:u,mode:"original"}),this.__unwatchStatus2=s.watchStatus(this,function(e){return function(n,o,i,u){"ready"===o&&(u(),a.block(function(){var n,o,i,a,u,c,d,p,f,h,m,g,y,_,v,w;l.pool.enableWatch(!1),h=e.mapToChanges(r.changes),d=h.load.Person;for(c in d)if(a=d[c],s.items.hasOwnProperty(c))for(u=s.items[c],o=0,i=a.length;i>o;o++)(n=a[o])(u);else console.error("Person #{personKey} missing in server data");w=(v=e.get("tasksSet")).$ds_pool,f={},p=h.changes.tasks;for(_ in p)g=p[_],l.pool.items.hasOwnProperty(_)?(m=l.pool.items[_]).addRef(e):(m=l.pool.find(e,_)).readMap(r.tasks[_]),(y=w.find(e,_,f)).init(m,v,g),y.$u=t,m.release(e);v.merge(e,f),l.pool.enableWatch(!0),e._endLoad(!0)}))}}(this)),s.release(this)):(n.remove("changes"),this._endLoad(!0)):this._endLoad(!0)}},h.prototype.persist=function(){this.hasOwnProperty("__persist")||(this.__persist=p(function(t){return function(){delete t.__persist,t.saveToLocalStorage()}}(this)))},h.prototype.saveToLocalStorage=function(){var t,r,s;if(this.anyChange()){t=this.changesToMap(),s={};for(r in t.tasks)s[r]=l.pool.items[r].writeMap();n.set("changes",{ver:o,changes:t,source:{url:e.get("teamwork"),token:e.get("token")},tasks:s})}else n.remove("changes")},h.prototype.save=function(t){return function(n){var o,s,i,u,l,d,p,h,m,g,y,v,w,S,D,k,b,T,O,P,$,A,j,C,M,L;if(t&&!n)return t.promise;if(n||(t=f.defer(),n=function(){var t,e;t=this.get("tasks"),e=[];for(j in t)A=t[j],e.push(A.addRef(this));return e}.call(this)),m=null,M={"todo-item":C={}},!(A=n.shift())){if((n=function(){var t,e;t=this.get("tasks"),e=[];for(j in t)A=t[j],A.__change.__error||e.push(A.addRef(this));return e}.call(this)).length>0)return void this.save(n);s=!0;for(h in this.get("tasks")){s=!1;break}return t.resolve(s),w=t.promise,t=null,w}i=_.clone(A.__change),C.content=A.get("title"),l=!1;for(D in i)if(S=i[D],"__error"!==D&&"__refreshView"!==D)switch(D){case"title":break;case"comments":break;case"split":C.description=c.put(A.get("description"),(T=S.v)?{split:S.v.valueOf()}:null),C["start-date"]=null===T||null===(p=A.get("duedate"))?"":T.firstDate(p).format("YYYYMMDD");break;case"duedate":C["due-date"]=d=S.v?S.v.format("YYYYMMDD"):"",null!==(O=A.get("startDate"))&&O>A.get("duedate")&&(C["start-date"]=d);break;case"estimate":C["estimated-minutes"]=S.v?Math.floor(S.v.asMinutes()):"0";break;case"responsible":C["responsible-party-id"]=(m=S.v)?[S.v.get("id")]:[];break;case"plan":u=null===(u=A.get("comments"))?new r:u.clone(),u.unshift(S.v?"Поставлено в план на "+A.get("duedate").format("DD.MM.YYYY"):"Снято с плана.  Причина:"),A.set("comments",u),C.tags=L=($=null!=(k=A.get("tags"))?k.map:void 0)?(S.v?(g=function(){var t;t=[];for(P in $)t.push(P);return t}(),g.unshift(e.planTag)):g=function(){var t;t=[];for(P in $)P!==e.planTag&&t.push(P);return t}(),g.join()):S.v?e.planTag:"";break;default:console.error("change.save(): Property "+D+" not expected to be changed")}return o=function(e){return function(n,o){o||(console.error("error: ",n),e.set("cancel",null)),A.release(e),t.reject(),t=null}}(this),b=function(t){return function(){return t.get("source").httpPut("tasks/"+A.get("id")+".json",M,t.set("cancel",f.defer())).then(function(e){var r,s,c;if(t.set("cancel",null),200===e.status)if(delete i.__error,a.block(function(){for(D in i)S=i[D],"__refreshView"!==D&&A.$ds_doc.set(D,S.v)}),null!==(u=A.get("comments"))){for(c="";s=u.shift();)c+="<p>"+s+"</p>";M={comment:{"content-type":"html",body:c,isprivate:!1}},t.get("source").httpPost("tasks/"+A.get("id")+"/comments.json",M,t.set("cancel",f.defer())).then(function(e){t.set("cancel",null),201===e.status?(A.release(t),t.save(n)):o(e,0===e.status)},o)}else A.release(t),t.save(n);else A.__change.__error=e.data.MESSAGE,"function"==typeof(r=A.__change).__refreshView&&r.__refreshView(),A.release(t),t.save(n)},o)}}(this),null===m?b():null===(v=(y=A.get("project")).get("people"))?this.get("source").httpGet("projects/"+y.get("id")+"/people.json",this.set("cancel",f.defer())).then(function(t){return function(e){var n,r,s,i;if(t.set("cancel",null),200===e.status){for(y.set("people",v={}),i=e.data.people,n=0,r=i.length;r>n;n++)s=i[n],v[s.id]=!0;t.addPersonToProject(y,m,b,o)}else o(e,0===e.status)}}(this),o):v.hasOwnProperty(m.get("id"))?b():this.addPersonToProject(y,m,b),t.promise}}(null),h.prototype.addPersonToProject=function(t,e,n,o){this.get("source").httpPost("projects/"+t.get("id")+"/people/"+e.get("id")+".json",null,this.set("cancel",f.defer())).then(function(r){return function(s){r.set("cancel",null),200===s.status||409===s.status?(t.get("people")[e.get("id")]=!0,n()):o(s,0===s.status)}}(this),o)},h.end(),h}(s),h.add(new g(h,"dataChanges"))}])},{"../dscommon/DSChangesBase":13,"../dscommon/DSDataEditable":15,"../dscommon/DSDataSource":19,"../dscommon/DSDigest":20,"../dscommon/util":30,"../models/Person":31,"../models/Task":36,"../models/types/Comments":39,"../utils/RMSData":65}],7:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g,y=function(t,e){function n(){this.constructor=t}for(var o in e)v.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},v={}.hasOwnProperty;e.exports=(m=angular.module("data/dsDataService",[t("./PeopleWithJson"),t("./TasksWithTimeTracking"),t("./teamwork/TWPeople"),t("./teamwork/TWTasks"),t("./teamwork/TWTags"),t("./teamwork/TWTimeTracking"),t("./PersonDayStatData"),t("./dsChanges"),t("../dscommon/DSDataSource"),t("../config")])).name,p=t("../dscommon/util").assert,g=t("../dscommon/util").serviceOwner,h=t("../dscommon/util").error,f=t("../utils/base64"),a=t("../dscommon/DSObject"),i=t("../dscommon/DSDataServiceBase"),o=t("../dscommon/DSChangesBase"),r=t("../dscommon/DSDataEditable"),s=t("../dscommon/DSDataFiltered"),u=t("../models/Person"),l=t("../models/Task"),d=t("../models/TaskTimeTracking"),c=t("../models/PersonTimeTracking"),m.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),m.factory("dsDataService",["TWPeople","TWTasks","TWTags","TWTimeTracking","PeopleWithJson","TasksWithTimeTracking","PersonDayStatData","DSDataSource","dsChanges","config","$http","$rootScope","$q",function(t,e,n,a,d,h,m,v,w,S,D,k,b){var T;return T=function(g){function T(){return O.apply(this,arguments)}var O;return y(T,g),T.begin("DSDataService"),T.propDoc("dataSource",v),T.propPool("editedPeople",r(u.Editable)),T.propPool("editedTasks",r(l.Editable)),T.propPool("tasksPool",s(l)),T.propPool("personTimeTrackingPool",s(c)),T.propBool("showTimeSpent",!1),T.propDoc("changes",o),T.propSet("emptyPersonTimeTracking",c),T.ds_dstr.push(function(){this.__unwatch2()}),O=function(){var t;i.apply(this,arguments),this.set("dataSource",new v(this,"dataSource")).release(this),t=null,this.__unwatch2=k.$watch(function(){return[S.get("teamwork"),S.get("token")]},function(e){return function(n){var o,r,s;return r=n[0],s=n[1],r&&s?(t&&(t.resolve(),t=null),o=function(n,o){o||(console.error("error: ",n),t=null),e.get("dataSource").setConnection(null,null)},D.get(r+"authenticate.json",{timeout:(t=b.defer()).promise,headers:{Authorization:"Basic "+f.encode(s)}}).then(function(n){200===n.status?(t=null,S.set("currentUserId",n.data.account.userId),e.get("dataSource").setConnection(r,s)):o(n,0===n.status)},o),void 0):e.get("dataSource").setConnection(null,null)}}(this),!0),this.set("changes",w).init(this)},T.prototype.refresh=function(){this.get("dataSource").refresh()},T.prototype.findDataSet=function(o,r){var s,p,f,g,y,v,w,D,k,b;switch(i.prototype.findDataSet.call(this,o,r),r.type.docType){case"Tag":return"function"==typeof(s=w=n.pool.find(this,r)).init&&s.init(this),(k=w.get("tagsSet")).addRef(o),w.release(this),k;case"PersonDayStat":return"function"==typeof(p=w=m.pool.find(this,r)).init&&p.init(this),(k=w.get("personDayStatsSet")).addRef(o),w.release(this),k;case"TaskTimeTracking":return(w=a.pool.find(this,{})).init&&w.init(this),(k=w.get("taskTimeTrackingSet")).addRef(o),w.release(this),k;case"PersonTimeTracking":return r.hasOwnProperty("showTimeSpent")&&!r.showTimeSpent?(k=this.get("emptyPersonTimeTrackingSet")).addRef(o):r.hasOwnProperty("startDate")?((w=this.get("personTimeTrackingPool").find(this,r)).init&&(w.init(D=this.findDataSet(this,{type:c,mode:r.mode}),a.filterPersonTimeTracking(r)),D.release(this)),(k=w.get("itemsSet")).addRef(o),w.release(this)):((w=a.pool.find(this,{})).init&&w.init(this),(k=w.get("personTimeTrackingSet")).addRef(o),w.release(this)),k}switch(r.mode){case"edited":switch(b=r.type.docType){case"Person":return this.findDataSet(o,_.assign({},r,{mode:"original"}));case"Task":return(w=this.get("editedTasks").find(this,r)).init&&(w.init(D=this.findDataSet(this,_.assign({},r,{mode:"original"})),v=this.findDataSet(this,_.assign({},r,{mode:"changes"})),e.filter(r)),D.release(this),v.release(this)),(k=w.get("itemsSet")).addRef(o),w.release(this),k;default:throw new Error("Not supported model type (1): "+b)}break;case"changes":switch(b=r.type.docType){case"Task":return(k=this.get("changes").get("tasksSet")).addRef(o);default:throw new Error("Not supported model type (2): "+b)}break;case"original":switch((b=r.type)!==u?b.docType:!S.get("hasRoles")||r.source?u.docType:"PeopleWithJson"){case"PeopleWithJson":return"function"==typeof(f=w=d.pool.find(this,r)).init&&f.init(this),(k=w.get("peopleSet")).addRef(o),w.release(this),k;case"Person":return delete r.source,"function"==typeof(g=w=t.pool.find(this,r)).init&&g.init(this),(k=w.get("peopleSet")).addRef(o),w.release(this),k;case"Task":return"all"!==r.filter||r.hasOwnProperty("startDate")?((w=this.get("tasksPool").find(this,r)).init&&(w.init(D=this.findDataSet(this,{type:l,filter:"all",mode:"original"}),e.filter(r)),D.release(this)),(k=w.get("itemsSet")).addRef(o),w.release(this)):(!S.get("hasTimeReports")||r.source?(delete r.source,"function"==typeof(y=w=e.pool.find(this,r)).init&&y.init(this)):(w=h.pool.find(this,{})).init&&w.init(this),(k=w.get("tasksSet")).addRef(o),w.release(this)),k;default:throw new Error("Not supported model type (3): "+b)}}},T.prototype.requestSources=function(t,e,n){var o,r,s,a,u,c,l,d,f;i.prototype.requestSources.call(this,t,e,n);for(r in n){switch(f=n[r],l=_.assign({},f.params,e),u={type:d=f.type,mode:s=l.mode},o=d.docType){case"Tag":break;case"Person":break;case"PersonDayStat":u.startDate=l.startDate,u.endDate=l.endDate;break;case"PersonTimeTracking":u.showTimeSpent=l.showTimeSpent,u.startDate=l.startDate,u.endDate=l.endDate;break;case"Task":if("changes"!==s){if(p&&!("string"==typeof l.filter&&0<=["all","assigned","notassigned","overdue","noduedate"].indexOf(l.filter)))throw new Error("Unexpected filter: "+l.filter);u.filter=l.filter,("all"===l.filter||"assigned"===l.filter||"notassigned"===l.filter)&&(u.startDate=l.startDate,u.endDate=l.endDate)}break;default:throw new Error("Not supported model type (4): "+o)}a=this.findDataSet(t,u),"undefined"==typeof(c=f.set)||c!==a?f.newSet=a:a.release(t)}},T.end(),T}(i),g.add(new T(g,"dataService"))}])},{"../config":2,"../dscommon/DSChangesBase":13,"../dscommon/DSDataEditable":15,"../dscommon/DSDataFiltered":16,"../dscommon/DSDataServiceBase":17,"../dscommon/DSDataSource":19,"../dscommon/DSObject":24,"../dscommon/util":30,"../models/Person":31,"../models/PersonTimeTracking":33,"../models/Task":36,"../models/TaskTimeTracking":37,"../utils/base64":67,"./PeopleWithJson":3,"./PersonDayStatData":4,"./TasksWithTimeTracking":5,"./dsChanges":6,"./teamwork/TWPeople":8,"./teamwork/TWTags":9,"./teamwork/TWTasks":10,"./teamwork/TWTimeTracking":11}],8:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWPeople",[t("../../dscommon/DSDataSource"),t("../../dscommon/DSDataSimple")])).name,r=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../models/Person"),i.factory("TWPeople",["DSDataSimple","DSDataSource","$rootScope","$q",function(t,e,n,r){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWPeople"),n.addPool(),n.propSet("people",o),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.importResponse=function(t){var e,n,r,s,i,a;for(s={},a=t.people,e=0,r=a.length;r>e;e++)n=a[e],i=o.pool.find(this,""+n.id,s),i.set("id",+n.id),i.set("name",(n["last-name"]+" "+n["first-name"].charAt(0).toUpperCase()+".").trim()),i.set("firstName",n["first-name"].trim()),i.set("avatar",n["avatar-url"]),i.set("email",n["email-address"]),i.set("companyId",+n["company-id"]),i.set("currentUser",!1);return this.get("peopleSet").merge(this,s),!0},n.end(),n}(t)}])},{"../../dscommon/DSDataSimple":18,"../../dscommon/DSDataSource":19,"../../dscommon/util":30,"../../models/Person":31}],9:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWTags",[t("../../dscommon/DSDataSource"),t("../../dscommon/DSDataSimple")])).name,r=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../models/Tag"),i.factory("TWTags",["DSDataSimple","DSDataSource","$rootScope","$q",function(t,e,n,r){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWTags"),n.addPool(),n.propSet("tags",o),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","tags.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.importResponse=function(t){var e,n,r,s,i,a;for(a={},i=t.tags,e=0,r=i.length;r>e;e++)n=i[e],s=o.pool.find(this,n.name,a),s.set("id",parseInt(n.id)),s.set("name",n.name),s.set("color",n.color);return this.get("tagsSet").merge(this,a),!0},n.end(),n}(t)}])},{"../../dscommon/DSDataSimple":18,"../../dscommon/DSDataSource":19,"../../dscommon/util":30,"../../models/Tag":35}],10:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g,y,_,v=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(y=angular.module("data/teamwork/TWTasks",[t("../../dscommon/DSDataSource"),t("../../dscommon/DSDataSimple")])).name,m=t("../../dscommon/util").assert,g=t("../../dscommon/util").error,_=t("../../ui/time"),d=t("../../models/Task"),l=t("../../models/Tag"),i=t("../../models/Person"),h=t("../../models/TodoList"),u=t("../../models/Project"),f=t("../../models/TaskTimeTracking"),a=t("../../models/PersonTimeTracking"),o=t("../../dscommon/DSData"),r=t("../../dscommon/DSDigest"),s=t("../../dscommon/DSTags"),p=t("../../models/types/TaskSplit"),c=t("../../utils/RMSData"),y.factory("TWTasks",["DSDataSimple","DSDataSource","config","$q",function(t,e,n,g){var y;return y=function(t){function y(){return w.apply(this,arguments)}var w,S,D,k,b;return v(y,t),y.begin("TWTasks"),y.addPool(),y.propDoc("source",e),y.propStr("request"),y.propSet("tasks",d),y.propPool("completedTasksPool",d),y.propObj("cancel",null),y.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),this.__unwatch1(),this.__unwatch2()}),y.propObj("visiblePersonTTracking",{}),w=function(){var t,e,n,r;o.apply(this,arguments),this.peopleMap={},this.projectMap={},this.todoListMap={},m&&a.prototype.hasOwnProperty("setVisible")&&console.error("TWTasks:ctor: setVisible expects that their will be only one instance of TWTasks object"),e=this,r=this.get("visiblePersonTTracking"),t=this.get("completedTasksPool"),n=this.get("tasksSet"),a.prototype.setVisible=function(o){var s,i;o?1===(this.__visCount=(this.__visCount||0)+1)&&(r[this.$ds_key]=this,null===(s=this.get("task"))&&((s=n.items[i=this.get("taskId")])?this.set("task",s):(this.set("task",s=t.find(this,""+i)),null===s.get("timeTracking")&&(s.set("id",i),s.set("timeTracking",f.pool.find(this,s.$ds_key)),k.call(e)),s.release(this))),s.setVisible(!0)):0===--this.__visCount&&(delete r[this.$ds_key],this.get("task").setVisible(!1))}},D=function(t,e){var n,o,r;return null===(n=e.get("duedate"))?!1:null===(r=e.get("split"))?t.startDate<=(o=e.get("duedate"))&&o<=t.endDate:t.startDate<=r.lastDate(n=e.get("duedate"))&&r.firstDate(n)<=t.endDate},y.filter=function(t){switch(t.filter){case"all":return moment.isMoment(t.startDate)?function(e){return D(t,e)}:function(t){return!0};case"assigned":return function(e){return null!==e.get("responsible")&&D(t,e)};case"notassigned":return function(e){return null===e.get("responsible")&&D(t,e)};case"overdue":return function(t){var e;return null!==(e=t.get("duedate"))&&e<_.today};case"noduedate":return function(t){return null===t.get("duedate")};default:throw new Error("Not supported filter: "+t.filter)}},y.prototype.init=function(t){var n,o,r;this.set("request",function(){switch((o=this.get("params")).filter){case"all":return moment.isMoment(o.startDate)?"tasks.json?startdate="+o.startDate.format("YYYYMMDD")+"&enddate="+o.endDate.format("YYYYMMDD")+"&getSubTasks=no":"tasks.json?getSubTasks=no";case"assigned":return"tasks.json?startdate="+o.startDate.format("YYYYMMDD")+"&enddate="+o.endDate.format("YYYYMMDD")+"&responsible-party-ids=-1&getSubTasks=no";case"notassigned":return"tasks.json?startdate="+o.startDate.format("YYYYMMDD")+"&enddate="+o.endDate.format("YYYYMMDD")+"&responsible-party-ids=0&getSubTasks=no";case"overdue":return"tasks.json?filter=overdue&getSubTasks=no";case"noduedate":return"tasks.json?filter=nodate&include=noduedate&getSubTasks=no";default:throw new Error("Unexpected filter: "+o.filter)}}.call(this)),n=y.filter(this.params),r=this.get("tasksSet"),this.__unwatch1=d.pool.watch(this,function(t){return function(e){n(e)?(e.addRef(t),r.items.hasOwnProperty(e.$ds_key)||r.add(t,e)):r.items.hasOwnProperty(e.$ds_key)&&r.remove(e)}}(this)),this.__unwatch2=e.setLoadAndRefresh.call(this,t),
this.init=null},b=function(){var t,e,n,o,r;e=this.peopleMap;for(t in e)r=e[t],r.release(this),delete this.peopleMap[t];n=this.todoListMap;for(t in n)r=n[t],r.release(this),delete this.todoListMap[t];o=this.projectMap;for(t in o)r=o[t],r.release(this),delete this.projectMap[t]},S=function(t,e){var o,r,a,d,f,m,g,y,_,v,w,S,D,k,b,T,O,P,$,A;if(_=i.pool.find(this,""+e["creator-id"],this.peopleMap),w=u.pool.find(this,""+e["project-id"],this.projectMap),$=h.pool.find(this,""+e["todo-list-id"],this.todoListMap),$.set("project",w),t.set("creator",_),t.set("project",w),t.set("todoList",$),t.set("title",e.content),t.set("estimate",(f=e["estimated-minutes"])?moment.duration(f,"minutes"):null),t.set("duedate",(d=e["due-date"])?moment(d,"YYYYMMDD"):null),t.set("startDate",(r=e["start-date"])?moment(r,"YYYYMMDD"):null),t.set("completed",e.completed),t.set("isReady",!0),(P=e.timeIsLogged)&&t.set("firstTimeEntryId",P),a=e.description,o=c.get(a),null!==o&&(a=c.clear(a),o.hasOwnProperty("split")&&null!==d&&t.set("split",k=new p(o.split))),t.set("description",a),e["responsible-party-ids"]&&t.set("responsible",(D=e["responsible-party-ids"].split(",")).length>0?i.pool.find(this,""+D[0],this.peopleMap):null),_.set("id",parseInt(e["creator-id"])),e.hasOwnProperty("tags")){for(O=null,v=!1,S=e.tags,m=0,y=S.length;y>m;m++)b=S[m],b.name===n.planTag?v=!0:(T=(null!=O?O:O={})[b.name]=l.pool.find(this,b.name),T.set("id",b.id),T.set("name",b.name),T.set("color",b.color));if(t.set("plan",v),null===O)t.set("tags",null);else{t.set("tags",new s(O));for(g in O)A=O[g],A.release(this)}}else t.set("tags",null),t.set("plan",!1);$.set("id",parseInt(e["todo-list-id"])),$.set("name",e["todo-list-name"]),w.set("id",parseInt(e["project-id"])),w.set("name",e["project-name"])},y.prototype.load=function(){var t,e,n,o,s;if(m&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(s={},e=function(t){return function(e){var n,o,r,i,a,u;d.pool.enableWatch(!1);try{for(i=u=e["todo-items"],n=0,r=i.length;r>n;n++)o=i[n],a=d.pool.find(t,""+o.id,s),a.set("id",parseInt(o.id)),S.call(t,a,o)}finally{d.pool.enableWatch(!0)}return 250===u.length}}(this),n=function(t){return function(e,n){var o,r;n||(console.error("error: ",e),t.set("cancel",null));for(o in s)r=s[o],r.release(t);b.call(t),t._endLoad(!1)}}(this),(t=this.get("cancel"))&&t.resolve(),(o=function(t){this.get("source").httpGet(this.get("request")+"&page="+t+"&pageSize=250",this.set("cancel",g.defer())).then(function(i){return function(a){200===a.status?(i.set("cancel",null),r.block(function(){return e(a.data,a.status)})?o.call(i,t+1):(r.block(function(){i.get("tasksSet").merge(i,s),b.call(i)}),i._endLoad(!0),k.call(i))):n(a,0===a.status)}}(this),n)}).call(this,1))},k=function(){var t,e,n,o,s,i;if(null===this.get("cancel")){s=null,n=this.get("visiblePersonTTracking");for(t in n)if(i=n[t],!(o=i.get("task")).get("isReady")){s=o;break}null!==s&&(e=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),s.release(t),b.call(t),t._endLoad(!1)}}(this),this.get("source").httpGet("/tasks/"+s.id+".json",this.set("cancel",g.defer())).then(function(t){return function(n){200===n.status?(t.set("cancel",null),r.block(function(){S.call(t,s,n.data["todo-item"]),b.call(t),k.call(t)})):e(n,0===n.status)}}(this),e))}},y.end(),y}(o)}])},{"../../dscommon/DSData":14,"../../dscommon/DSDataSimple":18,"../../dscommon/DSDataSource":19,"../../dscommon/DSDigest":20,"../../dscommon/DSTags":28,"../../dscommon/util":30,"../../models/Person":31,"../../models/PersonTimeTracking":33,"../../models/Project":34,"../../models/Tag":35,"../../models/Task":36,"../../models/TaskTimeTracking":37,"../../models/TodoList":38,"../../models/types/TaskSplit":40,"../../ui/time":51,"../../utils/RMSData":65}],11:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m,g=function(t,e){function n(){this.constructor=t}for(var o in e)y.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWTimeTracking",[t("../../config"),t("../../dscommon/DSDataSource"),t("../../dscommon/DSDataSimple"),t("../../db")])).name,p=t("../../dscommon/util").assert,f=t("../../dscommon/util").error,m=t("../../ui/time"),u=t("../../models/Task"),l=t("../../models/TaskTimeTracking"),i=t("../../models/PersonTimeTracking"),o=t("../../dscommon/DSData"),r=t("../../dscommon/DSDigest"),c=t("../../models/types/TaskSplit"),a=t("../../utils/RMSData"),d=500,s=50,h.factory("TWTimeTracking",["DSDataSimple","DSDataSource","$q","db","config",function(t,e,n,a,u){var c;return c=function(t){function a(){return c.apply(this,arguments)}var c;return g(a,t),a.begin("TWTimeTracking"),a.addPool(),a.propDoc("source",e),a.propSet("taskTimeTracking",l),a.propSet("personTimeTracking",i),a.propObj("cancel",null),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),a.propObj("visibleTTracking",{}),c=function(){var t;o.apply(this,arguments),p&&l.prototype.hasOwnProperty("setVisible")&&console.error("TWTimeTracking:ctor: setVisible expects that their will be only one instance of TWTimeTracking object"),t=this.get("visibleTTracking"),l.prototype.setVisible=function(e){e?1!==(this.__visCount=(this.__visCount||0)+1)||this.get("isReady")||(t[this.$ds_key]=this):0===--this.__visCount&&delete t[this.$ds_key]}},a.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchB&&this.__unwatchB()},a.filterPersonTimeTracking=function(t){return function(e){var n;return t.startDate<=(n=moment(e.get("date").startOf("day")))&&n<=t.endDate}},a.prototype.init=function(t){this.__unwatchA=e.setLoadAndRefresh.call(this,t),this.init=null},a.prototype.load=function(){var t,e,o,a,c,f,h,g,y,_,v,w,S,D,k,b;if(p&&!this.get("source"))throw new Error("load(): Source is not specified");if(this._startLoad()){"function"==typeof this.__unwatchB&&this.__unwatchB(),i.pool.enableWatch(!1),l.pool.enableWatch(!1),v=l.pool.items;for(S in v)k=v[S],k.set("isReady",!1),k.set("totalMin",0),k.set("priorTodayMin",0),k.set("timeEntries",{});w=i.pool.items;for(y in w)k=w[y],k.set("timeMin",0);_={},D={},c=function(t){return function(e){var n,o,r,s,a,u,c,p,f,h,g,y;try{for(o=0,s=e.length;s>o;o++)r=e[o],moment(r.date)>=m.historyLimit&&(f=parseInt(h=r["todo-item-id"]))&&(y=r.id,u=parseInt(c=r["person-id"]),a=60*parseInt(r.hours)+parseInt(r.minutes),n=moment(r.date).startOf("day"),p=i.pool.find(t,c+"-"+f+"-"+n.valueOf(),_),p.set("personId",u),p.set("date",n),p.set("taskId",f),p.set("timeMin",p.get("timeMin")+a),D.hasOwnProperty(h)?g=D[h]:(g=l.pool.find(t,h,D),g.set("taskId",f)),g.set("totalMin",g.get("totalMin")+a),g.get("timeEntries")[y]=!0,n<m.today&&g.set("priorTodayMin",g.get("priorTodayMin")+a))}catch(v){}return e.length===d}}(this),e=function(t){return function(){r.block(function(){var e,n;e=l.pool.items;for(S in e)n=e[S],n.set("isReady",!0);t.__unwatchB||(t.__unwatchB=l.pool.watch(t,function(t){t.set("isReady",!0)})),i.pool.enableWatch(!0),t.get("personTimeTrackingSet").merge(t,_),l.pool.enableWatch(!0),t.get("taskTimeTrackingSet").merge(t,D)}),t._endLoad(!0)}}(this),f=function(t){return function(e,n){var o,r;n||(console.error("error: ",e),t.set("cancel",null));for(o in D)r=D[o],r.release(t);t._endLoad(!1)}}(this),g={},h=function(t){return function(o){g.hasOwnProperty(o)?r.block(function(){return c(g[o])})?h(o+1):e():t.get("source").httpGet("time_entries.json?page="+o+"&pageSize="+d,t.set("cancel",n.defer())).then(function(n){var s;200===n.status?(t.set("cancel",null),(s=n.data["time-entries"])?moment(s[s.length-1].date)<m.historyLimit?(u.set("histStart",o+1),s.length===d?h(o+1):e()):r.block(function(){return c(s)})?h(o+1):e():e()):f(n,0===n.status)},f)}}(this),b=1,t=s,(a=u.get("histStart"))>=0?h(a):(o=function(i){return function(a){i.get("source").httpGet("time_entries.json?page="+a+"&pageSize="+d,i.set("cancel",n.defer())).then(function(n){var l,d;200===n.status?(i.set("cancel",null),(l=n.data["time-entries"])?moment(l[0].date)>=m.historyLimit?b===a?(u.set("histStart",a),r.block(function(){return c(l)})?h(a+1):e()):(g[a]=l,o(b+Math.floor(((t=a)-b)/2))):moment(l[l.length-1].date)<m.historyLimit?t===a?(d=[t,t+s],b=d[0],t=d[1],o(t)):t===a+1?e():(b=a+1,o(b+Math.floor((t-b)/2))):(u.set("histStart",a),r.block(function(){return c(l)})?h(a+1):e()):o(b+Math.floor(((t=a)-b)/2))):f(n,0===n.status)},f)}}(this))(t)}},a.end(),a}(o)}])},{"../../config":2,"../../db":12,"../../dscommon/DSData":14,"../../dscommon/DSDataSimple":18,"../../dscommon/DSDataSource":19,"../../dscommon/DSDigest":20,"../../dscommon/util":30,"../../models/PersonTimeTracking":33,"../../models/Task":36,"../../models/TaskTimeTracking":37,"../../models/types/TaskSplit":40,"../../ui/time":51,"../../utils/RMSData":65}],12:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=t("./dscommon/util").assert,i=t("./dscommon/util").serviceOwner,o=t("./dscommon/DSObject"),e.exports=(s=angular.module("db",[])).name,s.factory("db",["$q",function(t){var e,n;return n=null,e=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,e),o.begin("DB"),o.propConst("name","RMS"),o.propConst("ver",4),o.prototype.logQuota=function(){},o.prototype.openDB=function(){var e;return window.indexedDB?(n||(n=t.defer(),e=window.indexedDB.open(this.get("name"),this.get("ver")),e.onsuccess=function(t){console.info("IndexedDB.openDB: Success"),n.resolve(t.target.result)},e.onerror=function(t){console.warn("IndexedDB.openDB: Error",t),n.reject()},e.onupgradeneeded=function(t){var e,o,r;console.info("IndexedDB.openDB: Upgrade",t),e=t.target.result;try{e.deleteObjectStore("timetracking")}catch(r){o=r}e.createObjectStore("timetracking",{keyPath:"page"}),n.resolve(e)}),n.promise):(console.warn("IndexedDB.openDB: Missing window.indexedDB, so there will be no local time tracking info"),void n.reject())},o.end(),o}(o),i.add(new e(i,"db"))}])},{"./dscommon/DSObject":24,"./dscommon/util":30}],13:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=t("./util").assert,l=t("./util").error,a=t("./DSHistory"),u=t("./DSPool"),r=t("./DSData"),i=t("./DSDocument"),s=t("./DSDigest"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n,o;return d(e,t),e.begin("DSChangesBase"),e.noCache(),e.propDoc("hist",a),e.propNum("count",0),n=function(t,e){var n,o,s,i,c,l,d,p;for(r.call(this,t,e,{}),(o=this.set("hist",new a(this,e+".hist"))).release(this),n={add:function(t){return function(){t.count++,t.persist()}}(this),change:function(t){return function(){t.persist()}}(this),remove:function(t){return function(){t.count--,t.persist()}}(this)},this.__unwatch2=p=[],c=this.__proto__.__sets,s=0,i=c.length;i>s;s++)d=c[s],(l=this["_"+d]).$ds_hist=o,(l.$ds_pool=new u(this,e+"."+d+".pool",l.type)).release(this),l.watch(this,n,!0)},e.prototype.saveToLocalStorage=_.noop,e.prototype.persist=function(){},e.prototype.anyChange=function(){return this.get("count")>0},e.prototype.reset=function(){s.block(function(t){return function(){var e,n,o,r,s,i,a,u,c,l,d,p;(e=t.get("hist")).startReset();try{for(c=t.__proto__.__sets,n=0,s=c.length;s>n;n++)for(d=c[n],l=_.map((p=t["_"+d]).items,function(t){return t}),r=0,i=l.length;i>r;r++){o=l[r],a=o.$ds_doc;for(u in o.__change)"__error"!==u&&"__refreshView"!==u&&o.set(u,a.get(u))}}finally{e.endReset()}}}(this))},e.prototype.changesToMap=function(){var t,e,n,o,r,s,i,a,u,c,l,d,p,f,h,m;for(d={},u=this.__proto__.__sets,t=0,r=u.length;r>t;t++){h=u[t],a=(f=this["_"+h]).type.prototype.__props,d[h]=p={},c=f.items;for(o in c){e=c[o],p[o]=n={},l=e.__change;for(i in l)s=l[i],"__error"!==i&&"__refreshView"!==i&&(m=a[i].write)&&(n[i]={v:null===s.v?null:m(s.v),s:null===s.s?null:m(s.s)})}}return d},o=function(t,e,n,o,r){var s,i,a;a=e.hasOwnProperty(s=n.docType)?e[s]:e[s]={},a[t[r]]=i=a.hasOwnProperty(t[r])?a[t[r]]:a[t[r]]=[],i.push(function(t,e,n){return function(o){c&&(null===o||o.__proto__.constructor!==t||o.$ds_key!==e)&&l.invalidArg("doc"),n[r]=o}}(n,t[r],o))},e.prototype.mapToChanges=function(t){var e,n,r,s,i,a,u,c,l,d,p,f,h,m,g,y,_,v,w;for(y={load:c={},changes:n={}},m=this.__proto__.__sets,r=0,u=m.length;u>r;r++){v=m[r],f=this["_"+v].type.prototype.__props,n[v]=_={},g=t[v];for(a in g){s=g[a],_[a]=i={};for(p in s)d=s[p],i[p]=function(){if("function"==typeof(w=(l=f[p]).type))return e={v:null,s:null},d.v&&o(d,c,w,e,"v"),d.s&&o(d,c,w,e,"s"),e;if(h=l.read)return{v:null===d.v?null:h(d.v),s:null===d.s?null:h(d.s)};throw new Error("Unsupported type "+w)}()}}return y},e.end(),c&&(e.end=function(){var t,e,n;r.end.call(this),e=this.prototype.__props;for(t in e)if(n=e[t],"set"===n.type&&!n.itemType.ds_editable)throw new Error("Type '"+this.name+"': propSet '"+t+"' has non-editable item type")}),e}(r)},{"./DSData":14,"./DSDigest":20,"./DSDocument":21,"./DSHistory":22,"./DSPool":26,"./util":30}],14:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=t("./util").assert,i=t("./util").error,u=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,r=t("./DSObject"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return c(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var n,o,r,s;for(r=this.__proto__.__sets,n=0,o=r.length;o>n;n++)s=r[n],this["_"+s].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void u.remove(this.release(u)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},n=function(t,n,o){if(r.call(this,t,n),s){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof o&&i.invalidArg("params")}this.set("params",o),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&u.add(this.addRef(u))},e.prototype.clear=function(){var t,e,n,o;for(n=this.__proto__.__sets,t=0,e=n.length;e>t;t++)o=n[t],this["_"+o].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;r.end.call(this),this.prototype.__sets=function(){var n,o;n=this.prototype.__props,o=[];for(t in n)e=n[t],"set"===e.type&&o.push(t);return o}.call(this)},e}(r)},{"./DSObject":24,"./util":30}],15:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,s=t("./DSDocument"),o=t("./DSData"),r=t("./DSDigest"),i=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(null!==t&&t.ds_editable||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.name]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var u,d;l(n,e),n.begin("DSDataEditable<"+t.docType+">"),n.propDoc("original",i),n.propDoc("changes",i),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),n.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},n.$u=u={};for(d in t.__super__.__props)u[d]=!0;return n.prototype.init=function(e,n,o){var l,d,p,f,h,m,g,y;if(a){if(n instanceof i||c.invalidArg("changes"),e instanceof i||c.invalidArg("original"),"function"!=typeof o&&"undefined"!=typeof o&&c.invalidArg("filter"),e.type.ds_editable)throw new Error("'original' expected to have non DSDocument.Editable items");if(t!==n.type)throw new Error("'itemType' and 'changes' must have same DSDocument.Editable type");if(e.type.Editable!==n.type)throw new Error("'original' and 'changes' must base on same DSDocument type");if(!n.hasOwnProperty("$ds_pool"))throw new Error("'changes' must be set instantiated as a field of DSChanges object")}this.set("original",e),this.set("changes",n),f=this.get("itemsSet"),p=f.items,d=n.$ds_pool,m=e.items,l=n.items,h=function(t){return function(){var s,i,c,h,g;t._startLoad(),h=function(t){if(a&&!d.items.hasOwnProperty(t.$ds_key))throw new Error("Missing editable item");return d.items[t.$ds_key]},c=function(e){var o;return(o=d.find(t,e.$ds_key)).init&&(o.init(e,n),o.$u=u),o},o?(_.forEach(m,function(e){var n;l.hasOwnProperty(n=e.$ds_key)||f.add(t,c(e))}),_.forEach(l,function(e){o.call(t,e)&&f.add(t,e.addRef(t))}),g=function(t){if(a&&!l.hasOwnProperty(t))throw new Error("Missing edtItem");s(l[t])},s=function(e){o.call(t,e)?p.hasOwnProperty(e.$ds_key)||f.add(t,e.addRef(t)):p.hasOwnProperty(e.$ds_key)&&f.remove(e)},i=function(t){return l.hasOwnProperty(t.$ds_key)?(s(h(t)),!0):!1},t._unwatch1=e.watch(t,{add:function(e){i(e)||f.add(t,c(e))},remove:function(e){i(e)||(f.remove(h(e)),r.forget(t.$ds_key,e.$ds_key))}}),t._unwatch2=n.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,g)},change:function(e){r.render(t.$ds_key,e.$ds_key,g)},remove:function(e){s.call(t,e),r.forget(t.$ds_key,e.$ds_key)}})):(_.forEach(m,function(e){f.add(t,c(e))}),t._unwatch1=e.watch(t,{add:function(e){f.add(t,c(e))},remove:function(t){f.remove(h(t))}})),t._endLoad(!0)}}(this),g=[e,n],y=function(t){return function(e,n){var o,i,a;if(o=!1,(i=s.integratedStatus(g))!==(a=t.get("status")))switch(i){case"ready":o?(o=!1,t._endLoad(!0)):r.block(h);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(o=!0);break;case"nodata":o?(o=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this),this._unwatchA=e.watchStatus(this,y),this._unwatchB=n.watchStatus(this,y),this.init=null},n.end(),n}(o)}},{"./DSData":14,"./DSDigest":20,"./DSDocument":21,"./DSSet":27,"./util":30}],16:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,s=t("./DSObject"),o=t("./DSData"),r=t("./DSDigest"),i=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(s.isAssignableFrom(t)||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.docType]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var s,u;l(n,e),n.begin("DSDataFiltered<"+t.docType+">"),n.propDoc("original",i),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatch1&&this._unwatch1()}),n.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1},n.$u=s={};for(u in t.__super__.__props)s[u]=!0;return n.prototype.init=function(e,n){var o,s,u,l;if(a&&(e instanceof i||c.invalidArg("original"),"function"!=typeof n&&c.invalidArg("filter"),t!==e.type))throw new Error("'itemType' and 'original' must have same DSObject type");this.set("original",e),s=this.get("itemsSet"),o=s.items,l=e.items,u=function(t){return function(){var i,a,u;t._startLoad();for(a in l)i=l[a],n(i)&&(i.addRef(t),s.add(t,i));u=function(e){o.hasOwnProperty(e)?n(i=l[e])||s.remove(i):n(i=l[e])&&(i.addRef(t),s.add(t,i))},t._unwatch1=e.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,u)},change:function(e){r.render(t.$ds_key,e.$ds_key,u)},remove:function(e){s.remove(e),r.forget(t.$ds_key,e.$ds_key)}}),t._endLoad(!0)}}(this),this._unwatchA=e.watchStatus(this,function(t){return function(n,o){var s,i,a;if(s=!1,(i=e.get("status"))!==(a=t.get("status")))switch(i){case"ready":s?(s=!1,t._endLoad(!0)):r.block(u);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(s=!0);break;case"nodata":s?(s=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this)),this.init=null},n.end(),n}(o)}},{"./DSData":14,"./DSDigest":20,"./DSObject":24,"./DSSet":27,"./util":30}],17:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("./util").assert,a=t("./util").error,r=t("./DSObject"),s=t("./DSPool"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){i&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,n){var o,s,u,c;if(i){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),("object"!=typeof n||null===n)&&a.invalidArg("sources");for(o in n){u=n[o],("object"!=typeof u||null===u)&&a.invalidArg("sources");for(s in u)switch(c=u[s],s){case"name":break;case"type":!c instanceof r&&a.invalidArg("sources");break;case"set":!c instanceof r&&a.invalidArg("sources");break;case"params":("object"!=typeof c||null===c)&&a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(r)},{"./DSObject":24,"./DSPool":26,"./util":30}],18:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("dscommon/DSDataSimple",[])).name,s=t("./util").assert,i=t("./util").error,o=t("./DSData"),r=t("./DSDigest"),a.factory("DSDataSimple",["DSDataSource","$rootScope","$q",function(t,e,n){var i;return i=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,e),i.begin("DSDataSimple"),i.propDoc("source",t),i.propObj("cancel",null),i.propEnum("method",["httpGet","httpPost","httpPut"]),i.propStr("request"),i.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),i.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},i.prototype.load=function(){var t,e,o,i;if(s){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(i=this.get("request"))&&i.length>0))throw new Error("load(): Request is not specified")}if(this._startLoad())return t=this.set("cancel",n.defer()),o=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),function(){switch(e=this.get("method")){case"httpGet":return this.get("source").httpGet(this.get("request"),t);case"httpPost":return this.get("source").httpPost(this.get("request"),this.params.json,t);case"httpPut":return this.get("source").httpPut(this.get("request"),this.params.json,t)}}.call(this).then(function(t){return function(e){200===e.status?(t.set("cancel",null),t._endLoad(r.block(function(){return t.importResponse(e.data,e.status)}))):o(e,0===e.status)}}(this),o)},i.end(),i}(o)}])},{"./DSData":14,"./DSDigest":20,"./util":30}],19:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataSource",[])).name,l=t("./util").serviceOwner,u=t("./util").modeReleaseDataOnReload,s=t("./util").assert,a=t("./util").error,i=t("../utils/base64"),r=t("./DSObject"),o=t("./DSDigest"),c.factory("DSDataSource",["$q","$http",function(t,e){var n;return n=function(t){function n(){return u.apply(this,arguments)}var u;return d(n,t),n.begin("DSDataSource"),n.addDataSource(),n.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,n,r){switch(n){case"ready":o.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},u=function(t,e){r.call(this,t,e),this.cancelDefers=[]},n.prototype.setConnection=function(t,e){var n,o,r,u;if(s&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(u=this.cancelDefers,o=0,r=u.length;r>o;o++)n=u[o],n.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+i.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},n.prototype.refresh=function(){"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},n.prototype.httpGet=function(t,n){var o,r;return this.cancelDefers.push(n),r=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),o={timeout:n.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),e.get(""+this.url+t,o).then(r,r)},n.prototype.httpPost=function(t,n,o){var r,s;return this.cancelDefers.push(o),s=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),r={timeout:o.promise},this.authHeader&&(r.headers={Authorization:this.authHeader}),e.post(""+this.url+t,n,r).then(s,s)},n.prototype.httpPut=function(t,n,o){var r,s;return this.cancelDefers.push(o),s=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),r={timeout:o.promise},this.authHeader&&(r.headers={Authorization:this.authHeader}),e.put(""+this.url+t,n,r).then(s,s)},n.end(),n}(r)}])},{"../utils/base64":67,"./DSDigest":20,"./DSObject":24,"./util":30}],20:[function(t,e,n){var o,r,s;r=t("./util").assert,s=t("./util").error,e.exports=o=function(){function t(){}var e,n,o,i;return n=0,e=0,o={},i=function(){var t,n,r,s,a,u,c;s=!0;for(a in o){s=!1;break}if(!s){e++,c=o,o={};for(t in c){n=c[t];for(u in n)(r=n[u])(u)}e--,i()}},t.block=function(t){e++;try{return t()}finally{0===--e&&i()}},t.render=function(t,n,i){var a;r&&("string"==typeof t&&t.length>0||s.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||s.invalidArg("key"),"function"!=typeof i&&s.invalidArg("func")),0===e?i(n):(a=o.hasOwnProperty(t)?o[t]:o[t]={},a[n]=i)},t.forget=function(t,n){var i;r&&("string"==typeof t&&t.length>0||s.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||s.invalidArg("key")),0!==e&&o.hasOwnProperty(t)&&(i=o[t],delete i[n])},t}()},{"./util":30}],21:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;a=t("./util").assert,u=t("./util").error,s=t("./DSObjectBase"),r=t("./DSObject"),i=t("./DSSet"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return c(e,t),e.begin("DSDocument"),n=function(t,n){if(r.call(this,t,n),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")},e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;r.end.call(this),e=this,this.Editable=t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var o,l,d,p;c(n,t),n.begin(e.docType+".Editable"),delete n.prototype.$ds_docType,n.ds_editable=!0,n.prototype.__init=null,n.ds_dstr.push(function(){var t,e,n,o,r;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(n in t)e=t[n],(o=e.s)instanceof s&&o.release(this),(r=e.v)instanceof s&&r.release(this)}),n.prototype.init=function(t,n,o){var s,c,l,d,p;if(a&&((null===t||t.__proto__.constructor!==e)&&u.invalidArg("serverDoc"),null!==n&&n instanceof i||u.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof o&&u.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=n,o){l=this.__change=o;for(c in l)s=l[c],(p=s.v)instanceof r&&p.addRef(this),(d=s.s)instanceof r&&d.addRef(this);this.addRef(this),n.add(this,this)}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},n.prototype.__onChange=function(t,e,n,o){var r,i,a,u,c,l,d,p,f,h;if((r=this.__change)&&r.hasOwnProperty(e)&&t.__props[e].equal(h=(d=r[e]).v,n)){for(this.$ds_chg.$ds_hist.setSameAsServer(this,e),(f=d.s)instanceof s&&f.release(this),h instanceof s&&h.release(this),delete r[e],i=!0,a=0,c=r.length;c>a;a++)if(e=r[a],"__error"!==e&&"__refreshView"!==e){i=!1;break}i&&(delete this.__change,this.$ds_chg.remove(this))}else if(this.$ds_evt)for(p=this.$ds_evt,u=p.length-1;u>=0;u+=-1)l=p[u],l.__onChange.call(l,this,e,n,o)},d=n.prototype.__props=e.prototype.__props,n.prototype.get=function(t){return a&&(d.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]},n.prototype.set=function(t,e){return a&&(d.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]=e},p=e.prototype.__props;for(o in p)l=p[o],l.noneditable||!function(t,e,s){var i;return Object.defineProperty(n.prototype,t,{get:i=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(n){var c,l,d,p,f,h,m,g,y,_,v,w;if(a&&"undefined"==typeof(n=e(w=n))&&u.invalidValue(this,t,w),!s(m=i.call(this),n)){if(n instanceof r&&n.addRef(this),c=this.__change)if(s(v=this.$ds_doc[t],n)){this.$ds_chg.$ds_hist.add(this,t,void 0,(l=c[t]).v),(w=l.v)instanceof r&&w.release(this),(_=l.s)instanceof r&&_.release(this),delete c[t],d=!0;for(o in c)if("__error"!==o&&"__refreshView"!==o){d=!1;break}if(d){if(this.$ds_evt)for(g=this.$ds_evt,p=g.length-1;p>=0;p+=-1)h=g[p],h.__onChange.call(h,this,t,n,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(l=c[t])?(this.$ds_chg.$ds_hist.add(this,t,n,l.v),(w=l.v)instanceof r&&w.release(this),l.v=n):(v instanceof r&&v.addRef(this),c[t]={v:n,s:v},this.$ds_chg.$ds_hist.add(this,t,n,void 0));else c=this.__change={},m instanceof r&&m.addRef(this),c[t]={v:n,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,n,void 0);if(this.$ds_evt)for(y=this.$ds_evt,f=y.length-1;f>=0;f+=-1)h=y[f],h.__onChange.call(h,this,t,n,m)}}})}(l.name,l.valid,l.equal);return r.end.call(n),n}(e)},e}(r)},{"./DSObject":24,"./DSObjectBase":25,"./DSSet":27,"./util":30}],22:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;u=t("./util").assert,c=t("./util").error,a=t("./DSObjectBase"),i=t("./DSObject"),o=t("./DSDigest"),r=t("./DSDocument"),e.exports=s=function(t){function e(){return d.apply(this,arguments)}var n,r,s,d,p,f;return l(e,t),
e.begin("DSHistory"),e.ds_dstr.push(function(){n.call(this)}),d=function(t,e){i.call(this,t,e),this.hist=[],this.histTop=0},n=function(){var t,e,n,o,r;for(o=this.hist,e=0,n=o.length;n>e;e++)t=o[e],t.i.release(this),"object"==typeof(r=t.o)&&r instanceof a&&r.release(this),"object"==typeof(r=t.n)&&r instanceof a&&r.release(this);this.hist=[],this.histTop=0},f=!1,s=null,r=0,e.prototype.startBlock=function(){s=++r},e.prototype.endBlock=function(){s=null},e.prototype.startReset=function(){f=!0,n.call(this)},e.prototype.endReset=function(){f=!1},e.prototype.add=function(t,e,n,o){var r,i,l,d,p,h,m;if(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop"),0<=["string","number","boolean","object","undefined"].indexOf(typeof n)||c.invalidArg("newVal"),0<=["string","number","boolean","object","undefined"].indexOf(typeof o)||c.invalidArg("oldVal")),!f){if((i=this.hist).length>this.histTop){for(h=i.slice(this.histTop),l=0,d=h.length;d>l;l++)r=h[l],r.i.release(this),"object"==typeof(m=r.o)&&m instanceof a&&m.release(this),"object"==typeof(m=r.n)&&m instanceof a&&m.release(this);i.length=this.histTop}t.addRef(this),n instanceof a&&n.addRef(this),o instanceof a&&o.addRef(this),i.push(p={i:t,p:e,n:n,o:o}),s&&(p.b=s),this.histTop=i.length}},e.prototype.setSameAsServer=function(t,e){var n,o,r,s,i;for(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop")),s=this.hist.slice(0,this.histTop),o=r=s.length-1;r>=0;o=r+=-1)if(n=s[o],n.i===t&&n.p===e){"object"==typeof(i=n.n)&&i instanceof a&&i.release(this),"undefined"==typeof n.o?(t.release(this),this.hist.splice(o,1),this.histTop--):n.n=void 0;break}},e.prototype.hasUndo=function(){return this.histTop>0},e.prototype.undo=function(){var t,e,n,r,s;if((r=this.histTop)>0){f=!0;try{e=(n=this.hist)[this.histTop=--r],"number"!=typeof(t=e.b)||0===r||n[r-1].b!==t?"undefined"==typeof(s=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s):o.block(function(o){return function(){for(;;){if("undefined"==typeof(s=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s),0===r||(e=n[r-1]).b!==t)break;o.histTop=--r}}}(this))}finally{f=!1}}},e.prototype.hasRedo=p=function(){return this.histTop<this.hist.length},e.prototype.redo=function(){var t,e,n,r,s,i;if(f=!0,(r=this.histTop)<(s=(n=this.hist).length)){f=!0;try{e=n[r],this.histTop=++r,"number"!=typeof(t=e.b)||r===s||n[r].b!==t?"undefined"==typeof(i=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i):o.block(function(o){return function(){for(;;){if("undefined"==typeof(i=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i),r===s||(e=n[r]).b!==t)break;o.histTop=++r}}}(this))}finally{f=!1}}},e.end(),e}(i)},{"./DSDigest":20,"./DSDocument":21,"./DSObject":24,"./DSObjectBase":25,"./util":30}],23:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;c=t("./util"),s=t("./util").assert,u=t("./util").traceRefs,a=t("./util").totalReleaseVerb,i=t("./util").error,r=t("./DSObjectBase"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return l(e,t),e.begin("DSList"),n=function(t,e,n){r.call(this,t,e),s&&!n instanceof r&&i.notDSObjectClass(n),this.type=n,this.items=[]},e.ds_dstr.push(function(){var t,e,n,o;for(n=this.items,t=0,e=n.length;e>t;t++)o=n[t],o.release(this)}),e.prototype.merge=function(t,e){var n,o,l,d,p,f,h,m,g,y;for(s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),_.isArray(e)||i.invalidArg("newList")),d=this.items,y=this.type,p=0,h=d.length;h>p;p++)l=d[p],l.release(this);for(d.length=0,n=f=0,m=e.length;m>f;n=++f)l=e[n],!l instanceof y&&i.invalidListValue(this,n,l),u&&(g=l.$ds_referries,0===g.length?console.error(r.desc(DSDitem)+": Empty $ds_referries"):(o=g.lastIndexOf(t))<0?console.error(r.desc(this)+": Referry not found: "+r.desc(t)):(a&&(console.info(++c.serviceOwner.msgCount+": transfer: "+r.desc(l)+", refs: "+this.$ds_ref+", from: "+r.desc(t)+", to: "+r.desc(this)),c.serviceOwner.msgCount===window.totalBreak),g[o]=this)),d.push(l);return d},e.end(),e}(r)},{"./DSObjectBase":25,"./util":30}],24:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("./util").assert,l=t("./util").serviceOwner,d=t("./util").totalRelease,l=t("./util").serviceOwner,c=t("./util").error,s=t("./DSObjectBase"),a=t("./DSSet"),o=t("./DSList"),i=t("./DSPool"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n;return p(e,t),e.desc=s.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof o||t instanceof i?d?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:d?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===l?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},n=function(t,e){if(s.call(this,t,e),u&&this.__proto__.constructor===s)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){d?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new i(l,e.docType+".pool",e,t),l.clearPool(function(){e.__pool.release(l),delete e.__pool})),e.__pool}}(this)}):this.pool=new i(l,this.docType+".pool",this,t)},e.propPool=function(t,e,n){var o,r;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this),delete this[o]}),(r=this.prop({name:t,type:"pool",init:function(){return new i(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,n)},readonly:!0})).itemType=e,r},e.propSet=function(t,e){var n,o;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(o=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[n].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[n]}}),o},e.propList=function(t,e){var n,r;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(r=this.prop({name:t,type:"list",init:function(){return new o(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[n]}}),r},e}(s)},{"./DSList":23,"./DSObjectBase":25,"./DSPool":26,"./DSSet":27,"./util":30}],25:[function(t,e,n){var o,r,s,i,a,u,c,l,d;d=t("./util"),r=t("./util").assert,c=t("./util").traceData,i=t("./util").serviceOwner,l=t("./util").traceRefs,a=t("./util").totalRelease,u=t("./util").totalReleaseVerb,s=t("./util").error,e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n,o,i,p,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&s.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=n=null,(window.totalReleaseReset=function(){n=0,window.totalPool=h={},d.serviceOwner.start(),d.serviceOwner.msgCount=0})(),window.totalRelease=function(){return d.serviceOwner.stop(),h}),e=function(e,o){var i,c,p;if(r){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBsse direct");"object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry"),"string"!=typeof o&&s.invalidArg("key")}if(this.$ds_key=o,this.$ds_ref=1,a&&(h[this.$ds_globalId=++n]=this,u&&(console.info(++d.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak)),l&&(this.$ds_referries=[e]),i=this.__proto__.__init)for(c in i)p=i[c],this[c]="function"==typeof p?p.call(this):p;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(r&&("object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry")),0===this.$ds_ref)throw new Error("addRef() on already fully released object");return l&&this.$ds_referries.push(e),this.$ds_ref++,u&&(console.info(++d.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var n,o;if(r&&("object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry")),u&&(console.info(++d.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(l&&((n=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(n,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((o=this.$ds_pool).watchOn&&(r&&(_.find(this.$ds_evt,function(t){return function(t){return t===o}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,o)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+":"+this.$ds_key+("object"==typeof this.$ds_pool?"@"+this.$ds_pool:"")},t.prototype.writeMap=function(){var t,e,n,o;o={},n=this.__proto__.__props;for(e in n)t=n[e],t.hasOwnProperty("write")&&(o[e]=t.write(this["_"+e]));return o},t.prototype.readMap=function(t){var e,n,o,r;o=this.__proto__.__props;for(n in t)r=t[n],o.hasOwnProperty(n)&&(e=o[n]).hasOwnProperty("read")?this[n]=e.read(r):console.error("Unexpected property "+n)},t.begin=function(t){var e;r&&"string"!=typeof t&&s.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,n,o;for(n=0,o=t.length;o>n;n++)e=t[n],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,n;for(n=e.length-1;n>=0;n+=-1)t=e[n],t.call(this)})},t.prop=function(t){var e,n,o,i,a,u,c,l,d,p;if(r){if("object"!=typeof t&&s.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(o=t.init)?o():o))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set")}if(this.prototype.hasOwnProperty("__init")?r&&this.prototype.__props.hasOwnProperty(t.name)&&s.duplicatedProperty(this,t.name):(this.prototype.__init=(l=this.__super__.__init)?_.clone(l):{},c=this.prototype.__props=(d=this.__super__.__props)?_.clone(d):{},this.prototype.get=function(t){return r&&(c.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return r&&(c.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]=e}),u=this.prototype.__props[t.name]={name:t.name,type:t.type,write:t.write||function(t){return null===t?null:t.valueOf()},read:t.read||function(t){return t},equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){return null===t?"":t.toString()},readonly:t.readonly||!1},t.hasOwnProperty("init"))p=u.valid=t.valid,u.init=this.prototype.__init[i="_"+(a=t.name)]=t.init,Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[i]},set:t.set||(t.readonly?function(t){s.propIsReadOnly(this,a)}:function(t){var n,o,r,u,c;if("undefined"==typeof(t=p(c=t))&&s.invalidValue(this,a,c),!e(u=this[i],t)&&(this[i]=t,n=this.$ds_evt))for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,a,t,u)})});else if(t.hasOwnProperty("value"))u.value=t.value,u.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");u.func=n=t.func,u.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return n.call(this)},set:t.set||function(t){s.propIsReadOnly(this,a)}})}return u},t.propSimple=function(t,e,n,o){var i;return r&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&s.invalidArg("type"),o&&"function"!=typeof o&&s.invalidArg("valid"),"undefined"!=typeof n&&null!==n&&typeof n!==t&&s.invalidArg("init")),o=(i=o)?function(e){return null!==e&&typeof e!==t||void 0===(e=i(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop({name:e,type:t,init:"undefined"==typeof n?null:"object"!==t?n:function(){return _.clone(n)},valid:o,write:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()}})},t.propNum=function(t,e,n){this.propSimple("number",t,e,n)},t.propBool=function(t,e,n){return this.propSimple("boolean",t,e,n)},t.propStr=function(t,e,n){return this.propSimple("string",t,e,n)},t.propObj=function(t,e,n){return this.propSimple("object",t,e,n)},t.propDoc=function(e,n,o){var i,a;return r&&(o&&"function"!=typeof o&&s.invalidArg("valid"),"function"!=typeof n&&s.invalidArg("type"),!n instanceof t&&s.notDSObjectClass(n)),o=(a=o)?function(t){return(null===t||t instanceof n)&&void 0!==(t=a(t))?t:void 0}:function(t){return null===t||t instanceof n?t:void 0},i="_"+e,this.ds_dstr.push(function(){this[i]&&this[i].release(this)}),this.prop({name:e,type:n,init:null,valid:o,write:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof n.str?n.str:function(t){return null===t?"":t.$ds_key},set:function(t){var n,r,a,u,c;if("undefined"==typeof(t=o(c=t))&&s.invalidValue(this,e,c),(u=this[i])!==t){if(this[i]=t,t&&t.addRef(this),n=this.$ds_evt)for(r=n.length-1;r>=0;r+=-1)a=n[r],a.__onChange.call(a,this,e,t,u);u&&u.release(this)}}})},t.propCalc=function(t,e){return r&&(e&&"function"==typeof e||s.invalidArg("func")),this.prop({name:t,type:"calc",func:e})},t.propConst=function(t,e){return r&&"undefined"==typeof e&&s.invalidArg("value"),this.prop({name:t,type:"const",value:e})},t.propEnum=function(t,e){var n,o,i,a,u,c;if(r)for(_.isArray(e)&&0!==e.length||s.invalidArg("values"),n=0,o=e.length;o>n;n++)u=e[n];return c=(a=c)?function(t){return(null===t||e.indexOf(t)>=0)&&a(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},i="_"+t,this.prop({name:t,type:"enum",init:e[0],valid:c,set:function(e){var n,o,r,a,u;if("undefined"==typeof(e=c(u=e))&&s.invalidValue(this,t,u),(r=this[i])!==e&&(this[i]=e,this.$ds_evt))for(a=this.$ds_evt,n=a.length-1;n>=0;n+=-1)o=a[n],o.__onChange.call(o,this,t,e,r)}})},t.propMoment=function(t,e){var n;return r&&e&&"function"!=typeof e&&s.invalidArg("valid"),e=(n=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&n(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null})},t.propDuration=function(t,e){var n;return r&&e&&"function"!=typeof e&&s.invalidArg("valid"),e=(n=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&n(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null})},t.onAnyPropChange=function(t){r&&"function"!=typeof t&&s.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],p=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,n,o,i,a;for(r&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||s.invalidArg("sources")),o=-1,e=0,n=t.length;n>e;e++)a=t[e],a&&o<(i=p.indexOf(a.get("status")))&&(o=i);return-1===o?"nodata":p[o]},c&&(i=0,o=0),t.addDataSource=function(e){var n,a;if(r){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&s.invalidArg("onStatusChange")}this.ds_dataSource=!0,c&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++i,console.info(++o+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++o+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},n=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(n){var r,i,u,l,d;if("undefined"==typeof(n=a(d=n))&&s.invalidValue(this,"status",d),(u=this._status)!==n)for(c&&(console.info(++o+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+n+", old: "+u),o===window.sourceBreak),this._status=n,null!=e&&e.call(this,n,u),l=this.$ds_statusWatchers,r=l.length-1;r>=0;r+=-1)i=l[r],i.lst(this,n,u,i.unwatch)}}),n.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var n,o,i,a;return r&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("referry"),"function"!=typeof e&&s.invalidArg("listener")),(a=this.$ds_statusWatchers).push(i={lst:e}),this.addRef(t),i.unwatch=o=function(e){return function(n){return function(){n||(e.release(t),_.remove(a,i),n=!0)}}}(this)(!1),n=this.get("status"),"update"===n?(e(this,"ready","nodata",o),_.find(a,i)&&e(this,"update","ready",o)):e(this,n,"nodata",o),o}},t}()},{"./util":30}],26:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;i=t("./util").assert,a=t("./util").error,u=t("./util").traceWatch,r=t("./DSObjectBase"),o=t("./DSDigest"),e.exports=s=function(t){function e(){return n.apply(this,arguments)}var n,s;return c(e,t),e.begin("DSPool"),e.ds_dstr.push(function(){_.isEmpty(this.items)||console.error("Pool "+r.desc(this)+" is not empty. Items: ",this.items)}),n=function(t,e,n,o){var s;r.call(this,t,e),i&&(r.isAssignableFrom(n)||a.notDSObjectClass(n)),s=this.items={},this.type=n,o&&(this.watchOn=!0,this.evt=[])},s=function(t){var e,n,o,r,s;if((r=this.items).hasOwnProperty(t))for(o=r[t],s=this.evt,n=s.length-1;n>=0;n+=-1)e=s[n],e.lst(o)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&o.render(this.$ds_key,t.$ds_key,function(t){return function(e){s.call(t,e)}}(this))},e.prototype.find=function(t,e,n){var o,r;return i&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof n||"object"==typeof n&&null!==n||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(r=e)),n&&n.hasOwnProperty(e)?n[e]:(this.items.hasOwnProperty(e)?(o=this.items[e]).addRef(t):(o=this.items[e]=new this.type(t,e,r),o.$ds_pool=this,this.evt&&(o.hasOwnProperty("$ds_evt")?(i&&_.find(o.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),o.$ds_evt.push(this)):o.$ds_evt=[this],this.__onChange(o))),n?n[e]=o:o)},e.prototype.enableWatch=function(t){if(i&&!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var n,o,s,c,l;if(i){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(s in e)if(c=e[s],"change"!==s&&"add"!==s&&"remove"!==s)throw new Error("Unexpected event listener: "+s);if(u&&(e.owner=t),!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled")}return(o=this.evt).push(l={lst:e}),this.addRef(t),n=!0,function(e){return function(){n&&(n=!1,e.release(t),_.remove(o,l))}}(this)},e.end(),e}(r)},{"./DSDigest":20,"./DSObjectBase":25,"./util":30}],27:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;d=t("./util"),s=t("./util").assert,c=t("./util").traceRefs,l=t("./util").traceWatch,u=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,i=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(){return a.apply(this,arguments)}var n,r,a;return p(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,n,o;n=t=this.items;for(e in n)o=n[e],o.release(this),delete t[e]}),a=function(t,e,n,r){o.call(this,t,e),s&&(!n instanceof o&&i.notDSObjectClass(n),"object"!=typeof r&&void 0!==r&&i.invalidArg("data")),this.data=r,this.type=n,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,n,o;for(n=this.evt,e=n.length-1;e>=0;e+=-1)t=n[e],null!=(o=t.change)&&o.apply(t,arguments)},e.prototype.merge=function(t,e){var o,a,u;s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),"object"!=typeof e&&i.invalidArg("newMap")),u=this.items;for(a in u)o=u[a],e.hasOwnProperty(a)||r.call(this,o);for(a in e){if(o=e[a],s&&a!==o.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+o.$ds_key);n.call(this,t,o)}return this.items},e.prototype.reset=function(){var t,e,n,o,r;for(t=this.evt,_.forEach(n=this.items,function(e){return function(n){var o,r,s;for(r=0,s=t.length;s>r;r++)o=t[r],"function"==typeof o.remove&&o.remove(n);n.release(e)}}(this)),e=0,r=n.length;r>e;e++)o=n[e],delete n[o]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&r.call(this,t)},r=function(t){var e,n,o;for(t.hasOwnProperty("$ds_evt")&&(s&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],o=this.evt,n=o.length-1;n>=0;n+=-1)e=o[n],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=n=function(t,e){var n,r,a,l,p,f;if(s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),e instanceof this.type||i.invalidMapElementType(this,e)),(l=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(s&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],l[e.$ds_key]=e,c&&(f=e.$ds_referries,0===f.length?console.error(o.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(o.desc(this)+": Referry not found: "+o.desc(t)):(u&&(console.info(++d.serviceOwner.msgCount+": transfer: "+o.desc(e)+", refs: "+this.$ds_ref+", from: "+o.desc(t)+", to: "+o.desc(this)),d.serviceOwner.msgCount===window.totalBreak),f[a]=this)),p=this.evt,r=p.length-1;r>=0;r+=-1)n=p[r],"function"==typeof n.add&&n.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,n){var o,r,a,u;if(s){"object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),"object"!=typeof e&&i.invalidArg("listener");for(a in e)if(u=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);l&&(e.owner=t)}return _.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(r=this.evt).push(e),n?void 0:(this.addRef(t),o=!0,function(n){return function(){o&&(o=!1,n.release(t),_.remove(r,function(t){return t===e}))}}(this))},e.prototype.addRef=function(t){var n;return 1===this.$ds_ref&&(n=this.data)&&1===++n.__busySets&&n.addRef(n.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var n;return e.__super__.release.call(this,t),1===this.$ds_ref&&(n=this.data)&&0===--n.__busySets&&n.release(n.__backRef),this},e.end(),e}(o)},{"./DSObjectBase":25,"./util":30}],28:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("./util").assert,i=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n;return a(e,t),e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(n,o){var r;return s&&o&&"function"!=typeof o&&i.invalidArg("valid"),o=(r=o)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&r(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},t.prop({name:n,type:"DSTags",valid:o,read:function(t){return null!==t?new e(t):null},str:function(t){return t.value},init:null})}},e.ds_dstr.push(function(){var t,e;(function(){var n,r;n=this.map,r=[];for(t in n)e=n[t],r.push(e instanceof o);return r}).call(this)&&e.release(this)}),n=function(t){var n,r,a,u,c,l,d,p,f,h;if(s&&(1===arguments.length&&"object"==typeof(p=arguments[0])||"string"!=typeof t&&i.invalidArg("enums")),1===arguments.length&&"object"==typeof(p=arguments[0])){p.__proto__===e.prototype?(this.map=_.clone(p.map),this.value=p.value):(this.map=c=_.clone(t),this.value=_.sortBy(function(){var t;t=[];for(r in c)t.push(r);return t}()).join(", ")),l=this.map;for(a in l)h=l[a],h instanceof o&&h.addRef(this)}else{if(this.map=c={},"string"==typeof t)for(d=t.split(","),n=0,u=d.length;u>n;n++)f=d[n],c[f.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(r in c)t.push(r);return t}()).join(", ")}},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.clone=function(){return new e(this)},e.prototype.set=function(t,e){var n,r,a,u;return s&&("string"!=typeof t&&i.invalidArg("enumValue"),"undefined"==typeof e&&i.invalidArg("value")),e?(n=!(a=this.map).hasOwnProperty(t),e instanceof o&&e.addRef(this),(u=a[t])instanceof o&&u.release(this),a[t]=e,n||(this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((u=a[t])instanceof o&&u.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", ")),this},e.prototype.get=function(t){return s&&"string"!=typeof t&&i.invalidArg("enumValue"),this.map.hasOwnProperty(t)?this.map[t]:!1},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.diff=function(t){var n,o,r;return s&&("object"!=typeof t||t.__proto__!==e.prototype)&&i.invalidArg("src"),r=t.map,function(){var t;t=[];for(n in o=this.map)r.hasOwnProperty(n)||t.push("+"+n);return t}.call(this).concat(function(){var t;t=[];for(n in r)o.hasOwnProperty(n)||t.push("-"+n);return t}()).join(", ")},e.end(),e}(o)},{"./DSObjectBase":25,"./util":30}],29:[function(t,e,n){var o,r,s,i,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(a=angular.module("dscommon/DSView",[t("../data/dsDataService")])).name,u=t("./util").traceView,s=t("./util").assert,i=t("./util").error,o=t("./DSObject"),r=t("./DSSet"),a.factory("DSView",["dsDataService","$log",function(t,e){var n,r;return r=function(){function t(){}return t.prototype.get=function(t){return s&&(this.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},t.prototype.set=function(t,e){return s&&(this.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e},t}(),n=function(e){function n(){return a.apply(this,arguments)}var a,l;return c(n,e),n.begin("DSView"),n.begin=function(t){var e;o.begin.call(this,t),this.prototype.__src=(e=this.__super__.__src)?_.clone(e):{}},n.propData=function(t,e,n){var o,r;if(s){if("undefined"!=typeof this.prototype._src)throw new Error("Duplicate data set name: "+t);"undefined"==typeof n||"object"==typeof n&&null!==n||i.invalidArg("params")}"object"==typeof n&&(n.hasOwnProperty("watch")?(r=n.watch,delete n.watch):r=null,s&&(_.isArray(r)||null===r||i.invalidArg("params.watch"))),this.prototype.__srcLength=(o=_.size(this.prototype.__src))+1,this.prototype.__src[t]={name:t,type:e,watch:r,params:n,index:o}},n.ds_dstr.push(function(){var t,e,n;"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2(),e=this.__src;for(t in e)n=e[t],"function"==typeof n.unwatch&&n.unwatch(),"function"==typeof n.unwatchStatus&&n.unwatchStatus(),n.hasOwnProperty("set")&&n.set.release(this)}),a=function(t,e){var n,r,a,u,c;o.call(this,t,e),s&&"object"!=typeof t&&i.invalidArg("$scope"),this.__unwatch1=(this.__scope=t).$on("$destroy",function(e){return function(){return delete e.__unwatch1,e.release(t)}}(this)),this.__dirty=0,this.__src=_.cloneDeep(this.__proto__.__src),this.__srcList=new Array(__proto__.__srcLength),this.dataStatus="nodata",a=function(t){return function(){t.__dirty++}}(this),r=this.__src;for(n in r)u=r[n],c=u.watch,u.listener={add:a,remove:a,change:c?function(t){return function(e){return function(n,o){-1!==e.indexOf(o)&&t.__dirty++}}}(this)(c):a}},n.prop({name:"data",type:"DSView.data",readonly:!0,init:function(){return new r}}),l=0,n.prototype.dataUpdate=function(e){var n,r,a,c,d;"undefined"==typeof e&&(e={}),s&&"object"!=typeof e&&null!==e&&i.invalidArg("params"),t.requestSources(this,e,this.__src),c=this.__src;for(r in c)d=c[r],d.hasOwnProperty("newSet")&&(a=d.newSet,d.hasOwnProperty("set")&&(d.set.release(this),d.unwatch(),d.unwatchStatus()),Object.defineProperty(n=this.get("data"),r,{configurable:!0,enumerable:!0,value:a.items}),Object.defineProperty(n,r+"Set",{configurable:!0,get:function(t){return function(){return t}}(a)}),Object.defineProperty(n,r+"Status",{configurable:!0,get:function(t){return function(){return t.get("status")}}(a)}),this.__srcList[d.index]=d.set=a,delete d.newSet,this.__dirty++,d.unwatch=a.watch(this,d.listener),d.unwatchStatus=a.watchStatus(this,function(t){return function(e,n,r){
var s;(r=t.dataStatus)!==(s=o.integratedStatus(t.__srcList))&&(t.dataStatus=s,"ready"===s&&"update"===r||"update"===s&&"ready"===r||t.__dirty++)}}(this)));this.hasOwnProperty("__unwatch2")||(this.__unwatch2=this.__scope.$watch(function(t){return function(){return t.__dirty}}(this),function(t){return function(e,n){var r,s,i,a;if(u){s="",r=t.__src;for(a in r)i=r[a],s+=", "+a+": "+i.set.get("status");console.info(++l+":"+o.desc(t)+".render(): dataStatus: "+t.dataStatus+s),l===window.viewBreak}t.render()}}(this)))},n.end(),n}(o)}])},{"../data/dsDataService":7,"./DSObject":24,"./DSSet":27,"./util":30}],30:[function(t,e,n){var o,r;e.exports=r={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,n,o,r,s,i,a;for(s=this.services,e=0,o=s.length;o>e;e++)a=s[e],a.release(this);if(this.poolCleaners)for(i=this.poolCleaners,n=0,r=i.length;r>n;n++)(t=i[n])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")}}}},{}],31:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../dscommon/util").assert,a=t("../dscommon/util").error,o=t("../dscommon/DSDocument"),r=t("../dscommon/DSTags"),e.exports=s=function(t){function e(){return n.apply(this,arguments)}var n;return u(e,t),e.begin("Person"),r.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propDuration("contractTime"),n=function(t,e){o.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(o)},{"../dscommon/DSDocument":21,"../dscommon/DSTags":28,"../dscommon/util":30}],32:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../dscommon/util").assert,a=t("../dscommon/util").error,o=t("../dscommon/DSObject"),r=t("./Person"),e.exports=s=function(t){function e(){return s.apply(this,arguments)}var n,s;return u(e,t),e.begin("PersonDayStat"),e.DayStat=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DayStat"),e.propMoment("day"),e.propNum("tasksCount"),e.propDuration("contract"),e.propDuration("tasksTotal"),e.propDuration("timeLeft"),e.propDuration("timeSpent"),e.end(),e}(o),s=function(t,e,s,u){var c,l,d,p,f;if(o.call(this,t,e),i)for(s instanceof r||a.invalidArg("person"),Array.isArray(u)||a.invalidArg("days"),d=0,f=u.length;f>d;d++)c=u[d],moment.isMoment(c)||a.invalidArg("days");this.set("person",s),p=0,this.get("dayStatsList").merge(this,function(){var t,e,o;for(o=[],t=0,e=u.length;e>t;t++)c=u[t],o.push(((l=new n(this,""+p++)).set("day",c),l));return o}.call(this))},e.propDoc("person",r),e.propList("dayStats",n),e.propDuration("totalPeriodTime"),e.end(),e}(o)},{"../dscommon/DSObject":24,"../dscommon/util":30,"./Person":31}],33:[function(t,e,n){var o,r,s,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("../dscommon/DSObject"),s=t("../models/Task"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("PersonTimeTracking"),e.addPool(!0),e.propNum("personId",0),e.propMoment("date"),e.propNum("taskId",0),e.propDoc("task",s),e.propNum("timeMin",0),e.end(),e}(o)},{"../dscommon/DSObject":24,"../models/Task":36}],34:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../dscommon/util").assert,i=t("../dscommon/util").error,o=t("../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propObj("people"),e.end(),e}(o)},{"../dscommon/DSObject":24,"../dscommon/util":30}],35:[function(t,e,n){var o,r,s,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../dscommon/util").assert,i=t("../dscommon/util").error,o=t("../dscommon/DSDocument"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Tag"),e.addPool(),e.propNum("id",0),e.propStr("name"),e.propStr("color"),e.end(),e}(o)},{"../dscommon/DSDocument":21,"../dscommon/util":30}],36:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m=function(t,e){function n(){this.constructor=t}for(var o in e)g.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty;p=t("../dscommon/util").assert,f=t("../dscommon/util").error,h=t("../ui/time"),r=t("../dscommon/DSDocument"),a=t("./Project"),i=t("./Person"),d=t("./TodoList"),l=t("./TaskTimeTracking"),s=t("../dscommon/DSTags"),o=t("./types/Comments"),c=t("./types/TaskSplit"),e.exports=u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return m(e,t),e.begin("Task"),o.addPropType(e),c.addPropType(e),s.addPropType(e),e.addPool(!0),e.str=function(t){return null===t?"":t.get("title")},e.propNum("id",0),e.propStr("title"),e.propDuration("estimate").str=function(t){var e,n,o;return e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+"h":"",n&&(o+=" "+n+"m"),o||(o="0"),o},e.propMoment("duedate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propMoment("startDate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propDoc("creator",i),e.propDoc("responsible",i),e.propDoc("todoList",d),e.propDoc("project",a),e.propTaskRelativeSplit("split"),e.propStr("description"),e.propComments("comments"),e.propDoc("timeTracking",l),e.propStr("firstTimeEntryId"),e.propBool("completed"),e.propBool("isReady"),e.propBool("plan"),e.propDSTags("tags"),e.prototype.isOverdue=function(){var t;return null!==(t=this.get("duedate"))&&t<h.today},e.prototype.timeWithinEstimate=function(){var t;return null===(t=this.get("estimate"))?0:Math.min(100,Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))},e.prototype.timeAboveEstimate=function(){var t,e;return null===(t=this.get("estimate"))?0:(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))<=100?0:e>200?100:e-100},e.prototype.timeReported=function(){var t,e;return null===(t=this.get("estimate"))?"":(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))>200?e+" %":""},e.prototype.grade=function(){var t;return null===(t=this.get("estimate"))?"":t.asMinutes()<60?"easy":t.asMinutes()>=60&&t.asMinutes()<240?"medium":t.asMinutes()>=240&&t.asMinutes()<480?"hard":t.asMinutes()>=480?"complex":void 0},e.prototype.setVisible=function(t){var e,n;t?1===(this.__visCount=(this.__visCount||0)+1)&&null!=(e=this.get("timeTracking"))&&e.setVisible(!0):0===--this.__visCount&&null!=(n=this.get("timeTracking"))&&n.setVisible(!1)},e.end(),e}(r)},{"../dscommon/DSDocument":21,"../dscommon/DSTags":28,"../dscommon/util":30,"../ui/time":51,"./Person":31,"./Project":34,"./TaskTimeTracking":37,"./TodoList":38,"./types/Comments":39,"./types/TaskSplit":40}],37:[function(t,e,n){var o,r,s=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;o=t("../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("TaskTimeTracking"),e.addPool(!0),e.propNum("taskId",0),e.propBool("isReady"),e.propNum("totalMin",0),e.propNum("priorTodayMin",0),e.propObj("timeEntries",{}),e.end(),e}(o)},{"../dscommon/DSObject":24}],38:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../dscommon/util").assert,a=t("../dscommon/util").error,o=t("../dscommon/DSObject"),r=t("./Project"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TodoList"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propDoc("project",r),e.end(),e}(o)},{"../dscommon/DSObject":24,"../dscommon/util":30,"./Project":34}],39:[function(t,e,n){var o,r,s,i;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,r=t("../../dscommon/DSDocument"),e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propComments=function(n,o){var r;return s&&o&&"function"!=typeof o&&i.invalidArg("valid"),o=(r=o)?function(t){return(null===t||Array.isArray(t))&&r(t)?t:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"comments",valid:o,read:function(e){return null!==e?new t(e):null},str:function(){return"split"},equal:function(t,e){var n,o,r,s,i;if(null===t||null===e)return t===e;if(t.list.length!==e.list.length)return!1;for(i=t.list,n=o=0,r=i.length;r>o;n=++o)if(s=i[n],s!==e.list[n])return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,o,r,a;if(s)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(n=0,o=e.length;o>n;n++)a=e[n],"string"!=typeof a&&i.invalidArg("persisted");1===arguments.length&&"object"==typeof(r=arguments[0])&&r.__proto__===t.prototype?this.list=r.list.slice():this.list=[]},t.prototype.clone=function(){return new t(this)},t.prototype.add=function(t){this.list.push(t)},t.prototype.unshift=function(t){this.list.unshift(t)},t.prototype.shift=function(){return this.list.shift()},t.prototype.valueOf=function(){return this.list},t.prototype.clear=function(){this.list=[]},t}()},{"../../dscommon/DSDocument":21,"../../dscommon/util":30}],40:[function(t,e,n){var o,r,s,i;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,o=t("../../dscommon/DSDocument"),e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propTaskRelativeSplit=function(n,o){var r;return s&&o&&"function"!=typeof o&&i.invalidArg("valid"),o=(r=o)?function(e){return(null===e||"object"==typeof e&&e instanceof t)&&r(e)?e:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"taskRelativeSplit",valid:o,read:function(e){return null!==e?new t(e):null},str:function(t){return t?"split":""},equal:function(t,e){var n,o,r,s,i,a;if(null===t||null===e)return t===e;if((r=null!=t?t.list:void 0).length!==(i=null!=e?e.list:void 0).length)return!1;for(n=o=0,s=r.length;s>o;n=o+=2)if(a=r[n],a!==i[n]||r[n+1].valueOf()!==i[n+1].valueOf())return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,o,r,a,u,c,l,d,p;if(s)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(e.length%2!==0&&i.invalidArg("persisted"),r=0,u=e.length;u>r;r++)p=e[r],"number"!=typeof p&&i.invalidArg("persisted");if(1===arguments.length&&"object"==typeof(d=arguments[0])&&d.__proto__===t.prototype)this.list=d.list.slice();else if(this.list=l=[],Array.isArray(e))for(o=a=0,c=e.length;c>a;o=a+=2)n=e[o],l.push(moment.duration(n,"day").valueOf()),l.push(moment.duration(e[o+1],"minute"))},t.prototype.clone=function(){return new t(this)},t.prototype.set=function(t,e,n){var o,r,a,u,c,l,d;for(s&&(moment.isMoment(t)||i.invalidArg("duedate"),moment.isMoment(e)||i.invalidArg("date"),null===n||moment.isDuration(n)||i.invalidArg("estimate")),r=e.diff(t),d=l=this.list,a=u=0,c=d.length;c>u;a=u+=2){if(o=d[a],o===r){if(null!==n&&0!==n.valueOf()){if(l[a+1].valueOf()===n.valueOf())return;l[a+1]=n}else l.splice(a,2);return void delete this.value}if(o>r)return 0!==(null!=n?n.valueOf():void 0)&&l.splice(a,0,r,n),void delete this.value}return 0!==(null!=n?n.valueOf():void 0)&&(delete this.value,l.push(r),l.push(n)),this},t.prototype.get=function(t,e){var n,o,r,a,u,c,l;for(s&&(moment.isMoment(t)||i.invalidArg("duedate"),moment.isMoment(e)||i.invalidArg("date")),o=e.diff(t),l=c=this.list,r=a=0,u=l.length;u>a;r=a+=2)if(n=l[r],n===o)return c[r+1];return null},t.prototype.day=function(t,e){var n;return s&&(moment.isMoment(e)||i.invalidArg("date")),Object.defineProperty(n={},"val",{get:function(n){return function(){return n.get(t(),e)}}(this),set:function(n){return function(o){return n.set(t(),e,o)}}(this)}),n},t.prototype.valueOf=function(){var t,e,n,o,r,s,i,a,u;if(u=this.value)return u;for(this.value=i=[],s=r=this.list,e=n=0,o=s.length;o>n;e=n+=2)a=s[e],t=r[e+1],i.push(moment.duration(a).asDays()),i.push(t.asMinutes());return i},t.prototype.shift=function(t,e){var n,o,r,a,u,c,l;if(s)switch(arguments.length){case 1:"number"!=typeof t&&i.invalidArg("diff");break;case 2:moment.isMoment(t)||i.invalidArg("newDuedate"),moment.isMoment(e)||i.invalidArg("oldDuedate");break;default:throw new Error("Invalid arguments")}if(delete this.value,n="number"==typeof t?t:t.diff(e),0!==n)for(c=u=this.list,o=r=0,a=c.length;a>r;o=r+=2)l=c[o],u[o]-=n},t.prototype.firstDate=function(t){var e;return s&&(moment.isMoment(t)||i.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[0]):null},t.prototype.lastDate=function(t){var e;return s&&(moment.isMoment(t)||i.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[e.length-2]):null},t.prototype.clear=function(){delete this.value,this.list=[]},t.prototype.fixEstimate=function(t){var e,n,o,r,s,i;if(t>0)this.list[this.list.length-1].add(t);else if(0>t)for(s=r=this.list.slice(1),e=n=0,o=s.length;o>n;e=n+=2)if(i=s[e],(t+=i.valueOf())>0){this.list[e+1]=moment.duration(t),this.list=this.list.slice(e);break}},Object.defineProperty(t.prototype,"total",{get:function(){var t,e,o,r,s,i;if(0===(o=this.list).length)return n;if(1===o.length)return o[1];for(s=moment.duration(o[1]),r=o.slice(3),t=0,e=r.length;e>t;t+=2)i=r[t],s.add(i);return s}}),t}()},{"../../dscommon/DSDocument":21,"../../dscommon/util":30}],41:[function(t,e,n){var o;e.exports=(o=angular.module("app",["ui.router","ui.select","LocalStorageModule",t("./ui/ui"),t("./data/dsDataService"),t("./svc/emails/emails"),t("./db")])).name,o.run(["config","$rootScope","db",function(t,e,n){e.Math=Math,e.taskModal={}}]),o.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(t,e,n){n.html5Mode(!0),t.otherwise("/")}])},{"./data/dsDataService":7,"./db":12,"./svc/emails/emails":42,"./ui/ui":52}],42:[function(t,e,n){var o,r,s,i,a;s=t("../../utils/base64"),r=t("../../models/Task"),o=t("../../models/Person"),e.exports=(a=angular.module("svc-emails",[t("../../data/dsDataService")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,o){e.state({name:"emails",url:"/emails",templateUrl:function(){return"./svc/emails/main.html"},controller:i})}]),i=["$scope","$http","$sce","config","dsDataService",function(t,e,n,i,a){var u,c;t.dateCheck="",t.isDateCheckOk=function(){return/\d{1,2}\.\d{2}\.\d{4}/.test(t.dateCheck)?moment(t.dateCheck,"DD.MM.YYYY").startOf("day").valueOf()===moment().startOf("day").valueOf():!1},t.state="notStarted",t.data=null,t.formatDuration=u=function(t){var e,n,o;return e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+" ч.":"",n&&(o&&(o+=" "),o+=n+" мин."),o},t.prepare=function(){var e,s,i,c,l,d,p,f,h;c=a.findDataSet(this,{type:o,mode:"original"}),d=a.findDataSet(this,{type:r,mode:"original",filter:"assigned",startDate:l=moment().startOf("day"),endDate:s=moment(l).add(6,"days")}),i=function(t){var e,o,r;return o=u(t.planHours),e=u(t.optHours),r=o,e&&(r&&(r+=" + "),r+="<span style='background-color:rgb(255,153,0)'>"+e+"</span>"),t.hours=n.trustAsHtml(r),t},e=function(){var e,n,o,r,a,p,f,h,m,g,y,v,w,S,D,k,b,T,O;for(console.info("compute started..."),t.emails=r=[],S=h=_.sortBy(_.map(c.items),function(t){return t.get("name")}),p=0,f=S.length;f>p;p++)if(m=S[p],null!==m.get("roles")){w={},D=d.items;for(T in D)if(b=D[T],b.get("responsible")===m&&null!==b.get("estimate")&&462667!==b.get("todoList").get("id"))if((v=w[y=(g=b.get("project")).$ds_key])||(v=w[y]={id:g.get("id"),name:g.get("name"),planHours:moment.duration(),optHours:moment.duration(),manager:""}),a=-1!==b.get("title").toLowerCase().indexOf("бронь")||-1!==b.get("todoList").get("name").toLowerCase().indexOf("бронь")?v.optHours:v.planHours,k=b.get("split"))for(n=b.get("duedate"),e=moment(l);s>=e;)null!==(o=k.get(n,e))&&a.add(o),e.add(1,"day");else a.add(b.get("estimate"));O=moment.duration(),(w=_.map(w,function(t){return O.add(t.planHours),O.add(t.optHouras),i(t)})).length>0&&(w=_.sortBy(w,function(t){return t.name}),r.push({person:m,toName:m.get("firstName"),startDate:l.format("DD.MM"),endDate:s.format("DD.MM.YYYY"),totalHours:u(O),projects:w,status:"notSent"}))}console.info("compute finished: ",r)},h=function(){"ready"===c.status&&"ready"===d.status&&(e(),p(),f())},p=c.watchStatus(this,h),f=d.watchStatus(this,h),c.release(this),d.release(this)},c=function(n){var o,r,i,a,u;r=t.emails[n],i=template({email:r}),a=r.person.get("roles"),u=r.person.get("email"),o="managers@webprofy.ru",(a.get("Designer")||a.get("Jr. Designer"))&&(o+=", a.shevtsov@webprofy.ru, a.kolesnikov@webprofy.ru"),a.get("Markuper")&&(o+=", n.skinteev@webprofy.ru, s.yastrebov@webprofy.ru"),console.info("to: ",u),console.info("cc: ",o),e({method:"POST",url:"https://thawing-chamber-8269.herokuapp.com/https://api.mailgun.net/v3/webprofy.ru/messages",data:$.param({to:r.person.get("email"),cc:o,from:"Татьяна Верхотурова <t.verkhoturova@webprofy.ru>",subject:r.title,html:i}),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+s.encode("api:key-3ccadef54df260c8a2903da328ebb165")}}).then(function(e){console.info("ok: ",e),r.status="sent",n+1===t.emails.length?t.state="completed":c(n+1)},function(e){console.error("error: ",e),t.state="error"})},t.sendOut=function(){t.state="inProgress",c(0)}}]},{"../../data/dsDataService":7,"../../models/Person":31,"../../models/Task":36,"../../utils/base64":67}],43:[function(t,e,n){var o;e.exports=(o=angular.module("ui/account/rmsAccount",[t("../../config")])).name,o.run(["$rootScope",function(t){t.isShowAccount=!1,t.showAccount=function(){t.isShowAccount=!t.isShowAccount}}]),o.directive("rmsAccount",["config","$rootScope",function(t,e){return{restrict:"A",scope:!0,link:function(n,o,r){var s;n.$evalAsync(function(){$($("input",o)[1]).select()}),n.url=t.teamwork,n.token=t.token,n.save=function(){var e,o;o=n.url.trim(),e=n.token.trim(),o.length>0&&"/"!==o.charAt(o.length-1)&&(o+="/"),t.teamwork=o,t.token=e,s()},n.close=s=function(){e.isShowAccount=!1}}}}])},{"../../config":2}],44:[function(t,e,n){var o,r,s,i,a;r=t("../dscommon/util").assert,i=t("../dscommon/util").error,o=t("../dscommon/DSObject"),e.exports=(a=angular.module("ui/filters",[])).name,s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a.run(["$rootScope",function(t){t.filter={calendarHeader:function(t,e){var n,a,u,c,l;if(r&&(t instanceof o||i.invalidArg("doc"),(c=t.__proto__.__props).hasOwnProperty(e)||i.invalidArg("prop"),"moment"!==(l=c[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+l);if(!(n=t.get(e)))throw new Error("Non null date expected in the header");return a=moment(n).format("YYYYMMDD"),u=n.month()+1,10>u&&(u="0"+u),s[n.day()]+" "+n.date()+"/<small>"+u+"</small>"},shortDate:function(t,e){var n,s,a;if(r&&(t instanceof o||i.invalidArg("doc"),(s=t.__proto__.__props).hasOwnProperty(e)||i.invalidArg("prop"),"moment"!==(a=s[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+a);return n=t.get(e),n?n.format("DD.MM"):""},taskPeriod:function(e,n,s){var a,u,c,l,d,p;if(r&&e&&(e instanceof o||i.invalidArg("doc"),(l=e.__proto__.__props).hasOwnProperty(n)||i.invalidArg("prop"),"duration"!==(p=l[n].type)))throw new Error("Expected property with type 'duration', but property '"+n+"' has type "+p);return d="",s?(moment.isDuration(s)?(u=Math.floor(s.asHours()),c=s.minutes()):(u=Math.floor((s=s.get("timeMin"))/60),c=s%60),u||c?(d+=u?u+"h ":"",c&&(d+=c+"m")):d+="0"):null===typeof s&&(d+="0"),e&&(a=e.get(n))&&("undefined"!=typeof s&&t.dataService.showTimeSpent&&(d+=" / "),u=Math.floor(a.asHours()),c=a.minutes(),d+=u?u+"h":"",u&&c&&(d+=" "),c&&(d+=c+"m"),d||(d+="0")),d},taskPeriodLight:function(t){var e,n,o;return r&&(moment.isDuration(t)||i.invalidArg("duration")),t?(e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+"h":"",n&&(o+=" "+n+"m"),o||(o="0"),o):""},periodDiff:function(t){var e,n,o,s;return r&&(null===t||moment.isDuration(t)||i.invalidArg("diff")),t&&null!==(s=t.valueOf())?(o=0>s?(t=moment.duration(-s),"- "):"+ ",e=Math.floor(t.asHours()),n=t.minutes(),o+=e+"h",n&&(o+=" "+n+"m"),o||(o="0"),o):""},timeLeft:function(t){var e,n,o,s;return r&&(null===t||moment.isDuration(t)||i.invalidArg("diff")),t&&null!==(s=t.valueOf())?(o=0>s?(t=moment.duration(-s),"- "):"",e=Math.floor(t.asHours()),n=t.minutes(),o+=e+"h "+(10>n?"0"+n:n)+"m"):""},taskEditDueDate:function(t){return r&&t&&!moment.isMoment(t)&&i.invalidArg("date"),t?t.format("DD.MM.YYYY"):""},splitDuration:function(e,n){var o,r,s;return s="",n?(o=Math.floor((n=n.get("timeMin"))/60),r=n%60,o||r?(s+=o?o+"h ":"",r&&(s+=r+"m")):s+="0"):null===typeof n&&(s+="0"),e&&("undefined"!=typeof n&&t.dataService.showTimeSpent&&(s+=" / "),o=Math.floor(e.asHours()),r=e.minutes(),s=o?o+"h":"",r&&(s+=" "+r+"m"),s||(s="0")),s}}}])},{"../dscommon/DSObject":24,"../dscommon/util":30}],45:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h,m;l=t("../dscommon/util").assert,d=t("../dscommon/util").error,e.exports=(f=angular.module("ui/layout",[])).name,i=140,a=730,u=10,c=10,m=900,h=i+c,p=40,s=440,r=440,f.directive("uiLayout",["config","$window","$rootScope",function(t,e,n){return e=$(e),{restrict:"A",controller:["$scope",function(o){var r;o.layout=this,this.area1={},this.area2={},this.area3={},this.width=e.width(),this.area3.height=this.height=e.height()-p,r=function(){n.$digest(),n.$broadcast("layout-update")},(this.setVResizer=function(e,n){var o;o=this.area1.width=this.area2.width=this.vResizer=Math.min(Math.max(Math.round(e),a),this.width-c),this.area3.width=this.width-o,t.set("vResizer",this.area1.width/this.width),n||r()}).call(this,this.width*(t.get("vResizer")||.68),!0),(this.setHResizer=function(e,n){var o;o=this.area1.height=this.hResizer=Math.min(Math.max(Math.round(e),i),this.height-u),this.area2.height=this.height-o,t.set("hResizer",this.area1.height/this.height),n||r()}).call(this,this.height*(t.get("hResizer")||.68),!0),this.setSize=function(t,e,n){var o,s,i;e-=p,o=!1,(i=this.width)!==t&&(o=!0,this.setVResizer(this.vResizer*((this.width=Math.max(t,m))/i),!0)),(s=this.height)!==e&&(o=!0,this.setHResizer(this.hResizer*((this.height=Math.max(e,h))/s),!0),this.area3.height=e),o&&!n&&r()}}],link:function(t,n,o,r){var s;e.on("resize",s=function(){r.setSize(e.width(),e.height())}),t.$on("$destroy",function(){e.off("resize",s)})}}}]),f.directive("uiLayoutResizer",["$document",function(t){return{restrict:"A",require:"^uiLayout",link:function(e,n,o,r){var s,i,a,u;s="horizontal"===o.uiLayoutResizer,n.on("mousedown",u=function(e){e.preventDefault(),t.on("mousemove",i),t.on("mouseup",a)}),i=s?function(t){r.setHResizer(t.pageY-p)}:function(t){r.setVResizer(t.pageX)},a=function(e){t.off("mousemove",i),t.off("mouseup",a)},e.$on("$destroy",function(){t.off("mousedown",u),a()})}}}]),o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(t){this.elem=t},t.prototype.innerHeight=function(){return this.elem.innerHeight()},t}(),f.directive("uiLayoutContainer",["$document",function(t){return{restrict:"A",link:function(t,e,n){t.uiContainer=new o(e)}}}])},{"../dscommon/util":30}],46:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("ui/tasks/TaskSplitWeekView",[t("../../dscommon/DSView")])).name,u=t("../../dscommon/util").assert,o=t("../../dscommon/DSObject"),a=t("../../models/types/TaskSplit"),i=t("../../models/Task"),r=t("../../models/Person"),s=t("../../models/PersonDayStat"),l=t("../time"),c.factory("TaskSplitWeekView",["DSView","$log",function(t,e){var n,i;return n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.begin("DayModel"),e.ds_dstr.push(function(){"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2()}),e.propDuration("timeLeft"),e.propDuration("timeLeftShow"),e.propObj("plan"),e.propDuration("initPlan"),e.propBool("select"),e.end(),e}(o),i=function(e){function o(){return i.apply(this,arguments)}var i;return d(o,e),o.begin("TaskSplitWeekView"),a.addPropType(o),o.propData("personDayStat",s,{mode:"edited"}),o.propList("days",n),o.propMoment("monday"),o.propDoc("responsible",r),o.propMoment("today"),o.propMoment("duedate"),o.propTaskRelativeSplit("split"),i=function(e,o,r,s,i){var c,d,p,f,h,m;u&&(!s instanceof a&&error.invalidArg("split"),moment.isMoment(i)||error.invalidArg("monday")),t.call(this,e,o),this.set("split",s),this.set("monday",i),e.$watch("edit.responsible",function(t){return function(e){t.set("responsible",e),t.__dirty++}}(this)),this.dataUpdate({startDate:i,endDate:moment(i).endOf("week"),mode:e.mode}),h=e.edit.split,m=e.edit.splitDuedate,d=moment(i),this.get("daysList").merge(this,f=function(){var t,o,i;for(t=function(t){return function(t,n){var o;return t.set("initPlan",o=null===h?null:h.get(m,n)),t.set("plan",s.day(r,n)),n.valueOf()===l.today?t.set("select",!0):n>l.today&&(t.__unwatch1=e.$watch("edit.duedate",function(e){t.set("select",null!==e&&e>=n)})),t.__unwatch2=e.$watch(function(){var n,o,r;return[null!=(n=e.$eval("edit.responsible"))?n.$ds_key:void 0,null!=(o=t.get("plan"))?o.val:void 0,null!=(r=t.get("timeLeft"))?r.valueOf():void 0]},function(n){var r,s,i,a,u;a=n[0],s=n[1],u=n[2],"number"!=typeof u?t.set("timeLeftShow",null):(r=moment.duration(u),null!==o&&null!==(i=e.task.get("responsible"))&&i.$ds_key===a&&r.add(o),moment.isDuration(s)&&r.subtract(s),t.set("timeLeftShow",r))},!0)}}(this),i=[],c=o=0;7>o;c=++o)p=new n(this,""+c),t(p,d),(d=moment(d)).add(1,"day"),i.push(p);return i}.call(this))},o.prototype.render=function(){var t,e,n,o,r,s,i,a,c,l,d;if(null===(l=this.get("responsible"))||"ready"!==(d=this.data.get("personDayStatStatus"))&&"update"!==d)for(c=this.get("days"),r=0,i=c.length;i>r;r++)t=c[r],t.set("timeLeft",null);else{if(u&&!this.data.get("personDayStat").hasOwnProperty(l.$ds_key))throw new Error("Missing person");for(e=this.data.get("personDayStat")[l.$ds_key].get("dayStats"),a=this.get("days"),n=o=0,s=a.length;s>o;n=++o)t=a[n],t.set("timeLeft",e[n].get("timeLeft"))}},o.end(),o}(t)}])},{"../../dscommon/DSObject":24,"../../dscommon/DSView":29,"../../dscommon/util":30,"../../models/Person":31,"../../models/PersonDayStat":32,"../../models/Task":36,"../../models/types/TaskSplit":40,"../time":51}],47:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("../../dscommon/util").assert,c=t("../../dscommon/util").error,d=t("../../dscommon/util").serviceOwner,i=t("../../dscommon/DSObject"),s=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSDigest"),o=t("../../models/types/Comments"),a=t("../../models/Person"),e.exports=(l=angular.module("ui/tasks/addCommentAndSave",[t("../../config"),t("../../data/dsDataService"),t("../../data/dsChanges")])).name,l.run(["$rootScope",function(t){t.AddCommentAndSave=null}]),l.factory("addCommentAndSave",["dsDataService","dsChanges","config","$rootScope","$q",function(t,e,n,a,l){var f,h;return f=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.begin("AddCommentAndSave"),n.propDoc("document",s),n.propList("documents",s),n.propObj("changes"),n.propStr("reason",""),n.propBool("plansChange"),n.prototype.show=function(t,e,n){var o,r,i,d,p,f,h,m,g,y,_,v,w;if(u&&(null!==t&&(Array.isArray(t)&&t.length>0&&t[0]instanceof s||t instanceof s)||c.invalidArg("document"),"boolean"!=typeof e&&c.invalidArg("showDialog"),(null===n||"object"!=typeof n)&&c.invalidArg("changes")),this.__deferred=l.defer(),n.hasOwnProperty("plan")&&!n.plan)if(Array.isArray(t)){for(i=0,p=t.length;p>i;i++)if(r=t[i],r.get("plan")){m=this.set("plansChange",!0);break}}else t.get("plan")&&(m=this.set("plansChange",!0));if(Array.isArray(t)){for(d=0,f=t.length;f>d;d++)r=t[d],r.addRef(this);this.get("documentsList").merge(this,t),t=this.set("document",t[0])}else this.set("document",t);h=[],o=!1,v=t.__props;for(_ in v)if(y=v[_],n.hasOwnProperty(_)){if(!t.$u.hasOwnProperty(_)){console.error("Doc "+t.toString()+": Prop "+_+": Property is not editable");continue}if("undefined"==typeof y.valid(w=n[_])){console.error("Doc "+t.toString()+": Prop "+_+": Invalid value '"+w+"'");continue}y.equal(t.get(_),w=n[_])||(o=!0,h.push({propName:_,value:w,text:null===w?"-":y.str(w)})),delete n[_]}for(_ in n)console.error("Doc "+t.toString()+": Has no property '"+_+"'");return g=this.__deferred.promise,o?(this.set("changes",h),e||m?a.addCommentAndSave=this:(this.saveWOComment(),this.freeDocs())):(this.set("document",null),this.get("documentsList").merge(this,[]),this.__deferred.resolve(!0),delete this.__deferred),g},n.prototype.save=function(){this.addCommentAndSave(),a.addCommentAndSave=null},n.prototype.cancel=function(){this.freeDocs(),a.addCommentAndSave=null,this.__deferred.resolve(!1),delete this.__deferred},n.prototype.freeDocs=function(){this.set("reason",""),this.set("document",null),this.get("documentsList").merge(this,[]),this.set("changes",null)},n.prototype.addCommentAndSave=function(){r.block(function(t){return function(){var n,r,s,i,a,u,c,l,d,p,f,h,m;(a=e.get("hist")).startBlock();try{for(s=t.get("document"),0===(i=t.get("documents")).length&&(i=null),
h=t.get("changes"),u=0,d=h.length;d>u;u++)if(n=h[u],i)for(c=0,p=i.length;p>c;c++)s=i[c],s.set(n.propName,n.value);else s.set(n.propName,n.value);if((r=t.get("reason").trim()).length>0)if(m=function(t){var e;e=null===(e=t.get("comments"))?new o:e.clone(),e.add(r),t.set("comments",e)},i)for(l=0,f=i.length;f>l;l++)s=i[l],m(s);else m(s)}finally{a.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.prototype.saveWOComment=function(){r.block(function(t){return function(){var n,o,r,s,i,a,u,c,l;(s=e.get("hist")).startBlock();try{for(o=t.get("document"),0===(r=t.get("documents")).length&&(r=null),l=t.get("changes"),i=0,u=l.length;u>i;i++)if(n=l[i],r)for(a=0,c=r.length;c>a;a++)o=r[a],o.set(n.propName,n.value);else o.set(n.propName,n.value)}finally{s.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.end(),n}(i),h=new f(d,"addCommentAndSave"),function(t,e,n){return h.show(t,e,n)}}])},{"../../config":2,"../../data/dsChanges":6,"../../data/dsDataService":7,"../../dscommon/DSDigest":20,"../../dscommon/DSDocument":21,"../../dscommon/DSObject":24,"../../dscommon/util":30,"../../models/Person":31,"../../models/types/Comments":39}],48:[function(t,e,n){var o;e.exports=(o=angular.module("ui/tasks/rmsTask",[])).name,o.run(["$rootScope",function(t){t.modal={type:null}}]),o.directive("rmsTask",["$rootScope","$timeout",function(t,e){return{restrict:"A",require:"ngModel",link:function(n,o,r,s){o.on("click",function(n){var r;n.stopPropagation(),"task-edit"!==(r=t.modal).type?(t.modal={type:"task-edit",task:s.$viewValue,pos:o.offset()},t.$digest()):r.task!==s.$viewValue&&(t.modal={type:null},t.$digest(),e(function(){t.modal={type:"task-edit",task:s.$viewValue,pos:o.offset()}},0))}),o.on("mouseover",function(e){e.stopPropagation(),0<=["task-info",null].indexOf(t.modal.type)&&(t.modal={type:"task-info",task:s.$viewValue,pos:o.offset()},t.$digest())}),o.on("mouseleave",function(e){e.stopPropagation(),0<=["task-info"].indexOf(t.modal.type)&&(t.modal={type:null},t.$digest())}),n.$watch(r.rmsTask+".$u",function(e){var s;e?(s=o[0],s.draggable=!0,s.addEventListener("dragstart",function(e){t.modal={type:"drag-start",task:n.$eval(r.rmsTask),scope:n},o.addClass("drag-start"),t.$digest(),e.dataTransfer.setDragImage($("#task-drag-ghost")[0],20,20)}),o.on("dragend",function(e){t.modal={type:null},o.removeClass("drag-start"),t.$digest()})):(s=o[0],s.draggable=!1,s.removeEventListener("dragstart"),o.off("dragend"))})}}}]),o.directive("setTaskVisible",[function(){return{restrict:"A",link:function(t,e,n){var o;o=n.setTaskVisible,t.$eval(o+".setVisible(true)"),t.$on("$destroy",function(){t.$eval(o+".setVisible(false)")})}}}])},{}],49:[function(t,e,n){var o,r,s,i,a,u,c,l;e.exports=(u=angular.module("ui/tasks/rmsTaskEdit",[t("../../data/dsChanges"),t("../../data/dsDataService"),t("./TaskSplitWeekView"),t("./addCommentAndSave")])).name,a=t("../../dscommon/util").assert,l=t("../../ui/time"),o=t("../../dscommon/DSDigest"),r=t("../../models/Person"),i=t("../../models/types/TaskSplit"),s=t("../../models/PersonDayStat"),c=3,u.directive("rmsTaskEdit",["TaskSplitWeekView","dsDataService","dsChanges","addCommentAndSave","$rootScope","$window","$timeout",function(t,e,n,o,u,d,p){return{restrict:"A",scope:!0,link:function(n,d,p){var f,h,m,g,y,v,w,S,D,k,b,T,O,P;return w=u.modal,n.edit=m={},O=null,S=function(e){return new t(n,"TaskSplitWeekView "+e.format(),function(){return m.splitDuedate},m.split,e)},v=function(){var t,e,o;t=m.firstWeek,m.splitView=function(){var n,r,s;for(s=[],o=n=0,r=c;r>=0?r>n:n>r;o=r>=0?++n:--n)e=S(t),(t=moment(t)).add(1,"week"),s.push(e);return s}(),O=n.$watch(function(){var t;return null!=(t=m.split.lastDate(m.splitDuedate))?t.valueOf():void 0},function(t){var e;m.split.shift(e=moment(t),m.splitDuedate),m.splitDuedate=e})},D=function(){var t,e,o,r;for(o=m.splitView,t=0,e=o.length;e>t;t++)r=o[t],r.release(n);m.splitView=null,O()},n.$evalAsync(function(){$($("input",d)[1]).select()}),n.people=_.map(r.pool.items,function(t){return t}),n.task=b=w.task,n.$watch(function(){return l.today.valueOf()},function(){return n.today=l.today}),m.title=b.get("title"),m.duedate=h=b.get("duedate"),m.estimate=b.get("estimate"),m.responsible=b.get("responsible"),m.splitDiff=null,m.firstWeek=T=moment().startOf("week"),m.splitDuedate=null!==h?h:moment().startOf("day"),(m.isSplit=null!==(m.split=null!==(k=b.get("split"))?k.clone():null))?(g=moment(k.firstDate(h)).startOf("week"),y=moment(k.lastDate(h)).startOf("week"),(P=moment.duration(y.diff(g)).asWeeks())<c?g.isBefore(T)?m.firstWeek=g:moment.duration(y.diff(T)).asWeeks()<=c||(m.firstWeek=y.subtract(c-1,"week")):m.firstWeek=g,v()):m.splitView=null,(n.viewonly=!b.$u||_.isEmpty(b.$u))||(n.changes=!1,n.$watch(function(){var t,e,n,o;return e=[m.title,null===(h=m.duedate)?null:h.valueOf(),null===(t=m.estimate)?null:t.valueOf(),null===(n=m.responsible)?null:n.$ds_key],null!==(k=m.split)&&(o=k.valueOf()).length>0&&(e=e.concat(o)),e},function(t,e){n.changes=t!==e},!0),n.$watch(function(){return m.isSplit},function(t){var e;t?(null===m.split&&(m.split=new i),null===m.splitView&&v()):null!==m.splitView&&D(),(null!=(e=m.split)?e.valueOf().length:void 0)>0&&(n.changes=!0)}),n.$watch(function(){var t;return null!=(t=m.duedate)?t.valueOf():void 0},function(t,e){t!==e&&(n.changes=!0,null!==m.split&&null!==t&&null!==e&&m.splitDuedate.add(t-e))}),n.$watch(function(){var t;return[null!=(t=m.estimate)?t.valueOf():void 0,m.isSplit,m.split]},function(t){var e,n,o,r,s,i;e=t[0],n=t[1],s=t[2],"number"==typeof e&&n&&null!==s?(r=(o=moment.duration(s.total).subtract(e)).valueOf(),m.splitDiff=0===r||null!==(i=m.splitDiff)&&i.valueOf()===r?null:o):m.splitDiff=null},!0),n.splitPrevWeek=function(){m.firstWeek.subtract(1,"week"),m.splitView.unshift(S(m.firstWeek)),m.splitView.pop().release(n)},n.splitNextWeek=function(){var t;t=moment(m.firstWeek.add(1,"week")).add(c-1,"week"),m.splitView.push(S(t)),m.splitView.shift().release(n)}),n.close=f=function(){u.modal={type:null}},n.save=function(t,e){var n,r,s,i;a&&"undefined"!=typeof e&&"boolean"!=typeof e&&error.invalidArg("plan"),m.isSplit&&m.split.list.length>0&&(m.duedate=m.splitDuedate,s=k.total,null===(r=m.estimate)?m.estimate=s:0!==(n=r.valueOf()-s.valueOf())&&k.fixEstimate(n)),i={title:m.title,duedate:m.duedate,estimate:m.estimate,responsible:m.responsible,split:m.isSplit&&m.split.valueOf().length>0?m.split:null},"boolean"==typeof e&&(i.plan=e),o(b,t.shiftKey,i).then(function(t){t&&f()})},n.showTimeLeft=function(t){var e,o,r,s,i,a,u,c;return null===(u=t.get("timeLeft"))?"":(i=t.get("plan"),r=t.get("initPlan"),e=moment.duration(u),null!==r&&n.task.get("responsible")===m.responsible&&e.add(r),null!==(c=i.val)&&e.subtract(c),a=(c=e.valueOf())<0?(e=moment.duration(-c),"- "):"",o=Math.floor(e.asHours()),s=e.minutes(),a+=o+"h "+(10>s?"0"+s:s)+"m")},n.$on("$destroy",function(){"function"==typeof n._unwatch&&n._unwatch()}),n.autoSplitInProgress=!1,n.autoSplit=function(){var t,o,r,i,u,c,d,p;if(a){if(!(null!==m.duedate&&l.today<=m.duedate))throw new Error("Invalid duedate: "+(null!=(u=m.duedate)?u.format():void 0));if(null===m.responsible)throw new Error("Invalid value 'edit.responsible': "+m.responsible);if(!(null!==m.estimate&&m.estimate>0))throw new Error("Invalid value 'edit.estimate': "+(null!=(c=m.estimate)?c.valueOf():void 0))}n.autoSplitInProgress=!0,d=m.responsible.$ds_key,t=moment(h=m.duedate),o=moment.duration(m.estimate),(k=m.split).clear(),m.splitDuedate=moment(t),r=n.task.get("duedate"),i=null!==r&&n.edit.responsible===n.task.get("responsible")?n.task.get("split"):null,(p=function(){var a,u;a=e.findDataSet(n,{type:s,mode:"edited",startDate:u=moment(t).startOf("week"),endDate:moment(t).endOf("week")}),n._unwatch=a.watchStatus(n,function(e,s,a,c){var f,m,g,y,_;if("ready"===s){for(m=e.items[d].get("dayStats");o>0&&l.today<=t&&t>=u;)_=(f=m[moment.duration(t.diff(u)).asDays()]).timeLeft,null!==i&&null!==(y=i.get(r,t))&&(_=moment.duration(_)).add(y),_>0&&(k.set(h,t,g=moment.duration(Math.min(_.valueOf(),o.valueOf()))),o.subtract(g)),t.subtract(1,"day");c(),delete n._unwatch,o>0&&l.today<=t?(t.subtract(2,"days"),p()):n.autoSplitInProgress=!1}}),a.release(n)})()}}}}])},{"../../data/dsChanges":6,"../../data/dsDataService":7,"../../dscommon/DSDigest":20,"../../dscommon/util":30,"../../models/Person":31,"../../models/PersonDayStat":32,"../../models/types/TaskSplit":40,"../../ui/time":51,"./TaskSplitWeekView":46,"./addCommentAndSave":47}],50:[function(t,e,n){var o,r,s,i;e.exports=(i=angular.module("ui/tasks/rmsTaskInfo",[])).name,r=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),i.directive("rmsTaskInfo",["$rootScope","$window",function(t,e){return{restrict:"A",scope:!0,link:function(e,n,o){var r;r=t.modal,$(window).height()>r.pos.top+150?e.top=Math.ceil(r.pos.top+50):e.top=Math.ceil(r.pos.top-100),$(window).width()-$("#sidebar").innerWidth()>r.pos.left?e.left=Math.ceil(r.pos.left+95):e.left=Math.ceil(r.pos.left-300),e.task=r.task}}}])},{"../../dscommon/DSObject":24,"../../dscommon/util":30}],51:[function(t,e,n){var o,r;e.exports=o={today:moment().startOf("day"),historyLimit:moment().startOf("week").subtract(2,"weeks")},(r=function(){setTimeout(function(){o.today=moment().startOf("day"),r()},moment().startOf("day").add(1,"day").add(20,"seconds").valueOf()-(new Date).getTime())})()},{}],52:[function(t,e,n){var o,r,s,i,a,u,c;s=t("../dscommon/util").assert,i=t("../dscommon/util").error,u=t("../dscommon/util").totalRelease,o=t("../dscommon/DSObjectBase"),r=t("../models/PersonDayStat"),e.exports=(a=angular.module("ui/ui",["ui.router","ngSanitize",t("./views/view1/View1"),t("./views/view2/View2"),t("./views/view3/View3"),t("./views/changes/ViewChanges"),t("./account/rmsAccount"),t("./widgets/widgetDate"),t("./widgets/widgetDuration"),t("./tasks/rmsTask"),t("./tasks/rmsTaskEdit"),t("./tasks/TaskSplitWeekView"),t("./tasks/rmsTaskInfo"),t("./tasks/addCommentAndSave"),t("./layout"),t("./filters")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,o){e.state({name:"/",url:"/",templateUrl:function(){return"./ui/main.html"},controller:c}),u&&e.state({name:"totalRelease",url:"/totalRelease",templat:"<div/>"})}]),u&&a.run(["$state","$rootScope",function(t,e){var n;return n=window.totalRelease,window.totalRelease=function(){t.go("totalRelease"),e.$evalAsync(function(){n(),setTimeout(function(){console.info(window.totalPool)},1e3)})}}]),c=["$rootScope","$scope",function(t,e){e.mode="edited",e.setMode=function(t){e.mode=t},e.sidebarTabs={active:0,clickSideBarTab:function(t){this.active=t}},e.taskSummaryColor=function(t){var e;return s&&(t instanceof r.DayStat||i.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?"red":e/t.get("contract").valueOf()<=.2?"green":"light-yellow"},e.dayTaskWidth=function(t){var e;return s&&(t instanceof r.DayStat||i.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?100:Math.round(100*(1-e/t.get("contract").valueOf()))},e.taskViewExpand=function(t){e.period.people[t].tasks.expand=!e.period.people[t].tasks.expand}}]},{"../dscommon/DSObjectBase":25,"../dscommon/util":30,"../models/PersonDayStat":32,"./account/rmsAccount":43,"./filters":44,"./layout":45,"./tasks/TaskSplitWeekView":46,"./tasks/addCommentAndSave":47,"./tasks/rmsTask":48,"./tasks/rmsTaskEdit":49,"./tasks/rmsTaskInfo":50,"./views/changes/ViewChanges":53,"./views/view1/View1":55,"./views/view2/View2":59,"./views/view3/View3":60,"./widgets/widgetDate":63,"./widgets/widgetDuration":64}],53:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("ui/views/changes/ViewChanges",[t("../../../data/dsChanges"),t("../../../dscommon/DSView")])).name,u=t("../../../dscommon/util").assert,s=t("../../../dscommon/DSObject"),r=t("../../../dscommon/DSDigest"),a=t("../../../models/Task"),i=t("../../../models/Person"),o=t("./models/Change"),c.run(["$rootScope",function(t){t.showChanges=function(){t.modal="changes"!==t.modal.type?{type:"changes"}:{type:null}}}]),c.controller("ViewChanges",["$scope","ViewChanges","dsChanges","$rootScope",function(t,e,n,o){t.view=new e(t,"viewChanges"),t.save=function(){n.save().then(function(t){t&&(o.modal={type:null})})},t.reset=function(){n.reset(),o.modal={type:null}}}]),c.directive("viewChangesFix",[function(){return{restrict:"A",link:function(t,e,n){var o,r;r=$(".main-table.header",e),o=$(".main-table.data",e),r.width(o.width())}}}]),c.factory("ViewChanges",["DSView","dsChanges","$log",function(t,e,n){var s;return s=function(n){function s(){return i.apply(this,arguments)}var i;return l(s,n),s.begin("ViewChange"),s.propData("tasks",a,{mode:"changes"}),s.propPool("poolChanges",o),s.propList("changes",o),i=function(e,n){t.call(this,e,n),this.dataUpdate({})},s.ds_dstr.push(function(){var t,e,n;t=this.get("data").get("tasksSet").items;for(n in t)e=t[n],delete e.__change.__refreshView}),s.prototype.render=function(){var t,n,o,s,i,a,u,c,l,d,p,f,h,m,g,y,_,v,w;if("ready"!==(v=this.get("data").get("tasksStatus"))&&"update"!==v)return void this.get("changesList").merge(this,[]);a=this.get("poolChanges"),n=[],d=(_=this.get("data").get("tasksSet")).type.prototype.__props,s=!1,h=function(t){return function(){t.__dirty++}}(this),p=_.items;for(y in p){g=p[y],s=!s,i=!0,g.__change.__refreshView=h,m=function(t){return function(){var n;(n=e.get("hist")).startBlock();try{r.block(function(){var e,n,o;o=t.__change;for(n in o)e=o[n],"__error"!==n&&"__refreshView"!==n&&t.set(n,t.$ds_doc.get(n))})}finally{n.endBlock()}h()}}(g),f=g.__change;for(l in f)c=f[l],"__error"!==l&&"__refreshView"!==l&&"comments"!==l&&(u=d[l],n.push(t=a.find(this,g.$ds_key+"."+l)),t.set("isDark",s),i&&(i=!1,t.set("doc",g)),t.set("prop",l),t.set("value",null===(w=c.v)?" -":u.str(c.v)),t.set("conflict",u.equal(o=g.$ds_doc.get(l),c.s)?null:null===o?" -":u.str(o)),m&&(t.remove=m,m=null));g.__change.__error&&(n.push(t=a.find(this,g.$ds_key+".__error")),t.set("isDark",s),t.set("error",g.__change.__error))}this.get("changesList").merge(this,n)},s.end(),s}(t)}])},{"../../../data/dsChanges":6,"../../../dscommon/DSDigest":20,"../../../dscommon/DSObject":24,"../../../dscommon/DSView":29,"../../../dscommon/util":30,"../../../models/Person":31,"../../../models/Task":36,"./models/Change":54}],54:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../../../dscommon/util").assert,a=t("../../../../dscommon/util").error,s=t("../../../../dscommon/DSObject"),r=t("../../../../dscommon/DSDocument"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("Change"),e.propDoc("doc",r),e.propStr("prop"),e.propStr("value"),e.propStr("conflict"),e.propStr("error"),e.propBool("isDark"),e.end(),e}(s)},{"../../../../dscommon/DSDocument":21,"../../../../dscommon/DSObject":24,"../../../../dscommon/util":30}],55:[function(t,e,n){var o,r,s,i,a,u,c,l,d,p,f,h=function(t,e){function n(){this.constructor=t}for(var o in e)m.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty;e.exports=(f=angular.module("ui/views/view1/View1",[t("../../../config"),t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../dscommon/DSView"),t("../../tasks/addCommentAndSave")])).name,p=t("../../../dscommon/util").assert,o=t("../../../dscommon/DSDigest"),l=t("../../../models/Task"),c=t("../../../models/Tag"),s=t("../../../models/Person"),i=t("../../../models/PersonDayStat"),a=t("../../../models/PersonTimeTracking"),r=t("./models/Day"),u=t("./models/Row"),d=t("./models/TaskView"),f.controller("View1",["$scope","View1","$rootScope",function(t,e,n){n.view1=t.view=new e(t,"view1"),t.$on("$destroy",function(){delete n.view1}),t.expandedHeight=function(t){return t.expand?_.isEmpty(t.tasks)?"height:100px":"height:"+(65*_.max(t.tasks,"y").y+98)+"px":""}}]),f.factory("View1",["DSView","config","$rootScope","$log",function(t,e,n,o){var c;return c=function(o){function c(){return d.apply(this,arguments)}var d,p,f;return h(c,o),c.begin("View1"),c.propData("people",s,{watch:["roles","companyId"]}),c.propData("tasks",l,{filter:"assigned",watch:["responsible","duedate","split"]}),c.propData("personDayStat",i,{}),c.propData("personTimeTracking",a,{watch:[]}),c.propMoment("startDate"),c.propList("days",r),c.propPool("poolRows",u),c.propList("rows",u),c.propObj("hiddenPeople",{}),c.propNum("hiddenPeopleCount",0),c.ds_dstr.push(function(){this.__unwatchA(),this.__unwatchB(),this.__unwatchC()}),d=function(o,r){var s,i,a,u,c,l,d,p,f;if(t.call(this,o,r),this.scope=o,this.set("startDate",moment().startOf("week")),o.filterLoad=[o.selectedLoad={id:0,name:"All"},{id:-1,name:"Underload"},{id:1,name:"Overload"}],f=e.get("selectedLoad"))for(l=o.filterLoad,i=0,u=l.length;u>i;i++)s=l[i],s.id===f&&(o.selectedLoad=s);if(e.hasRoles&&(o.filterCompanies=[{id:null,name:"All"},o.selectedCompany={id:23872,name:"WebProfy"},{id:50486,name:"Freelancers"}],p=e.get("selectedCompany")))for(d=o.filterCompanies,a=0,c=d.length;c>a;a++)s=d[a],s.id===p&&(o.selectedCompany=s);this.__unwatchA=o.$watch(function(t){return function(){var e;return[null!=(e=t.get("startDate"))?e.valueOf():void 0,o.mode,o.dataService.showTimeSpent]}}(this),function(t){return function(e){var n,o,r;r=e[0],n=e[1],o=e[2],t.dataUpdate({startDate:moment(r),endDate:moment(r).add(6,"days"),mode:n,showTimeSpent:o})}}(this),!0),this.__unwatchB=o.$watch(function(){return[o.selectedRole,o.selectedCompany,o.selectedLoad]},function(t){return function(o){var r,s,i;return i=o[0],r=o[1],s=o[2],n.peopleRoles&&e.set("selectedRole",i?i.role:null),e.set("selectedCompany",r?r.id:null),e.set("selectedLoad",s?s.id:0),t.__dirty++}}(this),!0),this.__unwatchC=o.$watch(function(t){return function(){return[e.get("currentUserId"),t.get("data").get("peopleStatus")]}}(this),function(t){return function(n){var o,r;return o=n[0],r=n[1],null===o||"ready"!==r&&"update"!==r?void e.set("currentUser",null):void e.set("currentUser",t.get("data").get("people")[o])}}(this),!0)},c.prototype.periodChange=function(t){this.set("startDate",this.startDate.add(t,"week"))},c.prototype.hideRow=function(t){this.get("hiddenPeople")[t.$ds_key]=!0,this.hiddenPeopleCount++,this.__dirty++},c.prototype.unhideAll=function(){this.set("hiddenPeople",{}),this.hiddenPeopleCount=0,this.__dirty++},c.prototype.render=function(){var t,n,o,s,i,a,u,l,d,p,f,h,m,g,y,v,w,S,D,k,b,T,O,P,$,A,j,C,M,L,R,x;if("ready"!==(m=this.get("data").get("peopleStatus"))&&"update"!==m)return void this.get("rowsList").merge(this,[]);C=this.get("startDate"),n=this.get("daysList").merge(this,_.map([0,1,2,3,4,5,6],function(t){return function(e,n){var o,s;return o=moment(C).add(e,"days"),s=new r(t,o.format()),s.set("date",o),s.set("index",n),s.set("x",e),s}}(this))),u=function(){return!0},l=this.get("hiddenPeople");for(p in l){u=function(t){return!l.hasOwnProperty(t.$ds_key)};break}if(e.get("hasRoles")){if((null!=(D=this.scope.selectedCompany)?D.id:void 0)?(t=this.scope.selectedCompany.id,s=u,u=function(e){return s(e)&&e.get("companyId")===t}):s=u,null!=(k=this.scope.selectedRole)?k.role:void 0)if(j=this.scope.selectedRole,i=u,j.hasOwnProperty("roles")){for(P={},b=j.roles.split(","),d=0,f=b.length;f>d;d++)S=b[d],P[S.trim()]=!0;u=function(t){var e;return i(t)&&(null!=(e=t.get("roles"))?e.any(P):void 0)}}else if(j.hasOwnProperty("special"))switch(j.special){case"notSupervisors":u=function(t){var e;return i(t)&&(null===(e=t.get("roles"))||!e.get("Manager"))};break;default:console.error("Unexpected role.special value: "+O.special,j)}else O=j.role,u=function(t){var e;return i(t)&&(null!=(e=t.get("roles"))?e.get(O):void 0)};if(0!==(null!=(T=this.scope.selectedLoad)?T.id:void 0)){if("ready"!==this.get("data").get("personDayStatStatus"))return;g=this.get("data").get("personDayStat"),h=1===this.scope.selectedLoad.id?function(t){var e,n,o,r;for(r=g[t.$ds_key].get("dayStats"),n=0,o=r.length;o>n;n++)if(e=r[n],e.get("timeLeft")<0)return!0;return!1}:function(t){var e,n,o,r;for(r=g[t.$ds_key].get("dayStats"),n=0,o=r.length;o>n;n++)if(e=r[n],e.get("timeLeft").valueOf()/e.get("contract").valueOf()>.2)return!0;return!1},a=u,u=function(t){return a(t)&&h(t)}}}A=_.filter(this.data.get("people"),u),A.sort(function(t,e){var n,o;return(n=t.name.toLowerCase())<(o=e.name.toLowerCase())?-1:n>o?1:0}),w=this.get("poolRows"),$=this.get("rowsList").merge(this,_.map(A,function(t){return function(e){var n;return n=w.find(t,e.$ds_key),n.set("person",e),n}}(this))),o=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),x=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),"ready"!==(L=this.get("data").get("tasksStatus"))&&"update"!==L||"ready"!==(y=this.get("data").get("personDayStatStatus"))&&"update"!==y?_.forEach($,function(t){return function(e){e.get("tasksList").merge(t,[]),e.set("personDayStat",null)}}(this)):(M=_.groupBy(this.data.tasks,function(t){return t.get("responsible").$ds_key}),R=null,"ready"===this.data.personTimeTrackingStatus&&(x=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),R=_.groupBy(v=this.data.personTimeTracking,function(t){return t.get("personId")})),_.forEach($,function(t){return function(e){var n,r,s,i,a,u,l,d,p,f,h,m,y,w,S,D,k,b,T,O,P,$,A,j;for(e.set("personDayStat",g=t.data.get("personDayStat")[e.$ds_key]),S=r=g.get("dayStats"),u=l=0,d=S.length;d>l;u=++l)i=S[u],o[u].add(i.get("tasksTotal"));if(P=e.get("tasksPool"),b={},O=_.map(M[e.$ds_key],function(n){var o,r,s,i,a,u,c,l,d,p;if(d=P.find(t,n.$ds_key),d.set("task",n),R)if(c=n.get("split"))for(r=n.get("duedate"),l=(s=c.firstDate(r))<=C?0:moment.duration(s.diff(C)).asDays(),u=t.get("days").slice(l,7),a=0,i=u.length;i>a;a++)o=u[a],(p=v[e.$ds_key+"-"+n.$ds_key+"-"+o.get("date").valueOf()])&&(b[p.$ds_key]=!0);else(p=v[e.$ds_key+"-"+n.$ds_key+"-"+n.get("duedate").valueOf()])?(b[p.$ds_key]=!0,d.set("time",p)):d.set("time",null);return d}),R&&(A=R[e.$ds_key])){for(m=0,p=A.length;p>m;m++)$=A[m],b[$.$ds_key]||(O.push(T=P.find(t,$.$ds_key)),T.set("time",$));for(j=_.groupBy(A,function(t){return t.get("date").valueOf()}),D=g.get("dayStats"),u=y=0,f=D.length;f>y;u=++y)n=D[u],(s=j[n.get("day").valueOf()])?x[u].add(n.set("timeSpent",_.reduce(s,function(t,e){return t.add(e.get("timeMin"),"m")},moment.duration()))):n.set("timeSpent",null)}else for(k=g.get("dayStats"),w=0,h=k.length;h>w;w++)n=k[w],n.set("timeSpent",null);e.get("tasksList").merge(t,O),a=null,R&&(a=function(t,n){return($=v[e.$ds_key+"-"+t.get("task").$ds_key+"-"+n.valueOf()])?$:null}),c.layoutTaskView(C,O,a)}}(this))),_.forEach(n,function(t,e){t.set("workTime",o[e]),t.set("timeSpent",0===x[e].valueOf()?null:x[e])})},f=function(t,e){var n,o,r,s,i,a;return r=t.get("task"),a=e.get("task"),null===r&&null===a?t.get("time").get("taskId")-e.get("time").get("taskId"):null===r?1:null===a?-1:(n=null===(o=(r=t.get("task")).get("split"))?1:moment.duration(moment(o.lastDate(r.get("duedate"))).diff(o.startDate)).asDays(),s=null===(i=(a=e.get("task")).get("split"))?1:moment.duration(moment(i.lastDate(a.get("duedate"))).diff(i.startDate)).asDays(),n!==s?n-s:a.get("id")-r.get("id"))},p=function(t,e,n,o,r){var s,i,a,u,c,l,d,p,f,h,m,g,y,_,v,w;if(e.set("x",o),i=t[o],0===o)w=i.length;else for(w=u=0,d=i.length;d>u&&(_=i[w],"undefined"!=typeof _);w=++u);if(e.set("y",w),null===(g=e.get("task"))||null===(m=g.get("split")))e.set("split",null),e.set("len",1),w===i.length&&i.length++,i[w]=!0;else for(l=e.set("len",Math.min(moment.duration(moment(m.lastDate(g.get("duedate"))).diff(n)).asDays()+1,7-o)),v=e.set("split",[]),h=c=0,f=l;f>=0?f>c:c>f;h=f>=0?++c:--c)s=0===h?n:moment(n).add(h,"day"),y=r?r(e,s):null,(null!==(p=m.get(g.duedate,s))||null!==y)&&v.push({x:h,plan:p,time:y}),(a=t[o+h]).length<=w&&(a.length=w),a[w]=!0;return w},c.layoutTaskView=function(t,e,n){var o,r,s,i,a,u,c,l,d,h,m,g;if(c=0,_.some(e,function(t){var e;return null!=(e=t.get("task"))?e.get("split"):void 0}))for(m=_.groupBy(e,function(t){var e,n,o;return(o=t.get("task"))?(e=o.get("duedate"),(null!==(n=o.get("split"))?n.firstDate(e):e).valueOf()):t.get("time").get("date").valueOf()}),l=function(){var t,e;for(e=[],i=t=0;6>=t;i=++t)e.push([]);return e}(),s=function(){var t;t=[];for(d in m)t.push(+d);return t}().sort(),a=0,u=s.length;u>a;a++)o=s[a],(g=m[o]).sort(f),r=moment.duration((h=moment(o)).diff(t)).asDays(),0>r&&(r=0,h=t),_.forEach(g,function(t){c=Math.max(c,p(l,t,h,r,n))});else m=_.groupBy(e,function(t){var e;return((e=t.get("time"))?e.get("date"):t.get("task").get("duedate")).valueOf()}),_.forEach(m,function(e,n){var o,r;r=moment.duration(((o=e[0].get("time"))?o.get("date"):e[0].get("task").get("duedate")).diff(t)).asDays(),e.sort(function(t,e){var n,o;return n=t.get("task"),o=e.get("task"),null===n&&null===o?t.get("time").get("taskId")-e.get("time").get("taskId"):null===n?1:null===o?-1:o.get("id")-n.get("id")}),_.forEach(e,function(t,e){t.set("x",r),c=Math.max(c,t.set("y",e)),t.set("len",1),t.set("split",null)})});return c},c.end(),c}(t)}]),f.directive("rmsView1DropTask",["View1","$rootScope","dsChanges","addCommentAndSave",function(t,e,n,o){return{restrict:"A",scope:!0,link:function(n,r,s){r.on("dragover",function(t){return!1}),r.on("drop",function(s){var i,a,u,c,l,d;return a=_.findIndex($(".drop-zone",r),function(t){var e;return e=$(t),e.offset().left+e.width()>=s.originalEvent.clientX}),s.ctrlKey&&(c=(u=e.modal).scope).view instanceof t&&!u.task.split?(i=c.taskView.x,d=function(){var t,e,n,o;for(n=c.row.get("tasks"),o=[],t=0,e=n.length;e>t;t++)l=n[t],l.split||l.x!==i||l.task.plan||l.task.get("project")!==u.task.get("project")||o.push(l.get("task"));return o}()):d=[e.modal.task],0>a?o(d,s.shiftKey,{responsible:n.row.get("person"),plan:!1}):o(d,s.shiftKey,{responsible:n.row.get("person"),duedate:n.view.get("days")[a].get("date"),plan:!1}),e.$digest(),!1})}}}]),f.directive("rmsView1MouseOverWeekChange",["View1","$rootScope","dsChanges","addCommentAndSave",function(t,e,n,o){return{restrict:"A",link:function(t,n,o){var r,s;return r=t.$eval(o.rmsView1MouseOverWeekChange),s=0,n.on("dragover",function(t){return t.timeStamp>s&&(s=t.timeStamp+5e3,e.view1.periodChange(r),e.$digest()),!1})}}}])},{"../../../config":2,"../../../data/dsChanges":6,"../../../data/dsDataService":7,"../../../dscommon/DSDigest":20,"../../../dscommon/DSView":29,"../../../dscommon/util":30,"../../../models/Person":31,"../../../models/PersonDayStat":32,"../../../models/PersonTimeTracking":33,"../../../models/Tag":35,"../../../models/Task":36,"../../tasks/addCommentAndSave":47,"./models/Day":56,"./models/Row":57,"./models/TaskView":58}],56:[function(t,e,n){var o,r,s=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;o=t("../../../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("Day"),e.propMoment("date"),e.propNum("index"),e.propNum("x"),e.propDuration("workTime"),e.propDuration("timeSpent"),e.end(),e}(o)},{"../../../../dscommon/DSObject":24}],57:[function(t,e,n){var o,r,s,i,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;u=t("../../../../dscommon/util").assert,c=t("../../../../dscommon/util").error,o=t("../../../../dscommon/DSObject"),r=t("../../../../models/Person"),s=t("../../../../models/PersonDayStat"),a=t("./TaskView"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.begin("Row"),e.propPool("tasksPool",a),e.propDoc("person",r),e.propDoc("personDayStat",s),e.propList("tasks",a),e.propBool("expand",!1),e.end(),e}(o)},{"../../../../dscommon/DSObject":24,"../../../../dscommon/util":30,"../../../../models/Person":31,"../../../../models/PersonDayStat":32,"./TaskView":58}],58:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../dscommon/DSObject"),a=t("../../../../dscommon/util").validate,s=t("../../../../models/Task"),r=t("../../../../models/PersonTimeTracking"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskView"),e.propDoc("task",s),e.propDoc("time",r),e.propNum("x",0,a.required),e.propNum("y",0,a.required),e.propNum("len",1,a.required),e.propObj("split"),e.end(),e}(o)},{"../../../../dscommon/DSObject":24,"../../../../dscommon/util":30,"../../../../models/PersonTimeTracking":33,"../../../../models/Task":36}],59:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("ui/views/view2/View2",[t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../dscommon/DSView"),t("../view1/View1"),t("../../tasks/addCommentAndSave")])).name,i=t("../../../dscommon/util").assert,o=t("../../../dscommon/DSDigest"),r=t("../../../models/Task"),s=t("../view1/models/TaskView"),a.controller("View2",["$scope","View2",function(t,e){t.view=new e(t,"view2"),t.tasksHeight=function(t){return!t.expand||_.isEmpty(t.tasks)?"":"height:"+(52*_.max(t.tasks,"y").y+100)+"px"}}]),a.factory("View2",["View1","DSView","$rootScope","$log",function(t,e,n,o){var i;return i=function(n){function o(){return i.apply(this,arguments)}var i;return u(o,n),o.begin("View2"),o.propData("tasksOverdue",r,{filter:"overdue"}),o.propData("tasksNotAssigned",r,{filter:"notassigned"}),o.propList("tasksOverdue",r),o.propPool("poolTasksNotassignedViews",s),o.propList("tasksNotAssigned",s),o.propNum("tasksNotAssignedHeight",0),o.ds_dstr.push(function(){this.__unwatchA()}),i=function(t,n){e.call(this,t,n),this.__unwatchA=t.$watch(function(){var e;return[null!=(e=t.$parent.view.startDate)?e.valueOf():void 0,t.mode]},function(t){return function(e){var n,o;o=e[0],n=e[1],t.dataUpdate({startDate:moment(o),endDate:moment(o).add(6,"days"),mode:n})}}(this),!0)},o.prototype.render=function(){var e,n,o,r,s;n=this.__scope.$parent.view.startDate,"ready"!==(o=this.get("data").get("tasksOverdueStatus"))&&"update"!==o?this.get("tasksOverdueList").merge(this,[]):(s=_.map(this.get("data").get("tasksOverdue"),function(t){return function(e){return e.addRef(t),e}}(this)),s.sort(function(t,e){var n,o;return(n=t.get("duedate").valueOf())===(o=e.get("duedate").valueOf())?0:o-n}),this.get("tasksOverdueList").merge(this,s)),"ready"!==(o=this.get("data").get("tasksNotAssignedStatus"))&&"update"!==o?(this.get("tasksNotAssignedList").merge(this,[]),this.set("tasksNotAssignedHeight",0)):(e=this.get("poolTasksNotassignedViews"),r=this.get("tasksNotAssignedList").merge(this,_.map(this.get("data").get("tasksNotAssigned"),function(t){return function(n){var o;return o=e.find(t,n.$ds_key),o.set("task",n),o}}(this))),this.set("tasksNotAssignedHeight",t.layoutTaskView(n,r)))},o.end(),o}(e)}]),a.directive("rmsView2DayDropTask",["dsChanges","$rootScope","addCommentAndSave",function(t,e,n){return{restrict:"A",scope:!0,link:function(t,o,r){o.on("dragover",function(t){return!1}),o.on("drop",function(o){return n(e.modal.task,o.shiftKey,{responsible:null,duedate:t.day.get("date"),plan:!1}),e.$digest(),!1})}}}])},{"../../../data/dsChanges":6,"../../../data/dsDataService":7,"../../../dscommon/DSDigest":20,"../../../dscommon/DSView":29,"../../../dscommon/util":30,"../../../models/Task":36,"../../tasks/addCommentAndSave":47,
"../view1/View1":55,"../view1/models/TaskView":58}],60:[function(t,e,n){var o,r,s,i,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(l=angular.module("ui/views/view3/View3",[t("../../../config"),t("../../../data/dsDataService"),t("../../../dscommon/DSView"),t("../../tasks/addCommentAndSave")])).name,u=t("../../../dscommon/util").assert,c=t("../../../dscommon/util").error,s=t("../../../models/Task"),i=t("../../../models/TodoList"),o=t("../../../models/Project"),r=t("./models/ProjectView"),a=t("./models/TodoListView"),l.controller("View3",["$scope","View3",function(t,e){t.view=new e(t,"view3")}]),l.factory("View3",["DSView","config","$log",function(t,e,n){var a;return a=function(e){function n(){return a.apply(this,arguments)}var a;return d(n,e),n.begin("View3"),n.propData("tasks",s,{}),n.propPool("poolProjects",r),n.propList("projects",r),n.ds_dstr.push(function(){this.__unwatchA()}),a=function(e,n){t.call(this,e,n),this.expandedProj={},this.__unwatchA=e.$watch(function(){var t;return[e.mode,null!=(t=e.$parent.view.startDate)?t.valueOf():void 0,e.sidebarTabs.active]},function(t){return function(n){var o,r,s,i,a;switch(r=n[0],a=n[1],o=n[2],o){case 0:t.dataUpdate({filter:"noduedate",mode:r});break;case 1:"number"!=typeof a?e.sidebarTabs.active=0:(i=moment(a).add(1,"week"),s=moment(i).endOf("week"),t.dataUpdate({filter:"all",mode:r,startDate:i,endDate:s}));break;case 2:t.dataUpdate({filter:"all",mode:r})}}}(this),!0),e.toggleProjectExpanded=function(t){return function(n){var o,s,i,a,l;return u&&(n instanceof r||c.invalidArg("project")),a=(s=t.expandedProj).hasOwnProperty(o=e.sidebarTabs.active)?s[o]:s[o]=l={},a.hasOwnProperty(i=n.$ds_key)?a[i]=!a[i]:a[i]=!(2!==o)}}(this),e.isProjectExpanded=function(t){return function(n){var o,s,i,a;return u&&(n instanceof r||c.invalidArg("project")),(s=t.expandedProj).hasOwnProperty(o=e.sidebarTabs.active)&&(a=s[o]).hasOwnProperty(i=n.$ds_key)?a[i]:2!==o}}(this)},n.prototype.render=function(){var t,e,n,r,s;return"ready"!==(n=this.get("data").get("tasksStatus"))&&"update"!==n?void this.get("projectsList").merge(this,[]):(s=_.groupBy(this.get("data").get("tasks"),function(t){return t.get("todoList").$ds_key}),r=_.groupBy(s,function(t){return t[0].get("project").$ds_key}),t=this.get("poolProjects"),void(e=this.get("projectsList").merge(this,_.map(r,function(e){return function(n,r){var s;return s=t.find(e,r),s.set("project",o.pool.items[r]),s.get("todoListsList").merge(e,_.map(n,function(t){var n,o;return n=t[0].get("todoList").$ds_key,o=s.poolTodoLists.find(e,n),o.set("todoList",i.pool.items[n]),o.set("tasksCount",_.size(t)),o.set("totalEstimate",_.reduce(t,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),o.get("tasksList").merge(e,_.map(t,function(t){return t.addRef(e)})),o})),s}}(this)).sort(function(t,e){var n,o;return(n=t.get("project").get("name").toLowerCase())<(o=e.get("project").get("name").toLowerCase())?-1:n>o?1:0}))))},n.end(),n}(t)}]),l.directive("rmsView3DropTask",["$rootScope","addCommentAndSave",function(t,e){return{restrict:"A",scope:!0,link:function(n,o,r){o.on("dragover",function(t){return!1}),o.on("drop",function(n){return e(t.modal.task,n.shiftKey,{duedate:null,plan:!1}),t.$digest(),!1})}}}])},{"../../../config":2,"../../../data/dsDataService":7,"../../../dscommon/DSView":29,"../../../dscommon/util":30,"../../../models/Project":34,"../../../models/Task":36,"../../../models/TodoList":38,"../../tasks/addCommentAndSave":47,"./models/ProjectView":61,"./models/TodoListView":62}],61:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../dscommon/DSObject"),a=t("../../../../dscommon/util").validate,r=t("../../../../models/Project"),i=t("./TodoListView"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("ProjectView"),e.propDoc("project",r),e.propPool("poolTodoLists",i),e.propList("todoLists",i),e.end(),e}(o)},{"../../../../dscommon/DSObject":24,"../../../../dscommon/util":30,"../../../../models/Project":34,"./TodoListView":62}],62:[function(t,e,n){var o,r,s,i,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../dscommon/DSObject"),a=t("../../../../dscommon/util").validate,r=t("../../../../models/Task"),s=t("../../../../models/TodoList"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TodoListView"),e.propDoc("todoList",s),e.propList("tasks",r),e.propNum("tasksCount",0),e.propDuration("totalEstimate"),e.propBool("isExpand",!0),e.end(),e}(o)},{"../../../../dscommon/DSObject":24,"../../../../dscommon/util":30,"../../../../models/Task":36,"../../../../models/TodoList":38}],63:[function(t,e,n){var o;e.exports=(o=angular.module("ui/widgets/widgetDate",[])).name,$.datepicker.regional.ru={dateFormat:"dd.mm.yy",firstDay:1},$.datepicker.setDefaults($.datepicker.regional.ru),$.timepicker.regional.ru={},$.timepicker.setDefaults($.timepicker.regional.ru),o.directive("widgetDate",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(n,o,r,s){var i;i=$("input",o),e(function(){i.datepicker(),i.change(function(){var e;s.$setViewValue((e=i.datetimepicker("getDate"))?moment(e.getTime()):null),t.$digest()}),(s.$render=function(){i.datetimepicker("setDate",s.$viewValue?new Date(s.$viewValue.valueOf()):null)})()},0)}}}])},{}],64:[function(t,e,n){var o,r,s;e.exports=(s=angular.module("ui/widgets/widgetDuration",[])).name,o=36e5,r=6e4,s.directive("widgetDuration",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(e,n,s,i){var a,u,c,l;l=$("input",n),u=$(l[0]),c=$(l[1]),(i.$render=function(){var t,e,n;(n=i.$viewValue)?(t=Math.floor(n.valueOf()/o),e=Math.floor(n.valueOf()%o/r),u.val(t),c.val(10>e?"0"+e:e)):(u.val(""),c.val(""))})(),a=function(){var e,n,o;n=parseInt(u.val()),o=parseInt(c.val()),e=moment.duration(0),isNaN(n)||e.add(n,"hours"),isNaN(o)||e.add(o,"minutes"),i.$setViewValue(0===e.valueOf()?null:e),t.$digest()},u.on("input",a),c.on("input",a)}}}])},{}],65:[function(t,e,n){var o,r,s,i,a,u,c;s=t("../dscommon/util").assert,a=t("../dscommon/util").error,r=/RMS\s*Data\s*\(DO NOT CHANGE!?\)/i,o=/}\s*END/i,u=function(t){var e,n,o,r;for(n=o=r=t.length-1;o>=0&&("\r"===(e=t.charAt(n))||"\n"===e||" "===e||"	"===e);n=o+=-1);return n>=0?t.substr(0,n+1):""},c=function(t){var e,n,o,r,s;for(n=-1,o=r=0,s=t.length;s>r;o=r+=1)if("\n"===(e=t.charAt(o)))n=o;else if("\r"!==e&&" "!==e&&"	"!==e)break;return-1===n?t:o<t.length?t.substr(n+1):""},i=function(t){var e,n,s,a;return-1===(s=t.search(r))?t:-1!==(e=t.search(o))&&e>s?(a=u(t.substr(0,s)),n=c(t.substr(t.substr(s).search(/end/i)+3+s)),i(a.length>0?n.length>0?a+"\r\n\r\n"+n:a:n)):u(t.substr(0,s-1))},e.exports={clear:i,get:function(t){var e,n,i,u,c;if(s&&null!==t&&"string"!=typeof t&&a.invalidArg("description"),null===t||-1===(c=t.search(r)))return null;if(-1!==(e=t.search(o))&&e>c&&-1!==(u=t.indexOf("{",c))&&e>u)try{return JSON.parse(t.substr(u,e-u+1).trim())}catch(n){i=n,console.error("ex: ",i)}return console.error("Corrupted RMS Data: ",t),null},put:function(t,e){return s&&(null!==t&&"string"!=typeof t&&a.invalidArg("description"),null!==e&&"object"!=typeof e&&a.invalidArg("data")),t=null===t?"":i(t),null===e||0===_.size(e)?t:(0===t.length?"":""+t)+("\r\n\r\nRMS Data (DO NOT CHANGE!) "+JSON.stringify(e)+" END")}}},{"../dscommon/util":30}],66:[function(t,e,n){!function(t,e,n){"use strict";function o(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var r=e.isDefined,s=e.isUndefined,i=e.isNumber,a=e.isObject,u=e.isArray,c=e.extend,l=e.toJson,d=e.fromJson,p=e.module("LocalStorageModule",[]);p.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,n,p){var f,h=this,m=h.prefix,g=h.cookie,y=h.notify,_=h.storageType;n?n[0]&&(n=n[0]):n=document,"."!==m.substr(-1)&&(m=m?m+".":"");var v=function(t){return m+t},w=function(){try{var n=_ in e&&null!==e[_],o=v("__"+Math.round(1e7*Math.random()));return n&&(f=e[_],f.setItem(o,""),f.removeItem(o)),n}catch(r){return _="cookie",t.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),S=function(e,n){if(s(n)?n=null:(a(n)||u(n)||i(+n||n))&&(n=l(n)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:"cookie"}),P(e,n);try{(a(n)||u(n))&&(n=l(n)),f&&f.setItem(v(e),n),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:h.storageType})}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),P(e,n)}return!0},D=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),$(e);var n=f?f.getItem(v(e)):null;return n&&"null"!==n?"{"===n.charAt(0)||"["===n.charAt(0)||o(n)?d(n):n:null},k=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),A(e);try{f.removeItem(v(e)),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.message),A(e)}return!0},b=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,n=[];for(var o in f)if(o.substr(0,e)===m)try{n.push(o.substr(e))}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.Description),[]}return n},T=function(e){e=e||"";var n=m.slice(0,-1),o=new RegExp(n+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),j();var r=m.length;for(var s in f)if(o.test(s))try{k(s.substr(r))}catch(i){return t.$broadcast("LocalStorageModule.notification.error",i.message),j()}return!0},O=function(){try{return e.navigator.cookieEnabled||"cookie"in n&&(n.cookie.length>0||(n.cookie="test").indexOf.call(n.cookie,"test")>-1)}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),!1}}(),P=function(e,o){if(s(o))return!1;if((u(o)||a(o))&&(o=l(o)),!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var r="",i=new Date,c="";if(null===o?(i.setTime(i.getTime()+-864e5),r="; expires="+i.toGMTString(),o=""):0!==g.expiry&&(i.setTime(i.getTime()+24*g.expiry*60*60*1e3),r="; expires="+i.toGMTString()),e){var d="; path="+g.path;g.domain&&(c="; domain="+g.domain),n.cookie=v(e)+"="+encodeURIComponent(o)+r+d+c}}catch(p){return t.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},$=function(e){if(!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=n.cookie&&n.cookie.split(";")||[],r=0;r<o.length;r++){for(var s=o[r];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(v(e)+"=")){var i=decodeURIComponent(s.substring(m.length+e.length+1,s.length));try{var a=JSON.parse(i);return d(a)}catch(u){return i}}}return null},A=function(t){P(t,null)},j=function(){for(var t=null,e=m.length,o=n.cookie.split(";"),r=0;r<o.length;r++){for(t=o[r];" "===t.charAt(0);)t=t.substring(1,t.length);var s=t.substring(e,t.indexOf("="));A(s)}},C=function(){return _},M=function(t,e,n,o){o=o||e;var s=D(o);return null===s&&r(n)?s=n:a(s)&&a(n)&&(s=c(n,s)),p(e).assign(t,s),t.$watch(e,function(t){S(o,t)},a(t[e]))},L=function(){for(var t=0,n=e[_],o=0;o<n.length;o++)0===n.key(o).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:C,set:S,add:S,get:D,keys:b,remove:k,clearAll:T,bind:M,deriveKey:v,length:L,cookie:{isSupported:O,set:P,add:P,get:$,remove:A,clearAll:j}}}]})}(window,window.angular)},{}],67:[function(t,e,n){var o;o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,n,r,s,i,a,u,c,l;for(l="",e=void 0,n=void 0,r="",s=void 0,i=void 0,a=void 0,u="",c=0;;)if(e=t.charCodeAt(c++),n=t.charCodeAt(c++),r=t.charCodeAt(c++),s=e>>2,i=(3&e)<<4|n>>4,a=(15&n)<<2|r>>6,u=63&r,isNaN(n)?a=u=64:isNaN(r)&&(u=64),l=l+o.charAt(s)+o.charAt(i)+o.charAt(a)+o.charAt(u),e=n=r="",s=i=a=u="",!(c<t.length))break;return l},decode:function(t){var e,n,r,s,i,a,u,c,l,d;for(d="",n=void 0,r=void 0,s="",i=void 0,a=void 0,u=void 0,c="",l=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(i=o.indexOf(t.charAt(l++)),a=o.indexOf(t.charAt(l++)),u=o.indexOf(t.charAt(l++)),c=o.indexOf(t.charAt(l++)),n=i<<2|a>>4,r=(15&a)<<4|u>>2,s=(3&u)<<6|c,d+=String.fromCharCode(n),64!==u&&(d+=String.fromCharCode(r)),64!==c&&(d+=String.fromCharCode(s)),n=r=s="",i=a=u=c="",!(l<t.length))break;return d}}},{}]},{},[1]);