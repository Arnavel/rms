!function t(e,o,n){function r(i,a){if(!o[i]){if(!e[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=o[i]={exports:{}};e[i][0].call(l.exports,function(t){var o=e[i][1][t];return r(o?o:t)},l,l.exports,t,e,o,n)}return o[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e,o){t("./ng-app"),moment.locale("ru")},{"./ng-app":24}],2:[function(t,e,o){var n,r,s,i,a,u,c,l,p=function(t,e){function o(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("../dscommon/util").assert,l=t("../dscommon/util").validate,c=t("../dscommon/util").serviceOwner,n=t("../dscommon/DSObject"),r=t("./models/Person"),t("../utils/angular-local-storage.js"),e.exports=(u=angular.module("config",["LocalStorageModule"])).name,u.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),u.run(["$rootScope","config",function(t,e){t.config=e}]),s=1,i=1,u.factory("config",["$http","localStorageService",function(t,e){var o,a,u,d,f,h,m,g,y,_,v,w;if(o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return p(o,t),o.begin("Config"),o.propStr("token",null,l.trimString),o.propStr("teamwork","http://teamwork.webprofy.ru/"),o.propCalc("hasRoles",function(){return"http://teamwork.webprofy.ru/"===this.teamwork}),o.propCalc("hasTimeReports",function(){return"http://teamwork.webprofy.ru/"===this.teamwork||"http://delightsoft.teamworkpm.net/"===this.teamwork}),o.propConst("planTag","План"),o.propConst("teamleadRole","Teamlead"),o.propNum("hResizer"),o.propNum("vResizer"),o.propStr("currentUserId"),o.propDoc("currentUser",r),o.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),o.propStr("selectedRole"),o.propNum("selectedCompany"),o.propNum("selectedLoad"),o.propNum("activeSidebarTab",0),o.propNum("refreshPeriod"),o.propNum("view3GroupByPerson",0),o.propNum("view3HidePeopleWOTasks",0),o.propStr("view3FilterByPerson",""),o.propStr("view3FilterByProject",""),o.propStr("view3FilterByTask",""),o.propNum("histStart",-1),o.onAnyPropChange(function(t,o,n,r){"currentUserId"!==o&&"currentUser"!==o&&("teamwork"!==o&&"token"!==o||this.set("histStart",-1),"undefined"!=typeof n?e.set(o,n):e.remove(o))}),o.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},o.end(),o}(n),a=c.add(new o(c,"config")),d=!0,f=!0,_=1,v=0,"string"==typeof(y=e.get("ver"))&&((w=y.split(".")).length=2)&&(_=parseInt(w[0]),v=parseInt(w[1])),f=(d=_===s)&&v===i,f||e.set("ver",s+"."+i),d){m=o.prototype.__props;for(h in m)u=m[h],(f||"teamwork"===h||"token"===h)&&(u.readonly||null===(g=e.get(h))||a.set(h,g))}return a}])},{"../dscommon/DSObject":60,"../dscommon/util":66,"../utils/angular-local-storage.js":67,"./models/Person":14}],3:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d=function(t,e){function o(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(p=angular.module("data/PeopleWithJson",[])).name,c=t("../../dscommon/util").assert,l=t("../../dscommon/util").error,i=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),n=t("../../dscommon/DSData"),s=t("../../dscommon/DSDigest"),r=t("../../dscommon/DSDataServiceBase"),u=t("../models/Person"),p.factory("PeopleWithJson",["DSDataSource","config","$rootScope","$http","$q",function(t,e,o,p,f){var h;return h=function(t){function h(){return h.__super__.constructor.apply(this,arguments)}return d(h,t),h.begin("PeopleWithJson"),h.addPool(),h.propDoc("teamworkPeople",i),h.propObj("cancel",null),h.propSet("people",u),h.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),h.prototype.clear=function(){var t;n.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},h.prototype.init=function(t){var n,i,d,h;c&&(t instanceof r||l.invalidArg("dsDataService")),(h=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:u,source:!0})))).release(this),d=this.get("peopleSet"),i=function(t){return function(e,o){o||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),n=function(t){return function(){var n;t._startLoad()&&(n=t.set("cancel",f.defer()),p.get("data/people.json?t="+(new Date).getTime(),n).then(function(n){200===n.status?(t.set("cancel",null),s.block(function(){var r,s,i,u,c,l,p,f,m,g,y,_,v,w;if(f=o.peopleRoles=n.data.roles,w=e.get("selectedRole"))for(i=0,c=f.length;i<c;i++)s=f[i],s.role===w&&(o.selectedRole=s);for(_=n.data.people,u=0,l=_.length;u<l;u++)g=_[u],h.items.hasOwnProperty(y=""+g.id)&&(h.items[y].set("roles",r=new a(t,g.role)),r.release(t));p={},v=h.items;for(y in v)m=v[y],p[y]=m,m.addRef(t);d.merge(t,p),t._endLoad(!0)})):i(n,0===n.status)},i))}}(this),this._unwatchA=h.watchStatus(this,function(t){return function(e,o){var r;if(o!==(r=t.get("status")))switch(o){case"ready":s.block(n);break;case"update":s.block(n);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},h.end(),h}(n)}])},{"../../dscommon/DSData":51,"../../dscommon/DSDataServiceBase":54,"../../dscommon/DSDigest":56,"../../dscommon/DSSet":63,"../../dscommon/DSTags":64,"../../dscommon/util":66,"../models/Person":14}],4:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h=function(t,e){function o(){this.constructor=t}for(var n in e)m.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},m={}.hasOwnProperty;e.exports=(f=angular.module("data/PersonDayStatData",[])).name,p=t("../../dscommon/util").assert,d=t("../../dscommon/util").error,i=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSDataServiceBase"),n=t("../../dscommon/DSData"),s=t("../../dscommon/DSDigest"),a=t("../../dscommon/DSSet"),u=t("../models/Person"),l=t("../models/Task"),c=t("../models/PersonDayStat"),f.factory("PersonDayStatData",[function(){var t;return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.begin("PersonDayStatData"),e.addPool(),e.propDoc("tasks",a),e.propDoc("people",a),e.propSet("personDayStats",c),e.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),e.prototype.clear=function(){n.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},e.prototype.init=function(t){var e,o,n,a,f,h,m,g;p&&(t instanceof r||d.invalidArg("dsDataService")),(h=this.set("tasks",t.findDataSet(this,_.assign({},this.params,{type:l,filter:"assigned"})))).release(this),m=h.items,(o=this.set("people",t.findDataSet(this,{type:u,mode:this.params.mode}))).release(this),n=o.items,a=this.get("personDayStats"),e=function(t){return function(){var e,r,i,l,f,g,y,v,w,S,D,k,T,b,P;if(t._startLoad()){P=_.groupBy(m,function(t){return t.get("responsible").$ds_key}),f=moment.duration((y=t.params.endDate).diff(T=t.params.startDate)).asDays(),i=T,l=function(){var t,e,o;for(o=[],v=t=0,e=f;0<=e?t<=e:t>=e;v=0<=e?++t:--t)o.push(((i=moment(k=i)).add(1,"day"),k));return o}(),e=function(t){var e,o,n,r,s,a,u,c,p,d,f,h,m,g,y,_,w,S,D,k,b,O,$;if(k=function(){var t,e,o;for(o=[],t=0,e=l.length;t<e;t++)i=l[t],o.push(0);return o}(),b=function(){var t,e,o;for(o=[],t=0,e=l.length;t<e;t++)i=l[t],o.push(moment.duration(0));return o}(),o=t.get("dayStats"),P.hasOwnProperty(m=(h=t.get("person")).$ds_key))for(g=P[m],s=0,c=g.length;s<c;s++)if(D=g[s],null!==(n=D.duedate))if(null!==(w=D.get("split")))for(y=S=w.list,v=a=0,p=y.length;a<p;v=a+=2)i=y[v],f=Math.floor(moment(n).add(i).diff(T)/864e5),0<=f&&f<o.length&&(b[f].add(S[v+1]),k[f]++);else f=Math.floor((n.valueOf()-T.valueOf())/864e5),0<=f&&f<o.length&&(null!==(r=D.get("estimate"))&&b[f].add(r),k[f]++);for(e=h.get("contractTime"),O=moment.duration(0),v=u=0,d=o.length;u<d;v=++u)_=o[v],_.set("tasksCount",k[v]),_.set("contract",e),_.set("tasksTotal",$=b[v]),_.set("timeLeft",moment.duration(e).subtract($)),O.add($);t.set("totalPeriodTime",O)},b={};for(S in n)w=n[S],e(b[S]=new c(t,w.$ds_key,w,l));t.get("personDayStatsSet").merge(t,b),g=function(t){a.hasOwnProperty(t)&&e(a[t])},D=function(e){p&&(e instanceof u||d.invalidArg("person")),s.render(t.$ds_key,e.$ds_key,g)},t._unwatch1=h.watch(t,{change:r=function(t,e,o,n){"estimate"===e||"split"===e||"duedate"===e?null!==(w=t.get("responsible"))&&null!==t.get("duedate")&&D(w):"responsible"===e&&(null!==n&&P.hasOwnProperty(S=n.$ds_key)&&_.remove(P[S],t).length>0&&D(n),null!==o&&(h=P.hasOwnProperty(S=o.$ds_key)?P[S]:P[S]=[],_.find(h,t)||(h.push(t),D(o))))},add:function(t){r(t,"responsible",t.get("responsible"),null)},remove:function(t){null!==(w=t.get("responsible"))&&P.hasOwnProperty(S=w.$ds_key)&&(_.remove(P[S],t),D(w))}}),t._unwatch2=o.watch(t,{add:function(e){var o,n;n=new c(t,o=e.$ds_key,e,l),n.get("dayStatsList").merge(t,function(){var t,e,o;for(o=[],v=t=0,e=l.length;t<e;v=++t)i=l[v],o.push(((k=new c.DayStat(this,"personKey_"+v)).set("day",i),k));return o}.call(t)),t.get("personDayStatsSet").add(t,n),D(e)},remove:function(e){t.get("personDayStatsSet").remove(t.get("personDayStats")[e.$ds_key])},change:function(t,e,o,n){"contractTime"===e&&D(t)}}),t._endLoad(!0)}}}(this),f=[h,o],g=function(t){return function(o,n){var r,a;if((r=i.integratedStatus(f))!==(a=t.get("status")))switch(r){case"ready":s.block(e);break;case"update":t._startLoad()&&t._endLoad(!0);break;case"nodata":t.set("status","nodata")}}}(this),this._unwatchA=o.watchStatus(this,g),this._unwatchB=h.watchStatus(this,g),this.init=null},e.end(),e}(n)}])},{"../../dscommon/DSData":51,"../../dscommon/DSDataServiceBase":54,"../../dscommon/DSDigest":56,"../../dscommon/DSDocument":57,"../../dscommon/DSSet":63,"../../dscommon/util":66,"../models/Person":14,"../models/PersonDayStat":15,"../models/Task":19}],5:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f=function(t,e){function o(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(d=angular.module("data/TasksWithTimeTracking",[])).name,l=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,i=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),n=t("../../dscommon/DSData"),s=t("../../dscommon/DSDigest"),r=t("../../dscommon/DSDataServiceBase"),u=t("../models/Task"),c=t("../models/TaskTimeTracking"),d.factory("TasksWithTimeTracking",["DSDataSource","$rootScope","$http","$q",function(t,e,o,s){var a;return a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.begin("TasksWithTimeTracking"),e.addPool(),e.propDoc("srcTasks",i),e.propDoc("srcTasksTimeTracking",i),e.propObj("cancel",null),e.propSet("tasks",u),e.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),e.prototype.clear=function(){var t;n.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},e.prototype.init=function(t){var e,o,n;l&&(t instanceof r||p.invalidArg("dsDataService")),(e=this.set("srcTasks",t.findDataSet(this,{mode:"original",type:u,filter:"all",source:!0}))).release(this),(o=this.set("srcTasksTimeTracking",t.findDataSet(this,{mode:"original",type:c}))).release(this),n=this.get("tasksSet"),this.__unwatchA=e.watch(this,{add:function(t){var e;null===t.get("timeTracking")&&(e=c.pool.find(this,t.$ds_key))&&(t.set("timeTracking",e),e.release(this)),n.add(this,t.addRef(this))},remove:function(t){n.remove(t)}}),this.__unwatchB=e.watchStatus(this,function(t){return function(e,o){t.set("status",o)}}(this)),this.init=null},e.end(),e}(n)}])},{"../../dscommon/DSData":51,"../../dscommon/DSDataServiceBase":54,"../../dscommon/DSDigest":56,"../../dscommon/DSSet":63,"../../dscommon/DSTags":64,"../../dscommon/util":66,"../models/Task":19,"../models/TaskTimeTracking":20}],6:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m=function(t,e){function o(){this.constructor=t}for(var n in e)g.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},g={}.hasOwnProperty;e.exports=(f=angular.module("data/dsDataChanges",["LocalStorageModule",t("../../dscommon/DSDataSource")])).name,p=t("../../dscommon/util").assert,h=t("../../dscommon/util").serviceOwner,d=t("../../dscommon/util").error,a=t("../../dscommon/DSDigest"),s=t("../../dscommon/DSChangesBase"),i=t("../../dscommon/DSDataEditable"),u=t("../models/Person"),l=t("../models/Task"),r=t("../models/types/Comments"),c=t("../utils/RMSData"),f.run(["dsChanges","$rootScope",function(t,e){e.changes=t}]),n=1,f.factory("dsChanges",["DSDataSource","config","localStorageService","$http","$timeout","$q",function(t,e,o,p,d,f){var g;return g=function(p){function h(){return g.apply(this,arguments)}var g;return m(h,p),h.begin("DSChanges"),h.propSet("tasks",l.Editable),h.propObj("dataService"),h.propDoc("source",t),h.propObj("cancel",null),h.ds_dstr.push(function(){var t;this.__unwatch2(),"function"==typeof this.__unwatchStatus1&&this.__unwatchStatus1(),"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),(t=this.get("cancel"))&&t.resolve()}),g=function(t,e){s.call(this,t,e)},h.prototype.init=function(e){this.__unwatch2=t.setLoadAndRefresh.call(this,this.set("dataService",e))},h.prototype.clear=function(){"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),delete this.__unwatchStatus2,this.reset()},h.prototype.load=function(){var t,r,s;if("ready"!==this.get("status")){if(!this._startLoad())return;t=i(l.Editable).$u,(r=o.get("changes"))?r.ver===n&&r.source.url===e.get("teamwork")&&r.source.token===e.get("token")?(s=this.get("dataService").findDataSet(this,{type:u,mode:"original"}),this.__unwatchStatus2=s.watchStatus(this,function(e){return function(o,n,i,u){"ready"===n&&(u(),a.block(function(){var o,n,i,a,u,c,p,d,f,h,m,g,y,_,v,w;l.pool.enableWatch(!1),h=e.mapToChanges(r.changes),p=h.load.Person;for(c in p)if(a=p[c],s.items.hasOwnProperty(c))for(u=s.items[c],n=0,i=a.length;n<i;n++)(o=a[n])(u);else console.error("Person #{personKey} missing in server data");w=(v=e.get("tasksSet")).$ds_pool,f={},d=h.changes.tasks;for(_ in d)g=d[_],l.pool.items.hasOwnProperty(_)?(m=l.pool.items[_]).addRef(e):(m=l.pool.find(e,_)).readMap(r.tasks[_]),(y=w.find(e,_,f)).init(m,v,g),y.$u=t,y.hasOwnProperty("__change")||(delete f[y.$ds_key],y.release(e)),m.release(e);v.merge(e,f),l.pool.enableWatch(!0),e._endLoad(!0)}))}}(this)),s.release(this)):(o.remove("changes"),this._endLoad(!0)):this._endLoad(!0)}},h.prototype.persist=function(){this.hasOwnProperty("__persist")||(this.__persist=d(function(t){return function(){delete t.__persist,t.saveToLocalStorage()}}(this)))},h.prototype.saveToLocalStorage=function(){var t,r,s;if(this.anyChange()){t=this.changesToMap(),s={};for(r in t.tasks)s[r]=l.pool.items[r].writeMap();o.set("changes",{ver:n,changes:t,source:{url:e.get("teamwork"),token:e.get("token")},tasks:s})}else o.remove("changes")},h.prototype.save=function(t){return function(e){var o,n,s,i,u,l,p,d,h,m,g,y,v,w,S,D,k,T,b,P,O,$,A,j;if(t&&!e)return t.promise;if(e||(t=f.defer(),e=function(){var t,e;t=this.get("tasks"),e=[];for($ in t)O=t[$],e.push(O.addRef(this));return e}.call(this)),h=null,j={"todo-item":A={}},!(O=e.shift())){if((e=function(){var t,e;t=this.get("tasks"),e=[];for($ in t)O=t[$],O.__change.__error||e.push(O.addRef(this));return e}.call(this)).length>0)return void this.save(e);n=!0;for(d in this.get("tasks")){n=!1;break}return t.resolve(n),y=t.promise,t=null,y}s=_.clone(O.__change),A.content=O.get("title"),u=!1;for(w in s)if(v=s[w],"__error"!==w&&"__refreshView"!==w)switch(w){case"title":break;case"comments":break;case"split":A.description=c.put(O.get("description"),(k=v.v)?{split:v.v.valueOf()}:null),A["start-date"]=null===k||null===(p=O.get("duedate"))?"":k.firstDate(p).format("YYYYMMDD");break;case"duedate":A["due-date"]=l=v.v?v.v.format("YYYYMMDD"):"",null!==(T=O.get("startDate"))&&T>O.get("duedate")&&(A["start-date"]=l);break;case"estimate":A["estimated-minutes"]=v.v?Math.floor(v.v.asMinutes()):"0";break;case"responsible":A["responsible-party-id"]=(h=v.v)?[v.v.get("id")]:[];break;case"tags":A.tags=(P=null!=(S=O.get("tags"))?S.map:void 0)?function(){var t;t=[];for(b in P)t.push(b);return t}().join():"";break;case"plan":i=null===(i=O.get("comments"))?new r:i.clone(),i.unshift(v.v?"Поставлено в план на "+O.get("duedate").format("DD.MM.YYYY"):"Снято с плана.  Причина:"),O.set("comments",i);break;default:console.error("change.save(): Property "+w+" not expected to be changed")}return o=function(e){return function(o,n){n||(console.error("error: ",o),e.set("cancel",null)),O.release(e),t.reject(),t=null}}(this),D=function(t){return function(){return t.get("source").httpPut("tasks/"+O.get("id")+".json",j,t.set("cancel",f.defer())).then(function(n){var r,u,c;if(t.set("cancel",null),200===n.status)if(delete s.__error,a.block(function(){for(w in s)v=s[w],"__refreshView"!==w&&O.$ds_doc.set(w,v.v)}),null!==(i=O.get("comments"))){for(c="";u=i.shift();)c+="<p>"+u+"</p>";j={comment:{"content-type":"html",body:c,isprivate:!1}},t.get("source").httpPost("tasks/"+O.get("id")+"/comments.json",j,t.set("cancel",f.defer())).then(function(n){t.set("cancel",null),201===n.status?(O.release(t),t.save(e)):o(n,0===n.status)},o)}else O.release(t),t.save(e);else O.__change.__error=n.data.MESSAGE,"function"==typeof(r=O.__change).__refreshView&&r.__refreshView(),O.release(t),t.save(e)},o)}}(this),null===h?D():null===(g=(m=O.get("project")).get("people"))?this.get("source").httpGet("projects/"+m.get("id")+"/people.json",this.set("cancel",f.defer())).then(function(t){return function(e){var n,r,s,i;if(t.set("cancel",null),200===e.status){for(m.set("people",g={}),i=e.data.people,n=0,r=i.length;n<r;n++)s=i[n],g[s.id]=!0;t.addPersonToProject(m,h,D,o)}else o(e,0===e.status)}}(this),o):g.hasOwnProperty(h.get("id"))?D():this.addPersonToProject(m,h,D),t.promise}}(null),h.prototype.addPersonToProject=function(t,e,o,n){this.get("source").httpPost("projects/"+t.get("id")+"/people/"+e.get("id")+".json",null,this.set("cancel",f.defer())).then(function(r){return function(s){r.set("cancel",null),200===s.status||409===s.status?(t.get("people")[e.get("id")]=!0,o()):n(s,0===s.status)}}(this),n)},h.end(),h}(s),h.add(new g(h,"dataChanges"))}])},{"../../dscommon/DSChangesBase":50,"../../dscommon/DSDataEditable":52,"../../dscommon/DSDataSource":55,"../../dscommon/DSDigest":56,"../../dscommon/util":66,"../models/Person":14,"../models/Task":19,"../models/types/Comments":22,"../utils/RMSData":49}],7:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m,g,y=function(t,e){function o(){this.constructor=t}for(var n in e)v.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},v={}.hasOwnProperty;e.exports=(m=angular.module("data/dsDataService",[t("./PeopleWithJson"),t("./TasksWithTimeTracking"),t("./teamwork/TWPeople"),t("./teamwork/TWTasks"),t("./teamwork/TWTags"),t("./teamwork/TWTimeTracking"),t("./PersonDayStatData"),t("./dsChanges"),t("../../dscommon/DSDataSource"),t("../config")])).name,d=t("../../dscommon/util").assert,g=t("../../dscommon/util").serviceOwner,h=t("../../dscommon/util").error,f=t("../../utils/base64"),a=t("../../dscommon/DSObject"),i=t("../../dscommon/DSDataServiceBase"),n=t("../../dscommon/DSChangesBase"),r=t("../../dscommon/DSDataEditable"),s=t("../../dscommon/DSDataFiltered"),u=t("../models/Person"),l=t("../models/Task"),p=t("../models/TaskTimeTracking"),c=t("../models/PersonTimeTracking"),m.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),m.factory("dsDataService",["TWPeople","TWTasks","TWTags","TWTimeTracking","PeopleWithJson","TasksWithTimeTracking","PersonDayStatData","DSDataSource","dsChanges","config","$http","$rootScope","$q",function(t,e,o,a,p,h,m,v,w,S,D,k,T){var b;return b=function(g){function b(){return P.apply(this,arguments)}var P;return y(b,g),b.begin("DSDataService"),b.propDoc("dataSource",v),b.propPool("editedPeople",r(u.Editable)),b.propPool("editedTasks",r(l.Editable)),b.propPool("tasksPool",s(l)),b.propPool("personTimeTrackingPool",s(c)),b.propBool("showTimeSpent",!1),b.propDoc("changes",n),b.propSet("emptyPersonTimeTracking",c),b.ds_dstr.push(function(){this.__unwatch2()}),P=function(){var t;i.apply(this,arguments),this.set("dataSource",new v(this,"dataSource")).release(this),t=null,this.__unwatch2=k.$watch(function(){return[S.get("teamwork"),S.get("token")]},function(e){return function(o){var n,r,s;return r=o[0],s=o[1],r&&s?(t&&(t.resolve(),t=null),n=function(o,n){n||(console.error("error: ",o),t=null),e.get("dataSource").setConnection(null,null)},D.get(r+"authenticate.json",{timeout:(t=T.defer()).promise,headers:{Authorization:"Basic "+f.encode(s)}}).then(function(o){200===o.status?(t=null,S.set("currentUserId",o.data.account.userId),e.get("dataSource").setConnection(r,s)):n(o,0===o.status)},n),void 0):e.get("dataSource").setConnection(null,null)}}(this),!0),this.set("changes",w).init(this)},b.prototype.refresh=function(){this.get("dataSource").refresh()},b.prototype.findDataSet=function(n,r){var s,d,f,g,y,v,w,D,k,T;switch(i.prototype.findDataSet.call(this,n,r),r.type.docType){case"Tag":return"function"==typeof(s=w=o.pool.find(this,r)).init&&s.init(this),(k=w.get("tagsSet")).addRef(n),w.release(this),k;case"PersonDayStat":return"function"==typeof(d=w=m.pool.find(this,r)).init&&d.init(this),(k=w.get("personDayStatsSet")).addRef(n),w.release(this),k;case"TaskTimeTracking":return(w=a.pool.find(this,{})).init&&w.init(this),(k=w.get("taskTimeTrackingSet")).addRef(n),w.release(this),k;case"PersonTimeTracking":return r.hasOwnProperty("showTimeSpent")&&!r.showTimeSpent?(k=this.get("emptyPersonTimeTrackingSet")).addRef(n):r.hasOwnProperty("startDate")?((w=this.get("personTimeTrackingPool").find(this,r)).init&&(w.init(D=this.findDataSet(this,{type:c,mode:r.mode}),a.filterPersonTimeTracking(r)),D.release(this)),(k=w.get("itemsSet")).addRef(n),w.release(this)):((w=a.pool.find(this,{})).init&&w.init(this),(k=w.get("personTimeTrackingSet")).addRef(n),w.release(this)),k}switch(r.mode){case"edited":switch(T=r.type.docType){case"Person":return this.findDataSet(n,_.assign({},r,{mode:"original"}));case"Task":return(w=this.get("editedTasks").find(this,r)).init&&(w.init(D=this.findDataSet(this,_.assign({},r,{mode:"original"})),v=this.findDataSet(this,_.assign({},r,{mode:"changes"})),e.filter(r)),D.release(this),v.release(this)),(k=w.get("itemsSet")).addRef(n),w.release(this),k;default:throw new Error("Not supported model type (1): "+T)}break;case"changes":switch(T=r.type.docType){case"Task":return(k=this.get("changes").get("tasksSet")).addRef(n);default:throw new Error("Not supported model type (2): "+T)}break;case"original":switch((T=r.type)!==u?T.docType:!S.get("hasRoles")||r.source?u.docType:"PeopleWithJson"){case"PeopleWithJson":return"function"==typeof(f=w=p.pool.find(this,r)).init&&f.init(this),(k=w.get("peopleSet")).addRef(n),w.release(this),k;case"Person":return delete r.source,"function"==typeof(g=w=t.pool.find(this,r)).init&&g.init(this),(k=w.get("peopleSet")).addRef(n),w.release(this),k;case"Task":return"all"!==r.filter||r.hasOwnProperty("startDate")?((w=this.get("tasksPool").find(this,r)).init&&(w.init(D=this.findDataSet(this,{type:l,mode:"original",filter:"all"}),e.filter(r)),D.release(this)),(k=w.get("itemsSet")).addRef(n),w.release(this)):(!S.get("hasTimeReports")||r.source?(delete r.source,"function"==typeof(y=w=e.pool.find(this,r)).init&&y.init(this)):(w=h.pool.find(this,{})).init&&w.init(this),(k=w.get("tasksSet")).addRef(n),w.release(this)),k;default:throw new Error("Not supported model type (3): "+T)}}},b.prototype.requestSources=function(t,e,o){var n,r,s,a,u,c,l,p,f;i.prototype.requestSources.call(this,t,e,o);for(r in o){switch(f=o[r],l=_.assign({},f.params,e),u={type:p=f.type,mode:s=l.mode},n=p.docType){case"Tag":break;case"Person":break;case"PersonDayStat":u.startDate=l.startDate,u.endDate=l.endDate;break;case"PersonTimeTracking":u.showTimeSpent=l.showTimeSpent,u.startDate=l.startDate,u.endDate=l.endDate;break;case"Task":if("changes"!==s){if(d&&!("string"==typeof l.filter&&0<=["all","assigned","notassigned","overdue","noduedate"].indexOf(l.filter)))throw new Error("Unexpected filter: "+l.filter);u.filter=l.filter,"all"!==l.filter&&"assigned"!==l.filter&&"notassigned"!==l.filter||(u.startDate=l.startDate,u.endDate=l.endDate)}break;default:throw new Error("Not supported model type (4): "+n)}a=this.findDataSet(t,u),"undefined"==typeof(c=f.set)||c!==a?f.newSet=a:a.release(t)}},b.end(),b}(i),g.add(new b(g,"dataService"))}])},{"../../dscommon/DSChangesBase":50,"../../dscommon/DSDataEditable":52,"../../dscommon/DSDataFiltered":53,"../../dscommon/DSDataServiceBase":54,"../../dscommon/DSDataSource":55,"../../dscommon/DSObject":60,"../../dscommon/util":66,"../../utils/base64":68,"../config":2,"../models/Person":14,"../models/PersonTimeTracking":16,"../models/Task":19,"../models/TaskTimeTracking":20,"./PeopleWithJson":3,"./PersonDayStatData":4,"./TasksWithTimeTracking":5,"./dsChanges":6,"./teamwork/TWPeople":9,"./teamwork/TWTags":10,"./teamwork/TWTasks":11,"./teamwork/TWTimeTracking":12}],8:[function(t,e,o){var n,r,s,i,a,u,c=function(t,e){function o(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(u=angular.module("dscommon/DSDataTeamworkPaged",[])).name,i=t("../../../dscommon/util").assert,a=t("../../../dscommon/util").error,n=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),s=500,u.factory("DSDataTeamworkPaged",["DSDataSource","$rootScope","$q",function(t,e,o){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return c(a,e),a.begin("DSDataTeamworkPaged"),a.propDoc("source",t),a.propObj("cancel",null),a.propEnum("method",["httpGet","httpPost","httpPut"]),a.propStr("request"),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),a.prototype.clear=function(){var t;n.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},a.prototype.load=function(){var t,e,n,a,u;if(i){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(u=this.get("request"))&&u.length>0))throw new Error("load(): Request is not specified")}this._startLoad()&&(e=this.set("cancel",o.defer()),n=function(t){return function(e,o){o||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),t=function(t,e){return""+e+(e.indexOf("?")===-1?"?":"&")+"page="+t+"&pageSize="+s},this.startLoad(),(a=function(o){return function(i){var u;return function(){switch(u=this.get("method")){case"httpGet":return this.get("source").httpGet(t(i,this.get("request")),e);case"httpPost":return this.get("source").httpPost(t(i,this.get("request")),this.params.json,e);case"httpPut":return this.get("source").httpPut(t(i,this.get("request")),this.params.json,e)}}.call(o).then(function(t){if(200===t.status){if(o.set("cancel",null),o.importResponse(t.data,t.status)===s)return void a(i+1);r.block(function(){return o.finalizeLoad()}),o._endLoad(!0)}else n(t,0===t.status)},n)}}(this))(1))},a.end(),a}(n)}])},{"../../../dscommon/DSData":51,"../../../dscommon/DSDigest":56,"../../../dscommon/util":66}],9:[function(t,e,o){var n,r,s,i,a=function(t,e){function o(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWPeople",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,n=t("../../models/Person"),i.factory("TWPeople",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,o,r){var s;return s=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,t),o.begin("TWPeople"),o.addPool(),o.propSet("people",n),o.ds_dstr.push(function(){this.__unwatch2()}),o.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},o.prototype.startLoad=function(){return this.peopleMap={}},o.prototype.importResponse=function(t){var e,o,r,s,i,a;for(e=0,a=t.people,o=0,s=a.length;o<s;o++)r=a[o],++e,i=n.pool.find(this,""+r.id,this.peopleMap),i.set("id",+r.id),i.set("name",(r["last-name"]+" "+r["first-name"].charAt(0).toUpperCase()+".").trim()),i.set("firstName",r["first-name"].trim()),i.set("avatar",r["avatar-url"]),i.set("email",r["email-address"]),i.set("companyId",+r["company-id"]),i.set("currentUser",!1);return e},o.prototype.finalizeLoad=function(){this.get("peopleSet").merge(this,this.peopleMap),delete this.peopleMap},o.end(),o}(t)}])},{"../../../dscommon/DSDataSource":55,"../../../dscommon/util":66,"../../models/Person":14,"./DSDataTeamworkPaged":8}],10:[function(t,e,o){var n,r,s,i,a=function(t,e){function o(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(i=angular.module("data/teamwork/TWTags",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,n=t("../../models/Tag"),i.factory("TWTags",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,o,r){var s;return s=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,t),o.begin("TWTags"),o.addPool(),o.propSet("tags",n),o.ds_dstr.push(function(){this.__unwatch2()}),o.prototype.init=function(t){this.set("request","tags.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},o.prototype.startLoad=function(){this.tagsMap={}},o.prototype.importResponse=function(t){var e,o,r,s,i,a;for(e=0,a=t.tags,o=0,s=a.length;o<s;o++)r=a[o],++e,i=n.pool.find(this,r.name,this.tagsMap),i.set("id",parseInt(r.id)),i.set("name",r.name),i.set("color",r.color);return e},o.prototype.finalizeLoad=function(){this.get("tagsSet").merge(this,this.tagsMap),delete this.tagsMap},o.end(),o}(t)}])},{"../../../dscommon/DSDataSource":55,"../../../dscommon/util":66,"../../models/Tag":18,"./DSDataTeamworkPaged":8}],11:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m,g,y,_,v=function(t,e){function o(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(y=angular.module("data/teamwork/TWTasks",[t("../../../dscommon/DSDataSource")])).name,m=t("../../../dscommon/util").assert,g=t("../../../dscommon/util").error,_=t("../../ui/time"),p=t("../../models/Task"),l=t("../../models/Tag"),i=t("../../models/Person"),h=t("../../models/TodoList"),u=t("../../models/Project"),f=t("../../models/TaskTimeTracking"),a=t("../../models/PersonTimeTracking"),n=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),s=t("../../../dscommon/DSTags"),d=t("../../models/types/TaskSplit"),c=t("../../utils/RMSData"),y.factory("TWTasks",["DSDataSource","dsChanges","config","$http","$q",function(t,e,o,g,y){var w;return w=function(w){function S(){return k.apply(this,arguments)}var D,k,T,b,P,O,$,A,j;return v(S,w),p.TWTask=S,p.planTag=o.planTag,S.begin("TWTasks"),S.addPool(),S.propDoc("source",t),S.propStr("request"),S.propSet("tasks",p),S.propPool("completedTasksPool",p),S.propObj("cancel",null),S.propObj("cancel2",null),
S.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),this.__unwatch1(),this.__unwatch2()}),T=S,S.calcTaskPriority=P=function(t){t.__setCalcPriority(p.defaultTag.priority),t.__setCalcStyle(p.defaultTag)},S.prototype.clear=function(){var t;n.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},S.propObj("visiblePersonTTracking",{}),k=function(){var t,e,o,r;n.apply(this,arguments),this.peopleMap={},this.projectMap={},this.todoListMap={},m&&a.prototype.hasOwnProperty("setVisible")&&console.error("TWTasks:ctor: setVisible expects that their will be only one instance of TWTasks object"),r=this.get("visiblePersonTTracking"),t=this.get("completedTasksPool"),o=this.get("tasksSet"),e=this,a.prototype.setVisible=function(n){var s,i;n?1===(this.__visCount=(this.__visCount||0)+1)&&(r[this.$ds_key]=this,null===(s=this.get("task"))&&((s=o.items[i=this.get("taskId")])?this.set("task",s):(this.set("task",s=t.find(this,""+i)),null===s.get("timeTracking")&&(s.set("id",i),s.set("timeTracking",f.pool.find(this,s.$ds_key)),$.call(e)),s.release(this))),s.setVisible(!0)):0===--this.__visCount&&(delete r[this.$ds_key],this.get("task").setVisible(!1))}},O=function(t,e){var o,n,r;return null!==(o=e.get("duedate"))&&(null===(r=e.get("split"))?t.startDate<=(n=e.get("duedate"))&&n<=t.endDate:t.startDate<=r.lastDate(o=e.get("duedate"))&&r.firstDate(o)<=t.endDate)},D=function(t){return!0},S.filter=function(t){switch(t.filter){case"all":return moment.isMoment(t.startDate)?function(e){return O(t,e)}:D;case"assigned":return function(e){return null!==e.get("responsible")&&O(t,e)};case"notassigned":return function(e){return null===e.get("responsible")&&O(t,e)};case"overdue":return function(t){var e;return null!==(e=t.get("duedate"))&&e<_.today};case"noduedate":return function(t){return null===t.get("duedate")};default:throw new Error("Not supported filter: "+t.filter)}},S.prototype.init=function(e){var o,n,r;this.set("request",function(){switch((n=this.get("params")).filter){case"all":return moment.isMoment(n.startDate)?"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&getSubTasks=no":"tasks.json?getSubTasks=no";case"assigned":return"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&responsible-party-ids=-1&getSubTasks=no";case"notassigned":return"tasks.json?startdate="+n.startDate.format("YYYYMMDD")+"&enddate="+n.endDate.format("YYYYMMDD")+"&responsible-party-ids=0&getSubTasks=no";case"overdue":return"tasks.json?filter=overdue&getSubTasks=no";case"noduedate":return"tasks.json?filter=nodate&include=noduedate&getSubTasks=no";default:throw new Error("Unexpected filter: "+n.filter)}}.call(this)),o=S.filter(this.params),r=this.get("tasksSet"),this.__unwatch1=p.pool.watch(this,function(t){return function(e){o(e)?r.items.hasOwnProperty(e.$ds_key)||r.add(t,e.addRef(t)):r.items.hasOwnProperty(e.$ds_key)&&r.remove(e)}}(this)),this.__unwatch2=t.setLoadAndRefresh.call(this,e),this.allTasksSet=o===D,this.init=null},j=function(){var t,e,o,n,r;e=this.peopleMap;for(t in e)r=e[t],r.release(this),delete this.peopleMap[t];o=this.todoListMap;for(t in o)r=o[t],r.release(this),delete this.todoListMap[t];n=this.projectMap;for(t in n)r=n[t],r.release(this),delete this.projectMap[t]},b=function(t,e){var n,r,a,p,f,m,g,y,_,v,w,S,D,k,b,P,O,$,A,j;if(_=i.pool.find(this,""+e["creator-id"],this.peopleMap),w=u.pool.find(this,""+e["project-id"],this.projectMap),A=h.pool.find(this,""+e["todo-list-id"],this.todoListMap),A.set("project",w),t.set("creator",_),t.set("project",w),t.set("todoList",A),t.set("title",e.content),t.set("estimate",(f=e["estimated-minutes"])?moment.duration(f,"minutes"):null),t.set("duedate",(p=e["due-date"])?moment(p,"YYYYMMDD"):null),t.set("startDate",(r=e["start-date"])?moment(r,"YYYYMMDD"):null),t.set("completed",e.completed),t.set("isReady",!0),($=e.timeIsLogged)&&t.set("firstTimeEntryId",$),a=e.description,n=c.get(a),null!==n&&(a=c.clear(a),n.hasOwnProperty("split")&&null!==p&&t.set("split",k=new d(n.split))),t.set("description",a),e["responsible-party-ids"]&&t.set("responsible",(D=e["responsible-party-ids"].split(",")).length>0?i.pool.find(this,""+D[0],this.peopleMap):null),_.set("id",parseInt(e["creator-id"])),e.hasOwnProperty("tags")){for(O=null,v=!1,S=e.tags,m=0,y=S.length;m<y;m++)b=S[m],b.name===o.planTag&&(v=!0),P=(null!=O?O:O={})[b.name]=l.pool.find(this,b.name),P.set("id",b.id),P.set("name",b.name),P.set("color",b.color),(O||(O={}))[b.name]=P;if(t.set("plan",v),null===O)t.set("tags",null);else{t.set("tags",new s(this,O)).release(this);for(g in O)j=O[g],j.release(this)}T.calcTaskPriority(t)}else t.set("tags",null),t.set("plan",!1);A.set("id",parseInt(e["todo-list-id"])),A.set("name",e["todo-list-name"]),w.set("id",parseInt(e["project-id"])),w.set("name",e["project-name"])},T=S,A=function(){var t;T.calcTaskPriority=P,t=function(t){return function(e,o){o||(console.error("error: ",e),t.set("cancel2",null))}}(this),g.get("data/tags.json?t="+(new Date).getTime(),this.set("cancel2",y.defer())).then(function(o){return function(n){var r,s,i,a,u,c,l,d,f,h;if(200===n.status){if(o.set("cancel2",null),h=n.data,!Array.isArray(h))return void console.error("invalid tags.json");for(s=!1,i=a=0,c=h.length;a<c;i=++a)f=h[i],"string"==typeof f.name&&f.name.length>=0||(s=!0,console.error("invalid tags.json: invalid 'name'",f)),f.hasOwnProperty("priority")?"number"!=typeof f.priority&&(s=!0,console.error("invalid tags.json: invalid 'priority'",f)):f.priority=i,!f.hasOwnProperty("color")||"string"==typeof f.color&&f.color.length>=0||(s=!0,console.error("invalid tags.json: invalid 'color'",f)),!f.hasOwnProperty("border")||"string"==typeof f.border&&f.border.length>=0||(s=!0,console.error("invalid tags.json: invalid 'border'",f));if(s)return;T.calcTaskPriority=r=function(t){var e,o,n,r;if(r=t.get("tags"))for(i=e=0,o=h.length;e<o;i=++e)if(n=h[i],r.get(n.name))return t.__setCalcPriority(n.priority),void t.__setCalcStyle(n);t.__setCalcPriority(p.defaultTag.priority),t.__setCalcStyle(p.defaultTag)},l=p.pool.items;for(u in l)f=l[u],r(f);d=e.get("tasksSet").$ds_pool.items;for(u in d)f=d[u],r(f)}else t(n,0===n.status)}}(this),t)},S.prototype.load=function(){var t,o,n,s,i,a,u;if(m&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(u={},s=function(t){return function(e){var o,n,r,s,i,a;p.pool.enableWatch(!1);try{for(s=a=e["todo-items"],o=0,r=s.length;o<r;o++)n=s[o],i=p.pool.find(t,""+n.id,u),i.set("id",parseInt(n.id)),b.call(t,i,n)}finally{p.pool.enableWatch(!0)}return 250===a.length}}(this),i=function(t){return function(e,o){var n,r;o||(console.error("error: ",e),t.set("cancel",null));for(n in u)r=u[n],r.release(t);j.call(t),t._endLoad(!1)}}(this),(t=this.get("cancel"))&&t.resolve(),(o=this.get("cancel2"))&&o.resolve(),this.allTasksSet&&A.call(this),(a=function(t){this.get("source").httpGet(this.get("request")+"&page="+t+"&pageSize=250",this.set("cancel",y.defer())).then(function(e){return function(o){200===o.status?(e.set("cancel",null),r.block(function(){return s(o.data,o.status)})?a.call(e,t+1):(r.block(function(){n.call(e),e.get("tasksSet").merge(e,u),j.call(e)}),e._endLoad(!0),$.call(e))):i(o,0===o.status)}}(this),i)}).call(this,1),n=function(){var t,o,n;t=e.tasks;for(n in t)o=t[n],u.hasOwnProperty(n)||o._clearChanges()})},$=function(){var t,e,o,n,s,i;if(null===this.get("cancel")){s=null,o=this.get("visiblePersonTTracking");for(t in o)if(i=o[t],!(n=i.get("task")).get("isReady")){s=n;break}null!==s&&(e=function(t){return function(e,o){o||(console.error("error: ",e),t.set("cancel",null)),s.release(t),j.call(t),t._endLoad(!1)}}(this),this.get("source").httpGet("/tasks/"+s.id+".json",this.set("cancel",y.defer())).then(function(t){return function(o){200===o.status?(t.set("cancel",null),r.block(function(){b.call(t,s,o.data["todo-item"]),j.call(t),$.call(t)})):e(o,0===o.status)}}(this),e))}},S.tasksSortRule=function(t,e){var o,n,r,s,i,a;return(n=t.get("priority"))!==(a=e.get("priority"))?n-a:(o=null!=(r=t.get("estimate"))?r.valueOf():void 0)!==(i=null!=(s=e.get("estimate"))?s.valueOf():void 0)?void 0===o?1:void 0===i?-1:i-o:t.get("id")-e.get("id")},S.end(),S}(n)}])},{"../../../dscommon/DSData":51,"../../../dscommon/DSDataSource":55,"../../../dscommon/DSDigest":56,"../../../dscommon/DSTags":64,"../../../dscommon/util":66,"../../models/Person":14,"../../models/PersonTimeTracking":16,"../../models/Project":17,"../../models/Tag":18,"../../models/Task":19,"../../models/TaskTimeTracking":20,"../../models/TodoList":21,"../../models/types/TaskSplit":23,"../../ui/time":34,"../../utils/RMSData":49}],12:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m,g=function(t,e){function o(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWTimeTracking",[t("../../config"),t("../../../dscommon/DSDataSource"),t("../../db")])).name,d=t("../../../dscommon/util").assert,f=t("../../../dscommon/util").error,m=t("../../ui/time"),u=t("../../models/Task"),l=t("../../models/TaskTimeTracking"),i=t("../../models/PersonTimeTracking"),n=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),c=t("../../models/types/TaskSplit"),a=t("../../utils/RMSData"),p=500,s=50,h.factory("TWTimeTracking",["DSDataSource","$q","db","config",function(t,e,o,a){var u;return u=function(o){function u(){return c.apply(this,arguments)}var c;return g(u,o),u.begin("TWTimeTracking"),u.addPool(),u.propDoc("source",t),u.propSet("taskTimeTracking",l),u.propSet("personTimeTracking",i),u.propObj("cancel",null),u.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),u.propObj("visibleTTracking",{}),c=function(){var t;n.apply(this,arguments),d&&l.prototype.hasOwnProperty("setVisible")&&console.error("TWTimeTracking:ctor: setVisible expects that their will be only one instance of TWTimeTracking object"),t=this.get("visibleTTracking"),l.prototype.setVisible=function(e){e?1!==(this.__visCount=(this.__visCount||0)+1)||this.get("isReady")||(t[this.$ds_key]=this):0===--this.__visCount&&delete t[this.$ds_key]}},u.prototype.clear=function(){var t;n.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchB&&this.__unwatchB()},u.filterPersonTimeTracking=function(t){return function(e){var o;return t.startDate<=(o=moment(e.get("date").startOf("day")))&&o<=t.endDate}},u.prototype.init=function(e){this.__unwatchA=t.setLoadAndRefresh.call(this,e),this.init=null},u.prototype.load=function(){var t,o,n,u,c,f,h,g,y,_,v,w,S,D,k,T;if(d&&!this.get("source"))throw new Error("load(): Source is not specified");if(this._startLoad()){"function"==typeof this.__unwatchB&&this.__unwatchB(),i.pool.enableWatch(!1),l.pool.enableWatch(!1),v=l.pool.items;for(S in v)k=v[S],k.set("isReady",!1),k.set("totalMin",0),k.set("priorTodayMin",0),k.set("timeEntries",{});w=i.pool.items;for(y in w)k=w[y],k.set("timeMin",0);_={},D={},c=function(t){return function(e){var o,n,r,s,a,u,c,d,f,h,g,y;for(n=0,s=e.length;n<s;n++)r=e[n],moment(r.date)>=m.historyLimit&&(f=parseInt(h=r["todo-item-id"]))&&(y=r.id,u=parseInt(c=r["person-id"]),a=60*parseInt(r.hours)+parseInt(r.minutes),o=moment(r.date).startOf("day"),d=i.pool.find(t,c+"-"+f+"-"+o.valueOf(),_),d.set("personId",u),d.set("date",o),d.set("taskId",f),d.set("timeMin",d.get("timeMin")+a),D.hasOwnProperty(h)?g=D[h]:(g=l.pool.find(t,h,D),g.set("taskId",f)),g.set("totalMin",g.get("totalMin")+a),g.get("timeEntries")[y]=!0,o<m.today&&g.set("priorTodayMin",g.get("priorTodayMin")+a));return e.length===p}}(this),o=function(t){return function(){r.block(function(){var e,o;e=l.pool.items;for(S in e)o=e[S],o.set("isReady",!0);t.__unwatchB||(t.__unwatchB=l.pool.watch(t,function(t){t.set("isReady",!0)})),i.pool.enableWatch(!0),t.get("personTimeTrackingSet").merge(t,_),l.pool.enableWatch(!0),t.get("taskTimeTrackingSet").merge(t,D)}),t._endLoad(!0)}}(this),f=function(t){return function(e,o){var n,r;o||(console.error("error: ",e),t.set("cancel",null));for(n in D)r=D[n],r.release(t);t._endLoad(!1)}}(this),g={},h=function(t){return function(n){g.hasOwnProperty(n)?r.block(function(){return c(g[n])})?h(n+1):o():t.get("source").httpGet("time_entries.json?page="+n+"&pageSize="+p,t.set("cancel",e.defer())).then(function(e){var s;200===e.status?(t.set("cancel",null),(s=e.data["time-entries"])&&0!==s.length?moment(s[s.length-1].date)<m.historyLimit?(a.set("histStart",n+1),s.length===p?h(n+1):o()):r.block(function(){return c(s)})?h(n+1):o():o()):f(e,0===e.status)},f)}}(this),T=1,t=s,(u=a.get("histStart"))>=0?h(u):(n=function(i){return function(u){i.get("source").httpGet("time_entries.json?page="+u+"&pageSize="+p,i.set("cancel",e.defer())).then(function(e){var l,p;200===e.status?(i.set("cancel",null),(l=e.data["time-entries"])&&0!==l.length?moment(l[0].date)>=m.historyLimit?T===u?(a.set("histStart",u),r.block(function(){return c(l)})?h(u+1):o()):(g[u]=l,n(T+Math.floor(((t=u)-T)/2))):moment(l[l.length-1].date)<m.historyLimit?t===u?(p=[t,t+s],T=p[0],t=p[1],n(t)):t===u+1?o():(T=u+1,n(T+Math.floor((t-T)/2))):(a.set("histStart",u),r.block(function(){return c(l)})?h(u+1):o()):n(T+Math.floor(((t=u)-T)/2))):f(e,0===e.status)},f)}}(this))(t)}},u.end(),u}(n)}])},{"../../../dscommon/DSData":51,"../../../dscommon/DSDataSource":55,"../../../dscommon/DSDigest":56,"../../../dscommon/util":66,"../../config":2,"../../db":13,"../../models/PersonTimeTracking":16,"../../models/Task":19,"../../models/TaskTimeTracking":20,"../../models/types/TaskSplit":23,"../../ui/time":34,"../../utils/RMSData":49}],13:[function(t,e,o){var n,r,s,i,a=function(t,e){function o(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=t("../dscommon/util").assert,i=t("../dscommon/util").serviceOwner,n=t("../dscommon/DSObject"),e.exports=(s=angular.module("db",[])).name,s.factory("db",["$q",function(t){var e,o;return o=null,e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,e),n.begin("DB"),n.propConst("name","RMS"),n.propConst("ver",4),n.prototype.logQuota=function(){},n.prototype.openDB=function(){var e;return window.indexedDB?(o||(o=t.defer(),e=window.indexedDB.open(this.get("name"),this.get("ver")),e.onsuccess=function(t){console.info("IndexedDB.openDB: Success"),o.resolve(t.target.result)},e.onerror=function(t){console.warn("IndexedDB.openDB: Error",t),o.reject()},e.onupgradeneeded=function(t){var e,n,r;console.info("IndexedDB.openDB: Upgrade",t),e=t.target.result;try{e.deleteObjectStore("timetracking")}catch(r){n=r}e.createObjectStore("timetracking",{keyPath:"page"}),o.resolve(e)}),o.promise):(console.warn("IndexedDB.openDB: Missing window.indexedDB, so there will be no local time tracking info"),void o.reject())},n.end(),n}(n),i.add(new e(i,"db"))}])},{"../dscommon/DSObject":60,"../dscommon/util":66}],14:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,n=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSTags"),e.exports=s=function(t){function e(){return o.apply(this,arguments)}var o;return u(e,t),e.begin("Person"),r.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propBool("missing"),e.propDuration("contractTime"),o=function(t,e){n.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(n)},{"../../dscommon/DSDocument":57,"../../dscommon/DSTags":64,"../../dscommon/util":66}],15:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,n=t("../../dscommon/DSObject"),r=t("./Person"),e.exports=s=function(t){function e(){return s.apply(this,arguments)}var o,s;return u(e,t),e.begin("PersonDayStat"),e.DayStat=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DayStat"),e.propMoment("day"),e.propNum("tasksCount"),e.propDuration("contract"),e.propDuration("tasksTotal"),e.propDuration("timeLeft"),e.propDuration("timeSpent"),e.end(),e}(n),s=function(t,e,s,u){var c,l,p,d,f;if(n.call(this,t,e),i)for(s instanceof r||a.invalidArg("person"),Array.isArray(u)||a.invalidArg("days"),p=0,f=u.length;p<f;p++)c=u[p],moment.isMoment(c)||a.invalidArg("days");this.set("person",s),d=0,this.get("dayStatsList").merge(this,function(){var t,e,n;for(n=[],t=0,e=u.length;t<e;t++)c=u[t],n.push(((l=new o(this,""+d++)).set("day",c),l));return n}.call(this))},e.propDoc("person",r),e.propList("dayStats",o),e.propDuration("totalPeriodTime"),e.end(),e}(n)},{"../../dscommon/DSObject":60,"../../dscommon/util":66,"./Person":14}],16:[function(t,e,o){var n,r,s,i=function(t,e){function o(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},a={}.hasOwnProperty;n=t("../../dscommon/DSObject"),s=t("../models/Task"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("PersonTimeTracking"),e.addPool(!0),e.propNum("personId",0),e.propMoment("date"),e.propNum("taskId",0),e.propDoc("task",s),e.propNum("timeMin",0),e.end(),e}(n)},{"../../dscommon/DSObject":60,"../models/Task":19}],17:[function(t,e,o){var n,r,s,i,a=function(t,e){function o(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,n=t("../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propStr("status"),e.propObj("people"),e.end(),e}(n)},{"../../dscommon/DSObject":60,"../../dscommon/util":66}],18:[function(t,e,o){var n,r,s,i,a=function(t,e){function o(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,n=t("../../dscommon/DSDocument"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Tag"),e.addPool(),e.propNum("id",0),e.propStr("name"),e.propStr("color"),e.end(),e}(n)},{"../../dscommon/DSDocument":57,"../../dscommon/util":66}],19:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m,g=function(t,e){function o(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},y={}.hasOwnProperty;f=t("../../dscommon/util").assert,h=t("../../dscommon/util").error,m=t("../ui/time"),r=t("../../dscommon/DSDocument"),a=t("./Project"),i=t("./Person"),d=t("./TodoList"),p=t("./TaskTimeTracking"),u=t("./Tag"),s=t("../../dscommon/DSTags"),n=t("./types/Comments"),l=t("./types/TaskSplit"),e.exports=c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var o,r,c,f;return g(e,t),e.begin("Task"),n.addPropType(e),l.addPropType(e),s.addPropType(e),e.defaultTag=o={name:"[default]",priority:1e3},e.addPool(!0),c={__onChange:function(t,o,n,r){var i,a,c;switch(o){case"plan":c=t.get("tags"),c?(c=c.clone(this),n?c.get(e.planTag)||(c.set(e.planTag,a=u.pool.find(this,e.planTag)),a.release(this),t.set("tags",c)):c.get(e.planTag)&&(c.set(e.planTag,!1),t.set("tags",c.empty()?null:c)),c.release(this)):n&&((i={})[e.planTag]=a=u.pool.find(this,e.planTag),c=new s(this,i),t.set("tags",c),c.release(this));break;case"tags":e.TWTask.calcTaskPriority(t),console.info("set plan"),t.set("plan",!(!n||!n.get(e.planTag)))}}},f={__onChange:function(t,o,n,r){"tags"===o&&e.TWTask.calcTaskPriority(t)}},e.ds_ctor.push(function(){this.__proto__.constructor.ds_editable?this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(c):this.$ds_evt=[c]:this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(f):this.$ds_evt=[f]}),e.str=function(t){return null===t?"":t.get("title")},e.propNum("id",0),e.propStr("title"),e.propDuration("estimate").str=function(t){var e,o,n;return e=Math.floor(t.asHours()),o=t.minutes(),n=e?e+"h":"",o&&(n+=" "+o+"m"),n||(n="0"),n},e.propMoment("duedate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propMoment("startDate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propDoc("creator",i),e.propDoc("responsible",i),e.propDoc("todoList",d),e.propDoc("project",a),e.propTaskRelativeSplit("split"),e.propStr("description"),e.propComments("comments"),e.propDoc("timeTracking",p),e.propStr("firstTimeEntryId"),e.propBool("completed"),e.propBool("isReady"),e.propBool("plan"),e.propDSTags("tags"),e.propNum("priority",1e3,null,!0),e.propObj("style",function(){return o},null,!0),e.prototype.isOverdue=function(){var t;return null!==(t=this.get("duedate"))&&t<m.today},e.prototype.timeWithinEstimate=function(){var t;return null===(t=this.get("estimate"))?0:Math.min(100,Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))},e.prototype.timeAboveEstimate=function(){var t,e;return null===(t=this.get("estimate"))?0:(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))<=100?0:e>200?100:e-100},e.prototype.timeReported=function(){var t,e;return null===(t=this.get("estimate"))?"":(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))>200?e+" %":""},e.prototype.grade=function(){var t;return null===(t=this.get("estimate"))?"":t.asMinutes()<60?"easy":t.asMinutes()>=60&&t.asMinutes()<240?"medium":t.asMinutes()>=240&&t.asMinutes()<480?"hard":t.asMinutes()>=480?"complex":void 0},e.prototype.setVisible=function(t){var e,o;t?1===(this.__visCount=(this.__visCount||0)+1)&&null!=(e=this.get("timeTracking"))&&e.setVisible(!0):0===--this.__visCount&&null!=(o=this.get("timeTracking"))&&o.setVisible(!1)},e.end(),r=e.Editable.prototype.init,e.Editable.prototype.init=function(){r.apply(this,arguments),e.TWTask.calcTaskPriority(this)},e}(r)},{"../../dscommon/DSDocument":57,"../../dscommon/DSTags":64,"../../dscommon/util":66,"../ui/time":34,"./Person":14,"./Project":17,"./Tag":18,"./TaskTimeTracking":20,"./TodoList":21,"./types/Comments":22,"./types/TaskSplit":23}],20:[function(t,e,o){var n,r,s=function(t,e){function o(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;n=t("../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("TaskTimeTracking"),e.addPool(!0),e.propNum("taskId",0),e.propBool("isReady"),e.propNum("totalMin",0),e.propNum("priorTodayMin",0),e.propObj("timeEntries",{}),e.end(),e}(n)},{"../../dscommon/DSObject":60}],21:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,n=t("../../dscommon/DSObject"),r=t("./Project"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TodoList"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",0),e.propStr("name"),e.propDoc("project",r),e.end(),e}(n)},{"../../dscommon/DSObject":60,"../../dscommon/util":66,"./Project":17}],22:[function(t,e,o){var n,r,s,i;s=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,r=t("../../../dscommon/DSDocument"),e.exports=n=function(){function t(){return e.apply(this,arguments)}var e,o;return t.addPropType=function(e){e.propComments=function(o,n){var r;return s&&n&&"function"!=typeof n&&i.invalidArg("valid"),n=(r=n)?function(t){return(null===t||Array.isArray(t))&&r(t)?t:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:o,type:"comments",valid:n,read:function(e){return null!==e?new t(e):null},str:function(){return"split"},equal:function(t,e){var o,n,r,s,i;if(null===t||null===e)return t===e;if(t.list.length!==e.list.length)return!1;for(i=t.list,o=n=0,r=i.length;n<r;o=++n)if(s=i[o],s!==e.list[o])return!1;return!0},init:null})}},o=moment.duration(0),e=function(e){var o,n,r,a;if(s)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(o=0,n=e.length;o<n;o++)a=e[o],"string"!=typeof a&&i.invalidArg("persisted");1===arguments.length&&"object"==typeof(r=arguments[0])&&r.__proto__===t.prototype?this.list=r.list.slice():this.list=e||[]},t.prototype.clone=function(){return new t(this)},t.prototype.add=function(t){this.list.push(t)},t.prototype.unshift=function(t){this.list.unshift(t)},t.prototype.shift=function(){return this.list.shift()},t.prototype.valueOf=function(){return this.list},t.prototype.clear=function(){this.list=[]},t}()},{"../../../dscommon/DSDocument":57,"../../../dscommon/util":66}],23:[function(t,e,o){var n,r,s,i;s=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,n=t("../../../dscommon/DSDocument"),e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,o;return t.addPropType=function(e){e.propTaskRelativeSplit=function(o,n){var r;return s&&n&&"function"!=typeof n&&i.invalidArg("valid"),n=(r=n)?function(e){return(null===e||"object"==typeof e&&e instanceof t)&&r(e)?e:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:o,type:"taskRelativeSplit",valid:n,read:function(e){return null!==e?new t(e):null},str:function(t){return t?"split":""},equal:function(t,e){var o,n,r,s,i,a;if(null===t||null===e)return t===e;if((r=null!=t?t.list:void 0).length!==(i=null!=e?e.list:void 0).length)return!1;for(o=n=0,s=r.length;n<s;o=n+=2)if(a=r[o],a!==i[o]||r[o+1].valueOf()!==i[o+1].valueOf())return!1;return!0},init:null})}},o=moment.duration(0),e=function(e){var o,n,r,a,u,c,l,p,d;if(s)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(e.length%2!==0&&i.invalidArg("persisted"),r=0,u=e.length;r<u;r++)d=e[r],"number"!=typeof d&&i.invalidArg("persisted");if(1===arguments.length&&"object"==typeof(p=arguments[0])&&p.__proto__===t.prototype)this.list=p.list.slice();else if(this.list=l=[],Array.isArray(e))for(n=a=0,c=e.length;a<c;n=a+=2)o=e[n],l.push(moment.duration(o,"day").valueOf()),l.push(moment.duration(e[n+1],"minute"))},t.prototype.clone=function(){return new t(this)},t.prototype.set=function(t,e,o){var n,r,a,u,c,l,p;for(s&&(moment.isMoment(t)||i.invalidArg("duedate"),moment.isMoment(e)||i.invalidArg("date"),null===o||moment.isDuration(o)||i.invalidArg("estimate")),r=e.diff(t),p=l=this.list,a=u=0,c=p.length;u<c;a=u+=2){if(n=p[a],n===r){if(null!==o&&0!==o.valueOf()){if(l[a+1].valueOf()===o.valueOf())return;l[a+1]=o}else l.splice(a,2);return void delete this.value}if(r<n)return 0!==(null!=o?o.valueOf():void 0)&&l.splice(a,0,r,o),void delete this.value}return 0!==(null!=o?o.valueOf():void 0)&&(delete this.value,l.push(r),l.push(o)),this},t.prototype.get=function(t,e){var o,n,r,a,u,c,l;for(s&&(moment.isMoment(t)||i.invalidArg("duedate"),moment.isMoment(e)||i.invalidArg("date")),n=e.diff(t),l=c=this.list,r=a=0,u=l.length;a<u;r=a+=2)if(o=l[r],o===n)return c[r+1];return null},t.prototype.day=function(t,e){var o;return s&&(moment.isMoment(e)||i.invalidArg("date")),Object.defineProperty(o={},"val",{get:function(o){return function(){return o.get(t(),e)}}(this),set:function(o){return function(n){return o.set(t(),e,n)}}(this)}),o},t.prototype.valueOf=function(){var t,e,o,n,r,s,i,a,u;if(u=this.value)return u;for(this.value=i=[],s=r=this.list,e=o=0,n=s.length;o<n;e=o+=2)a=s[e],t=r[e+1],i.push(moment.duration(a).asDays()),i.push(t.asMinutes());return i},t.prototype.shift=function(t,e){var o,n,r,a,u,c,l;if(s)switch(arguments.length){case 1:"number"!=typeof t&&i.invalidArg("diff");break;case 2:moment.isMoment(t)||i.invalidArg("newDuedate"),moment.isMoment(e)||i.invalidArg("oldDuedate");break;default:throw new Error("Invalid arguments")}if(delete this.value,o="number"==typeof t?t:t.diff(e),0!==o)for(c=u=this.list,n=r=0,a=c.length;r<a;n=r+=2)l=c[n],u[n]-=o},t.prototype.firstDate=function(t){var e;return s&&(moment.isMoment(t)||i.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[0]):null},t.prototype.lastDate=function(t){var e;return s&&(moment.isMoment(t)||i.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[e.length-2]):null},t.prototype.clear=function(){delete this.value,this.list=[]},t.prototype.fixEstimate=function(t){var e,o,n,r,s,i;if(t>0)this.list[this.list.length-1].add(t);else if(t<0)for(s=r=this.list.slice(1),e=o=0,n=s.length;o<n;e=o+=2)if(i=s[e],(t+=i.valueOf())>0){this.list[e+1]=moment.duration(t),this.list=this.list.slice(e);break}},Object.defineProperty(t.prototype,"total",{get:function(){var t,e,n,r,s,i;if(0===(n=this.list).length)return o;if(1===n.length)return n[1];for(s=moment.duration(n[1]),r=n.slice(3),t=0,e=r.length;t<e;t+=2)i=r[t],s.add(i);return s}}),t}()},{"../../../dscommon/DSDocument":57,"../../../dscommon/util":66}],24:[function(t,e,o){var n;e.exports=(n=angular.module("app",["ui.router","ui.select",t("./ui/ui"),t("./data/dsDataService"),t("./svc/emails/emails"),t("./db")])).name,n.run(["config","$rootScope","db",function(t,e,o){e.Math=Math,e.taskModal={},e.startDateVal=null,e.view3ActiveTab=null}]),n.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(t,e,o){o.html5Mode(!0),t.otherwise("/")}])},{"./data/dsDataService":7,"./db":13,"./svc/emails/emails":25,"./ui/ui":35}],25:[function(t,e,o){var n,r,s,i,a;s=t("../../../utils/base64"),r=t("../../models/Task"),n=t("../../models/Person"),e.exports=(a=angular.module("svc-emails",[t("../../data/dsDataService")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,o,n){e.state({name:"emails",url:"/emails",templateUrl:function(){return"./svc/emails/main.html"},controller:i})}]),i=["$scope","$http","$sce","config","dsDataService",function(t,e,o,i,a){var u,c;t.dateCheck="",t.isDateCheckOk=function(){return!!/\d{1,2}\.\d{2}\.\d{4}/.test(t.dateCheck)&&moment(t.dateCheck,"DD.MM.YYYY").startOf("day").valueOf()===moment().startOf("day").valueOf()},t.state="notStarted",t.data=null,t.formatDuration=u=function(t){var e,o,n;return e=Math.floor(t.asHours()),o=t.minutes(),n=e?e+" ч.":"",o&&(n&&(n+=" "),n+=o+" мин."),n},t.prepare=function(){var e,s,i,c,l,p,d,f,h;c=a.findDataSet(this,{type:n,mode:"original"}),p=a.findDataSet(this,{type:r,mode:"original",filter:"assigned",startDate:l=moment().startOf("week"),endDate:s=moment(l).add(6,"days")}),i=function(t){var e,n,r;return n=u(t.planHours),e=u(t.optHours),r=n,e&&(r&&(r+=" + "),r+="<span style='background-color:rgb(255,153,0)'>"+e+"</span>"),t.hours=o.trustAsHtml(r),t},e=function(){var e,o,n,r,a,d,f,h,m,g,y,v,w,S,D,k,T,b,P;for(console.info("compute started..."),t.emails=r=[],S=h=_.sortBy(_.map(c.items),function(t){return t.get("name")}),d=0,f=S.length;d<f;d++)if(m=S[d],null!==m.get("roles")){w={},D=p.items;for(b in D)if(T=D[b],T.get("responsible")===m&&null!==T.get("estimate")&&462667!==T.get("todoList").get("id"))if((v=w[y=(g=T.get("project")).$ds_key])||(v=w[y]={
id:g.get("id"),name:g.get("name"),planHours:moment.duration(),optHours:moment.duration(),manager:""}),a=T.get("title").toLowerCase().indexOf("бронь")!==-1||T.get("todoList").get("name").toLowerCase().indexOf("бронь")!==-1?v.optHours:v.planHours,k=T.get("split"))for(o=T.get("duedate"),e=moment(l);e<=s;)null!==(n=k.get(o,e))&&a.add(n),e.add(1,"day");else a.add(T.get("estimate"));P=moment.duration(),(w=_.map(w,function(t){return P.add(t.planHours),P.add(t.optHouras),i(t)})).length>0&&(w=_.sortBy(w,function(t){return t.name}),r.push({person:m,toName:m.get("firstName"),startDate:l.format("DD.MM"),endDate:s.format("DD.MM.YYYY"),totalHours:u(P),projects:w,status:"notSent"}))}console.info("compute finished: ",r)},h=function(){"ready"===c.status&&"ready"===p.status&&(e(),d(),f())},d=c.watchStatus(this,h),f=p.watchStatus(this,h),c.release(this),p.release(this)},c=function(o){var n,r,i,a,u;r=t.emails[o],i=template({email:r}),a=r.person.get("roles"),u=r.person.get("email"),n="managers@webprofy.ru",(a.get("Designer")||a.get("Jr. Designer"))&&(n+=", a.shevtsov@webprofy.ru, a.kolesnikov@webprofy.ru"),a.get("Markuper")&&(n+=", n.skinteev@webprofy.ru, s.yastrebov@webprofy.ru"),console.info("to: ",u),console.info("cc: ",n),e({method:"POST",url:"https://thawing-chamber-8269.herokuapp.com/https://api.mailgun.net/v3/webprofy.ru/messages",data:$.param({to:r.person.get("email"),cc:n,from:"Татьяна Верхотурова <t.verkhoturova@webprofy.ru>",subject:r.title,html:i}),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+s.encode("api:key-3ccadef54df260c8a2903da328ebb165")}}).then(function(e){console.info("ok: ",e),r.status="sent",o+1===t.emails.length?t.state="completed":c(o+1)},function(e){console.error("error: ",e),t.state="error"})},t.sendOut=function(){t.state="inProgress",c(0)}}]},{"../../../utils/base64":68,"../../data/dsDataService":7,"../../models/Person":14,"../../models/Task":19}],26:[function(t,e,o){var n;e.exports=(n=angular.module("ui/account/rmsAccount",[t("../../config")])).name,n.run(["$rootScope",function(t){t.isShowAccount=!1,t.showAccount=function(){t.isShowAccount=!t.isShowAccount}}]),n.directive("rmsAccount",["config","$rootScope",function(t,e){return{restrict:"A",scope:!0,link:function(o,n,r){var s;o.$evalAsync(function(){$($("input",n)[1]).select()}),o.url=t.teamwork,o.token=t.token,o.refreshPeriod=t.refreshPeriod,o.save=function(){var e,n;n=o.url.trim(),e=o.token.trim(),n.length>0&&"/"!==n.charAt(n.length-1)&&(n+="/"),t.teamwork=n,t.token=e,t.refreshPeriod=o.refreshPeriod,s()},o.close=s=function(){e.isShowAccount=!1}}}}])},{"../../config":2}],27:[function(t,e,o){var n,r,s,i,a;r=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,n=t("../../dscommon/DSObject"),e.exports=(a=angular.module("ui/filters",[])).name,s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a.run(["$rootScope",function(t){t.filter={calendarHeader:function(t,e){var o,a,u,c,l;if(r&&(t instanceof n||i.invalidArg("doc"),(c=t.__proto__.__props).hasOwnProperty(e)||i.invalidArg("prop"),"moment"!==(l=c[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+l);if(!(o=t.get(e)))throw new Error("Non null date expected in the header");return a=moment(o).format("YYYYMMDD"),u=o.month()+1,u<10&&(u="0"+u),s[o.day()]+" "+o.date()+"/<small>"+u+"</small>"},shortDate:function(t,e){var o,s,a;if(r&&(t instanceof n||i.invalidArg("doc"),(s=t.__proto__.__props).hasOwnProperty(e)||i.invalidArg("prop"),"moment"!==(a=s[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+a);return o=t.get(e),o?o.format("DD.MM"):""},taskPeriod:function(e,o,s){var a,u,c,l,p,d;if(r&&e&&(e instanceof n||i.invalidArg("doc"),(l=e.__proto__.__props).hasOwnProperty(o)||i.invalidArg("prop"),"duration"!==(d=l[o].type)))throw new Error("Expected property with type 'duration', but property '"+o+"' has type "+d);return p="",s?(moment.isDuration(s)?(u=Math.floor(s.asHours()),c=s.minutes()):(u=Math.floor((s=s.get("timeMin"))/60),c=s%60),u||c?(p+=u?u+"h ":"",c&&(p+=c+"m")):p+="0"):null===typeof s&&(p+="0"),e&&(a=e.get(o))&&("undefined"!=typeof s&&t.dataService.showTimeSpent&&(p+=" / "),u=Math.floor(a.asHours()),c=a.minutes(),p+=u?u+"h":"",u&&c&&(p+=" "),c&&(p+=c+"m"),p||(p+="0")),p},taskPeriodLight:function(t){var e,o,n;return r&&(moment.isDuration(t)||i.invalidArg("duration")),t?(e=Math.floor(t.asHours()),o=t.minutes(),n=e?e+"h":"",o&&(n+=" "+o+"m"),n||(n="0"),n):""},periodDiff:function(t){var e,o,n,s;return r&&(null===t||moment.isDuration(t)||i.invalidArg("diff")),t&&null!==(s=t.valueOf())?(n=s<0?(t=moment.duration(-s),"- "):"+ ",e=Math.floor(t.asHours()),o=t.minutes(),n+=e+"h",o&&(n+=" "+o+"m"),n||(n="0"),n):""},timeLeft:function(t){var e,o,n,s;return r&&(null===t||moment.isDuration(t)||i.invalidArg("diff")),t&&null!==(s=t.valueOf())?(n=s<0?(t=moment.duration(-s),"- "):"",e=Math.floor(t.asHours()),o=t.minutes(),n+=e+"h "+(o<10?"0"+o:o)+"m"):""},taskEditDueDate:function(t){return r&&t&&!moment.isMoment(t)&&i.invalidArg("date"),t?t.format("DD.MM.YYYY"):""},splitDuration:function(e,o){var n,r,s;return s="",o?(n=Math.floor((o=o.get("timeMin"))/60),r=o%60,n||r?(s+=n?n+"h ":"",r&&(s+=r+"m")):s+="0"):null===typeof o&&(s+="0"),e&&("undefined"!=typeof o&&t.dataService.showTimeSpent&&(s+=" / "),n=Math.floor(e.asHours()),r=e.minutes(),s=n?n+"h":"",r&&(s+=" "+r+"m"),s||(s="0")),s}}}])},{"../../dscommon/DSObject":60,"../../dscommon/util":66}],28:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m;l=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,e.exports=(f=angular.module("ui/layout",[])).name,i=140,a=730,u=10,c=10,m=900,h=i+c,d=40,s=440,r=440,f.directive("uiLayout",["config","$window","$rootScope",function(t,e,o){return e=$(e),{restrict:"A",controller:["$scope",function(n){var r;n.layout=this,this.area1={},this.area2={},this.area3={},this.width=e.width(),this.area3.height=this.height=e.height()-d,r=function(){o.$digest(),o.$broadcast("layout-update")},(this.setVResizer=function(e,o){var n;n=this.area1.width=this.area2.width=this.vResizer=Math.min(Math.max(Math.round(e),a),this.width-c),this.area3.width=this.width-n,t.set("vResizer",this.area1.width/this.width),o||r()}).call(this,this.width*(t.get("vResizer")||.68),!0),(this.setHResizer=function(e,o){var n;n=this.area1.height=this.hResizer=Math.min(Math.max(Math.round(e),i),this.height-u),this.area2.height=this.height-n,t.set("hResizer",this.area1.height/this.height),o||r()}).call(this,this.height*(t.get("hResizer")||.68),!0),this.setSize=function(t,e,o){var n,s,i;e-=d,n=!1,(i=this.width)!==t&&(n=!0,this.setVResizer(this.vResizer*((this.width=Math.max(t,m))/i),!0)),(s=this.height)!==e&&(n=!0,this.setHResizer(this.hResizer*((this.height=Math.max(e,h))/s),!0),this.area3.height=e),n&&!o&&r()}}],link:function(t,o,n,r){var s;e.on("resize",s=function(){r.setSize(e.width(),e.height())}),t.$on("$destroy",function(){e.off("resize",s)})}}}]),f.directive("uiLayoutResizer",["$document",function(t){return{restrict:"A",require:"^uiLayout",link:function(e,o,n,r){var s,i,a,u;s="horizontal"===n.uiLayoutResizer,o.on("mousedown",u=function(e){e.preventDefault(),t.on("mousemove",i),t.on("mouseup",a)}),i=s?function(t){r.setHResizer(t.pageY-d)}:function(t){r.setVResizer(t.pageX)},a=function(e){t.off("mousemove",i),t.off("mouseup",a)},e.$on("$destroy",function(){t.off("mousedown",u),a()})}}}]),n=function(){function t(){return e.apply(this,arguments)}var e;return e=function(t){this.elem=t},t.prototype.innerHeight=function(){return this.elem.innerHeight()},t}(),f.directive("uiLayoutContainer",["$document",function(t){return{restrict:"A",link:function(t,e,o){t.uiContainer=new n(e)}}}])},{"../../dscommon/util":66}],29:[function(t,e,o){var n,r,s,i,a,u,c,l,p=function(t,e){function o(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("ui/tasks/TaskSplitWeekView",[t("../../../dscommon/DSView")])).name,u=t("../../../dscommon/util").assert,n=t("../../../dscommon/DSObject"),a=t("../../models/types/TaskSplit"),i=t("../../models/Task"),r=t("../../models/Person"),s=t("../../models/PersonDayStat"),l=t("../time"),c.factory("TaskSplitWeekView",["DSView","$log",function(t,e){var o,i;return o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.begin("DayModel"),e.ds_dstr.push(function(){"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2()}),e.propDuration("timeLeft"),e.propDuration("timeLeftShow"),e.propObj("plan"),e.propDuration("initPlan"),e.propBool("select"),e.end(),e}(n),i=function(e){function n(){return i.apply(this,arguments)}var i;return p(n,e),n.begin("TaskSplitWeekView"),a.addPropType(n),n.propData("personDayStat",s,{mode:"edited"}),n.propList("days",o),n.propMoment("monday"),n.propDoc("responsible",r),n.propMoment("today"),n.propMoment("duedate"),n.propTaskRelativeSplit("split"),i=function(e,n,r,s,i){var c,p,d,f,h,m;u&&(!s instanceof a&&error.invalidArg("split"),moment.isMoment(i)||error.invalidArg("monday")),t.call(this,e,n),this.set("split",s),this.set("monday",i),e.$watch("edit.responsible",function(t){return function(e){t.set("responsible",e),t.__dirty++}}(this)),this.dataUpdate({startDate:i,endDate:moment(i).endOf("week"),mode:e.mode}),h=e.edit.split,m=e.edit.splitDuedate,p=moment(i),this.get("daysList").merge(this,f=function(){var t,n,i;for(t=function(t){return function(t,o){var n;return t.set("initPlan",n=null===h?null:h.get(m,o)),t.set("plan",s.day(r,o)),o.valueOf()===l.today?t.set("select",!0):o>l.today&&(t.__unwatch1=e.$watch("edit.duedate",function(e){t.set("select",null!==e&&o<=e)})),t.__unwatch2=e.$watch(function(){var o,n,r;return[null!=(o=e.$eval("edit.responsible"))?o.$ds_key:void 0,null!=(n=t.get("plan"))?n.val:void 0,null!=(r=t.get("timeLeft"))?r.valueOf():void 0]},function(o){var r,s,i,a,u;a=o[0],s=o[1],u=o[2],"number"!=typeof u?t.set("timeLeftShow",null):(r=moment.duration(u),null!==n&&null!==(i=e.task.get("responsible"))&&i.$ds_key===a&&r.add(n),moment.isDuration(s)&&r.subtract(s),t.set("timeLeftShow",r))},!0)}}(this),i=[],c=n=0;n<7;c=++n)d=new o(this,""+c),t(d,p),(p=moment(p)).add(1,"day"),i.push(d);return i}.call(this))},n.prototype.render=function(){var t,e,o,n,r,s,i,a,c,l,p;if(null===(l=this.get("responsible"))||"ready"!==(p=this.data.get("personDayStatStatus"))&&"update"!==p)for(c=this.get("days"),r=0,i=c.length;r<i;r++)t=c[r],t.set("timeLeft",null);else{if(u&&!this.data.get("personDayStat").hasOwnProperty(l.$ds_key))throw new Error("Missing person");for(e=this.data.get("personDayStat")[l.$ds_key].get("dayStats"),a=this.get("days"),o=n=0,s=a.length;n<s;o=++n)t=a[o],t.set("timeLeft",e[o].get("timeLeft"))}},n.end(),n}(t)}])},{"../../../dscommon/DSObject":60,"../../../dscommon/DSView":65,"../../../dscommon/util":66,"../../models/Person":14,"../../models/PersonDayStat":15,"../../models/Task":19,"../../models/types/TaskSplit":23,"../time":34}],30:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d=function(t,e){function o(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("../../../dscommon/util").assert,c=t("../../../dscommon/util").error,p=t("../../../dscommon/util").serviceOwner,i=t("../../../dscommon/DSObject"),s=t("../../../dscommon/DSDocument"),r=t("../../../dscommon/DSDigest"),n=t("../../models/types/Comments"),a=t("../../models/Person"),e.exports=(l=angular.module("ui/tasks/addCommentAndSave",[t("../../config"),t("../../data/dsDataService"),t("../../data/dsChanges")])).name,l.run(["$rootScope",function(t){t.AddCommentAndSave=null}]),l.factory("addCommentAndSave",["dsDataService","dsChanges","config","$rootScope","$q",function(t,e,o,a,l){var f,h;return f=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return d(o,t),o.begin("AddCommentAndSave"),o.propDoc("document",s),o.propList("documents",s),o.propObj("changes"),o.propStr("reason",""),o.propBool("plansChange"),o.prototype.show=function(t,e,o){var n,r,i,p,d,f,h,m,g,y,_,v,w;if(u&&(null!==t&&(Array.isArray(t)&&t.length>0&&t[0]instanceof s||t instanceof s)||c.invalidArg("document"),"boolean"!=typeof e&&c.invalidArg("showDialog"),null!==o&&"object"==typeof o||c.invalidArg("changes")),this.__deferred=l.defer(),o.hasOwnProperty("plan")&&!o.plan)if(Array.isArray(t)){for(i=0,d=t.length;i<d;i++)if(r=t[i],r.get("plan")){m=this.set("plansChange",!0);break}}else t.get("plan")&&(m=this.set("plansChange",!0));if(Array.isArray(t)){for(p=0,f=t.length;p<f;p++)r=t[p],r.addRef(this);this.get("documentsList").merge(this,t),t=this.set("document",t[0])}else this.set("document",t);h=[],n=!1,v=t.__props;for(_ in v)if(y=v[_],o.hasOwnProperty(_)){if(!t.$u.hasOwnProperty(_)){console.error("Doc "+t.toString()+": Prop "+_+": Property is not editable");continue}if("undefined"==typeof y.valid(w=o[_])){console.error("Doc "+t.toString()+": Prop "+_+": Invalid value '"+w+"'");continue}y.equal(t.get(_),w=o[_])||(n=!0,h.push({propName:_,value:w,text:null===w?"-":y.str(w)})),delete o[_]}for(_ in o)console.error("Doc "+t.toString()+": Has no property '"+_+"'");return g=this.__deferred.promise,n?(this.set("changes",h),e||m?a.addCommentAndSave=this:(this.saveWOComment(),this.freeDocs())):(this.set("document",null),this.get("documentsList").merge(this,[]),this.__deferred.resolve(!0),delete this.__deferred),g},o.prototype.save=function(){this.addCommentAndSave(),a.addCommentAndSave=null},o.prototype.cancel=function(){this.freeDocs(),a.addCommentAndSave=null,this.__deferred.resolve(!1),delete this.__deferred},o.prototype.freeDocs=function(){this.set("reason",""),this.set("document",null),this.get("documentsList").merge(this,[]),this.set("changes",null)},o.prototype.addCommentAndSave=function(){r.block(function(t){return function(){var o,r,s,i,a,u,c,l,p,d,f,h,m;(a=e.get("hist")).startBlock();try{for(s=t.get("document"),0===(i=t.get("documents")).length&&(i=null),h=t.get("changes"),u=0,p=h.length;u<p;u++)if(o=h[u],i)for(c=0,d=i.length;c<d;c++)s=i[c],s.set(o.propName,o.value);else s.set(o.propName,o.value);if((r=t.get("reason").trim()).length>0)if(m=function(t){var e;e=null===(e=t.get("comments"))?new n:e.clone(),e.add(r),t.set("comments",e)},i)for(l=0,f=i.length;l<f;l++)s=i[l],m(s);else m(s)}finally{a.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},o.prototype.saveWOComment=function(){r.block(function(t){return function(){var o,n,r,s,i,a,u,c,l;(s=e.get("hist")).startBlock();try{for(n=t.get("document"),0===(r=t.get("documents")).length&&(r=null),l=t.get("changes"),i=0,u=l.length;i<u;i++)if(o=l[i],r)for(a=0,c=r.length;a<c;a++)n=r[a],n.set(o.propName,o.value);else n.set(o.propName,o.value)}finally{s.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},o.end(),o}(i),h=p.add(new f(p,"addCommentAndSave")),function(t,e,o){return h.show(t,e,o)}}])},{"../../../dscommon/DSDigest":56,"../../../dscommon/DSDocument":57,"../../../dscommon/DSObject":60,"../../../dscommon/util":66,"../../config":2,"../../data/dsChanges":6,"../../data/dsDataService":7,"../../models/Person":14,"../../models/types/Comments":22}],31:[function(t,e,o){var n;e.exports=(n=angular.module("ui/tasks/rmsTask",[])).name,n.run(["$rootScope",function(t){t.modal={type:null}}]),n.directive("rmsTask",["$rootScope","$timeout",function(t,e){return{restrict:"A",require:"ngModel",link:function(e,o,n,r){var s;o.on("click",function(e){var n;e.stopPropagation(),"task-edit"!==(n=t.modal).type?(t.modal={type:"task-edit",task:r.$viewValue,pos:o.offset()},t.$digest()):n.task!==r.$viewValue&&(t.modal={type:null},t.$digest(),t.$evalAsync(function(){t.modal={type:"task-edit",task:r.$viewValue,pos:o.offset()}},0))}),o.on("mouseover",function(e){e.stopPropagation(),0<=["task-info",null].indexOf(t.modal.type)&&(t.modal={type:"task-info",task:r.$viewValue,pos:o.offset()},t.$digest())}),o.on("mouseleave",function(e){e.stopPropagation(),0<=["task-info"].indexOf(t.modal.type)&&(t.modal={type:null},t.$digest())}),s=void 0,"taskView.time.task"!==n.rmsTask&&e.$watch(n.rmsTask+".style",function(t){o.css("background-color",t.color?t.color:""),o.css("border",t.border?t.border:"")}),e.$watch(n.rmsTask+".$u",function(r){var i;r?(i=o[0],i.draggable=!0,i.addEventListener("dragstart",s=function(r){var s;return t.modal={type:"drag-start",task:s=e.$eval(n.rmsTask),scope:e},t.$digest(),o.addClass("drag-start"),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("task",s),r.dataTransfer.setDragImage($("#task-drag-ghost")[0],20,20),!0}),i.addEventListener("dragend",function(e){return t.modal={type:null},o.removeClass("drag-start"),t.$digest(),!0})):(i=o[0],i.draggable=!1,i.removeEventListener("dragstart",s),o.off("dragend"))})}}}]),n.directive("setTaskVisible",[function(){return{restrict:"A",link:function(t,e,o){var n;n=o.setTaskVisible,t.$eval(n+".setVisible(true)"),t.$on("$destroy",function(){t.$eval(n+".setVisible(false)")})}}}])},{}],32:[function(t,e,o){var n,r,s,i,a,u,c,l;e.exports=(u=angular.module("ui/tasks/rmsTaskEdit",[t("../../data/dsChanges"),t("../../data/dsDataService"),t("./TaskSplitWeekView"),t("./addCommentAndSave")])).name,a=t("../../../dscommon/util").assert,l=t("../../ui/time"),n=t("../../../dscommon/DSDigest"),r=t("../../models/Person"),i=t("../../models/types/TaskSplit"),s=t("../../models/PersonDayStat"),c=3,u.directive("rmsTaskEdit",["TaskSplitWeekView","dsDataService","dsChanges","addCommentAndSave","$rootScope","$window","$timeout",function(t,e,o,n,u,p,d){return{restrict:"A",scope:!0,link:function(o,p,d){var f,h,m,g,y,v,w,S,D,k,T,b,P,O;return w=u.modal,o.edit=m={},P=null,S=function(e){return new t(o,"TaskSplitWeekView "+e.format(),function(){return m.splitDuedate},m.split,e)},v=function(){var t,e,n;t=m.firstWeek,m.splitView=function(){var o,r,s;for(s=[],n=o=0,r=c;0<=r?o<r:o>r;n=0<=r?++o:--o)e=S(t),(t=moment(t)).add(1,"week"),s.push(e);return s}(),P=o.$watch(function(){var t;return null!=(t=m.split.lastDate(m.splitDuedate))?t.valueOf():void 0},function(t){var e;m.split.shift(e=moment(t),m.splitDuedate),m.splitDuedate=e})},D=function(){var t,e,n,r;for(n=m.splitView,t=0,e=n.length;t<e;t++)r=n[t],r.release(o);m.splitView=null,P()},o.$evalAsync(function(){$($("input",p)[1]).select()}),o.people=_.map(r.pool.items,function(t){return t}),o.task=T=w.task,o.$watch(function(){return l.today.valueOf()},function(){return o.today=l.today}),m.title=T.get("title"),m.duedate=h=T.get("duedate"),m.estimate=T.get("estimate"),m.responsible=T.get("responsible"),m.splitDiff=null,m.firstWeek=b=moment().startOf("week"),m.splitDuedate=null!==h?h:moment().startOf("day"),(m.isSplit=null!==(m.split=null!==(k=T.get("split"))?k.clone():null))?(g=moment(k.firstDate(h)).startOf("week"),y=moment(k.lastDate(h)).startOf("week"),(O=moment.duration(y.diff(g)).asWeeks())<c?g.isBefore(b)?m.firstWeek=g:moment.duration(y.diff(b)).asWeeks()<=c||(m.firstWeek=y.subtract(c-1,"week")):m.firstWeek=g,v()):m.splitView=null,(o.viewonly=!T.$u||_.isEmpty(T.$u))||(o.changes=!1,o.$watch(function(){var t,e,o,n;return e=[m.title,null===(h=m.duedate)?null:h.valueOf(),null===(t=m.estimate)?null:t.valueOf(),null===(o=m.responsible)?null:o.$ds_key],null!==(k=m.split)&&(n=k.valueOf()).length>0&&(e=e.concat(n)),e},function(t,e){o.changes=t!==e},!0),o.$watch(function(){return m.isSplit},function(t){var e;t?(null===m.split&&(m.split=new i),null===m.splitView&&v()):null!==m.splitView&&D(),(null!=(e=m.split)?e.valueOf().length:void 0)>0&&(o.changes=!0)}),o.$watch(function(){var t;return null!=(t=m.duedate)?t.valueOf():void 0},function(t,e){t!==e&&(o.changes=!0,null!==m.split&&null!==t&&null!==e&&m.splitDuedate.add(t-e))}),o.$watch(function(){var t;return[null!=(t=m.estimate)?t.valueOf():void 0,m.isSplit,m.split]},function(t){var e,o,n,r,s,i;e=t[0],o=t[1],s=t[2],"number"==typeof e&&o&&null!==s?(r=(n=moment.duration(s.total).subtract(e)).valueOf(),m.splitDiff=0===r||null!==(i=m.splitDiff)&&i.valueOf()===r?null:n):m.splitDiff=null},!0),o.splitPrevWeek=function(){m.firstWeek.subtract(1,"week"),m.splitView.unshift(S(m.firstWeek)),m.splitView.pop().release(o)},o.splitNextWeek=function(){var t;t=moment(m.firstWeek.add(1,"week")).add(c-1,"week"),m.splitView.push(S(t)),m.splitView.shift().release(o)}),o.close=f=function(){u.modal={type:null}},o.save=function(t,e){var o,r,s,i;a&&"undefined"!=typeof e&&"boolean"!=typeof e&&error.invalidArg("plan"),m.isSplit&&m.split.list.length>0&&(m.duedate=m.splitDuedate,s=k.total,null===(r=m.estimate)?m.estimate=s:0!==(o=r.valueOf()-s.valueOf())&&k.fixEstimate(o)),i={title:m.title,duedate:m.duedate,estimate:m.estimate,responsible:m.responsible,split:m.isSplit&&m.split.valueOf().length>0?m.split:null},"boolean"==typeof e&&(i.plan=e),n(T,t.shiftKey,i).then(function(t){t&&f()})},o.showTimeLeft=function(t){var e,n,r,s,i,a,u,c;return null===(u=t.get("timeLeft"))?"":(i=t.get("plan"),r=t.get("initPlan"),e=moment.duration(u),null!==r&&o.task.get("responsible")===m.responsible&&e.add(r),null!==(c=i.val)&&e.subtract(c),a=(c=e.valueOf())<0?(e=moment.duration(-c),"- "):"",n=Math.floor(e.asHours()),s=e.minutes(),a+=n+"h "+(s<10?"0"+s:s)+"m")},o.$on("$destroy",function(){"function"==typeof o._unwatch&&o._unwatch()}),o.autoSplitInProgress=!1,o.autoSplit=function(){var t,n,r,i,u,c,p,d;if(a){if(!(null!==m.duedate&&l.today<=m.duedate))throw new Error("Invalid duedate: "+(null!=(u=m.duedate)?u.format():void 0));if(null===m.responsible)throw new Error("Invalid value 'edit.responsible': "+m.responsible);if(!(null!==m.estimate&&m.estimate>0))throw new Error("Invalid value 'edit.estimate': "+(null!=(c=m.estimate)?c.valueOf():void 0))}o.autoSplitInProgress=!0,p=m.responsible.$ds_key,t=moment(h=m.duedate),n=moment.duration(m.estimate),(k=m.split).clear(),m.splitDuedate=moment(t),r=o.task.get("duedate"),i=null!==r&&o.edit.responsible===o.task.get("responsible")?o.task.get("split"):null,(d=function(){var a,u;a=e.findDataSet(o,{type:s,mode:"edited",startDate:u=moment(t).startOf("week"),endDate:moment(t).endOf("week")}),o._unwatch=a.watchStatus(o,function(e,s,a,c){var f,m,g,y,_;if("ready"===s){for(m=e.items[p].get("dayStats");n>0&&l.today<=t&&u<=t;)_=(f=m[moment.duration(t.diff(u)).asDays()]).timeLeft,null!==i&&null!==(y=i.get(r,t))&&(_=moment.duration(_)).add(y),_>0&&(k.set(h,t,g=moment.duration(Math.min(_.valueOf(),n.valueOf()))),n.subtract(g)),t.subtract(1,"day");c(),delete o._unwatch,n>0&&l.today<=t?(t.subtract(2,"days"),d()):o.autoSplitInProgress=!1}}),a.release(o)})()}}}}])},{"../../../dscommon/DSDigest":56,"../../../dscommon/util":66,"../../data/dsChanges":6,"../../data/dsDataService":7,"../../models/Person":14,"../../models/PersonDayStat":15,"../../models/types/TaskSplit":23,"../../ui/time":34,"./TaskSplitWeekView":29,"./addCommentAndSave":30}],33:[function(t,e,o){var n,r,s,i;e.exports=(i=angular.module("ui/tasks/rmsTaskInfo",[])).name,r=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,n=t("../../../dscommon/DSObject"),i.directive("rmsTaskInfo",["$rootScope","$window",function(t,e){return{restrict:"A",scope:!0,link:function(e,o,n){var r;r=t.modal,$(window).height()>r.pos.top+150?e.top=Math.ceil(r.pos.top+50):e.top=Math.ceil(r.pos.top-100),$(window).width()-$("#sidebar").innerWidth()>r.pos.left?e.left=Math.ceil(r.pos.left+95):e.left=Math.ceil(r.pos.left-300),e.task=r.task}}}])},{"../../../dscommon/DSObject":60,"../../../dscommon/util":66}],34:[function(t,e,o){var n,r;e.exports=n={today:moment().startOf("day"),historyLimit:moment().startOf("week").subtract(2,"weeks")},(r=function(){setTimeout(function(){n.today=moment().startOf("day"),r()},moment().startOf("day").add(1,"day").add(20,"seconds").valueOf()-(new Date).getTime())})()},{}],35:[function(t,e,o){var n,r,s,i,a,u,c;s=t("../../dscommon/util").assert,i=t("../../dscommon/util").error,u=t("../../dscommon/util").totalRelease,n=t("../../dscommon/DSObjectBase"),r=t("../models/PersonDayStat"),e.exports=(a=angular.module("ui/ui",["ui.router","ngSanitize",t("./views/view1/View1"),t("./views/view2/View2"),t("./views/view3/View3"),t("./views/changes/ViewChanges"),t("./account/rmsAccount"),t("./widgets/widgetDate"),t("./widgets/widgetDuration"),t("./tasks/rmsTask"),t("./tasks/rmsTaskEdit"),t("./tasks/TaskSplitWeekView"),t("./tasks/rmsTaskInfo"),t("./tasks/addCommentAndSave"),t("./layout"),t("./filters")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,o,n){e.state({name:"/",url:"/",templateUrl:function(){return"./ui/main.html"},controller:c}),u&&e.state({name:"totalRelease",url:"/totalRelease",templat:"<div/>"})}]),u&&a.run(["$state","$rootScope",function(t,e){var o;return o=window.totalRelease,window.totalRelease=function(){t.go("totalRelease"),e.$evalAsync(function(){o(),setTimeout(function(){console.info(window.totalPool)},1e3)})}}]),c=["$rootScope","$scope",function(t,e){e.mode="edited",e.setMode=function(t){e.mode=t},e.taskSummaryColor=function(t){var e;return s&&(t instanceof r.DayStat||i.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?"red":e/t.get("contract").valueOf()<=.2?"green":"light-yellow"},e.dayTaskWidth=function(t){var e;return s&&(t instanceof r.DayStat||i.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?100:Math.round(100*(1-e/t.get("contract").valueOf()))},e.taskViewExpand=function(t){e.period.people[t].tasks.expand=!e.period.people[t].tasks.expand}}]},{"../../dscommon/DSObjectBase":61,"../../dscommon/util":66,"../models/PersonDayStat":15,"./account/rmsAccount":26,"./filters":27,"./layout":28,"./tasks/TaskSplitWeekView":29,"./tasks/addCommentAndSave":30,"./tasks/rmsTask":31,"./tasks/rmsTaskEdit":32,"./tasks/rmsTaskInfo":33,"./views/changes/ViewChanges":36,"./views/view1/View1":38,"./views/view2/View2":42,"./views/view3/View3":43,"./widgets/widgetDate":47,"./widgets/widgetDuration":48}],36:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("ui/views/changes/ViewChanges",[t("../../../data/dsChanges"),t("../../../../dscommon/DSView")])).name,u=t("../../../../dscommon/util").assert,s=t("../../../../dscommon/DSObject"),r=t("../../../../dscommon/DSDigest"),a=t("../../../models/Task"),i=t("../../../models/Person"),n=t("./models/Change"),c.run(["$rootScope",function(t){t.showChanges=function(){t.modal="changes"!==t.modal.type?{type:"changes"}:{type:null}}}]),c.controller("ViewChanges",["$scope","ViewChanges","dsChanges","$rootScope",function(t,e,o,n){t.view=new e(t,"viewChanges"),t.save=function(){o.save().then(function(t){t&&(n.modal={type:null})})},t.reset=function(){o.reset(),n.modal={type:null}}}]),c.directive("viewChangesFix",[function(){return{restrict:"A",link:function(t,e,o){var n,r;r=$(".main-table.header",e),n=$(".main-table.data",e),r.width(n.width())}}}]),c.factory("ViewChanges",["DSView","dsChanges","$log",function(t,e,o){var s;return s=function(o){function s(){return i.apply(this,arguments)}var i;return l(s,o),s.begin("ViewChange"),s.propData("tasks",a,{mode:"changes"}),s.propPool("poolChanges",n),s.propList("changes",n),i=function(e,o){t.call(this,e,o),this.dataUpdate({})},s.ds_dstr.push(function(){var t,e,o;t=this.get("data").get("tasksSet").items;for(o in t)e=t[o],delete e.__change.__refreshView}),s.prototype.render=function(){var t,o,n,s,i,a,u,c,l,p,d,f,h,m,g,y,_,v,w;if("ready"!==(v=this.get("data").get("tasksStatus"))&&"update"!==v)return void this.get("changesList").merge(this,[]);a=this.get("poolChanges"),o=[],p=(_=this.get("data").get("tasksSet")).type.prototype.__props,s=!1,h=function(t){return function(){t.__dirty++}}(this),d=_.items;for(y in d){g=d[y],s=!s,i=!0,g.__change.__refreshView=h,m=function(t){return function(){var o;(o=e.get("hist")).startBlock();try{r.block(function(){var e,o,n;n=t.__change;for(o in n)e=n[o],"__error"!==o&&"__refreshView"!==o&&t.set(o,t.$ds_doc.get(o))})}finally{o.endBlock()}h()}}(g),f=g.__change;for(l in f)c=f[l],"__error"!==l&&"__refreshView"!==l&&"comments"!==l&&(u=p[l],o.push(t=a.find(this,g.$ds_key+"."+l)),t.set("isDark",s),i&&(i=!1,t.set("doc",g)),t.set("prop",l),t.set("value",null===(w=c.v)?" -":u.str(c.v)),t.set("conflict",u.equal(n=g.$ds_doc.get(l),c.s)?null:null===n?" -":u.str(n)),m&&(t.remove=m,m=null));g.__change.__error&&(o.push(t=a.find(this,g.$ds_key+".__error")),t.set("isDark",s),t.set("error",g.__change.__error))}this.get("changesList").merge(this,o)},s.end(),s}(t)}])},{"../../../../dscommon/DSDigest":56,"../../../../dscommon/DSObject":60,"../../../../dscommon/DSView":65,"../../../../dscommon/util":66,"../../../data/dsChanges":6,"../../../models/Person":14,"../../../models/Task":19,"./models/Change":37}],37:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("../../../../../dscommon/util").assert,a=t("../../../../../dscommon/util").error,s=t("../../../../../dscommon/DSObject"),r=t("../../../../../dscommon/DSDocument"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("Change"),e.propDoc("doc",r),e.propStr("prop"),e.propStr("value"),e.propStr("conflict"),e.propStr("error"),e.propBool("isDark"),e.end(),e}(s)},{"../../../../../dscommon/DSDocument":57,"../../../../../dscommon/DSObject":60,"../../../../../dscommon/util":66}],38:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f,h,m=function(t,e){function o(){this.constructor=t}for(var n in e)g.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},g={}.hasOwnProperty;e.exports=(f=angular.module("ui/views/view1/View1",[t("../../../config"),t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,d=t("../../../../dscommon/util").assert,n=t("../../../../dscommon/DSDigest"),l=t("../../../models/Task"),c=t("../../../models/Tag"),s=t("../../../models/Person"),i=t("../../../models/PersonDayStat"),a=t("../../../models/PersonTimeTracking"),r=t("./models/Day"),u=t("./models/Row"),p=t("./models/TaskView"),h=t("../../../../dscommon/util").serviceOwner,f.controller("View1",["$scope","View1","$rootScope",function(t,e,o){o.view1=t.view=new e(t,"view1"),t.$on("$destroy",function(){delete o.view1}),t.expandedHeight=function(t){return t.expand?_.isEmpty(t.tasks)?"height:100px":"height:"+(65*_.maxBy(t.tasks,"y").y+98)+"px":""}}]),f.factory("View1",["DSView","config","$rootScope","$log","TWTasks",function(t,e,o,n,c){var p;return p=function(n){function p(){return d.apply(this,arguments)}var d,f,h;return m(p,n),p.begin("View1"),p.propData("people",s,{watch:["roles","companyId"]}),p.propData("tasks",l,{filter:"assigned",watch:["responsible","duedate","split","estimate","priority"]}),p.propData("personDayStat",i,{}),p.propData("personTimeTracking",a,{watch:[]}),p.propMoment("startDate"),p.propList("days",r),p.propPool("poolRows",u),p.propList("rows",u),p.propObj("hiddenPeople",{}),p.propNum("hiddenPeopleCount",0),p.ds_dstr.push(function(){this.__unwatchA(),this.__unwatchB(),this.__unwatchC()}),d=function(n,r){var s,i,a,u,c,l,p,d,f;if(t.call(this,n,r),this.scope=n,this.set("startDate",moment().startOf("week")),n.filterLoad=[n.selectedLoad={id:0,name:"All"},{id:-1,name:"Underload"},{id:1,name:"Overload"}],f=e.get("selectedLoad"))for(l=n.filterLoad,i=0,u=l.length;i<u;i++)s=l[i],s.id===f&&(n.selectedLoad=s);if(e.hasRoles&&(n.filterCompanies=[{id:null,name:"All"},n.selectedCompany={id:23872,name:"WebProfy"},{id:50486,name:"Freelancers"}],d=e.get("selectedCompany")))for(p=n.filterCompanies,a=0,c=p.length;a<c;a++)s=p[a],s.id===d&&(n.selectedCompany=s);this.__unwatchA=n.$watch(function(t){return function(){
var e;return[null!=(e=t.get("startDate"))?e.valueOf():void 0,n.mode,n.dataService.showTimeSpent]}}(this),function(t){return function(e){var o,n,r;r=e[0],o=e[1],n=e[2],t.dataUpdate({startDate:moment(r),endDate:moment(r).add(6,"days"),mode:o,showTimeSpent:n})}}(this),!0),this.__unwatchB=n.$watch(function(){return[n.selectedRole,n.selectedCompany,n.selectedLoad]},function(t){return function(n){var r,s,i;return i=n[0],r=n[1],s=n[2],o.peopleRoles&&e.set("selectedRole",i?i.role:null),e.set("selectedCompany",r?r.id:null),e.set("selectedLoad",s?s.id:0),t.__dirty++}}(this),!0),this.__unwatchC=n.$watch(function(t){return function(){return[e.get("currentUserId"),t.get("data").get("peopleStatus")]}}(this),function(t){return function(o){var n,r;return n=o[0],r=o[1],null===n||"ready"!==r&&"update"!==r?void e.set("currentUser",null):void e.set("currentUser",t.get("data").get("people")[n])}}(this),!0)},p.prototype.periodChange=function(t){this.set("startDate",this.startDate.add(t,"week"))},p.prototype.hideRow=function(t){this.get("hiddenPeople")[t.$ds_key]=!0,this.hiddenPeopleCount++,this.__dirty++},p.prototype.unhideAll=function(){this.set("hiddenPeople",{}),this.hiddenPeopleCount=0,this.__dirty++},p.prototype.render=function(){var t,o,n,s,i,a,u,c,l,d,f,h,m,g,y,v,w,S,D,k,T,b,P,O,$,A,j,C,L,M,R,x;if("ready"!==(m=this.get("data").get("peopleStatus"))&&"update"!==m)return void this.get("rowsList").merge(this,[]);C=this.get("startDate"),o=this.get("daysList").merge(this,_.map([0,1,2,3,4,5,6],function(t){return function(e,o){var n,s;return n=moment(C).add(e,"days"),s=new r(t,n.format()),s.set("date",n),s.set("index",o),s.set("x",e),s}}(this))),u=function(){return!0},c=this.get("hiddenPeople");for(d in c){u=function(t){return!c.hasOwnProperty(t.$ds_key)};break}if(e.get("hasRoles")){if((null!=(D=this.scope.selectedCompany)?D.id:void 0)?(t=this.scope.selectedCompany.id,s=u,u=function(e){return s(e)&&e.get("companyId")===t}):s=u,null!=(k=this.scope.selectedRole)?k.role:void 0)if(j=this.scope.selectedRole,i=u,j.hasOwnProperty("roles")){for(O={},T=j.roles.split(","),l=0,f=T.length;l<f;l++)S=T[l],O[S.trim()]=!0;u=function(t){var e;return i(t)&&(null!=(e=t.get("roles"))?e.any(O):void 0)}}else if(j.hasOwnProperty("special"))switch(j.special){case"notSupervisors":u=function(t){var e;return i(t)&&(null===(e=t.get("roles"))||!e.get("Manager"))};break;default:console.error("Unexpected role.special value: "+P.special,j)}else P=j.role,u=function(t){var e;return i(t)&&(null!=(e=t.get("roles"))?e.get(P):void 0)};if(0!==(null!=(b=this.scope.selectedLoad)?b.id:void 0)){if("ready"!==this.get("data").get("personDayStatStatus"))return;g=this.get("data").get("personDayStat"),h=1===this.scope.selectedLoad.id?function(t){var e,o,n,r;for(r=g[t.$ds_key].get("dayStats"),o=0,n=r.length;o<n;o++)if(e=r[o],e.get("timeLeft")<0)return!0;return!1}:function(t){var e,o,n,r;for(r=g[t.$ds_key].get("dayStats"),o=0,n=r.length;o<n;o++)if(e=r[o],e.get("timeLeft").valueOf()/e.get("contract").valueOf()>.2)return!0;return!1},a=u,u=function(t){return a(t)&&h(t)}}}A=_.filter(this.data.get("people"),u),A.sort(function(t,e){var o,n;return(o=t.name.toLowerCase())<(n=e.name.toLowerCase())?-1:o>n?1:0}),w=this.get("poolRows"),$=this.get("rowsList").merge(this,_.map(A,function(t){return function(e){var o;return o=w.find(t,e.$ds_key),o.set("person",e),o}}(this))),n=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),x=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),"ready"!==(M=this.get("data").get("tasksStatus"))&&"update"!==M||"ready"!==(y=this.get("data").get("personDayStatStatus"))&&"update"!==y?_.forEach($,function(t){return function(e){e.get("tasksList").merge(t,[]),e.set("personDayStat",null)}}(this)):(L=_.groupBy(this.data.tasks,function(t){return t.get("responsible").$ds_key}),R=null,"ready"===this.data.personTimeTrackingStatus&&(x=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),R=_.groupBy(v=this.data.personTimeTracking,function(t){return t.get("personId")})),_.forEach($,function(t){return function(e){var o,r,s,i,a,u,c,l,d,f,h,m,y,w,S,D,k,T,b,P,O,$,A,j;for(e.set("personDayStat",g=t.data.get("personDayStat")[e.$ds_key]),S=r=g.get("dayStats"),u=c=0,l=S.length;c<l;u=++c)i=S[u],n[u].add(i.get("tasksTotal"));if(O=e.get("tasksPool"),T={},P=_.map(L[e.$ds_key],function(o){var n,r,s,i,a,u,c,l,p,d;if(p=O.find(t,o.$ds_key),p.set("task",o),R)if(c=o.get("split"))for(r=o.get("duedate"),l=(s=c.firstDate(r))<=C?0:moment.duration(s.diff(C)).asDays(),u=t.get("days").slice(l,7),a=0,i=u.length;a<i;a++)n=u[a],(d=v[e.$ds_key+"-"+o.$ds_key+"-"+n.get("date").valueOf()])&&(T[d.$ds_key]=!0);else(d=v[e.$ds_key+"-"+o.$ds_key+"-"+o.get("duedate").valueOf()])?(T[d.$ds_key]=!0,p.set("time",d)):p.set("time",null);return p}),R&&(A=R[e.$ds_key])){for(m=0,d=A.length;m<d;m++)$=A[m],T[$.$ds_key]||(P.push(b=O.find(t,$.$ds_key)),b.set("time",$));for(j=_.groupBy(A,function(t){return t.get("date").valueOf()}),D=g.get("dayStats"),u=y=0,f=D.length;y<f;u=++y)o=D[u],(s=j[o.get("day").valueOf()])?x[u].add(o.set("timeSpent",_.reduce(s,function(t,e){return t.add(e.get("timeMin"),"m")},moment.duration()))):o.set("timeSpent",null)}else for(k=g.get("dayStats"),w=0,h=k.length;w<h;w++)o=k[w],o.set("timeSpent",null);e.get("tasksList").merge(t,P),a=null,R&&(a=function(t,o){return($=v[e.$ds_key+"-"+t.get("task").$ds_key+"-"+o.valueOf()])?$:null}),p.layoutTaskView(C,P,a)}}(this))),_.forEach(o,function(t,e){t.set("workTime",n[e]),t.set("timeSpent",0===x[e].valueOf()?null:x[e])})},p.taskViewsSortRule=h=function(t,e){var o,n;return o=t.get("task"),n=e.get("task"),null===o&&null===n?e.get("time").get("taskId")-t.get("time").get("taskId"):null===o?1:null===n?-1:c.tasksSortRule(o,n)},f=function(t,e,o,n,r){var s,i,a,u,c,l,p,d,f,h,m,g,y,_,v,w;if(e.set("x",n),i=t[n],0===n)w=i.length;else for(w=u=0,p=i.length;u<p&&(_=i[w],"undefined"!=typeof _);w=++u);if(e.set("y",w),null===(g=e.get("task"))||null===(m=g.get("split")))e.set("split",null),e.set("len",1),w===i.length&&i.length++,i[w]=!0;else for(l=e.set("len",Math.min(moment.duration(moment(m.lastDate(g.get("duedate"))).diff(o)).asDays()+1,7-n)),v=e.set("split",[]),h=c=0,f=l;0<=f?c<f:c>f;h=0<=f?++c:--c)s=0===h?o:moment(o).add(h,"day"),y=r?r(e,s):null,null===(d=m.get(g.duedate,s))&&null===y||v.push({x:h,plan:d,time:y}),(a=t[n+h]).length<=w&&(a.length=w),a[w]=!0;return w},p.layoutTaskView=function(t,e,o){var n,r,s,i,a,u,c,l,p,d,m,g;if(c=0,_.some(e,function(t){var e;return null!=(e=t.get("task"))?e.get("split"):void 0}))for(m=_.groupBy(e,function(t){var e,o,n;return(n=t.get("task"))?(e=n.get("duedate"),(null!==(o=n.get("split"))?o.firstDate(e):e).valueOf()):t.get("time").get("date").valueOf()}),l=function(){var t,e;for(e=[],i=t=0;t<=6;i=++t)e.push([]);return e}(),s=function(){var t;t=[];for(p in m)t.push(parseInt(p));return t}().sort(),a=0,u=s.length;a<u;a++)n=s[a],(g=m[n]).sort(h),r=moment.duration((d=moment(n)).diff(t)).asDays(),r<0&&(r=0,d=t),_.forEach(g,function(t){c=Math.max(c,f(l,t,d,r,o))});else m=_.groupBy(e,function(t){var e;return((e=t.get("time"))?e.get("date"):t.get("task").get("duedate")).valueOf()}),_.forEach(m,function(e,o){var n,r;e.sort(h),r=moment.duration(((n=e[0].get("time"))?n.get("date"):e[0].get("task").get("duedate")).diff(t)).asDays(),_.forEach(e,function(t,e){t.set("x",r),c=Math.max(c,t.set("y",e)),t.set("len",1),t.set("split",null)})});return c},p.end(),p}(t)}]),f.factory("getDropTasksGroup",["dsDataService","$rootScope",function(t,e){var o;return o=h.add(t.findDataSet(h,{type:l,mode:"edited",filter:"all"})),function(){var t,n,r,s,i,a;return t=e.modal.task.get("duedate").valueOf(),i=e.modal.task.get("responsible"),r=e.modal.task.get("project"),s=function(){var e,s,u;e=o.items,u=[];for(n in e)a=e[n],a.plan||a.split||a.get("responsible")!==i||(null!=(s=a.get("duedate"))?s.valueOf():void 0)!==t||a.get("project")!==r||u.push(a);return u}(),0===s.length?[e.modal.task]:s}}]),f.directive("rmsView1DropTask",["View1","$rootScope","dsChanges","addCommentAndSave","getDropTasksGroup",function(t,e,o,n,r){return{restrict:"A",scope:!0,link:function(t,o,s){var i;return i=o[0],i.addEventListener("dragover",function(t){return t.preventDefault(),!0}),i.addEventListener("drop",function(s){var i,a,u;return i=_.findIndex($(".drop-zone",o),function(t){var e;return e=$(t),e.offset().left+e.width()>=s.clientX}),u=!s.ctrlKey||(a=e.modal).task.split||null===a.task.duedate?[e.modal.task]:r(),i<0?n(u,s.shiftKey,{responsible:t.row.get("person"),plan:!1}):n(u,s.shiftKey,{responsible:t.row.get("person"),duedate:t.view.get("days")[i].get("date"),plan:!1}),e.$digest(),s.stopPropagation(),!1})}}}]),f.directive("rmsView1MouseOverWeekChange",["View1","$rootScope","dsChanges","addCommentAndSave",function(t,e,o,n){return{restrict:"A",link:function(t,o,n){var r,s,i;r=t.$eval(n.rmsView1MouseOverWeekChange),i=0,s=o[0],s.addEventListener("dragover",function(t){return t.timeStamp>i&&(i=t.timeStamp+3e3,e.view1.periodChange(r),e.$digest()),t.preventDefault(),!0})}}}])},{"../../../../dscommon/DSDigest":56,"../../../../dscommon/DSView":65,"../../../../dscommon/util":66,"../../../config":2,"../../../data/dsChanges":6,"../../../data/dsDataService":7,"../../../data/teamwork/TWTasks":11,"../../../models/Person":14,"../../../models/PersonDayStat":15,"../../../models/PersonTimeTracking":16,"../../../models/Tag":18,"../../../models/Task":19,"../../tasks/addCommentAndSave":30,"./models/Day":39,"./models/Row":40,"./models/TaskView":41}],39:[function(t,e,o){var n,r,s=function(t,e){function o(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;n=t("../../../../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("Day"),e.propMoment("date"),e.propNum("index"),e.propNum("x"),e.propDuration("workTime"),e.propDuration("timeSpent"),e.end(),e}(n)},{"../../../../../dscommon/DSObject":60}],40:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;u=t("../../../../../dscommon/util").assert,c=t("../../../../../dscommon/util").error,n=t("../../../../../dscommon/DSObject"),r=t("../../../../models/Person"),s=t("../../../../models/PersonDayStat"),a=t("./TaskView"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.begin("Row"),e.propPool("tasksPool",a),e.propDoc("person",r),e.propDoc("personDayStat",s),e.propList("tasks",a),e.propBool("expand",!1),e.end(),e}(n)},{"../../../../../dscommon/DSObject":60,"../../../../../dscommon/util":66,"../../../../models/Person":14,"../../../../models/PersonDayStat":15,"./TaskView":41}],41:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,s=t("../../../../models/Task"),r=t("../../../../models/PersonTimeTracking"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskView"),e.propDoc("task",s),e.propDoc("time",r),e.propNum("x",0,a.required),e.propNum("y",0,a.required),e.propNum("len",1,a.required),e.propObj("split"),e.end(),e}(n)},{"../../../../../dscommon/DSObject":60,"../../../../../dscommon/util":66,"../../../../models/PersonTimeTracking":16,"../../../../models/Task":19}],42:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("ui/views/view2/View2",[t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../view1/View1"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,i=t("../../../../dscommon/util").assert,n=t("../../../../dscommon/DSDigest"),r=t("../../../models/Task"),s=t("../view1/models/TaskView"),a.controller("View2",["$scope","View2",function(t,e){t.view=new e(t,"view2"),t.tasksHeight=function(t){return!t.expand||_.isEmpty(t.tasks)?"":"height:"+(52*_.maxBy(t.tasks,"y").y+100)+"px"}}]),a.factory("View2",["View1","DSView","$rootScope","$log","TWTasks",function(t,e,o,n,i){var a;return a=function(o){function n(){return a.apply(this,arguments)}var a,c;return u(n,o),n.begin("View2"),n.propData("tasksOverdue",r,{filter:"overdue",watch:["duedate","plan","estimate","priority"]}),n.propData("tasksNotAssigned",r,{filter:"notassigned",watch:["duedate","split","plan","estimate","priority"]}),n.propList("tasksOverdue",r),n.propPool("poolTasksNotassignedViews",s),n.propList("tasksNotAssigned",s),n.propNum("tasksNotAssignedHeight",0),n.ds_dstr.push(function(){this.__unwatchA()}),a=function(t,o){e.call(this,t,o),this.__unwatchA=t.$watch(function(){var e;return[null!=(e=t.$parent.view.startDate)?e.valueOf():void 0,t.mode]},function(t){return function(e){var o,n;n=e[0],o=e[1],t.dataUpdate({startDate:moment(n),endDate:moment(n).add(6,"days"),mode:o})}}(this),!0)},c=function(t,e){var o,n;return o=t.get("task"),n=e.get("task"),i.tasksSortRule(o,n)},n.prototype.render=function(){var e,o,n,r,s;o=this.__scope.$parent.view.startDate,"ready"!==(n=this.get("data").get("tasksOverdueStatus"))&&"update"!==n?this.get("tasksOverdueList").merge(this,[]):(s=_.map(this.get("data").get("tasksOverdue"),function(t){return function(e){return e.addRef(t),e}}(this)),s.sort(i.tasksSortRule),this.get("tasksOverdueList").merge(this,s)),"ready"!==(n=this.get("data").get("tasksNotAssignedStatus"))&&"update"!==n?(this.get("tasksNotAssignedList").merge(this,[]),this.set("tasksNotAssignedHeight",0)):(e=this.get("poolTasksNotassignedViews"),r=this.get("tasksNotAssignedList").merge(this,_.map(this.get("data").get("tasksNotAssigned"),function(t){return function(o){var n;return n=e.find(t,o.$ds_key),n.set("task",o),n}}(this)).sort(c)),this.set("tasksNotAssignedHeight",t.layoutTaskView(o,r)))},n.end(),n}(e)}]),a.directive("rmsView2DayDropTask",["dsChanges","$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,o,n){return{restrict:"A",scope:!0,link:function(t,r,s){var i,a;i=r[0],a=function(t){var e,o;return e=_.findIndex($(".vertical-lines > .col",r),function(e){var o;return o=$(e),o.offset().left+o.width()>=t.clientX}),-1<=(o=--e)&&o<=6?e:-2},i.addEventListener("dragover",function(t){return a(t)!==-2&&(t.preventDefault(),!0)}),i.addEventListener("drop",function(r){var s,i,u;return s=a(r),u=!r.ctrlKey||(i=e.modal).task.split||null===i.task.duedate?[e.modal.task]:n(),o(u,r.shiftKey,{responsible:null,duedate:s===-1?null:t.view1.get("days")[s].get("date"),plan:!1}),e.$digest(),r.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSDigest":56,"../../../../dscommon/DSView":65,"../../../../dscommon/util":66,"../../../data/dsChanges":6,"../../../data/dsDataService":7,"../../../data/teamwork/TWTasks":11,"../../../models/Task":19,"../../tasks/addCommentAndSave":30,"../view1/View1":38,"../view1/models/TaskView":41}],43:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d,f=function(t,e){function o(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(d=angular.module("ui/views/view3/View3",[t("../../../config"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,l=t("../../../../dscommon/util").assert,p=t("../../../../dscommon/util").error,a=t("../../../models/Task"),u=t("../../../models/TodoList"),r=t("../../../models/Project"),n=t("./models/PersonView"),s=t("./models/ProjectView"),c=t("./models/TodoListView"),i=t("../view1/models/Row"),d.controller("View3",["$scope","View3",function(t,e){t.view=new e(t,"view3")}]),d.factory("View3",["DSView","config","$rootScope","$log","TWTasks",function(t,e,o,i,c){var d;return d=function(i){function d(r,i){t.call(this,r,i),this.scope=r,this.expandedProj={},this.expandedRows={},this.__unwatchA=r.$watch(function(){return[r.mode,e.activeSidebarTab]},function(t){return function(n){var s,i;switch(i=n[0],s=n[1],o.view3ActiveTab=s,s){case-1:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"clipboard",mode:i});break;case 0:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"noduedate",mode:i});break;case 1:t.__unwatchB=r.$watch(function(){var t;return null!=(t=r.$parent.view.startDate)?t.valueOf():void 0},function(n){var r,s;o.startDateVal=n,"number"!=typeof n?e.activeSidebarTab=0:(s=moment(n).add(1,"week"),r=moment(s).endOf("week"),t.dataUpdate({filter:"all",mode:i,startDate:s,endDate:r}))});break;case 2:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"all",mode:i})}}}(this),!0),this.__unwatchC=r.$watch(function(){return[e.view3GroupByPerson,e.view3HidePeopleWOTasks,e.view3FilterByPerson,e.view3FilterByProject,e.view3FilterByTask]},function(t){return function(){clearTimeout(t.__timer1),t.__timer1=setTimeout(function(){t.__dirty++,r.$digest()},300)}}(this),!0),r.notAssignedExpanded=!0,r.toggleProjectExpanded=function(t){return function(o){var n,r,i,a,u;return l&&(o instanceof s||p.invalidArg("project")),a=(r=t.expandedProj).hasOwnProperty(n=e.activeSidebarTab)?r[n]:r[n]=u={},a.hasOwnProperty(i=o.$ds_key)?a[i]=!a[i]:a[i]=!(2!==n)}}(this),r.isProjectExpanded=function(t){return function(o){var n,r,i,a;return l&&(o instanceof s||p.invalidArg("project")),(r=t.expandedProj).hasOwnProperty(n=e.activeSidebarTab)&&(a=r[n]).hasOwnProperty(i=o.$ds_key)?a[i]:2!==n}}(this),r.togglePersonExpanded=function(t){return function(o){var r,s,i,a,u;return l&&(o instanceof n||p.invalidArg("personView")),a=(s=t.expandedRows).hasOwnProperty(r=e.activeSidebarTab)?s[r]:s[r]=u={},a.hasOwnProperty(i=o.$ds_key)?a[i]=!a[i]:a[i]=!1}}(this),r.isPersonExpended=function(t){return function(o){var r,s,i,a;return l&&(o instanceof n||p.invalidArg("personView")),!(s=t.expandedRows).hasOwnProperty(r=e.activeSidebarTab)||!(a=s[r]).hasOwnProperty(i=o.$ds_key)||a[i]}}(this)}var h;return f(d,i),d.begin("View3"),d.propData("tasks",a,{watch:["duedate","priority"]}),d.propPool("poolPeople",n),d.propList("people",n),d.propPool("poolProjects",s),d.propList("projects",s),d.ds_dstr.push(function(){this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB(),this.__unwatchС(),"function"==typeof this.__unwatchD&&this.__unwatchD(),clearTimeout(this.__timer1)}),h=function(t,e){return"null"===t?"not assigned tasks".indexOf(e)>=0:t.person.name.toLowerCase().indexOf(e)>=0||t.person.firstName.toLowerCase().indexOf(e)>=0||t.person.email.toLowerCase().indexOf(e)>=0},d.prototype.render=function(){var t,o,n,s,i,a,l,p,d,f,m,g,y,v,w,S,D,k,T,b,P,O,$,A;if("ready"!==(T=this.get("data").get("tasksStatus"))&&"update"!==T)return void this.get("projectsList").merge(this,[]);if(b=this.get("data").get("tasks"),(null!=(y=n=e.view3FilterByTask)?y.length:void 0)>0&&(n=n.trim().toLowerCase(),b=_.filter(b,function(t){return t.get("title").toLowerCase().indexOf(n)>=0})),0===e.view3GroupByPerson){if($=_.groupBy(b,function(t){return t.get("todoList").$ds_key}),O=_.groupBy($,function(t){return t[0].get("project").$ds_key}),(null!=(v=o=e.view3FilterByProject)?v.length:void 0)>0){o=o.trim().toLowerCase();for(i in O)A=O[i],r.pool.items[i].get("name").toLowerCase().indexOf(o)>=0||delete O[i]}f=this.get("poolProjects"),m=this.get("projectsList").merge(this,_.map(O,function(t){return function(e,o){var n;return n=f.find(t,o),n.set("project",r.pool.items[o]),n.get("todoListsList").merge(t,_.map(e,function(e){var o,r;return o=e[0].get("todoList").$ds_key,r=n.poolTodoLists.find(t,o),r.set("todoList",u.pool.items[o]),r.set("tasksCount",_.size(e)),r.set("totalEstimate",_.reduce(e,function(t,e){var o;return(o=e.get("estimate"))?t.add(o):t},moment.duration(0))),r.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)}).sort(c.tasksSortRule)),r})),n}}(this)).sort(function(t,e){var o,n;return(o=t.get("project").get("name").toLowerCase())<(n=e.get("project").get("name").toLowerCase())?-1:o>n?1:0})),this.get("peopleList").merge(this,[]),this.__unwatchD&&(this.__unwatchD(),this.__unwatchD=null,this.__src.tasks.watch.length=this.__src.tasks.watch.length-1)}else{for(this.__unwatchD||(this.__unwatchD=this.scope.$watch(function(t){return function(){var e,o,n,r,s;for(r=t.scope.view1.rows,s=[],e=0,o=r.length;e<o;e++)n=r[e],s.push(n.$ds_key);return s}}(this),function(t){return function(e,o){e!==o&&t.__dirty++}}(this),!0),this.__src.tasks.watch.push("responsible")),d=this.get("poolPeople"),(null!=(w=t=e.view3FilterByPerson)?w.length:void 0)>0&&(t=t.trim().toLowerCase()),(null!=(S=o=e.view3FilterByProject)?S.length:void 0)>0&&(o=o.trim().toLowerCase()),P=_.groupBy(b,function(t){var e;return(e=t.get("responsible"))?e.$ds_key:"null"}),k=this.scope.view1.rows,P.hasOwnProperty("null")&&(k=k.concat("null")),D=[],s=0,a=k.length;s<a;s++)if(g=k[s],!t||h(g,t))if(P.hasOwnProperty(p="null"!==g?g.$ds_key:"null")){if($=_.groupBy(P[p],function(t){return t.get("todoList").$ds_key}),O=_.groupBy($,function(t){return t[0].get("project").$ds_key}),o)for(i in O)A=O[i],r.pool.items[i].get("name").toLowerCase().indexOf(o)>=0||delete O[i];if(0===Object.keys(O).length)continue;D.push(l=d.find(this,p)),"null"!==g&&l.set("row",g),f=l.get("poolProjects"),l.get("projectsList").merge(this,_.map(O,function(t){return function(e,o){var n;return n=f.find(t,o),n.set("project",r.pool.items[o]),n.get("todoListsList").merge(t,_.map(e,function(e){var o,r;return o=e[0].get("todoList").$ds_key,r=n.poolTodoLists.find(t,o),r.set("todoList",u.pool.items[o]),r.set("tasksCount",_.size(e)),r.set("totalEstimate",_.reduce(e,function(t,e){var o;return(o=e.get("estimate"))?t.add(o):t},moment.duration(0))),r.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)})),r})),n}}(this)).sort(function(t,e){var o,n;return(o=t.get("project").get("name").toLowerCase())<(n=e.get("project").get("name").toLowerCase())?-1:o>n?1:0}))}else e.get("view3HidePeopleWOTasks")||(D.push(l=d.find(this,p)),"null"!==g&&l.set("row",g),l.get("projectsList").merge(this,[]));this.get("peopleList").merge(this,D),this.get("projectsList").merge(this,[])}},d.end(),d}(t)}]),d.directive("rmsView3DropTask",["$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,o){return{restrict:"A",scope:!0,link:function(n,r,s){var i,a;a=r[0],i=s.rmsView3DropTask.length>0?function(t){return function(){return t}}(parseInt(s.rmsView3DropTask)):function(){return t.view3ActiveTab},a.addEventListener("dragover",function(t){return t.preventDefault(),2===i()}),a.addEventListener("drop",function(n){var r,s;return s=!n.ctrlKey||(r=t.modal).task.split||null===r.task.duedate?[t.modal.task]:o(),e(s,n.shiftKey,{duedate:0===i()?null:moment(t.startDateVal).add(1,"week"),plan:!1}),t.$digest(),n.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSView":65,"../../../../dscommon/util":66,"../../../config":2,"../../../data/dsDataService":7,"../../../data/teamwork/TWTasks":11,"../../../models/Project":17,"../../../models/Task":19,"../../../models/TodoList":21,"../../tasks/addCommentAndSave":30,"../view1/models/Row":40,"./models/PersonView":44,"./models/ProjectView":45,"./models/TodoListView":46}],44:[function(t,e,o){var n,r,s,i,a,u,c,l,p=function(t,e){function o(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},d={}.hasOwnProperty;n=t("../../../../../dscommon/DSObject"),l=t("../../../../../dscommon/util").validate,r=t("../../../../models/Person"),i=t("../../../../models/Project"),a=t("./ProjectView"),c=t("./TodoListView"),u=t("../../view1/models/Row"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.begin("PersonView"),e.propDoc("row",u),e.propPool("poolProjects",a),e.propList("projects",c),e.end(),e}(n)},{"../../../../../dscommon/DSObject":60,"../../../../../dscommon/util":66,"../../../../models/Person":14,"../../../../models/Project":17,"../../view1/models/Row":40,"./ProjectView":45,"./TodoListView":46}],45:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,r=t("../../../../models/Project"),i=t("./TodoListView"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("ProjectView"),e.propDoc("project",r),e.propPool("poolTodoLists",i),e.propList("todoLists",i),e.end(),e}(n)},{"../../../../../dscommon/DSObject":60,"../../../../../dscommon/util":66,"../../../../models/Project":17,"./TodoListView":46}],46:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;n=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,r=t("../../../../models/Task"),s=t("../../../../models/TodoList"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TodoListView"),e.propDoc("todoList",s),e.propList("tasks",r),e.propNum("tasksCount",0),e.propDuration("totalEstimate"),e.propBool("isExpand",!0),e.end(),e}(n)},{"../../../../../dscommon/DSObject":60,"../../../../../dscommon/util":66,"../../../../models/Task":19,"../../../../models/TodoList":21}],47:[function(t,e,o){var n;e.exports=(n=angular.module("ui/widgets/widgetDate",[])).name,$.datepicker.regional.ru={dateFormat:"dd.mm.yy",firstDay:1},$.datepicker.setDefaults($.datepicker.regional.ru),$.timepicker.regional.ru={},$.timepicker.setDefaults($.timepicker.regional.ru),n.directive("widgetDate",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(o,n,r,s){var i;i=$("input",n),e(function(){i.datepicker(),i.change(function(){var e;s.$setViewValue((e=i.datetimepicker("getDate"))?moment(e.getTime()):null),t.$digest()}),(s.$render=function(){i.datetimepicker("setDate",s.$viewValue?new Date(s.$viewValue.valueOf()):null)})()},0)}}}])},{}],48:[function(t,e,o){var n,r,s;e.exports=(s=angular.module("ui/widgets/widgetDuration",[])).name,n=36e5,r=6e4,s.directive("widgetDuration",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(e,o,s,i){var a,u,c,l;l=$("input",o),u=$(l[0]),c=$(l[1]),(i.$render=function(){var t,e,o;(o=i.$viewValue)?(t=Math.floor(o.valueOf()/n),e=Math.floor(o.valueOf()%n/r),u.val(t),c.val(e<10?"0"+e:e)):(u.val(""),c.val(""))})(),a=function(){var e,o,n;o=parseInt(u.val()),n=parseInt(c.val()),e=moment.duration(0),isNaN(o)||e.add(o,"hours"),isNaN(n)||e.add(n,"minutes"),i.$setViewValue(0===e.valueOf()?null:e),t.$digest()},u.on("input",a),c.on("input",a)}}}])},{}],49:[function(t,e,o){var n,r,s,i,a,u,c;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=/RMS\s*Data\s*\(DO NOT CHANGE!?\)/i,n=/}\s*END/i,u=function(t){var e,o,n,r;for(o=n=r=t.length-1;n>=0&&("\r"===(e=t.charAt(o))||"\n"===e||" "===e||"\t"===e);o=n+=-1);return o>=0?t.substr(0,o+1):""},c=function(t){var e,o,n,r,s;for(o=-1,n=r=0,s=t.length;r<s;n=r+=1)if("\n"===(e=t.charAt(n)))o=n;else if("\r"!==e&&" "!==e&&"\t"!==e)break;return o===-1?t:n<t.length?t.substr(o+1):""},i=function(t){var e,o,s,a;return(s=t.search(r))===-1?t:(e=t.search(n))!==-1&&s<e?(a=u(t.substr(0,s)),o=c(t.substr(t.substr(s).search(/end/i)+3+s)),i(a.length>0?o.length>0?a+"\r\n\r\n"+o:a:o)):u(t.substr(0,s-1))},e.exports={clear:i,get:function(t){var e,o,i,u,c;if(s&&null!==t&&"string"!=typeof t&&a.invalidArg("description"),null===t||(c=t.search(r))===-1)return null;if((e=t.search(n))!==-1&&c<e&&(u=t.indexOf("{",c))!==-1&&u<e)try{return JSON.parse(t.substr(u,e-u+1).trim())}catch(o){i=o,console.error("ex: ",i)}return console.error("Corrupted RMS Data: ",t),null},put:function(t,e){return s&&(null!==t&&"string"!=typeof t&&a.invalidArg("description"),null!==e&&"object"!=typeof e&&a.invalidArg("data")),t=null===t?"":i(t),null===e||0===_.size(e)?t:(0===t.length?"":""+t)+("\r\n\r\nRMS Data (DO NOT CHANGE!) "+JSON.stringify(e)+" END")}}},{"../../dscommon/util":66}],50:[function(t,e,o){var n,r,s,i,a,u,c,l,p=function(t,e){function o(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},d={}.hasOwnProperty;c=t("./util").assert,l=t("./util").error,a=t("./DSHistory"),u=t("./DSPool"),r=t("./DSData"),i=t("./DSDocument"),s=t("./DSDigest"),e.exports=n=function(t){function e(){return o.apply(this,arguments)}var o,n;return p(e,t),e.begin("DSChangesBase"),e.noCache(),e.propDoc("hist",a),e.propNum("count",0),o=function(t,e){var o,n,s,i,c,l,p,d;for(r.call(this,t,e,{}),(n=this.set("hist",new a(this,e+".hist"))).release(this),o={add:function(t){return function(){t.count++,t.persist()}}(this),change:function(t){return function(){t.persist()}}(this),remove:function(t){return function(){t.count--,t.persist()}}(this)},this.__unwatch2=d=[],c=this.__proto__.__sets,s=0,i=c.length;s<i;s++)p=c[s],(l=this["_"+p]).$ds_hist=n,(l.$ds_pool=new u(this,e+"."+p+".pool",l.type)).release(this),l.watch(this,o,!0)},e.prototype.saveToLocalStorage=_.noop,e.prototype.persist=function(){},e.prototype.anyChange=function(){return this.get("count")>0},e.prototype.reset=function(){s.block(function(t){return function(){var e,o,n,r,s,i,a,u,c,l,p,d;(e=t.get("hist")).startReset();try{for(c=t.__proto__.__sets,o=0,s=c.length;o<s;o++)for(p=c[o],l=_.map((d=t["_"+p]).items,function(t){return t}),r=0,i=l.length;r<i;r++){n=l[r],a=n.$ds_doc;for(u in n.__change)"__error"!==u&&"__refreshView"!==u&&n.set(u,a.get(u))}}finally{e.endReset()}}}(this))},e.prototype.changesToMap=function(){var t,e,o,n,r,s,i,a,u,c,l,p,d,f,h,m;for(p={},u=this.__proto__.__sets,t=0,r=u.length;t<r;t++){h=u[t],a=(f=this["_"+h]).type.prototype.__props,p[h]=d={},c=f.items;for(n in c){e=c[n],d[n]=o={},l=e.__change;for(i in l)s=l[i],"__error"!==i&&"__refreshView"!==i&&(m=a[i].write)&&(o[i]={v:null===s.v?null:m(s.v),s:null===s.s?null:m(s.s)})}}return p},n=function(t,e,o,n,r){var s,i,a;a=e.hasOwnProperty(s=o.docType)?e[s]:e[s]={},a[t[r]]=i=a.hasOwnProperty(t[r])?a[t[r]]:a[t[r]]=[],i.push(function(t,e,o){return function(n){c&&(null!==n&&n.__proto__.constructor===t&&n.$ds_key===e||l.invalidArg("doc")),o[r]=n}}(o,t[r],n))},e.prototype.mapToChanges=function(t){var e,o,r,s,i,a,u,c,l,p,d,f,h,m,g,y,_,v,w;for(y={load:c={},changes:o={}},m=this.__proto__.__sets,r=0,u=m.length;r<u;r++){v=m[r],f=this["_"+v].type.prototype.__props,o[v]=_={},g=t[v];for(a in g){s=g[a],_[a]=i={};for(d in s)p=s[d],i[d]=function(){if("function"==typeof(w=(l=f[d]).type))return e={v:null,s:null},p.v&&n(p,c,w,e,"v"),p.s&&n(p,c,w,e,"s"),e;if(h=l.read)return{v:null===p.v?null:h.call(this,p.v),s:null===p.s?null:h.call(this,p.s)};throw new Error("Unsupported type "+w)}.call(this)}}return y},e.end(),c&&(e.end=function(){var t,e,o;r.end.call(this),e=this.prototype.__props;for(t in e)if(o=e[t],"set"===o.type&&!o.itemType.ds_editable)throw new Error("Type '"+this.name+"': propSet '"+t+"' has non-editable item type")}),e}(r)},{"./DSData":51,"./DSDigest":56,"./DSDocument":57,"./DSHistory":58,"./DSPool":62,"./util":66}],51:[function(t,e,o){var n,r,s,i,a,u,c=function(t,e){function o(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=t("./util").assert,i=t("./util").error,u=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,r=t("./DSObject"),e.exports=n=function(t){function e(){
return o.apply(this,arguments)}var o;return c(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var o,n,r,s;for(r=this.__proto__.__sets,o=0,n=r.length;o<n;o++)s=r[o],this["_"+s].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void u.remove(this.release(u)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},o=function(t,o,n){if(r.call(this,t,o),s){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof n&&i.invalidArg("params")}this.set("params",n),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&u.add(this.addRef(u))},e.prototype.clear=function(){var t,e,o,n;for(o=this.__proto__.__sets,t=0,e=o.length;t<e;t++)n=o[t],this["_"+n].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;r.end.call(this),this.prototype.__sets=function(){var o,n;o=this.prototype.__props,n=[];for(t in o)e=o[t],"set"===e.type&&n.push(t);return n}.call(this)},e}(r)},{"./DSObject":60,"./util":66}],52:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,s=t("./DSDocument"),n=t("./DSData"),r=t("./DSDigest"),i=t("./DSSet"),u={},e.exports=function(t){var e,o;return a&&(null!==t&&t.ds_editable||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(o=u[t.docType]).itemType===t?o:u[t.name]=e=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}var u,p;l(o,e),o.begin("DSDataEditable<"+t.docType+">"),o.propDoc("original",i),o.propDoc("changes",i),o.propSet("items",o.itemType=t),o.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),o.prototype.clear=function(){n.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},o.$u=u={};for(p in t.__super__.__props)u[p]=!0;return o.prototype.init=function(e,o,n){var l,p,d,f,h,m,g,y;if(a){if(o instanceof i||c.invalidArg("changes"),e instanceof i||c.invalidArg("original"),"function"!=typeof n&&"undefined"!=typeof n&&c.invalidArg("filter"),e.type.ds_editable)throw new Error("'original' expected to have non DSDocument.Editable items");if(t!==o.type)throw new Error("'itemType' and 'changes' must have same DSDocument.Editable type");if(e.type.Editable!==o.type)throw new Error("'original' and 'changes' must base on same DSDocument type");if(!o.hasOwnProperty("$ds_pool"))throw new Error("'changes' must be set instantiated as a field of DSChanges object")}this.set("original",e),this.set("changes",o),f=this.get("itemsSet"),d=f.items,p=o.$ds_pool,m=e.items,l=o.items,h=function(t){return function(){var s,i,c,h,g;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null,"function"==typeof t._unwatch2&&t._unwatch2(),t._unwatch2=null,h=function(t){if(a&&!p.items.hasOwnProperty(t.$ds_key))throw new Error("Missing editable item");return p.items[t.$ds_key]},c=function(e){var n;return(n=p.find(t,e.$ds_key)).init&&(n.init(e,o),n.$u=u),n},n?(_.forEach(m,function(e){var o;l.hasOwnProperty(o=e.$ds_key)||f.add(t,c(e))}),_.forEach(l,function(e){n.call(t,e)&&f.add(t,e.addRef(t))}),g=function(t){if(a&&!l.hasOwnProperty(t))throw new Error("Missing edtItem");s(l[t])},s=function(e){n.call(t,e)?d.hasOwnProperty(e.$ds_key)||f.add(t,e.addRef(t)):d.hasOwnProperty(e.$ds_key)&&f.remove(e)},i=function(t){return!!l.hasOwnProperty(t.$ds_key)&&(s(h(t)),!0)},t._unwatch1=e.watch(t,{add:function(e){i(e)||f.add(t,c(e))},remove:function(e){i(e)||(f.remove(h(e)),r.forget(t.$ds_key,e.$ds_key))}}),t._unwatch2=o.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,g)},change:function(e){r.render(t.$ds_key,e.$ds_key,g)},remove:function(e){s.call(t,e),r.forget(t.$ds_key,e.$ds_key)}})):(_.forEach(m,function(e){f.add(t,c(e))}),t._unwatch1=e.watch(t,{add:function(e){f.add(t,c(e))},remove:function(t){f.remove(h(t))}})),t._endLoad(!0)}}(this),g=[e,o],y=function(t){return function(e,o){var n,i,a;if(n=!1,(i=s.integratedStatus(g))!==(a=t.get("status")))switch(i){case"ready":n?(n=!1,t._endLoad(!0)):r.block(h);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(n=!0);break;case"nodata":n?(n=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this),this._unwatchA=e.watchStatus(this,y),this._unwatchB=o.watchStatus(this,y),this.init=null},o.end(),o}(n)}},{"./DSData":51,"./DSDigest":56,"./DSDocument":57,"./DSSet":63,"./util":66}],53:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,s=t("./DSObject"),n=t("./DSData"),r=t("./DSDigest"),i=t("./DSSet"),u={},e.exports=function(t){var e,o;return a&&(s.isAssignableFrom(t)||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(o=u[t.docType]).itemType===t?o:u[t.docType]=e=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}var s,u;l(o,e),o.begin("DSDataFiltered<"+t.docType+">"),o.propDoc("original",i),o.propSet("items",o.itemType=t),o.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatch1&&this._unwatch1()}),o.prototype.clear=function(){n.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1},o.$u=s={};for(u in t.__super__.__props)s[u]=!0;return o.prototype.init=function(e,o){var n,s,u,l;if(a&&(e instanceof i||c.invalidArg("original"),"function"!=typeof o&&c.invalidArg("filter"),t!==e.type))throw new Error("'itemType' and 'original' must have same DSObject type");this.set("original",e),s=this.get("itemsSet"),n=s.items,l=e.items,u=function(t){return function(){var i,a,u;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null;for(a in l)i=l[a],o(i)&&(i.addRef(t),s.add(t,i));u=function(e){n.hasOwnProperty(e)?o(i=l[e])||s.remove(i):o(i=l[e])&&(i.addRef(t),s.add(t,i))},t._unwatch1=e.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,u)},change:function(e){r.render(t.$ds_key,e.$ds_key,u)},remove:function(e){s.remove(e),r.forget(t.$ds_key,e.$ds_key)}}),t._endLoad(!0)}}(this),this._unwatchA=e.watchStatus(this,function(t){return function(o,n){var s,i,a;if(s=!1,(i=e.get("status"))!==(a=t.get("status")))switch(i){case"ready":s?(s=!1,t._endLoad(!0)):r.block(u);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(s=!0);break;case"nodata":s?(s=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this)),this.init=null},o.end(),o}(n)}},{"./DSData":51,"./DSDigest":56,"./DSObject":60,"./DSSet":63,"./util":66}],54:[function(t,e,o){var n,r,s,i,a,u=function(t,e){function o(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("./util").assert,a=t("./util").error,r=t("./DSObject"),s=t("./DSPool"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){i&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,o){var n,s,u,c;if(i){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),"object"==typeof o&&null!==o||a.invalidArg("sources");for(n in o){u=o[n],"object"==typeof u&&null!==u||a.invalidArg("sources");for(s in u)switch(c=u[s],s){case"name":break;case"type":!c instanceof r&&a.invalidArg("sources");break;case"set":!c instanceof r&&a.invalidArg("sources");break;case"params":"object"==typeof c&&null!==c||a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(r)},{"./DSObject":60,"./DSPool":62,"./util":66}],55:[function(t,e,o){var n,r,s,i,a,u,c,l,p=function(t,e){function o(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataSource",[])).name,l=t("./util").serviceOwner,u=t("./util").modeReleaseDataOnReload,s=t("./util").assert,a=t("./util").error,i=t("../utils/base64"),r=t("./DSObject"),n=t("./DSDigest"),c.factory("DSDataSource",["config","$rootScope","$q","$http",function(t,e,o,u){var c;return c=function(o){function c(){return l.apply(this,arguments)}var l;return p(c,o),c.begin("DSDataSource"),c.addDataSource(),c.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,o,r){switch(o){case"ready":n.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},l=function(o,n){r.call(this,o,n),this.cancelDefers=[],this._lastRefresh=null,this._refreshTimer=null,e.$watch(function(){return t.refreshPeriod},function(t){return function(e){t._setNextRefresh()}}(this))},c.prototype.setConnection=function(t,e){var o,n,r,u;if(s&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(u=this.cancelDefers,n=0,r=u.length;n<r;n++)o=u[n],o.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+i.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},c.prototype._setNextRefresh=function(){var e,o,n;null!==this._refreshTimer&&clearTimeout(this._refreshTimer),null!==t.refreshPeriod&&(n=null===this._lastRefresh?0:(o=this._lastRefresh.add(t.refreshPeriod,"minutes"),e=moment(),o>=e?o-e:0),this._refreshTimer=setTimeout(function(t){return function(){t.refresh()}}(this),n))},c.prototype.refresh=function(){this._lastRefresh=moment(),this._setNextRefresh(),"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},c.prototype.httpGet=function(t,e){var o,n;return this.cancelDefers.push(e),n=function(t){return function(o){return _.remove(t.cancelDefers,e),o}}(this),o={timeout:e.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),u.get(""+this.url+t,o).then(n,n)},c.prototype.httpPost=function(t,e,o){var n,r;return this.cancelDefers.push(o),r=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),n={timeout:o.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),u.post(""+this.url+t,e,n).then(r,r)},c.prototype.httpPut=function(t,e,o){var n,r;return this.cancelDefers.push(o),r=function(t){return function(e){return _.remove(t.cancelDefers,o),e}}(this),n={timeout:o.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),u.put(""+this.url+t,e,n).then(r,r)},c.end(),c}(r)}])},{"../utils/base64":68,"./DSDigest":56,"./DSObject":60,"./util":66}],56:[function(t,e,o){var n,r,s;r=t("./util").assert,s=t("./util").error,e.exports=n=function(){function t(){}var e,o,n,i;return o=0,e=0,n={},i=function(){var t,o,r,s,a,u,c;s=!0;for(a in n){s=!1;break}if(!s){e++,c=n,n={};for(t in c){o=c[t];for(u in o)(r=o[u])(u)}e--,i()}},t.block=function(t){e++;try{return t()}finally{0===--e&&i()}},t.render=function(t,o,i){var a;r&&("string"==typeof t&&t.length>0||s.invalidArg("dataDataKey"),"string"==typeof o&&o.length>0||s.invalidArg("key"),"function"!=typeof i&&s.invalidArg("func")),0===e?i(o):(a=n.hasOwnProperty(t)?n[t]:n[t]={},a[o]=i)},t.forget=function(t,o){var i;r&&("string"==typeof t&&t.length>0||s.invalidArg("dataDataKey"),"string"==typeof o&&o.length>0||s.invalidArg("key")),0!==e&&n.hasOwnProperty(t)&&(i=n[t],delete i[o])},t}()},{"./util":66}],57:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,u=t("./util").error,c=t("./util").traceRefs,s=t("./DSObjectBase"),r=t("./DSObject"),i=t("./DSSet"),e.exports=n=function(t){function e(t,o){if(e.__super__.constructor.call(this,t,o),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")}return l(e,t),e.begin("DSDocument"),e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;r.end.call(this),e=this,this.Editable=t=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}var n,p,d,f,h,m,g;l(o,t),o.begin(e.docType+".Editable"),delete o.prototype.$ds_docType,o.ds_editable=!0,n=null,h=o.__super__.__init;for(p in h)g=h[p],e.prototype.__props[p.substr(1)].calc&&((n||(n={}))[p]=g);o.prototype.__init=n,o.ds_dstr.push(function(){var t,e,o,n;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(o in t)e=t[o],(n=e.s)instanceof s&&n.release(this),(g=e.v)instanceof s&&g.release(this)}),o.prototype.init=function(t,o,n){var r,l,p,d,f,h,m,g,y,v;if(a&&(null!==t&&t.__proto__.constructor===e||u.invalidArg("serverDoc"),null!==o&&o instanceof i||u.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof n&&u.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=o,this.__change=n){m=!1;for(y in n)g=n[y],this.__props[y].equal(t.get(y),g.v)?delete n[y]:m=!0;if(m){if(c){h=[];for(y in n)r=n[y],r.v instanceof s&&h.push(r.v),r.s instanceof s&&h.push(r.s);for(l=0,f=h.length;l<f;l++)d=h[l],v=d.$ds_referries,0===v.length?console.error(s.desc(d)+": Empty $ds_referries"):(p=v.lastIndexOf(owner))<0?(console.error(s.desc(this)+": Referry not found: "+s.desc(owner)),totalReleaseVerb):(totalReleaseVerb&&(console.info(++util.serviceOwner.msgCount+": transfer: "+s.desc(d)+", refs: "+this.$ds_ref+", from: "+s.desc(owner)+", to: "+s.desc(this)),util.serviceOwner.msgCount===window.totalBreak),v[p]=this)}this.addRef(this),o.add(this,this)}else delete this.__change}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},o.prototype.__onChange=function(t,e,o,n){var r,i,a,u,c,l,p;if((r=this.__change)&&r.hasOwnProperty(e)&&t.__props[e].equal(p=(c=r[e]).v,o)){for((l=c.s)instanceof s&&l.release(this),p instanceof s&&p.release(this),delete r[e],i=!0,a=0,u=r.length;a<u;a++)if(e=r[a],"__error"!==e&&"__refreshView"!==e){i=!1;break}i&&(delete this.__change,this.$ds_chg.remove(this))}},o.prototype._clearChanges=function(){var t,e,o,n,r,i,a;if(t=this.__change){for(r in t){if(n=t[r],this.$ds_evt)for(i=this.$ds_evt,e=i.length-1;e>=0;e+=-1)o=i[e],o.__onChange.call(o,this,r,this.$ds_doc[r],n.v);(a=n.s)instanceof s&&a.release(this),(g=n.v)instanceof s&&g.release(this)}delete this.__change,this.$ds_chg.remove(this)}},f=o.prototype.__props=e.prototype.__props,o.prototype.get=function(t){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]},o.prototype.set=function(t,e){return a&&(f.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]=e},m=e.prototype.__props;for(p in m)d=m[p],d.calc||!function(t,e,n){var r;return Object.defineProperty(o.prototype,t,{get:r=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(o){var i,c,l,d,f,h,m,y,_,v,w;if("tags"===t&&console.info("tags:",null!=o?o.value:void 0),a&&"undefined"==typeof(o=e(g=o))&&u.invalidValue(this,t,g),!n(m=r.call(this),o)){if(o instanceof s&&o.addRef(this),i=this.__change)if(n(w=this.$ds_doc[t],o)){this.$ds_chg.$ds_hist.add(this,t,void 0,(c=i[t]).v),(g=c.v)instanceof s&&g.release(this),(v=c.s)instanceof s&&v.release(this),delete i[t],l=!0;for(p in i)if("__error"!==p&&"__refreshView"!==p){l=!1;break}if(l){if(this.$ds_evt)for(y=this.$ds_evt,d=y.length-1;d>=0;d+=-1)h=y[d],h.__onChange.call(h,this,t,o,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(c=i[t])?(this.$ds_chg.$ds_hist.add(this,t,o,c.v),(g=c.v)instanceof s&&g.release(this),c.v=o):(w instanceof s&&w.addRef(this),i[t]={v:o,s:w},this.$ds_chg.$ds_hist.add(this,t,o,void 0));else i=this.__change={},m instanceof s&&m.addRef(this),i[t]={v:o,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,o,void 0);if(this.$ds_evt)for(_=this.$ds_evt,f=_.length-1;f>=0;f+=-1)h=_[f],h.__onChange.call(h,this,t,o,m)}}})}(d.name,d.valid,d.equal);return r.end.call(o),o}(e)},e}(r)},{"./DSObject":60,"./DSObjectBase":61,"./DSSet":63,"./util":66}],58:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;u=t("./util").assert,c=t("./util").error,a=t("./DSObjectBase"),i=t("./DSObject"),n=t("./DSDigest"),r=t("./DSDocument"),e.exports=s=function(t){function e(){return p.apply(this,arguments)}var o,r,s,p,d,f;return l(e,t),e.begin("DSHistory"),e.ds_dstr.push(function(){o.call(this)}),p=function(t,e){i.call(this,t,e),this.hist=[],this.histTop=0},o=function(){var t,e,o,n,r;for(n=this.hist,e=0,o=n.length;e<o;e++)t=n[e],t.i.release(this),"object"==typeof(r=t.o)&&r instanceof a&&r.release(this),"object"==typeof(r=t.n)&&r instanceof a&&r.release(this);this.hist=[],this.histTop=0},f=!1,s=null,r=0,e.prototype.startBlock=function(){s=++r},e.prototype.endBlock=function(){s=null},e.prototype.startReset=function(){f=!0,o.call(this)},e.prototype.endReset=function(){f=!1},e.prototype.add=function(t,e,o,n){var r,i,l,p,d,h,m;if(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop"),0<=["string","number","boolean","object","undefined"].indexOf(typeof o)||c.invalidArg("newVal"),0<=["string","number","boolean","object","undefined"].indexOf(typeof n)||c.invalidArg("oldVal")),!f){if((i=this.hist).length>this.histTop){for(h=i.slice(this.histTop),l=0,p=h.length;l<p;l++)r=h[l],r.i.release(this),"object"==typeof(m=r.o)&&m instanceof a&&m.release(this),"object"==typeof(m=r.n)&&m instanceof a&&m.release(this);i.length=this.histTop}t.addRef(this),o instanceof a&&o.addRef(this),n instanceof a&&n.addRef(this),i.push(d={i:t,p:e,n:o,o:n}),s&&(d.b=s),this.histTop=i.length}},e.prototype.hasUndo=function(){return this.histTop>0},e.prototype.undo=function(){var t,e,o,r,s;if(console.info("undo"),(r=this.histTop)>0){f=!0;try{e=(o=this.hist)[this.histTop=--r],"number"!=typeof(t=e.b)||0===r||o[r-1].b!==t?"undefined"==typeof(s=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s):n.block(function(n){return function(){for(;;){if("undefined"==typeof(s=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s),0===r||(e=o[r-1]).b!==t)break;n.histTop=--r}}}(this))}finally{f=!1}}},e.prototype.hasRedo=d=function(){return this.histTop<this.hist.length},e.prototype.redo=function(){var t,e,o,r,s,i;if(console.info("redo"),f=!0,(r=this.histTop)<(s=(o=this.hist).length)){f=!0;try{e=o[r],this.histTop=++r,"number"!=typeof(t=e.b)||r===s||o[r].b!==t?"undefined"==typeof(i=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i):n.block(function(n){return function(){for(;;){if("undefined"==typeof(i=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i),r===s||(e=o[r]).b!==t)break;n.histTop=++r}}}(this))}finally{f=!1}}},e.end(),e}(i)},{"./DSDigest":56,"./DSDocument":57,"./DSObject":60,"./DSObjectBase":61,"./util":66}],59:[function(t,e,o){var n,r,s,i,a,u,c,l=function(t,e){function o(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=t("./util"),s=t("./util").assert,u=t("./util").traceRefs,a=t("./util").totalReleaseVerb,i=t("./util").error,r=t("./DSObjectBase"),e.exports=n=function(t){function e(){return o.apply(this,arguments)}var o;return l(e,t),e.begin("DSList"),o=function(t,e,o){r.call(this,t,e),s&&!o instanceof r&&i.notDSObjectClass(o),this.type=o,this.items=[]},e.ds_dstr.push(function(){var t,e,o,n;for(o=this.items,t=0,e=o.length;t<e;t++)n=o[t],n.release(this)}),e.prototype.merge=function(t,e){var o,n,l,p,d,f,h,m,g,y;for(s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),_.isArray(e)||i.invalidArg("newList")),p=this.items,y=this.type,d=0,h=p.length;d<h;d++)l=p[d],l.release(this);for(p.length=0,o=f=0,m=e.length;f<m;o=++f)l=e[o],!l instanceof y&&i.invalidListValue(this,o,l),u&&(g=l.$ds_referries,0===g.length?console.error(r.desc(DSDitem)+": Empty $ds_referries"):(n=g.lastIndexOf(t))<0?console.error(r.desc(this)+": Referry not found: "+r.desc(t)):(a&&(console.info(++c.serviceOwner.msgCount+": transfer: "+r.desc(l)+", refs: "+this.$ds_ref+", from: "+r.desc(t)+", to: "+r.desc(this)),c.serviceOwner.msgCount===window.totalBreak),g[n]=this)),p.push(l);return p},e.end(),e}(r)},{"./DSObjectBase":61,"./util":66}],60:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d=function(t,e){function o(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("./util").assert,l=t("./util").serviceOwner,p=t("./util").totalRelease,l=t("./util").serviceOwner,c=t("./util").error,s=t("./DSObjectBase"),a=t("./DSSet"),n=t("./DSList"),i=t("./DSPool"),e.exports=r=function(t){function e(){return o.apply(this,arguments)}var o;return d(e,t),e.desc=s.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof n||t instanceof i?p?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:p?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===l?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},o=function(t,e){if(s.call(this,t,e),u&&this.__proto__.constructor===s)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){p?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new i(l,e.docType+".pool",e,t),l.clearPool(function(){e.__pool.release(l),delete e.__pool})),e.__pool}}(this)}):this.pool=new i(l,this.docType+".pool",this,t)},e.propPool=function(t,e,o){var n,r;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this),delete this[n]}),(r=this.prop({name:t,type:"pool",init:function(){return new i(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,o)},readonly:!0})).itemType=e,r},e.propSet=function(t,e){var o,n;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this)}),(n=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[o].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[o].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[o]}}),n},e.propList=function(t,e){var o,r;return u&&(s.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this)}),(r=this.prop({name:t,type:"list",init:function(){return new n(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[o].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[o]}}),r},e}(s)},{"./DSList":59,"./DSObjectBase":61,"./DSPool":62,"./DSSet":63,"./util":66}],61:[function(t,e,o){var n,r,s,i,a,u,c,l,p;p=t("./util"),r=t("./util").assert,c=t("./util").traceData,i=t("./util").serviceOwner,l=t("./util").traceRefs,a=t("./util").totalRelease,u=t("./util").totalReleaseVerb,s=t("./util").error,e.exports=n=function(){function t(){return e.apply(this,arguments)}var e,o,n,i,d,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&s.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=o=null,(window.totalReleaseReset=function(){o=0,window.totalPool=h={},p.serviceOwner.start(),p.serviceOwner.msgCount=0})(),window.totalRelease=function(){return p.serviceOwner.stop(),h}),e=function(e,n){var i,c,d;if(r){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBаse directly");"object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry"),"string"!=typeof n&&s.invalidArg("key")}if(this.$ds_key=n,this.$ds_ref=1,a&&(h[this.$ds_globalId=++o]=this,u&&(console.info(++p.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),p.serviceOwner.msgCount===window.totalBreak)),l&&(this.$ds_referries=[e]),i=this.__proto__.__init)for(c in i)d=i[c],this[c]="function"==typeof d?d.call(this):d;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(r&&("object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry")),0===this.$ds_ref)throw new Error("addRef() on already fully released object");return l&&this.$ds_referries.push(e),this.$ds_ref++,u&&(console.info(++p.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),p.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var o,n;if(r&&("object"==typeof e&&e!==window||"function"==typeof e||s.invalidArg("referry")),u&&(console.info(++p.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),p.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(l&&((o=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(o,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((n=this.$ds_pool).watchOn&&(r&&(_.find(this.$ds_evt,function(t){return function(t){return t===n}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,n)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+":"+this.$ds_key+("object"==typeof this.$ds_pool?"@"+this.$ds_pool:"")},t.prototype.writeMap=function(){var t,e,o,n;n={},o=this.__proto__.__props;for(e in o)t=o[e],t.hasOwnProperty("write")&&(n[e]=t.write(this["_"+e]));return n},t.prototype.readMap=function(t){var e,o,n,r;n=this.__proto__.__props;for(o in t)r=t[o],n.hasOwnProperty(o)&&(e=n[o]).hasOwnProperty("read")?this[o]=e.read.call(this,r):console.error("Unexpected property "+o)},t.begin=function(t){var e;r&&"string"!=typeof t&&s.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,o,n;for(o=0,n=t.length;o<n;o++)e=t[o],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,o;for(o=e.length-1;o>=0;o+=-1)t=e[o],t.call(this)})},t.prop=function(t){var e,o,n,i,a,u,c,l,p,d;if(r){if("object"!=typeof t&&s.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if("undefined"!=typeof t.calc&&"boolean"!=typeof t.calc)throw new Error("Invalid value of opts.calc");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.calc&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(n=t.init)?n():n))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("calc")&&t.calc)throw new Error("Ambiguous opts.readonly and opts.calc")}if(this.prototype.hasOwnProperty("__init")?r&&this.prototype.__props.hasOwnProperty(t.name)&&s.duplicatedProperty(this,t.name):(this.prototype.__init=(l=this.__super__.__init)?_.clone(l):{},c=this.prototype.__props=(p=this.__super__.__props)?_.clone(p):{},this.prototype.get=function(t){return r&&(c.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return r&&(c.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]=e}),u=this.prototype.__props[t.name]={name:t.name,type:t.type,write:t.write||function(t){return null===t?null:t.valueOf()},read:t.read||function(t){return t},equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){return null===t?"":t.toString()},readonly:t.readonly||!1,calc:t.calc||!1},t.hasOwnProperty("init"))d=u.valid=t.valid,u.init=this.prototype.__init[i="_"+(a=t.name)]=t.init,t.calc&&(t.readonly===!0,this.prototype["__setCalc"+(a.substr(0,1).toUpperCase()+a.substr(1))]=function(t){var o,n,r,u,c;if("undefined"==typeof(t=d(c=t))&&s.invalidValue(this,a,c),!e(u=this[i],t)&&(this[i]=t,o=this.$ds_evt))for(n=o.length-1;n>=0;n+=-1)r=o[n],
r.__onChange.call(r,this,a,t,u)}),Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[i]},set:t.set||(t.readonly?function(t){s.propIsReadOnly(this,a)}:function(t){var o,n,r,u,c;if("undefined"==typeof(t=d(c=t))&&s.invalidValue(this,a,c),!e(u=this[i],t)&&(this[i]=t,o=this.$ds_evt))for(n=o.length-1;n>=0;n+=-1)r=o[n],r.__onChange.call(r,this,a,t,u)})});else if(t.hasOwnProperty("value"))u.value=t.value,u.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");u.func=o=t.func,u.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return o.call(this)},set:t.set||function(t){s.propIsReadOnly(this,a)}})}return u},t.propSimple=function(t,e,o,n,i){var a;return r&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&s.invalidArg("type"),"string"!=typeof e&&s.invalidArg("name"),"undefined"!=typeof o&&null!==o&&"function"!=typeof o&&typeof o!==t&&s.invalidArg("init"),n&&"function"!=typeof n&&s.invalidArg("valid"),"undefined"!=typeof i&&"boolean"!=typeof i&&s.invalidArg("calc")),n=(a=n)?function(e){return null!==e&&typeof e!==t||void 0===(e=a(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop({name:e,type:t,init:"undefined"==typeof o||null===o?null:"function"==typeof o||"object"!==t?o:function(){return _.clone(o)},valid:n,write:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()},calc:i})},t.propNum=function(t,e,o,n){this.propSimple("number",t,e,o,n)},t.propBool=function(t,e,o,n){return this.propSimple("boolean",t,e,o,n)},t.propStr=function(t,e,o,n){return this.propSimple("string",t,e,o,n)},t.propObj=function(t,e,o,n){return this.propSimple("object",t,e,o,n)},t.propDoc=function(e,o,n,i){var a,u;return r&&(n&&"function"!=typeof n&&s.invalidArg("valid"),"function"!=typeof o&&s.invalidArg("type"),!o instanceof t&&s.notDSObjectClass(o),"undefined"!=typeof i&&"boolean"!=typeof i&&s.invalidArg("calc")),n=(u=n)?function(t){return(null===t||t instanceof o)&&void 0!==(t=u(t))?t:void 0}:function(t){return null===t||t instanceof o?t:void 0},a="_"+e,this.ds_dstr.push(function(){this[a]&&this[a].release(this)}),this.prop({name:e,type:o,init:null,valid:n,write:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof o.str?o.str:function(t){return null===t?"":t.$ds_key},calc:i,set:function(t){var o,r,i,u,c;if("undefined"==typeof(t=n(c=t))&&s.invalidValue(this,e,c),(u=this[a])!==t){if(this[a]=t,t&&t.addRef(this),o=this.$ds_evt)for(r=o.length-1;r>=0;r+=-1)i=o[r],i.__onChange.call(i,this,e,t,u);u&&u.release(this)}}})},t.propCalc=function(t,e){return r&&(e&&"function"==typeof e||s.invalidArg("func")),this.prop({name:t,type:"calc",func:e})},t.propConst=function(t,e){return r&&"undefined"==typeof e&&s.invalidArg("value"),this.prop({name:t,type:"const",value:e})},t.propEnum=function(t,e){var o,n,i,a,u,c;if(r)for(_.isArray(e)&&0!==e.length||s.invalidArg("values"),o=0,n=e.length;o<n;o++)u=e[o];return c=(a=c)?function(t){return(null===t||e.indexOf(t)>=0)&&a(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},i="_"+t,this.prop({name:t,type:"enum",init:e[0],valid:c,set:function(e){var o,n,r,a,u;if("undefined"==typeof(e=c(u=e))&&s.invalidValue(this,t,u),(r=this[i])!==e&&(this[i]=e,this.$ds_evt))for(a=this.$ds_evt,o=a.length-1;o>=0;o+=-1)n=a[o],n.__onChange.call(n,this,t,e,r)}})},t.propMoment=function(t,e){var o;return r&&e&&"function"!=typeof e&&s.invalidArg("valid"),e=(o=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&o(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null})},t.propDuration=function(t,e){var o;return r&&e&&"function"!=typeof e&&s.invalidArg("valid"),e=(o=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&o(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null})},t.onAnyPropChange=function(t){r&&"function"!=typeof t&&s.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],d=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,o,n,i,a;for(r&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||s.invalidArg("sources")),n=-1,e=0,o=t.length;e<o;e++)a=t[e],a&&n<(i=d.indexOf(a.get("status")))&&(n=i);return n===-1?"nodata":d[n]},c&&(i=0,n=0),t.addDataSource=function(e){var o,a;if(r){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&s.invalidArg("onStatusChange")}this.ds_dataSource=!0,c&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++i,console.info(++n+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),n===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++n+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),n===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},o=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(o){var r,i,u,l,p;if("undefined"==typeof(o=a(p=o))&&s.invalidValue(this,"status",p),(u=this._status)!==o)for(c&&(console.info(++n+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+o+", old: "+u),n===window.sourceBreak),this._status=o,null!=e&&e.call(this,o,u),l=this.$ds_statusWatchers,r=l.length-1;r>=0;r+=-1)i=l[r],i.lst(this,o,u,i.unwatch)}}),o.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var o,n,i,a;return r&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("referry"),"function"!=typeof e&&s.invalidArg("listener")),(a=this.$ds_statusWatchers).push(i={lst:e}),this.addRef(t),i.unwatch=n=function(e){return function(o){return function(){o||(e.release(t),_.remove(a,i),o=!0)}}}(this)(!1),o=this.get("status"),"update"===o?(e(this,"ready","nodata",n),_.find(a,i)&&e(this,"update","ready",n)):e(this,o,"nodata",n),n}},t}()},{"./util":66}],62:[function(t,e,o){var n,r,s,i,a,u,c=function(t,e){function o(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l={}.hasOwnProperty;i=t("./util").assert,a=t("./util").error,u=t("./util").traceWatch,r=t("./DSObjectBase"),n=t("./DSDigest"),e.exports=s=function(t){function e(){return o.apply(this,arguments)}var o,s;return c(e,t),e.begin("DSPool"),o=function(t,e,o,n){var s;r.call(this,t,e),i&&(r.isAssignableFrom(o)||a.notDSObjectClass(o)),s=this.items={},this.type=o,n&&(this.watchOn=!0,this.evt=[])},s=function(t){var e,o,n,r,s;if((r=this.items).hasOwnProperty(t))for(n=r[t],s=this.evt,o=s.length-1;o>=0;o+=-1)e=s[o],e.lst(n)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&n.render(this.$ds_key,t.$ds_key,function(t){return function(e){s.call(t,e)}}(this))},e.prototype.find=function(t,e,o){var n,r;return i&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof o||"object"==typeof o&&null!==o||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(r=e)),o&&o.hasOwnProperty(e)?o[e]:(this.items.hasOwnProperty(e)?(n=this.items[e]).addRef(t):(n=this.items[e]=new this.type(t,e,r),n.$ds_pool=this,this.evt&&(n.hasOwnProperty("$ds_evt")?(i&&_.find(n.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),n.$ds_evt.push(this)):n.$ds_evt=[this],this.__onChange(n))),o?o[e]=n:n)},e.prototype.enableWatch=function(t){if(i&&!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var o,n,s,c,l;if(i){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(s in e)if(c=e[s],"change"!==s&&"add"!==s&&"remove"!==s)throw new Error("Unexpected event listener: "+s);if(u&&(e.owner=t),!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled")}return(n=this.evt).push(l={lst:e}),this.addRef(t),o=!0,function(e){return function(){o&&(o=!1,e.release(t),_.remove(n,l))}}(this)},e.end(),e}(r)},{"./DSDigest":56,"./DSObjectBase":61,"./util":66}],63:[function(t,e,o){var n,r,s,i,a,u,c,l,p,d=function(t,e){function o(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},f={}.hasOwnProperty;p=t("./util"),s=t("./util").assert,c=t("./util").traceRefs,l=t("./util").traceWatch,u=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,i=t("./util").error,n=t("./DSObjectBase"),e.exports=r=function(t){function e(){return a.apply(this,arguments)}var o,r,a;return d(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,o,n;o=t=this.items;for(e in o)n=o[e],n.release(this),delete t[e]}),a=function(t,e,o,r){n.call(this,t,e),s&&(!o instanceof n&&i.notDSObjectClass(o),"object"!=typeof r&&void 0!==r&&i.invalidArg("data")),this.data=r,this.type=o,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,o,n;for(o=this.evt,e=o.length-1;e>=0;e+=-1)t=o[e],null!=(n=t.change)&&n.apply(t,arguments)},e.prototype.merge=function(t,e){var n,a,u;s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),"object"!=typeof e&&i.invalidArg("newMap")),u=this.items;for(a in u)n=u[a],e.hasOwnProperty(a)||r.call(this,n);for(a in e){if(n=e[a],s&&a!==n.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+n.$ds_key);o.call(this,t,n)}return this.items},e.prototype.reset=function(){var t,e,o,n,r;for(t=this.evt,_.forEach(o=this.items,function(e){return function(o){var n,r,s;for(r=0,s=t.length;r<s;r++)n=t[r],"function"==typeof n.remove&&n.remove(o);o.release(e)}}(this)),e=0,r=o.length;e<r;e++)n=o[e],delete o[n]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&r.call(this,t)},r=function(t){var e,o,n;for(t.hasOwnProperty("$ds_evt")&&(s&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],n=this.evt,o=n.length-1;o>=0;o+=-1)e=n[o],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=o=function(t,e){var o,r,a,l,d,f;if(s&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),e instanceof this.type||i.invalidMapElementType(this,e)),(l=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(s&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],l[e.$ds_key]=e,c&&(f=e.$ds_referries,0===f.length?console.error(n.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(n.desc(this)+": Referry not found: "+n.desc(t)):(u&&(console.info(++p.serviceOwner.msgCount+": transfer: "+n.desc(e)+", refs: "+this.$ds_ref+", from: "+n.desc(t)+", to: "+n.desc(this)),p.serviceOwner.msgCount===window.totalBreak),f[a]=this)),d=this.evt,r=d.length-1;r>=0;r+=-1)o=d[r],"function"==typeof o.add&&o.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,o){var n,r,a,u;if(s){"object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("owner"),"object"!=typeof e&&i.invalidArg("listener");for(a in e)if(u=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);l&&(e.owner=t)}if(_.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(r=this.evt).push(e),!o)return this.addRef(t),n=!0,function(o){return function(){n&&(n=!1,o.release(t),_.remove(r,function(t){return t===e}))}}(this)},e.prototype.addRef=function(t){var o;return 1===this.$ds_ref&&(o=this.data)&&1===++o.__busySets&&o.addRef(o.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var o;return e.__super__.release.call(this,t),1===this.$ds_ref&&(o=this.data)&&0===--o.__busySets&&o.release(o.__backRef),this},e.end(),e}(n)},{"./DSObjectBase":61,"./util":66}],64:[function(t,e,o){var n,r,s,i,a=function(t,e){function o(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=t("./util").assert,i=t("./util").error,n=t("./DSObjectBase"),e.exports=r=function(t){function e(t,o){var r,a,u,c,l,p,d,f,h,m;if(e.__super__.constructor.call(this,t,""+ ++e.nextTags),s&&(2===arguments.length&&"object"==typeof(f=arguments[1])||"string"!=typeof o&&i.invalidArg("enums")),2===arguments.length&&"object"==typeof(f=arguments[1])){f.__proto__===e.prototype?(this.map=_.clone(f.map),this.value=f.value):(this.map=l=_.clone(o),this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")),p=this.map;for(u in p)m=p[u],m instanceof n&&m.addRef(this)}else{if(this.map=l={},"string"==typeof o)for(d=o.split(","),r=0,c=d.length;r<c;r++)h=d[r],l[h.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")}}return a(e,t),e.nextTags=0,e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(o,n){var r,a;return s&&n&&"function"!=typeof n&&i.invalidArg("valid"),n=(a=n)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&a(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},r="_"+o,this.ds_dstr.push(function(){this[r]&&this[r].release(this)}),t.prop({name:o,type:"DSTags",valid:n,read:function(t){return null!==t?new e(this,t):null},str:function(t){return t.value},init:null,set:function(t){var e,s,a,u,c;if("undefined"==typeof(t=n(c=t))&&i.invalidValue(this,o,c),(u=this[r])!==t){if(this[r]=t,t&&t.addRef(this),e=this.$ds_evt)for(s=e.length-1;s>=0;s+=-1)a=e[s],a.__onChange.call(a,this,o,t,u);u&&u.release(this)}}})}},e.ds_dstr.push(function(){var t,e,o;e=this.map;for(t in e)o=e[t],o instanceof n&&o.release(this)}),e.prototype.clone=function(t){return new e(t,this)},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.set=function(t,e){var o,r,a,u;return s&&("string"!=typeof t&&i.invalidArg("enumValue"),"undefined"==typeof e&&i.invalidArg("value")),e?(o=(a=this.map).hasOwnProperty(t),e instanceof n&&e.addRef(this),(u=a[t])instanceof n&&u.release(this),a[t]=e,o||(this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((u=a[t])instanceof n&&u.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", ")),this},e.prototype.get=function(t){return s&&"string"!=typeof t&&i.invalidArg("enumValue"),!!this.map.hasOwnProperty(t)&&this.map[t]},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.empty=function(){var t;for(t in this.map)return!1;return!0},e.prototype.diff=function(t){var o,n,r;return s&&("object"==typeof t&&t.__proto__===e.prototype||i.invalidArg("src")),r=t.map,function(){var t;t=[];for(o in n=this.map)r.hasOwnProperty(o)||t.push("+"+o);return t}.call(this).concat(function(){var t;t=[];for(o in r)n.hasOwnProperty(o)||t.push("-"+o);return t}()).join(", ")},e.end(),e}(n)},{"./DSObjectBase":61,"./util":66}],65:[function(t,e,o){var n,r,s,i,a,u,c=function(t,e){function o(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(a=angular.module("dscommon/DSView",[t("../app/data/dsDataService")])).name,u=t("./util").traceView,s=t("./util").assert,i=t("./util").error,n=t("./DSObject"),r=t("./DSSet"),a.factory("DSView",["dsDataService","$log",function(t,e){var o,r;return r=function(){function t(){}return t.prototype.get=function(t){return s&&(this.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},t.prototype.set=function(t,e){return s&&(this.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e},t}(),o=function(e){function o(){return a.apply(this,arguments)}var a,l;return c(o,e),o.begin("DSView"),o.begin=function(t){var e;n.begin.call(this,t),this.prototype.__src=(e=this.__super__.__src)?_.clone(e):{}},o.propData=function(t,e,o){var n,r;if(s){if("undefined"!=typeof this.prototype._src)throw new Error("Duplicate data set name: "+t);"undefined"==typeof o||"object"==typeof o&&null!==o||i.invalidArg("params")}"object"==typeof o&&(o.hasOwnProperty("watch")?(r=o.watch,delete o.watch):r=null,s&&(_.isArray(r)||null===r||i.invalidArg("params.watch"))),this.prototype.__srcLength=(n=_.size(this.prototype.__src))+1,this.prototype.__src[t]={name:t,type:e,watch:r,params:o,index:n}},o.ds_dstr.push(function(){var t,e,o;"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2(),e=this.__src;for(t in e)o=e[t],"function"==typeof o.unwatch&&o.unwatch(),"function"==typeof o.unwatchStatus&&o.unwatchStatus(),o.hasOwnProperty("set")&&o.set.release(this)}),a=function(t,e){var o,r,a,u,c;n.call(this,t,e),s&&"object"!=typeof t&&i.invalidArg("$scope"),this.__unwatch1=(this.__scope=t).$on("$destroy",function(e){return function(){return delete e.__unwatch1,e.release(t)}}(this)),this.__dirty=0,this.__src=_.cloneDeep(this.__proto__.__src),this.__srcList=new Array(__proto__.__srcLength),this.dataStatus="nodata",a=function(t){return function(){t.__dirty++}}(this),r=this.__src;for(o in r)u=r[o],c=u.watch,u.listener={add:a,remove:a,change:c?function(t){return function(e){return function(o,n){e.indexOf(n)!==-1&&t.__dirty++}}}(this)(c):a}},o.prop({name:"data",type:"DSView.data",readonly:!0,init:function(){return new r}}),l=0,o.prototype.dataUpdate=function(e){var o,r,a,c,p;"undefined"==typeof e&&(e={}),s&&"object"!=typeof e&&null!==e&&i.invalidArg("params"),t.requestSources(this,e,this.__src),c=this.__src;for(r in c)p=c[r],p.hasOwnProperty("newSet")&&(a=p.newSet,p.hasOwnProperty("set")&&(p.set.release(this),p.unwatch(),p.unwatchStatus()),Object.defineProperty(o=this.get("data"),r,{configurable:!0,enumerable:!0,value:a.items}),Object.defineProperty(o,r+"Set",{configurable:!0,get:function(t){return function(){return t}}(a)}),Object.defineProperty(o,r+"Status",{configurable:!0,get:function(t){return function(){return t.get("status")}}(a)}),this.__srcList[p.index]=p.set=a,delete p.newSet,this.__dirty++,p.unwatch=a.watch(this,p.listener),p.unwatchStatus=a.watchStatus(this,function(t){return function(e,o,r){var s;(r=t.dataStatus)!==(s=n.integratedStatus(t.__srcList))&&(t.dataStatus=s,"ready"===s&&"update"===r||"update"===s&&"ready"===r||t.__dirty++)}}(this)));this.hasOwnProperty("__unwatch2")||(this.__unwatch2=this.__scope.$watch(function(t){return function(){return t.__dirty}}(this),function(t){return function(e,o){var r,s,i,a;if(u){s="",r=t.__src;for(a in r)i=r[a],s+=", "+a+": "+i.set.get("status");console.info(++l+":"+n.desc(t)+".render(): dataStatus: "+t.dataStatus+s),l===window.viewBreak}t.render()}}(this)))},o.end(),o}(n)}])},{"../app/data/dsDataService":7,"./DSObject":60,"./DSSet":63,"./util":66}],66:[function(t,e,o){var n,r;e.exports=r={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(n=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,o,n,r,s,i,a;for(s=this.services,e=0,n=s.length;e<n;e++)a=s[e],a.release(this);if(this.poolCleaners)for(i=this.poolCleaners,o=0,r=i.length;o<r;o++)(t=i[o])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,o){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+o+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,o){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+o+"'")}}}},{}],67:[function(t,e,o){!function(t,e,o){"use strict";function n(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var r=e.isDefined,s=e.isUndefined,i=e.isNumber,a=e.isObject,u=e.isArray,c=e.extend,l=e.toJson,p=e.fromJson,d=e.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,o,d){var f,h=this,m=h.prefix,g=h.cookie,y=h.notify,_=h.storageType;o?o[0]&&(o=o[0]):o=document,"."!==m.substr(-1)&&(m=m?m+".":"");var v=function(t){return m+t},w=function(){try{var o=_ in e&&null!==e[_],n=v("__"+Math.round(1e7*Math.random()));return o&&(f=e[_],f.setItem(n,""),f.removeItem(n)),o}catch(r){return _="cookie",t.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),S=function(e,o){if(s(o)?o=null:(a(o)||u(o)||i(+o||o))&&(o=l(o)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:o,storageType:"cookie"}),O(e,o);try{(a(o)||u(o))&&(o=l(o)),f&&f.setItem(v(e),o),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:o,storageType:h.storageType})}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.message),O(e,o)}return!0},D=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),$(e);var o=f?f.getItem(v(e)):null;return o&&"null"!==o?"{"===o.charAt(0)||"["===o.charAt(0)||n(o)?p(o):o:null},k=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),A(e);try{f.removeItem(v(e)),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),A(e)}return!0},T=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,o=[];for(var n in f)if(n.substr(0,e)===m)try{o.push(n.substr(e))}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.Description),[]}return o},b=function(e){e=e||"";var o=m.slice(0,-1),n=new RegExp(o+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),j();var r=m.length;for(var s in f)if(n.test(s))try{k(s.substr(r))}catch(i){return t.$broadcast("LocalStorageModule.notification.error",i.message),j()}return!0},P=function(){try{return e.navigator.cookieEnabled||"cookie"in o&&(o.cookie.length>0||(o.cookie="test").indexOf.call(o.cookie,"test")>-1)}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.message),!1}}(),O=function(e,n){if(s(n))return!1;if((u(n)||a(n))&&(n=l(n)),!P)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var r="",i=new Date,c="";if(null===n?(i.setTime(i.getTime()+-864e5),r="; expires="+i.toGMTString(),n=""):0!==g.expiry&&(i.setTime(i.getTime()+24*g.expiry*60*60*1e3),r="; expires="+i.toGMTString()),e){var p="; path="+g.path;g.domain&&(c="; domain="+g.domain),o.cookie=v(e)+"="+encodeURIComponent(n)+r+p+c}}catch(d){return t.$broadcast("LocalStorageModule.notification.error",d.message),!1}return!0},$=function(e){if(!P)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var n=o.cookie&&o.cookie.split(";")||[],r=0;r<n.length;r++){for(var s=n[r];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(v(e)+"=")){var i=decodeURIComponent(s.substring(m.length+e.length+1,s.length));try{var a=JSON.parse(i);return p(a)}catch(u){return i}}}return null},A=function(t){O(t,null)},j=function(){for(var t=null,e=m.length,n=o.cookie.split(";"),r=0;r<n.length;r++){for(t=n[r];" "===t.charAt(0);)t=t.substring(1,t.length);var s=t.substring(e,t.indexOf("="));A(s)}},C=function(){return _},L=function(t,e,o,n){n=n||e;var s=D(n);return null===s&&r(o)?s=o:a(s)&&a(o)&&(s=c(o,s)),d(e).assign(t,s),t.$watch(e,function(t){S(n,t)},a(t[e]))},M=function(){for(var t=0,o=e[_],n=0;n<o.length;n++)0===o.key(n).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:C,set:S,add:S,get:D,keys:T,remove:k,clearAll:b,bind:L,deriveKey:v,length:M,cookie:{isSupported:P,set:O,add:O,get:$,remove:A,clearAll:j}}}]})}(window,window.angular)},{}],68:[function(t,e,o){var n;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,o,r,s,i,a,u,c,l;for(l="",e=void 0,o=void 0,r="",s=void 0,i=void 0,a=void 0,u="",c=0;;)if(e=t.charCodeAt(c++),o=t.charCodeAt(c++),r=t.charCodeAt(c++),s=e>>2,i=(3&e)<<4|o>>4,a=(15&o)<<2|r>>6,u=63&r,isNaN(o)?a=u=64:isNaN(r)&&(u=64),l=l+n.charAt(s)+n.charAt(i)+n.charAt(a)+n.charAt(u),e=o=r="",s=i=a=u="",!(c<t.length))break;return l},decode:function(t){var e,o,r,s,i,a,u,c,l,p;for(p="",o=void 0,r=void 0,s="",i=void 0,a=void 0,u=void 0,c="",l=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(i=n.indexOf(t.charAt(l++)),a=n.indexOf(t.charAt(l++)),u=n.indexOf(t.charAt(l++)),c=n.indexOf(t.charAt(l++)),o=i<<2|a>>4,r=(15&a)<<4|u>>2,s=(3&u)<<6|c,p+=String.fromCharCode(o),64!==u&&(p+=String.fromCharCode(r)),64!==c&&(p+=String.fromCharCode(s)),o=r=s="",i=a=u=c="",!(l<t.length))break;return p}}},{}]},{},[1]);