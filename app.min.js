!function t(e,n,o){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return r(n?n:t)},l,l.exports,t,e,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(t,e,n){t("./ng-app"),moment.locale("ru")},{"./ng-app":26}],2:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("../dscommon/util").assert,l=t("../dscommon/util").validate,c=t("../dscommon/util").serviceOwner,o=t("../dscommon/DSObject"),r=t("./models/Person"),t("../utils/angular-local-storage.js"),e.exports=(u=angular.module("config",["LocalStorageModule"])).name,u.config(["localStorageServiceProvider",function(t){t.setPrefix("rms")}]),u.run(["$rootScope","config",function(t,e){t.config=e}]),i=1,s=1,u.factory("config",["$http","localStorageService",function(t,e){var n,a,u,p,f,h,m,g,y,_,v,w;if(n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return d(n,t),n.begin("Config"),n.propStr("token",{valid:l.trimString}),n.propStr("teamwork",{init:"http://teamwork.webprofy.ru/"}),n.propCalc("hasRoles",function(){return"http://teamwork.webprofy.ru/"===this.teamwork||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propCalc("hasTimeReports",function(){return"http://teamwork.webprofy.ru/"===this.teamwork||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propConst("planTag","План"),n.propConst("teamleadRole","Teamlead"),n.propNum("hResizer"),n.propNum("vResizer"),n.propStr("currentUserId"),n.propDoc("currentUser",r),n.propCalc("canUserSetPlan",function(){var t,e;return(null!=(t=this.currentUser)&&null!=(e=t.roles)?e.get(this.teamleadRole):void 0)||"http://delightsoft.teamworkpm.net/"===this.teamwork}),n.propStr("selectedRole"),n.propNum("selectedCompany",{init:-1}),n.propNum("selectedLoad"),n.propNum("activeSidebarTab",{init:0}),n.propNum("refreshPeriod"),n.propNum("view3GroupByPerson",{init:0}),n.propNum("view3HidePeopleWOTasks",{init:0}),n.propStr("view3FilterByPerson",{init:""}),n.propStr("view3FilterByProject",{init:""}),n.propStr("view3FilterByTask",{init:""}),n.propNum("histStart",{init:-1}),n.onAnyPropChange(function(t,n,o,r){"currentUserId"!==n&&"currentUser"!==n&&("teamwork"!==n&&"token"!==n||this.set("histStart",-1),"undefined"!=typeof o?e.set(n,o):e.remove(n))}),n.prototype.hasFilter=function(){var t;return t=this.get("teamwork"),"http://teamwork.webprofy.ru/"===t||"https://delightsoft.teamworkpm.net/"===t},n.end(),n}(o),a=c.add(new n(c,"config")),p=!0,f=!0,_=1,v=0,"string"==typeof(y=e.get("ver"))&&((w=y.split(".")).length=2)&&(_=parseInt(w[0]),v=parseInt(w[1])),f=(p=_===i)&&v===s,f||e.set("ver",i+"."+s),p){m=n.prototype.__props;for(h in m)u=m[h],(f||"teamwork"===h||"token"===h)&&(u.readonly||null===(g=e.get(h))||a.set(h,g))}return a}])},{"../dscommon/DSObject":62,"../dscommon/util":68,"../utils/angular-local-storage.js":69,"./models/Person":16}],3:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;e.exports=(d=angular.module("data/PeopleWithJson",[])).name,c=t("../../dscommon/util").assert,l=t("../../dscommon/util").error,s=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),o=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),r=t("../../dscommon/DSDataServiceBase"),u=t("../models/Person"),d.factory("PeopleWithJson",["DSDataSource","config","$rootScope","$http","$q",function(t,e,n,d,f){var h;return h=function(t){function h(){return h.__super__.constructor.apply(this,arguments)}return p(h,t),h.begin("PeopleWithJson"),h.addPool(),h.propDoc("teamworkPeople",s),h.propObj("cancel",{init:null}),h.propSet("people",u),h.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this._unwatchA&&this._unwatchA()}),h.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},h.prototype.init=function(t){var o,s,p,h;c&&(t instanceof r||l.invalidArg("dsDataService")),(h=this.set("teamworkPeople",t.findDataSet(this,_.assign({},this.params,{type:u,source:!0})))).release(this),p=this.get("peopleSet"),s=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),o=function(t){return function(){var o;t._startLoad()&&(o=t.set("cancel",f.defer()),d.get("data/people.json?t="+(new Date).getTime(),o).then(function(o){200===o.status?(t.set("cancel",null),i.block(function(){var r,i,s,u,c,l,d,f,m,g,y,_,v,w;if(f=n.peopleRoles=o.data.roles,w=e.get("selectedRole"))for(s=0,c=f.length;s<c;s++)i=f[s],i.role===w&&(n.selectedRole=i);for(_=o.data.people,u=0,l=_.length;u<l;u++)g=_[u],h.items.hasOwnProperty(y=""+g.id)&&(h.items[y].set("roles",r=new a(t,g.role)),r.release(t));d={},v=h.items;for(y in v)m=v[y],d[y]=m,m.addRef(t);p.merge(t,d),t._endLoad(!0)})):s(o,0===o.status)},s))}}(this),this._unwatchA=h.watchStatus(this,function(t){return function(e,n){var r;if(n!==(r=t.get("status")))switch(n){case"ready":i.block(o);break;case"update":i.block(o);break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},h.end(),h}(o)}])},{"../../dscommon/DSData":53,"../../dscommon/DSDataServiceBase":56,"../../dscommon/DSDigest":58,"../../dscommon/DSSet":65,"../../dscommon/DSTags":66,"../../dscommon/util":68,"../models/Person":16}],4:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h=function(t,e){function n(){this.constructor=t}for(var o in e)m.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},m={}.hasOwnProperty;e.exports=(f=angular.module("data/PersonDayStatData",[])).name,d=t("../../dscommon/util").assert,p=t("../../dscommon/util").error,s=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSDataServiceBase"),o=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),a=t("../../dscommon/DSSet"),u=t("../models/Person"),l=t("../models/Task"),c=t("../models/PersonDayStat"),f.factory("PersonDayStatData",[function(){var t;return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.begin("PersonDayStatData"),e.addPool(),e.propDoc("tasks",a),e.propDoc("people",a),e.propSet("personDayStats",c),e.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),e.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},e.prototype.init=function(t){var e,n,o,a,f,h,m,g;d&&(t instanceof r||p.invalidArg("dsDataService")),(h=this.set("tasks",t.findDataSet(this,_.assign({},this.params,{type:l,filter:"assigned"})))).release(this),m=h.items,(n=this.set("people",t.findDataSet(this,{type:u,mode:this.params.mode}))).release(this),o=n.items,a=this.get("personDayStats"),e=function(t){return function(){var e,r,s,l,f,g,y,v,w,S,D,k,b,T,O;if(t._startLoad()){O=_.groupBy(m,function(t){return t.get("responsible").$ds_key}),f=moment.duration((y=t.params.endDate).diff(b=t.params.startDate)).asDays(),s=b,l=function(){var t,e,n;for(n=[],v=t=0,e=f;0<=e?t<=e:t>=e;v=0<=e?++t:--t)n.push(((s=moment(k=s)).add(1,"day"),k));return n}(),e=function(t){var e,n,o,r,i,a,u,c,d,p,f,h,m,g,y,_,w,S,D,k,T,P,$;if(k=function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)s=l[t],n.push(0);return n}(),T=function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)s=l[t],n.push(moment.duration(0));return n}(),n=t.get("dayStats"),O.hasOwnProperty(m=(h=t.get("person")).$ds_key))for(g=O[m],i=0,c=g.length;i<c;i++)if(D=g[i],null!==(o=D.duedate))if(null!==(w=D.get("split")))for(y=S=w.list,v=a=0,d=y.length;a<d;v=a+=2)s=y[v],f=Math.floor(moment(o).add(s).diff(b)/864e5),0<=f&&f<n.length&&(T[f].add(S[v+1]),k[f]++);else f=Math.floor((o.valueOf()-b.valueOf())/864e5),0<=f&&f<n.length&&(null!==(r=D.get("estimate"))&&T[f].add(r),k[f]++);for(e=h.get("contractTime"),P=moment.duration(0),v=u=0,p=n.length;u<p;v=++u)_=n[v],_.set("tasksCount",k[v]),_.set("contract",e),_.set("tasksTotal",$=T[v]),_.set("timeLeft",moment.duration(e).subtract($)),P.add($);t.set("totalPeriodTime",P)},T={};for(S in o)w=o[S],e(T[S]=new c(t,w.$ds_key,w,l));t.get("personDayStatsSet").merge(t,T),g=function(t){a.hasOwnProperty(t)&&e(a[t])},D=function(e){d&&(e instanceof u||p.invalidArg("person")),i.render(t.$ds_key,e.$ds_key,g)},t._unwatch1=h.watch(t,{change:r=function(t,e,n,o){"estimate"===e||"split"===e||"duedate"===e?null!==(w=t.get("responsible"))&&null!==t.get("duedate")&&D(w):"responsible"===e&&(null!==o&&O.hasOwnProperty(S=o.$ds_key)&&_.remove(O[S],t).length>0&&D(o),null!==n&&(h=O.hasOwnProperty(S=n.$ds_key)?O[S]:O[S]=[],_.find(h,t)||(h.push(t),D(n))))},add:function(t){r(t,"responsible",t.get("responsible"),null)},remove:function(t){null!==(w=t.get("responsible"))&&O.hasOwnProperty(S=w.$ds_key)&&(_.remove(O[S],t),D(w))}}),t._unwatch2=n.watch(t,{add:function(e){var n,o;o=new c(t,n=e.$ds_key,e,l),o.get("dayStatsList").merge(t,function(){var t,e,n;for(n=[],v=t=0,e=l.length;t<e;v=++t)s=l[v],n.push(((k=new c.DayStat(this,"personKey_"+v)).set("day",s),k));return n}.call(t)),t.get("personDayStatsSet").add(t,o),D(e)},remove:function(e){t.get("personDayStatsSet").remove(t.get("personDayStats")[e.$ds_key])},change:function(t,e,n,o){"contractTime"===e&&D(t)}}),t._endLoad(!0)}}}(this),f=[h,n],g=function(t){return function(n,o){var r,a;if((r=s.integratedStatus(f))!==(a=t.get("status")))switch(r){case"ready":i.block(e);break;case"update":t._startLoad()&&t._endLoad(!0);break;case"nodata":t.set("status","nodata")}}}(this),this._unwatchA=n.watchStatus(this,g),this._unwatchB=h.watchStatus(this,g),this.init=null},e.end(),e}(o)}])},{"../../dscommon/DSData":53,"../../dscommon/DSDataServiceBase":56,"../../dscommon/DSDigest":58,"../../dscommon/DSDocument":59,"../../dscommon/DSSet":65,"../../dscommon/util":68,"../models/Person":16,"../models/PersonDayStat":17,"../models/Task":21}],5:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f=function(t,e){function n(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(p=angular.module("data/TasksWithTimeTracking",[])).name,l=t("../../dscommon/util").assert,d=t("../../dscommon/util").error,s=t("../../dscommon/DSSet"),a=t("../../dscommon/DSTags"),o=t("../../dscommon/DSData"),i=t("../../dscommon/DSDigest"),r=t("../../dscommon/DSDataServiceBase"),u=t("../models/Task"),c=t("../models/TaskTimeTracking"),p.factory("TasksWithTimeTracking",["DSDataSource","$rootScope","$http","$q",function(t,e,n,i){var a;return a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.begin("TasksWithTimeTracking"),e.addPool(),e.propDoc("srcTasks",s),e.propDoc("srcTasksTimeTracking",s),e.propObj("cancel",{init:null}),e.propSet("tasks",u),e.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),e.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},e.prototype.init=function(t){var e,n,o;l&&(t instanceof r||d.invalidArg("dsDataService")),(e=this.set("srcTasks",t.findDataSet(this,{mode:"original",type:u,filter:"all",source:!0}))).release(this),(n=this.set("srcTasksTimeTracking",t.findDataSet(this,{mode:"original",type:c}))).release(this),o=this.get("tasksSet"),this.__unwatchA=e.watch(this,{add:function(t){var e;null===t.get("timeTracking")&&(e=c.pool.find(this,t.$ds_key))&&(t.set("timeTracking",e),e.release(this)),o.add(this,t.addRef(this))},remove:function(t){o.remove(t)}}),this.__unwatchB=e.watchStatus(this,function(t){return function(e,n){t.set("status",n)}}(this)),this.init=null},e.end(),e}(o)}])},{"../../dscommon/DSData":53,"../../dscommon/DSDataServiceBase":56,"../../dscommon/DSDigest":58,"../../dscommon/DSSet":65,"../../dscommon/DSTags":66,"../../dscommon/util":68,"../models/Task":21,"../models/TaskTimeTracking":22}],6:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m,g,y=function(t,e){function n(){this.constructor=t}for(var o in e)v.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},v={}.hasOwnProperty;e.exports=(m=angular.module("data/dsDataChanges",["LocalStorageModule",t("../../dscommon/DSDataSource")])).name,f=t("../../dscommon/util").assert,g=t("../../dscommon/util").serviceOwner,h=t("../../dscommon/util").error,a=t("../../dscommon/DSDigest"),i=t("../../dscommon/DSChangesBase"),s=t("../../dscommon/DSDataEditable"),c=t("../../dscommon/DSTags"),u=t("../../dscommon/DSSet"),l=t("../models/Person"),p=t("../models/Task"),r=t("../models/types/Comments"),d=t("../utils/RMSData"),m.run(["dsChanges","$rootScope",function(t,e){e.changes=t}]),o=1,m.factory("dsChanges",["DSDataSource","config","localStorageService","$http","$timeout","$q",function(t,e,n,f,h,m){var v;return v=function(f){function g(){return v.apply(this,arguments)}var v;return y(g,f),g.begin("DSChanges"),g.propSet("tasks",p.Editable),g.propObj("dataService"),g.propDoc("source",t),g.propObj("cancel",{init:null}),g.propDoc("tags",u),g.ds_dstr.push(function(){var t;this.__unwatch2(),"function"==typeof this.__unwatchStatus1&&this.__unwatchStatus1(),"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),(t=this.get("cancel"))&&t.resolve()}),v=function(t,e){i.call(this,t,e)},g.prototype.init=function(t,e){this.set("dataService",t),this.set("source",t.get("dataSource")),this.set("tags",e),p.prototype.__props.tags.read=function(t){var n,o,r,i,s;if(null===t)return null;for(s=null,r=t.split(","),n=0,o=r.length;n<o;n++)i=r[n],e.items.hasOwnProperty(i=i.trim())&&((s||(s={}))[i]=e.items[i]);return null===s?null:new c(this,s)},this.__unwatch2=this.tags.watchStatus(this,function(t){return function(e,n){switch(n){case"ready":a.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},g.prototype.clear=function(){"function"==typeof this.__unwatchStatus2&&this.__unwatchStatus2(),delete this.__unwatchStatus2,this.reset()},g.prototype.load=function(){var t,r,i;if("ready"!==this.get("status")){if(!this._startLoad())return;t=s(p.Editable).$u,(r=n.get("changes"))?r.ver===o&&r.source.url===e.get("teamwork")&&r.source.token===e.get("token")?(i=this.get("dataService").findDataSet(this,{type:l,mode:"original"}),this.__unwatchStatus2=i.watchStatus(this,function(e){return function(n,o,s,u){"ready"===o&&(u(),a.block(function(){var n,o,s,a,u,c,l,d,f,h,m,g,y,_,v,w;p.pool.enableWatch(!1),h=e.mapToChanges(r.changes),l=h.load.Person;for(c in l)if(a=l[c],i.items.hasOwnProperty(c))for(u=i.items[c],o=0,s=a.length;o<s;o++)(n=a[o])(u);else console.error("Person #{personKey} missing in server data");w=(v=e.get("tasksSet")).$ds_pool,f={},d=h.changes.tasks;for(_ in d)g=d[_],p.pool.items.hasOwnProperty(_)?(m=p.pool.items[_]).addRef(e):(m=p.pool.find(e,_)).readMap(r.tasks[_]),(y=w.find(e,_,f)).init(m,v,g),y.$u=t,y.hasOwnProperty("__change")||(delete f[y.$ds_key],y.release(e)),m.release(e);v.merge(e,f),p.pool.enableWatch(!0),e._endLoad(!0)}))}}(this)),i.release(this)):(n.remove("changes"),this._endLoad(!0)):this._endLoad(!0)}},g.prototype.persist=function(){this.hasOwnProperty("__persist")||(this.__persist=h(function(t){return function(){delete t.__persist,t.saveToLocalStorage()}}(this)))},g.prototype.saveToLocalStorage=function(){var t,r,i;if(this.anyChange()){t=this.changesToMap(),i={};for(r in t.tasks)i[r]=p.pool.items[r].writeMap();n.set("changes",{ver:o,changes:t,source:{url:e.get("teamwork"),token:e.get("token")},tasks:i})}else n.remove("changes")},g.prototype.save=function(t){return function(e){var n,o,i,s,u,c,l,p,f,h,g,y,v,w,S,D,k,b,T,O,P,$,A,j;if(t&&!e)return t.promise;if(e||(t=m.defer(),e=function(){var t,e;t=this.get("tasks"),e=[];for($ in t)P=t[$],e.push(P.addRef(this));return e}.call(this)),f=null,j={"todo-item":A={}},!(P=e.shift())){if((e=function(){var t,e;t=this.get("tasks"),e=[];for($ in t)P=t[$],P.__change.__error||e.push(P.addRef(this));return e}.call(this)).length>0)return void this.save(e);o=!0;for(p in this.get("tasks")){o=!1;break}return t.resolve(o),y=t.promise,t=null,y}i=_.clone(P.__change),A.content=P.get("title"),u=!1;for(w in i)if(v=i[w],"__error"!==w&&"__refreshView"!==w)switch(w){case"title":break;case"comments":break;case"description":i.hasOwnProperty("split")||(A.description=P.get("description"));break;case"split":A.description=d.put(P.get("description"),(k=v.v)?{split:v.v.valueOf()}:null),A["start-date"]=null===k||null===(l=P.get("duedate"))?"":k.firstDate(l).format("YYYYMMDD");break;case"duedate":A["due-date"]=c=v.v?v.v.format("YYYYMMDD"):"",null!==(b=P.get("startDate"))&&b>P.get("duedate")&&(A["start-date"]=c);break;case"estimate":A["estimated-minutes"]=v.v?Math.floor(v.v.asMinutes()):"0";break;case"responsible":A["responsible-party-id"]=(f=v.v)?[v.v.get("id")]:[];break;case"tags":A.tags=(O=null!=(S=P.get("tags"))?S.map:void 0)?function(){var t;t=[];for(T in O)t.push(T);return t}().join():"";break;case"plan":s=null===(s=P.get("comments"))?new r:s.clone(),s.unshift(v.v?"Поставлено в план на "+P.get("duedate").format("DD.MM.YYYY"):"Снято с плана.  Причина:"),P.set("comments",s);break;default:console.error("change.save(): Property "+w+" not expected to be changed")}return n=function(e){return function(n,o){o||(console.error("error: ",n),e.set("cancel",null)),P.release(e),t.reject(),t=null}}(this),D=function(t){return function(){return t.get("source").httpPut("tasks/"+P.get("id")+".json",j,t.set("cancel",m.defer())).then(function(o){var r,u,c;if(t.set("cancel",null),200===o.status)if(delete i.__error,a.block(function(){for(w in i)v=i[w],"__refreshView"!==w&&P.$ds_doc.set(w,v.v)}),null!==(s=P.get("comments"))){for(c="";u=s.shift();)c+="<p>"+u+"</p>";j={comment:{"content-type":"html",body:c,isprivate:!1}},t.get("source").httpPost("tasks/"+P.get("id")+"/comments.json",j,t.set("cancel",m.defer())).then(function(o){t.set("cancel",null),201===o.status?(P.$ds_chg.$ds_hist.setSameAsServer(P,"comments"),P.release(t),t.save(e)):n(o,0===o.status)},n)}else P.release(t),t.save(e);else P.__change.__error=o.data.MESSAGE,"function"==typeof(r=P.__change).__refreshView&&r.__refreshView(),P.release(t),t.save(e)},n)}}(this),null===f?D():null===(g=(h=P.get("project")).get("people"))?this.get("source").httpGet("projects/"+h.get("id")+"/people.json",this.set("cancel",m.defer())).then(function(t){return function(e){var o,r,i,s;if(t.set("cancel",null),200===e.status){for(h.set("people",g={}),s=e.data.people,o=0,r=s.length;o<r;o++)i=s[o],g[i.id]=!0;t.addPersonToProject(h,f,D,n)}else n(e,0===e.status)}}(this),n):g.hasOwnProperty(f.get("id"))?D():this.addPersonToProject(h,f,D),t.promise}}(null),g.prototype.addPersonToProject=function(t,e,n,o){this.get("source").httpPost("projects/"+t.get("id")+"/people/"+e.get("id")+".json",null,this.set("cancel",m.defer())).then(function(r){return function(i){r.set("cancel",null),200===i.status||409===i.status?(t.get("people")[e.get("id")]=!0,n()):o(i,0===i.status)}}(this),o)},g.end(),g}(i),g.add(new v(g,"dataChanges"))}])},{"../../dscommon/DSChangesBase":52,"../../dscommon/DSDataEditable":54,"../../dscommon/DSDataSource":57,"../../dscommon/DSDigest":58,"../../dscommon/DSSet":65,"../../dscommon/DSTags":66,"../../dscommon/util":68,"../models/Person":16,"../models/Task":21,"../models/types/Comments":24,"../utils/RMSData":51}],7:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m,g,y,v=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(g=angular.module("data/dsDataService",[t("./PeopleWithJson"),t("./TasksWithTimeTracking"),t("./teamwork/TWPeople"),t("./teamwork/TWTasks"),t("./teamwork/TWTags"),t("./teamwork/TWTimeTracking"),t("./PersonDayStatData"),t("./dsChanges"),t("../../dscommon/DSDataSource"),t("../config")])).name,f=t("../../dscommon/util").assert,y=t("../../dscommon/util").serviceOwner,m=t("../../dscommon/util").error,h=t("../../utils/base64"),a=t("../../dscommon/DSObject"),s=t("../../dscommon/DSDataServiceBase"),o=t("../../dscommon/DSChangesBase"),r=t("../../dscommon/DSDataEditable"),i=t("../../dscommon/DSDataFiltered"),u=t("../models/Person"),l=t("../models/Tag"),d=t("../models/Task"),p=t("../models/TaskTimeTracking"),c=t("../models/PersonTimeTracking"),g.run(["dsDataService","$rootScope",function(t,e){e.dataService=t}]),g.factory("dsDataService",["TWPeople","TWTasks","TWTags","TWTimeTracking","PeopleWithJson","TasksWithTimeTracking","PersonDayStatData","DSDataSource","dsChanges","config","$http","$rootScope","$q",function(t,e,n,a,p,m,g,w,S,D,k,b,T){var O;return O=function(y){function O(){return P.apply(this,arguments)}var P;return v(O,y),O.begin("DSDataService"),O.propDoc("dataSource",w),O.propPool("editedPeople",r(u.Editable)),O.propPool("editedTasks",r(d.Editable)),O.propPool("tasksPool",i(d)),O.propPool("personTimeTrackingPool",i(c)),O.propBool("showTimeSpent",{init:!1}),O.propDoc("changes",o),O.propSet("emptyPersonTimeTracking",c),O.ds_dstr.push(function(){this.__unwatch2()}),P=function(){var t,e;s.apply(this,arguments),this.set("dataSource",new w(this,"dataSource")).release(this),t=null,this.__unwatch2=b.$watch(function(){return[D.get("teamwork"),D.get("token")]},function(e){return function(n){var o,r,i;return r=n[0],i=n[1],r&&i?(t&&(t.resolve(),t=null),o=function(n,o){o||(console.error("error: ",n),t=null),e.get("dataSource").setConnection(null,null)},k.get(r+"authenticate.json",{timeout:(t=T.defer()).promise,headers:{Authorization:"Basic "+h.encode(i)}}).then(function(n){200===n.status?(t=null,D.set("currentUserId",n.data.account.userId),e.get("dataSource").setConnection(r,i)):o(n,0===n.status)},o),void 0):e.get("dataSource").setConnection(null,null)}}(this),!0),e=this.findDataSet(this,{type:l,mode:"original"}),this.set("changes",S).init(this,e),e.release(this)},O.prototype.refresh=function(){this.get("dataSource").refresh()},O.prototype.findDataSet=function(o,r){var i,f,h,y,v,w,S,k,b,T,O;switch(s.prototype.findDataSet.call(this,o,r),r.type.docType){case"Tag":return"function"==typeof(i=S=n.pool.find(this,{})).init&&i.init(this),(b=S.get("tagsSet")).addRef(o),S.release(this),b;case"PersonDayStat":return"function"==typeof(f=S=g.pool.find(this,r)).init&&f.init(this),(b=S.get("personDayStatsSet")).addRef(o),S.release(this),b;case"TaskTimeTracking":return(S=a.pool.find(this,{})).init&&S.init(this),(b=S.get("taskTimeTrackingSet")).addRef(o),S.release(this),b;case"PersonTimeTracking":return r.hasOwnProperty("showTimeSpent")&&!r.showTimeSpent?(b=this.get("emptyPersonTimeTrackingSet")).addRef(o):r.hasOwnProperty("startDate")?((S=this.get("personTimeTrackingPool").find(this,r)).init&&(S.init(k=this.findDataSet(this,{type:c,mode:r.mode}),a.filterPersonTimeTracking(r)),k.release(this)),(b=S.get("itemsSet")).addRef(o),S.release(this)):((S=a.pool.find(this,{})).init&&S.init(this),(b=S.get("personTimeTrackingSet")).addRef(o),S.release(this)),b}switch(r.mode){case"edited":switch(O=r.type.docType){case"Person":return this.findDataSet(o,_.assign({},r,{mode:"original"}));case"Task":return(S=this.get("editedTasks").find(this,r)).init&&(S.init(k=this.findDataSet(this,_.assign({},r,{mode:"original"})),w=this.findDataSet(this,_.assign({},r,{mode:"changes"})),e.filter(r)),k.release(this),w.release(this)),(b=S.get("itemsSet")).addRef(o),S.release(this),b;default:throw new Error("Not supported model type (1): "+O)}break;case"changes":switch(O=r.type.docType){case"Task":return(b=this.get("changes").get("tasksSet")).addRef(o);default:throw new Error("Not supported model type (2): "+O)}break;case"original":switch((O=r.type)!==u?O.docType:!D.get("hasRoles")||r.source?u.docType:"PeopleWithJson"){case"PeopleWithJson":return"function"==typeof(h=S=p.pool.find(this,r)).init&&h.init(this),(b=S.get("peopleSet")).addRef(o),S.release(this),b;case"Person":return delete r.source,"function"==typeof(y=S=t.pool.find(this,r)).init&&y.init(this),(b=S.get("peopleSet")).addRef(o),S.release(this),b;case"Task":return"all"!==r.filter||r.hasOwnProperty("startDate")?((S=this.get("tasksPool").find(this,r)).init&&(S.init(k=this.findDataSet(this,{type:d,mode:"original",filter:"all"}),e.filter(r)),k.release(this)),(b=S.get("itemsSet")).addRef(o),S.release(this)):(!D.get("hasTimeReports")||r.source?(delete r.source,T=this.findDataSet(this,{type:l,mode:"original"}),"function"==typeof(v=S=e.pool.find(this,r)).init&&v.init(this,T),T.release(this)):(S=m.pool.find(this,{})).init&&S.init(this),(b=S.get("tasksSet")).addRef(o),S.release(this)),b;default:throw new Error("Not supported model type (3): "+O)}}},O.prototype.requestSources=function(t,e,n){var o,r,i,a,u,c,l,d,p;s.prototype.requestSources.call(this,t,e,n);for(r in n){switch(p=n[r],l=_.assign({},p.params,e),u={type:d=p.type,mode:i=l.mode},o=d.docType){case"Tag":break;case"Person":break;case"PersonDayStat":u.startDate=l.startDate,u.endDate=l.endDate;break;case"PersonTimeTracking":u.showTimeSpent=l.showTimeSpent,u.startDate=l.startDate,u.endDate=l.endDate;break;case"Task":if("changes"!==i){if(f&&!("string"==typeof l.filter&&0<=["all","assigned","notassigned","overdue","noduedate","clipboard"].indexOf(l.filter)))throw new Error("Unexpected filter: "+l.filter);u.filter=l.filter,"all"!==l.filter&&"assigned"!==l.filter&&"notassigned"!==l.filter||(u.startDate=l.startDate,u.endDate=l.endDate)}break;default:throw new Error("Not supported model type (4): "+o)}a=this.findDataSet(t,u),"undefined"==typeof(c=p.set)||c!==a?p.newSet=a:a.release(t)}},O.end(),O}(s),y.add(new O(y,"dataService"))}])},{"../../dscommon/DSChangesBase":52,"../../dscommon/DSDataEditable":54,"../../dscommon/DSDataFiltered":55,"../../dscommon/DSDataServiceBase":56,"../../dscommon/DSDataSource":57,"../../dscommon/DSObject":62,"../../dscommon/util":68,"../../utils/base64":70,"../config":2,"../models/Person":16,"../models/PersonTimeTracking":18,"../models/Tag":20,"../models/Task":21,"../models/TaskTimeTracking":22,"./PeopleWithJson":3,"./PersonDayStatData":4,"./TasksWithTimeTracking":5,"./dsChanges":6,"./teamwork/TWPeople":10,"./teamwork/TWTags":11,"./teamwork/TWTasks":12,"./teamwork/TWTimeTracking":13}],8:[function(t,e,n){var o,r,i,s;r=t("../../dscommon/util").assert,s=t("../../dscommon/util").serviceOwner,o=t("../models/Task.coffee"),e.exports=(i=angular.module("data/persistClipboard",[t("./dsDataService.coffee")])).name,i.factory("clipboardTasks",["localStorageService",function(t){var e,n,o,r,i;if(r={},null!==(i=t.get("clipboardTasks")))for(e=0,o=i.length;e<o;e++)n=i[e],r[n]=!0;return r}]),i.run(["dsDataService","localStorageService",function(t,e){var n,r;n=s.add(t.findDataSet(s,{type:o,mode:"original",filter:"clipboard"})),r=s.add(n.watchStatus(s,function(t,o){var i;"ready"===o&&(r(),(i=function(){var t;e.set("clipboardTasks",function(){var e;e=[];for(t in n.items)e.push(t);return e}())})(),s.add(n.watch(s,{add:i,remove:i})))}))}])},{"../../dscommon/util":68,"../models/Task.coffee":21,"./dsDataService.coffee":7}],9:[function(t,e,n){var o,r,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(u=angular.module("dscommon/DSDataTeamworkPaged",[])).name,s=t("../../../dscommon/util").assert,a=t("../../../dscommon/util").error,o=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),i=500,u.factory("DSDataTeamworkPaged",["DSDataSource","$rootScope","$q",function(t,e,n){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return c(a,e),a.begin("DSDataTeamworkPaged"),a.propDoc("source",t),a.propObj("cancel",{init:null}),a.propEnum("method",["httpGet","httpPost","httpPut"]),a.propStr("request"),a.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve()}),a.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},a.prototype.load=function(){var t,e,o,a,u;if(s){if(!this.get("source"))throw new Error("load(): Source is not specified");if(!("string"==typeof(u=this.get("request"))&&u.length>0))throw new Error("load(): Request is not specified")}this._startLoad()&&(e=this.set("cancel",n.defer()),o=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),t._endLoad(!1)}}(this),t=function(t,e){return""+e+(e.indexOf("?")===-1?"?":"&")+"page="+t+"&pageSize="+i},this.startLoad(),(a=function(n){return function(s){var u;return function(){switch(u=this.get("method")){case"httpGet":return this.get("source").httpGet(t(s,this.get("request")),e);case"httpPost":return this.get("source").httpPost(t(s,this.get("request")),this.params.json,e);case"httpPut":return this.get("source").httpPut(t(s,this.get("request")),this.params.json,e)}}.call(n).then(function(t){var e;if(200===t.status){if(n.set("cancel",null),n.importResponse(t.data,t.status)===i)return void a(s+1);e=r.block(function(){return n.finalizeLoad()}),"object"==typeof e&&null!==e&&"then"in e?e.then(function(){n._endLoad(!0)}):n._endLoad(!0)}else o(t,0===t.status)},o)}}(this))(1))},a.end(),a}(o)}])},{"../../../dscommon/DSData":53,"../../../dscommon/DSDigest":58,"../../../dscommon/util":68}],10:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWPeople",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../models/Person"),s.factory("TWPeople",["DSDataTeamworkPaged","DSDataSource","$rootScope","$q",function(t,e,n,r){var i;return i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.begin("TWPeople"),n.addPool(),n.propSet("people",o),n.ds_dstr.push(function(){this.__unwatch2()}),n.prototype.init=function(t){this.set("request","people.json"),this.__unwatch2=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){return this.peopleMap={}},n.prototype.importResponse=function(t){var e,n,r,i,s,a;for(e=0,a=t.people,n=0,i=a.length;n<i;n++)r=a[n],++e,s=o.pool.find(this,""+r.id,this.peopleMap),s.set("id",+r.id),s.set("name",(r["last-name"]+" "+r["first-name"].charAt(0).toUpperCase()+".").trim()),s.set("firstName",r["first-name"].trim()),s.set("avatar",r["avatar-url"]),s.set("email",r["email-address"]),s.set("companyId",+r["company-id"]),s.set("currentUser",!1);return e},n.prototype.finalizeLoad=function(){this.get("peopleSet").merge(this,this.peopleMap),delete this.peopleMap},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":57,"../../../dscommon/util":68,"../../models/Person":16,"./DSDataTeamworkPaged":9}],11:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e.exports=(s=angular.module("data/teamwork/TWTags",[t("../../../dscommon/DSDataSource"),t("./DSDataTeamworkPaged")])).name,r=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../models/Tag"),s.factory("TWTags",["DSDataTeamworkPaged","DSDataSource","$rootScope","$http","$q",function(t,e,n,r,i){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments);
}return a(n,t),n.begin("TWTags"),n.addPool(),n.propObj("cancel",{init:null}),n.propSet("tags",o),n.ds_dstr.push(function(){this.__unwatch()}),n.prototype.init=function(t){this.set("request","tags.json"),this.__unwatch=e.setLoadAndRefresh.call(this,t),this.init=null},n.prototype.startLoad=function(){var t;this.tagsMap={},t=function(t){return function(e,n){return n||(console.error("error: ",e),t.set("cancel",null)),[]}}(this),this.tagsJson=r.get("data/tags.json?t="+(new Date).getTime(),this.set("cancel",i.defer())).then(function(e){return function(n){var o,r,i,s,a,u;if(200!==n.status)return t(n,0===n.status);if(e.set("cancel",null),u=n.data,!Array.isArray(u))return console.error("invalid tags.json"),[];for(o=!1,r=i=0,s=u.length;i<s;r=++i)a=u[r],"string"==typeof a.name&&a.name.length>=0||(o=!0,console.error("invalid tags.json: invalid 'name'",a)),a.hasOwnProperty("priority")?"number"!=typeof a.priority&&(o=!0,console.error("invalid tags.json: invalid 'priority'",a)):a.priority=r,!a.hasOwnProperty("color")||"string"==typeof a.color&&a.color.length>=0||(o=!0,console.error("invalid tags.json: invalid 'color'",a)),!a.hasOwnProperty("border")||"string"==typeof a.border&&a.border.length>=0||(o=!0,console.error("invalid tags.json: invalid 'border'",a));return o?[]:u}}(this),t)},n.prototype.importResponse=function(t){var e,n,r,i,s,a,u,c;for(e=0,a=t.tags,n=0,i=a.length;n<i;n++)r=a[n],++e,s=o.pool.find(this,c=r.name,this.tagsMap),s.set("id",parseInt(r.id)),s.set("name",c),s.set("color",u=r.color),s.set("twColor",u);return e},n.prototype.finalizeLoad=function(){return this.tagsJson.then(function(t){return function(e){var n,o,r,i;for(t.tagsJson=null,n=0,o=e.length;n<o;n++)r=e[n],t.tagsMap.hasOwnProperty(r.name)&&(i=t.tagsMap[r.name],i.set("name",r.name),r.hasOwnProperty("priority")&&i.set("priority",r.priority),r.color&&i.set("color",r.color),r.border&&i.set("border",r.border));t.get("tagsSet").merge(t,t.tagsMap),delete t.tagsMap}}(this))},n.end(),n}(t)}])},{"../../../dscommon/DSDataSource":57,"../../../dscommon/util":68,"../../models/Tag":20,"./DSDataTeamworkPaged":9}],12:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m,g,y,_,v=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;e.exports=(y=angular.module("data/teamwork/TWTasks",[t("../../../dscommon/DSDataSource"),t("./TWTags")])).name,m=t("../../../dscommon/util").assert,g=t("../../../dscommon/util").error,_=t("../../ui/time"),d=t("../../models/Task"),l=t("../../models/Tag"),s=t("../../models/Person"),h=t("../../models/TodoList"),u=t("../../models/Project"),f=t("../../models/TaskTimeTracking"),a=t("../../models/PersonTimeTracking"),o=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),i=t("../../../dscommon/DSTags"),p=t("../../models/types/TaskSplit"),c=t("../../utils/RMSData"),y.factory("TWTasks",["TWTags","DSDataSource","dsChanges","config","$injector","$http","$q",function(t,e,n,g,y,w,S){var D;return D=function(t){function w(){return D.apply(this,arguments)}var D,k,b,T,O,P;return v(w,t),d.TWTask=w,d.planTag=g.planTag,w.begin("TWTasks"),w.addPool(),w.propDoc("source",e),w.propStr("request"),w.propSet("tasks",d),w.propPool("completedTasksPool",d),w.propObj("cancel",{init:null}),w.ds_dstr.push(function(){var t;this.tags.release(this),(t=this.get("cancel"))&&t.resolve(),this.__unwatch1(),this.__unwatch2()}),k=w,w.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve()},w.propObj("visiblePersonTTracking",{init:{}}),D=function(){var t,e,n,r;o.apply(this,arguments),this.peopleMap={},this.projectMap={},this.todoListMap={},this.tags=null,m&&a.prototype.hasOwnProperty("setVisible")&&console.error("TWTasks:ctor: setVisible expects that their will be only one instance of TWTasks object"),r=this.get("visiblePersonTTracking"),t=this.get("completedTasksPool"),n=this.get("tasksSet"),e=this,a.prototype.setVisible=function(o){var i,s;o?1===(this.__visCount=(this.__visCount||0)+1)&&(r[this.$ds_key]=this,null===(i=this.get("task"))&&((i=n.items[s=this.get("taskId")])?this.set("task",i):(this.set("task",i=t.find(this,""+s)),null===i.get("timeTracking")&&(i.set("id",s),i.set("timeTracking",f.pool.find(this,i.$ds_key)),O.call(e)),i.release(this))),i.setVisible(!0)):0===--this.__visCount&&(delete r[this.$ds_key],this.get("task").setVisible(!1))}},T=function(t,e){var n,o,r;return null!==(n=e.get("duedate"))&&(null===(r=e.get("split"))?t.startDate<=(o=e.get("duedate"))&&o<=t.endDate:t.startDate<=r.lastDate(n=e.get("duedate"))&&r.firstDate(n)<=t.endDate)},w.filter=function(t){switch(t.filter){case"all":return moment.isMoment(t.startDate)?function(e){return T(t,e)}:function(t){return!0};case"assigned":return function(e){return null!==e.get("responsible")&&T(t,e)};case"notassigned":return function(e){return null===e.get("responsible")&&T(t,e)};case"overdue":return function(t){var e;return null!==(e=t.get("duedate"))&&e<_.today};case"noduedate":return function(t){return null===t.get("duedate")};case"clipboard":return function(t){return t.get("clipboard")};default:throw new Error("Not supported filter: "+t.filter)}},w.prototype.init=function(t,e){var n,o,i;this.tags=e,this.set("source",t.get("dataSource")),this.tags.addRef(this),this.set("request",function(){switch((o=this.get("params")).filter){case"all":return moment.isMoment(o.startDate)?"tasks.json?startdate="+o.startDate.format("YYYYMMDD")+"&enddate="+o.endDate.format("YYYYMMDD")+"&getSubTasks=no":"tasks.json?getSubTasks=no";case"assigned":return"tasks.json?startdate="+o.startDate.format("YYYYMMDD")+"&enddate="+o.endDate.format("YYYYMMDD")+"&responsible-party-ids=-1&getSubTasks=no";case"notassigned":return"tasks.json?startdate="+o.startDate.format("YYYYMMDD")+"&enddate="+o.endDate.format("YYYYMMDD")+"&responsible-party-ids=0&getSubTasks=no";case"overdue":return"tasks.json?filter=overdue&getSubTasks=no";case"noduedate":return"tasks.json?filter=nodate&include=noduedate&getSubTasks=no";default:throw new Error("Unexpected filter: "+o.filter)}}.call(this)),n=w.filter(this.params),i=this.get("tasksSet"),this.__unwatch1=d.pool.watch(this,function(t){return function(e){n(e)?i.items.hasOwnProperty(e.$ds_key)||i.add(t,e.addRef(t)):i.items.hasOwnProperty(e.$ds_key)&&i.remove(e)}}(this)),this.__unwatch2=this.tags.watchStatus(this,function(t){return function(e,n){switch(n){case"ready":r.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this)),this.init=null},P=function(){var t,e,n,o,r;e=this.peopleMap;for(t in e)r=e[t],r.release(this),delete this.peopleMap[t];n=this.todoListMap;for(t in n)r=n[t],r.release(this),delete this.todoListMap[t];o=this.projectMap;for(t in o)r=o[t],r.release(this),delete this.projectMap[t]},b=function(t,e){var n,o,r,a,d,f,m,g,y,_,v,w,S,D,k,b,T,O,P;if(y=s.pool.find(this,""+e["creator-id"],this.peopleMap),_=u.pool.find(this,""+e["project-id"],this.projectMap),O=h.pool.find(this,""+e["todo-list-id"],this.todoListMap),O.set("project",_),t.set("creator",y),t.set("project",_),t.set("todoList",O),t.set("title",e.content),t.set("estimate",(d=e["estimated-minutes"])?moment.duration(d,"minutes"):null),t.set("duedate",(a=e["due-date"])?moment(a,"YYYYMMDD"):null),t.set("startDate",(o=e["start-date"])?moment(o,"YYYYMMDD"):null),t.set("completed",e.completed),t.set("isReady",!0),(T=e.timeIsLogged)&&t.set("firstTimeEntryId",T),r=e.description,n=c.get(r),null!==n&&(r=c.clear(r),n.hasOwnProperty("split")&&null!==a&&t.set("split",S=new p(n.split))),t.set("description",r),e["responsible-party-ids"]&&t.set("responsible",(w=e["responsible-party-ids"].split(",")).length>0?s.pool.find(this,""+w[0],this.peopleMap):null),y.set("id",parseInt(e["creator-id"])),e.hasOwnProperty("tags")){for(b=null,v=e.tags,f=0,g=v.length;f<g;f++)D=v[f],k=(null!=b?b:b={})[D.name]=l.pool.find(this,D.name),k.set("id",D.id),k.set("name",D.name),k.set("color",k.set("twColor",D.color)),(b||(b={}))[D.name]=k;if(null===b)t.set("tags",null);else{t.set("tags",new i(this,b)).release(this);for(m in b)P=b[m],P.release(this)}}else t.set("tags",null),t.set("plan",!1);O.set("id",parseInt(e["todo-list-id"])),O.set("name",e["todo-list-name"]),_.set("id",parseInt(e["project-id"])),_.set("name",e["project-name"])},w.prototype.load=function(){var t,e,o,i,s,a,u;if(m&&!this.get("source"))throw new Error("load(): Source is not specified");this._startLoad()&&(o=null,y.invoke(["clipboardTasks",function(t){o=t}]),u={},i=function(t){return function(e){var n,r,i,s,a,c,l;d.pool.enableWatch(!1);try{for(s=l=e["todo-items"],n=0,i=s.length;n<i;n++)r=s[n],a=d.pool.find(t,c=""+r.id,u),a.set("id",parseInt(r.id)),b.call(t,a,r),o.hasOwnProperty(c)&&(a.clipboard=!0)}finally{d.pool.enableWatch(!0)}return 250===l.length}}(this),s=function(t){return function(e,n){var o,r;n||(console.error("error: ",e),t.set("cancel",null));for(o in u)r=u[o],r.release(t);P.call(t),t._endLoad(!1)}}(this),(t=this.get("cancel"))&&t.resolve(),(a=function(t){this.get("source").httpGet(this.get("request")+"&page="+t+"&pageSize=250",this.set("cancel",S.defer())).then(function(n){return function(o){200===o.status?(n.set("cancel",null),r.block(function(){return i(o.data,o.status)})?a.call(n,t+1):(r.block(function(){e.call(n),n.get("tasksSet").merge(n,u),P.call(n)}),n._endLoad(!0),O.call(n))):s(o,0===o.status)}}(this),s)}).call(this,1),e=function(){var t,e,o;t=n.tasks;for(o in t)e=t[o],u.hasOwnProperty(o)||e._clearChanges()})},O=function(){var t,e,n,o,i,s;if(null===this.get("cancel")){i=null,n=this.get("visiblePersonTTracking");for(t in n)if(s=n[t],!(o=s.get("task")).get("isReady")){i=o;break}null!==i&&(e=function(t){return function(e,n){n||(console.error("error: ",e),t.set("cancel",null)),i.release(t),P.call(t)}}(this),this.get("source").httpGet("/tasks/"+i.id+".json",this.set("cancel",S.defer())).then(function(t){return function(n){200===n.status?(t.set("cancel",null),r.block(function(){b.call(t,i,n.data["todo-item"]),P.call(t),O.call(t)})):e(n,0===n.status)}}(this),e))}},w.tasksSortRule=function(t,e){var n,o,r,i,s,a;return(o=t.get("priority"))!==(a=e.get("priority"))?o-a:(n=null!=(r=t.get("estimate"))?r.valueOf():void 0)!==(s=null!=(i=e.get("estimate"))?i.valueOf():void 0)?void 0===n?1:void 0===s?-1:s-n:t.get("id")-e.get("id")},w.end(),w}(o)}])},{"../../../dscommon/DSData":53,"../../../dscommon/DSDataSource":57,"../../../dscommon/DSDigest":58,"../../../dscommon/DSTags":66,"../../../dscommon/util":68,"../../models/Person":16,"../../models/PersonTimeTracking":18,"../../models/Project":19,"../../models/Tag":20,"../../models/Task":21,"../../models/TaskTimeTracking":22,"../../models/TodoList":23,"../../models/types/TaskSplit":25,"../../ui/time":36,"../../utils/RMSData":51,"./TWTags":11}],13:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m,g=function(t,e){function n(){this.constructor=t}for(var o in e)y.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},y={}.hasOwnProperty;e.exports=(h=angular.module("data/teamwork/TWTimeTracking",[t("../../config"),t("../../../dscommon/DSDataSource"),t("../../db")])).name,p=t("../../../dscommon/util").assert,f=t("../../../dscommon/util").error,m=t("../../ui/time"),u=t("../../models/Task"),l=t("../../models/TaskTimeTracking"),s=t("../../models/PersonTimeTracking"),o=t("../../../dscommon/DSData"),r=t("../../../dscommon/DSDigest"),c=t("../../models/types/TaskSplit"),a=t("../../utils/RMSData"),d=500,i=50,h.factory("TWTimeTracking",["DSDataSource","$q","db","config",function(t,e,n,a){var u;return u=function(n){function u(){return c.apply(this,arguments)}var c;return g(u,n),u.begin("TWTimeTracking"),u.addPool(),u.propDoc("source",t),u.propSet("taskTimeTracking",l),u.propSet("personTimeTracking",s),u.propObj("cancel",null),u.ds_dstr.push(function(){var t;(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchA&&this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB()}),u.propObj("visibleTTracking",{init:{}}),c=function(){var t;o.apply(this,arguments),p&&l.prototype.hasOwnProperty("setVisible")&&console.error("TWTimeTracking:ctor: setVisible expects that their will be only one instance of TWTimeTracking object"),t=this.get("visibleTTracking"),l.prototype.setVisible=function(e){e?1!==(this.__visCount=(this.__visCount||0)+1)||this.get("isReady")||(t[this.$ds_key]=this):0===--this.__visCount&&delete t[this.$ds_key]}},u.prototype.clear=function(){var t;o.prototype.clear.call(this),(t=this.get("cancel"))&&t.resolve(),"function"==typeof this.__unwatchB&&this.__unwatchB()},u.filterPersonTimeTracking=function(t){return function(e){var n;return t.startDate<=(n=moment(e.get("date").startOf("day")))&&n<=t.endDate}},u.prototype.init=function(e){this.__unwatchA=t.setLoadAndRefresh.call(this,e),this.init=null},u.prototype.load=function(){var t,n,o,u,c,f,h,g,y,_,v,w,S,D,k,b;if(p&&!this.get("source"))throw new Error("load(): Source is not specified");if(this._startLoad()){"function"==typeof this.__unwatchB&&this.__unwatchB(),s.pool.enableWatch(!1),l.pool.enableWatch(!1),v=l.pool.items;for(S in v)k=v[S],k.set("isReady",!1),k.set("totalMin",0),k.set("priorTodayMin",0),k.set("timeEntries",{});w=s.pool.items;for(y in w)k=w[y],k.set("timeMin",0);_={},D={},c=function(t){return function(e){var n,o,r,i,a,u,c,p,f,h,g,y;for(o=0,i=e.length;o<i;o++)r=e[o],moment(r.date)>=m.historyLimit&&(f=parseInt(h=r["todo-item-id"]))&&(y=r.id,u=parseInt(c=r["person-id"]),a=60*parseInt(r.hours)+parseInt(r.minutes),n=moment(r.date).startOf("day"),p=s.pool.find(t,c+"-"+f+"-"+n.valueOf(),_),p.set("personId",u),p.set("date",n),p.set("taskId",f),p.set("timeMin",p.get("timeMin")+a),D.hasOwnProperty(h)?g=D[h]:(g=l.pool.find(t,h,D),g.set("taskId",f)),g.set("totalMin",g.get("totalMin")+a),g.get("timeEntries")[y]=!0,n<m.today&&g.set("priorTodayMin",g.get("priorTodayMin")+a));return e.length===d}}(this),n=function(t){return function(){r.block(function(){var e,n;e=l.pool.items;for(S in e)n=e[S],n.set("isReady",!0);t.__unwatchB||(t.__unwatchB=l.pool.watch(t,function(t){t.set("isReady",!0)})),s.pool.enableWatch(!0),t.get("personTimeTrackingSet").merge(t,_),l.pool.enableWatch(!0),t.get("taskTimeTrackingSet").merge(t,D)}),t._endLoad(!0)}}(this),f=function(t){return function(e,n){var o,r;n||(console.error("error: ",e),t.set("cancel",null));for(o in D)r=D[o],r.release(t);t._endLoad(!1)}}(this),g={},h=function(t){return function(o){g.hasOwnProperty(o)?r.block(function(){return c(g[o])})?h(o+1):n():t.get("source").httpGet("time_entries.json?page="+o+"&pageSize="+d,t.set("cancel",e.defer())).then(function(e){var i;200===e.status?(t.set("cancel",null),(i=e.data["time-entries"])&&0!==i.length?moment(i[i.length-1].date)<m.historyLimit?(a.set("histStart",o+1),i.length===d?h(o+1):n()):r.block(function(){return c(i)})?h(o+1):n():n()):f(e,0===e.status)},f)}}(this),b=1,t=i,(u=a.get("histStart"))>=0?h(u):(o=function(s){return function(u){s.get("source").httpGet("time_entries.json?page="+u+"&pageSize="+d,s.set("cancel",e.defer())).then(function(e){var l,d;200===e.status?(s.set("cancel",null),(l=e.data["time-entries"])&&0!==l.length?moment(l[0].date)>=m.historyLimit?b===u?(a.set("histStart",u),r.block(function(){return c(l)})?h(u+1):n()):(g[u]=l,o(b+Math.floor(((t=u)-b)/2))):moment(l[l.length-1].date)<m.historyLimit?t===u?(d=[t,t+i],b=d[0],t=d[1],o(t)):t===u+1?n():(b=u+1,o(b+Math.floor((t-b)/2))):(a.set("histStart",u),r.block(function(){return c(l)})?h(u+1):n()):o(b+Math.floor(((t=u)-b)/2))):f(e,0===e.status)},f)}}(this))(t)}},u.end(),u}(o)}])},{"../../../dscommon/DSData":53,"../../../dscommon/DSDataSource":57,"../../../dscommon/DSDigest":58,"../../../dscommon/util":68,"../../config":2,"../../db":14,"../../models/PersonTimeTracking":18,"../../models/Task":21,"../../models/TaskTimeTracking":22,"../../models/types/TaskSplit":25,"../../ui/time":36,"../../utils/RMSData":51}],14:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=t("../dscommon/util").assert,s=t("../dscommon/util").serviceOwner,o=t("../dscommon/DSObject"),e.exports=(i=angular.module("db",[])).name,i.factory("db",["$q",function(t){var e,n;return n=null,e=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return a(o,e),o.begin("DB"),o.propConst("name","RMS"),o.propConst("ver",4),o.prototype.logQuota=function(){},o.prototype.openDB=function(){var e;return window.indexedDB?(n||(n=t.defer(),e=window.indexedDB.open(this.get("name"),this.get("ver")),e.onsuccess=function(t){console.info("IndexedDB.openDB: Success"),n.resolve(t.target.result)},e.onerror=function(t){console.warn("IndexedDB.openDB: Error",t),n.reject()},e.onupgradeneeded=function(t){var e,o,r;console.info("IndexedDB.openDB: Upgrade",t),e=t.target.result;try{e.deleteObjectStore("timetracking")}catch(r){o=r}e.createObjectStore("timetracking",{keyPath:"page"}),n.resolve(e)}),n.promise):(console.warn("IndexedDB.openDB: Missing window.indexedDB, so there will be no local time tracking info"),void n.reject())},o.end(),o}(o),s.add(new e(s,"db"))}])},{"../dscommon/DSObject":62,"../dscommon/util":68}],15:[function(t,e,n){e.exports={history:1,clipboard:0}},{}],16:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSDocument"),r=t("../../dscommon/DSTags"),e.exports=i=function(t){function e(){return n.apply(this,arguments)}var n;return u(e,t),e.begin("Person"),r.addPropType(e),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("firstName"),e.propStr("avatar"),e.propStr("email"),e.propDSTags("roles"),e.propNum("companyId"),e.propBool("currentUser"),e.propBool("missing"),e.propDuration("contractTime"),n=function(t,e){o.call(this,t,e),this.set("contractTime",moment.duration(8,"hours"))},e.end(),e}(o)},{"../../dscommon/DSDocument":59,"../../dscommon/DSTags":66,"../../dscommon/util":68}],17:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),r=t("./Person"),e.exports=i=function(t){function e(){return i.apply(this,arguments)}var n,i;return u(e,t),e.begin("PersonDayStat"),e.DayStat=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DayStat"),e.propMoment("day"),e.propNum("tasksCount"),e.propDuration("contract"),e.propDuration("tasksTotal"),e.propDuration("timeLeft"),e.propDuration("timeSpent"),e.end(),e}(o),i=function(t,e,i,u){var c,l,d,p,f;if(o.call(this,t,e),s)for(i instanceof r||a.invalidArg("person"),Array.isArray(u)||a.invalidArg("days"),d=0,f=u.length;d<f;d++)c=u[d],moment.isMoment(c)||a.invalidArg("days");this.set("person",i),p=0,this.get("dayStatsList").merge(this,function(){var t,e,o;for(o=[],t=0,e=u.length;t<e;t++)c=u[t],o.push(((l=new n(this,""+p++)).set("day",c),l));return o}.call(this))},e.propDoc("person",r),e.propList("dayStats",n),e.propDuration("totalPeriodTime"),e.end(),e}(o)},{"../../dscommon/DSObject":62,"../../dscommon/util":68,"./Person":16}],18:[function(t,e,n){var o,r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("../../dscommon/DSObject"),i=t("../models/Task"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.begin("PersonTimeTracking"),e.addPool(!0),e.propNum("personId",{init:0}),e.propMoment("date"),e.propNum("taskId",{init:0}),e.propDoc("task",i),e.propNum("timeMin",{init:0}),e.end(),e}(o)},{"../../dscommon/DSObject":62,"../models/Task":21}],19:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Project"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propStr("status"),e.propObj("people"),e.end(),e}(o)},{"../../dscommon/DSObject":62,"../../dscommon/util":68}],20:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../dscommon/DSDocument"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.begin("Tag"),e.addPool(),e.propNum("id",{init:0}),e.propStr("name"),e.propStr("color"),e.propStr("twColor"),e.propStr("border"),e.propNum("priority",{init:1e3}),e.end(),e}(o)},{"../../dscommon/DSDocument":59,"../../dscommon/util":68}],21:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m,g,y=function(t,e){function n(){this.constructor=t}for(var o in e)_.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},_={}.hasOwnProperty;f=t("../../dscommon/util").assert,m=t("../../dscommon/util").error,h=t("../features").clipboard,g=t("../ui/time"),r=t("../../dscommon/DSDocument"),a=t("./Project"),s=t("./Person"),p=t("./TodoList"),d=t("./TaskTimeTracking"),u=t("./Tag"),i=t("../../dscommon/DSTags"),o=t("./types/Comments"),l=t("./types/TaskSplit"),e.exports=c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var n,r,c,f,m;return y(e,t),e.begin("Task"),o.addPropType(e),l.addPropType(e),i.addPropType(e),e.defaultTag=n={name:"[default]",priority:1e3},e.addPool(!0),m=function(t,o){var r,i,s,a,u,c;if(t.set("plan",!(!o||!o.get(e.planTag))),null!==o){u=1e6,c=null,r=o.map;for(s in r)i=r[s],i===!0&&console.info("tag:",i),(a=i.get("priority"))<u&&(c=i,u=a);t.__setCalcPriority(c.priority),t.__setCalcStyle(c)}else t.__setCalcPriority(n.priority),t.__setCalcStyle(n)},c={__onChange:function(t,n,o,r){var s,a,c;switch(n){case"plan":c=t.get("tags"),c?(c=c.clone(this),o?c.get(e.planTag)||(c.set(e.planTag,a=u.pool.find(this,e.planTag)),a.release(this),t.set("tags",c)):c.get(e.planTag)&&(c.set(e.planTag,!1),t.set("tags",c.empty()?null:c)),c.release(this)):o&&((s={})[e.planTag]=a=u.pool.find(this,e.planTag),c=new i(this,s),t.set("tags",c),c.release(this));break;case"tags":m(t,o)}}},f={__onChange:function(t,e,n,o){"tags"===e&&m(t,n)}},e.ds_ctor.push(function(){this.__proto__.constructor.ds_editable?this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(c):this.$ds_evt=[c]:this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(f):this.$ds_evt=[f]}),e.str=function(t){return null===t?"":t.get("title")},e.propNum("id",{init:0}),e.propStr("title"),e.propDuration("estimate").str=function(t){var e,n,o;return e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+"h":"",n&&(o+=" "+n+"m"),o||(o="0"),o},e.propMoment("duedate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propMoment("startDate").str=function(t){return null===t?"":t.format("DD.MM.YYYY")},e.propDoc("creator",s),e.propDoc("responsible",s),e.propDoc("todoList",p),e.propDoc("project",a),e.propTaskRelativeSplit("split"),e.propStr("description",{str:function(t){return t&&0!==t.length?t.length<=20?t:t.substr(0,20)+"...":""}}),e.propComments("comments"),e.propDoc("timeTracking",d,{write:null}),e.propStr("firstTimeEntryId",{write:null}),e.propBool("completed"),e.propBool("isReady",{write:null}),e.propBool("plan",{write:null,read:null}),e.propDSTags("tags"),e.propNum("priority",{init:n.priority,calc:!0}),e.propObj("style",{init:function(){return n},calc:!0}),0===h&&e.propBool("clipboard",{init:!1,common:!0}),e.prototype.isOverdue=function(){var t;return null!==(t=this.get("duedate"))&&t<g.today},e.prototype.timeWithinEstimate=function(){var t;return null===(t=this.get("estimate"))?0:Math.min(100,Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))},e.prototype.timeAboveEstimate=function(){var t,e;return null===(t=this.get("estimate"))?0:(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))<=100?0:e>200?100:e-100},e.prototype.timeReported=function(){var t,e;return null===(t=this.get("estimate"))?"":(e=Math.round(100*this.get("timeTracking").get("totalMin")/t.asMinutes()))>200?e+" %":""},e.prototype.grade=function(){var t;return null===(t=this.get("estimate"))?"":t.asMinutes()<60?"easy":t.asMinutes()>=60&&t.asMinutes()<240?"medium":t.asMinutes()>=240&&t.asMinutes()<480?"hard":t.asMinutes()>=480?"complex":void 0},e.prototype.setVisible=function(t){var e,n;t?1===(this.__visCount=(this.__visCount||0)+1)&&null!=(e=this.get("timeTracking"))&&e.setVisible(!0):0===--this.__visCount&&null!=(n=this.get("timeTracking"))&&n.setVisible(!1)},e.end(),r=e.Editable.prototype.init,e.Editable.prototype.init=function(){r.apply(this,arguments),m(this,this.get("tags"))},e}(r)},{"../../dscommon/DSDocument":59,"../../dscommon/DSTags":66,"../../dscommon/util":68,"../features":15,"../ui/time":36,"./Person":16,"./Project":19,"./Tag":20,"./TaskTimeTracking":22,"./TodoList":23,"./types/Comments":24,"./types/TaskSplit":25}],22:[function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("TaskTimeTracking"),e.addPool(!0),e.propNum("taskId",{init:0}),e.propBool("isReady"),e.propNum("totalMin",{init:0}),e.propNum("priorTodayMin",{init:0}),e.propObj("timeEntries",{init:{}}),e.end(),e}(o)},{"../../dscommon/DSObject":62}],23:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),r=t("./Project"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TodoList"),e.addPool(),e.str=function(t){return null===t?"":t.get("name")},e.propNum("id",{init:0}),e.propStr("name"),e.propDoc("project",r),e.end(),e}(o)},{"../../dscommon/DSObject":62,"../../dscommon/util":68,"./Project":19}],24:[function(t,e,n){var o,r,i,s;i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,r=t("../../../dscommon/DSDocument"),e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propComments=function(n,o){var r;return i&&o&&"function"!=typeof o&&s.invalidArg("valid"),o=(r=o)?function(t){return(null===t||Array.isArray(t))&&r(t)?t:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"comments",valid:o,read:function(e){return null!==e?new t(e):null},str:function(t){var e;return 0===t.list.length?"":(e=t.list[0]).length<=20?e:e.substr(0,20)+"..."},equal:function(t,e){var n,o,r,i,s;if(null===t||null===e)return t===e;if(t.list.length!==e.list.length)return!1;for(s=t.list,n=o=0,r=s.length;o<r;n=++o)if(i=s[n],i!==e.list[n])return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,o,r,a;if(i)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(n=0,o=e.length;n<o;n++)a=e[n],"string"!=typeof a&&s.invalidArg("persisted");1===arguments.length&&"object"==typeof(r=arguments[0])&&r.__proto__===t.prototype?this.list=r.list.slice():this.list=e||[]},t.prototype.clone=function(){return new t(this)},t.prototype.add=function(t){this.list.push(t)},t.prototype.unshift=function(t){this.list.unshift(t)},t.prototype.shift=function(){return this.list.shift()},t.prototype.valueOf=function(){return this.list},t.prototype.clear=function(){this.list=[]},t}()},{"../../../dscommon/DSDocument":59,"../../../dscommon/util":68}],25:[function(t,e,n){var o,r,i,s;i=t("../../../dscommon/util").assert,s=t("../../../dscommon/util").error,o=t("../../../dscommon/DSDocument"),e.exports=r=function(){function t(){return e.apply(this,arguments)}var e,n;return t.addPropType=function(e){e.propTaskRelativeSplit=function(n,o){var r;return i&&o&&"function"!=typeof o&&s.invalidArg("valid"),o=(r=o)?function(e){return(null===e||"object"==typeof e&&e instanceof t)&&r(e)?e:void 0}:function(e){return null===e||e instanceof t?e:void 0},e.prop({name:n,type:"taskRelativeSplit",valid:o,read:function(e){return null!==e?new t(e):null},str:function(t){return t?"split":""},equal:function(t,e){var n,o,r,i,s,a;if(null===t||null===e)return t===e;if((r=null!=t?t.list:void 0).length!==(s=null!=e?e.list:void 0).length)return!1;for(n=o=0,i=r.length;o<i;n=o+=2)if(a=r[n],a!==s[n]||r[n+1].valueOf()!==s[n+1].valueOf())return!1;return!0},init:null})}},n=moment.duration(0),e=function(e){var n,o,r,a,u,c,l,d,p;if(i)if(1===arguments.length&&"object"==typeof arguments[0]&&arguments[0].__proto__===t.prototype);else if(1===arguments.length&&Array.isArray(e))for(e.length%2!==0&&s.invalidArg("persisted"),r=0,u=e.length;r<u;r++)p=e[r],"number"!=typeof p&&s.invalidArg("persisted");if(1===arguments.length&&"object"==typeof(d=arguments[0])&&d.__proto__===t.prototype)this.list=d.list.slice();else if(this.list=l=[],Array.isArray(e))for(o=a=0,c=e.length;a<c;o=a+=2)n=e[o],l.push(moment.duration(n,"day").valueOf()),l.push(moment.duration(e[o+1],"minute"))},t.prototype.clone=function(){return new t(this)},t.prototype.set=function(t,e,n){var o,r,a,u,c,l,d;for(i&&(moment.isMoment(t)||s.invalidArg("duedate"),moment.isMoment(e)||s.invalidArg("date"),null===n||moment.isDuration(n)||s.invalidArg("estimate")),r=e.diff(t),d=l=this.list,a=u=0,c=d.length;u<c;a=u+=2){if(o=d[a],o===r){if(null!==n&&0!==n.valueOf()){if(l[a+1].valueOf()===n.valueOf())return;l[a+1]=n}else l.splice(a,2);return void delete this.value}if(r<o)return 0!==(null!=n?n.valueOf():void 0)&&l.splice(a,0,r,n),void delete this.value}return 0!==(null!=n?n.valueOf():void 0)&&(delete this.value,l.push(r),l.push(n)),this},t.prototype.get=function(t,e){var n,o,r,a,u,c,l;for(i&&(moment.isMoment(t)||s.invalidArg("duedate"),moment.isMoment(e)||s.invalidArg("date")),o=e.diff(t),l=c=this.list,r=a=0,u=l.length;a<u;r=a+=2)if(n=l[r],n===o)return c[r+1];return null},t.prototype.day=function(t,e){var n;return i&&(moment.isMoment(e)||s.invalidArg("date")),Object.defineProperty(n={},"val",{get:function(n){return function(){return n.get(t(),e)}}(this),set:function(n){return function(o){return n.set(t(),e,o)}}(this)}),n},t.prototype.valueOf=function(){var t,e,n,o,r,i,s,a,u;if(u=this.value)return u;for(this.value=s=[],i=r=this.list,e=n=0,o=i.length;n<o;e=n+=2)a=i[e],t=r[e+1],s.push(moment.duration(a).asDays()),s.push(t.asMinutes());return s},t.prototype.shift=function(t,e){var n,o,r,a,u,c,l;if(i)switch(arguments.length){case 1:"number"!=typeof t&&s.invalidArg("diff");break;case 2:moment.isMoment(t)||s.invalidArg("newDuedate"),moment.isMoment(e)||s.invalidArg("oldDuedate");break;default:throw new Error("Invalid arguments")}if(delete this.value,n="number"==typeof t?t:t.diff(e),0!==n)for(c=u=this.list,o=r=0,a=c.length;r<a;o=r+=2)l=c[o],u[o]-=n},t.prototype.firstDate=function(t){var e;return i&&(moment.isMoment(t)||s.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[0]):null;
},t.prototype.lastDate=function(t){var e;return i&&(moment.isMoment(t)||s.invalidArg("duedate")),(e=this.list).length>0?moment(t).add(e[e.length-2]):null},t.prototype.clear=function(){delete this.value,this.list=[]},t.prototype.fixEstimate=function(t){var e,n,o,r,i,s;if(t>0)this.list[this.list.length-1].add(t);else if(t<0)for(i=r=this.list.slice(1),e=n=0,o=i.length;n<o;e=n+=2)if(s=i[e],(t+=s.valueOf())>0){this.list[e+1]=moment.duration(t),this.list=this.list.slice(e);break}},Object.defineProperty(t.prototype,"total",{get:function(){var t,e,o,r,i,s;if(0===(o=this.list).length)return n;if(1===o.length)return o[1];for(i=moment.duration(o[1]),r=o.slice(3),t=0,e=r.length;t<e;t+=2)s=r[t],i.add(s);return i}}),t}()},{"../../../dscommon/DSDocument":59,"../../../dscommon/util":68}],26:[function(t,e,n){var o;e.exports=(o=angular.module("app",["ui.router","ui.select",t("./ui/ui"),t("./data/dsDataService"),t("./data/persistClipboard"),t("./svc/emails/emails"),t("./db")])).name,o.run(["config","$rootScope","db",function(e,n,o){n.Math=Math,n.taskModal={},n.startDateVal=null,n.view3ActiveTab=null,n.features=t("./features")}]),o.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(t,e,n){n.html5Mode(!0),t.otherwise("/")}])},{"./data/dsDataService":7,"./data/persistClipboard":8,"./db":14,"./features":15,"./svc/emails/emails":27,"./ui/ui":37}],27:[function(t,e,n){var o,r,i,s,a;i=t("../../../utils/base64"),r=t("../../models/Task"),o=t("../../models/Person"),e.exports=(a=angular.module("svc-emails",[t("../../data/dsDataService")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,o){e.state({name:"emails",url:"/emails",templateUrl:function(){return"./svc/emails/main.html"},controller:s})}]),s=["$scope","$http","$sce","config","dsDataService",function(t,e,n,s,a){var u,c;t.dateCheck="",t.isDateCheckOk=function(){return!!/\d{1,2}\.\d{2}\.\d{4}/.test(t.dateCheck)&&moment(t.dateCheck,"DD.MM.YYYY").startOf("day").valueOf()===moment().startOf("day").valueOf()},t.state="notStarted",t.data=null,t.formatDuration=u=function(t){var e,n,o;return e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+" ч.":"",n&&(o&&(o+=" "),o+=n+" мин."),o},t.prepare=function(){var e,i,s,c,l,d,p,f,h;c=a.findDataSet(this,{type:o,mode:"original"}),d=a.findDataSet(this,{type:r,mode:"original",filter:"assigned",startDate:l=moment().startOf("week"),endDate:i=moment(l).add(6,"days")}),s=function(t){var e,o,r;return o=u(t.planHours),e=u(t.optHours),r=o,e&&(r&&(r+=" + "),r+="<span style='background-color:rgb(255,153,0)'>"+e+"</span>"),t.hours=n.trustAsHtml(r),t},e=function(){var e,n,o,r,a,p,f,h,m,g,y,v,w,S,D,k,b,T,O;for(console.info("compute started..."),t.emails=r=[],S=h=_.sortBy(_.map(c.items),function(t){return t.get("name")}),p=0,f=S.length;p<f;p++)if(m=S[p],null!==m.get("roles")){w={},D=d.items;for(T in D)if(b=D[T],b.get("responsible")===m&&null!==b.get("estimate")&&462667!==b.get("todoList").get("id"))if((v=w[y=(g=b.get("project")).$ds_key])||(v=w[y]={id:g.get("id"),name:g.get("name"),planHours:moment.duration(),optHours:moment.duration(),manager:""}),a=b.get("title").toLowerCase().indexOf("бронь")!==-1||b.get("todoList").get("name").toLowerCase().indexOf("бронь")!==-1?v.optHours:v.planHours,k=b.get("split"))for(n=b.get("duedate"),e=moment(l);e<=i;)null!==(o=k.get(n,e))&&a.add(o),e.add(1,"day");else a.add(b.get("estimate"));O=moment.duration(),(w=_.map(w,function(t){return O.add(t.planHours),O.add(t.optHouras),s(t)})).length>0&&(w=_.sortBy(w,function(t){return t.name}),r.push({person:m,toName:m.get("firstName"),startDate:l.format("DD.MM"),endDate:i.format("DD.MM.YYYY"),totalHours:u(O),projects:w,status:"notSent"}))}console.info("compute finished: ",r)},h=function(){"ready"===c.status&&"ready"===d.status&&(e(),p(),f())},p=c.watchStatus(this,h),f=d.watchStatus(this,h),c.release(this),d.release(this)},c=function(n){var o,r,s,a,u;r=t.emails[n],s=template({email:r}),a=r.person.get("roles"),u=r.person.get("email"),o="managers@webprofy.ru",(a.get("Designer")||a.get("Jr. Designer"))&&(o+=", a.shevtsov@webprofy.ru, a.kolesnikov@webprofy.ru"),a.get("Markuper")&&(o+=", n.skinteev@webprofy.ru, s.yastrebov@webprofy.ru"),console.info("to: ",u),console.info("cc: ",o),e({method:"POST",url:"https://thawing-chamber-8269.herokuapp.com/https://api.mailgun.net/v3/webprofy.ru/messages",data:$.param({to:r.person.get("email"),cc:o,from:"Татьяна Верхотурова <t.verkhoturova@webprofy.ru>",subject:r.title,html:s}),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+i.encode("api:key-3ccadef54df260c8a2903da328ebb165")}}).then(function(e){console.info("ok: ",e),r.status="sent",n+1===t.emails.length?t.state="completed":c(n+1)},function(e){console.error("error: ",e),t.state="error"})},t.sendOut=function(){t.state="inProgress",c(0)}}]},{"../../../utils/base64":70,"../../data/dsDataService":7,"../../models/Person":16,"../../models/Task":21}],28:[function(t,e,n){var o;e.exports=(o=angular.module("ui/account/rmsAccount",[t("../../config")])).name,o.run(["$rootScope",function(t){t.isShowAccount=!1,t.showAccount=function(){t.isShowAccount=!t.isShowAccount}}]),o.directive("rmsAccount",["config","$rootScope",function(t,e){return{restrict:"A",scope:!0,link:function(n,o,r){var i;n.$evalAsync(function(){$($("input",o)[1]).select()}),n.url=t.teamwork,n.token=t.token,n.refreshPeriod=t.refreshPeriod,n.save=function(){var e,o;o=n.url.trim(),e=n.token.trim(),o.length>0&&"/"!==o.charAt(o.length-1)&&(o+="/"),t.teamwork=o,t.token=e,t.refreshPeriod=n.refreshPeriod,i()},n.close=i=function(){e.isShowAccount=!1}}}}])},{"../../config":2}],29:[function(t,e,n){var o,r,i,s,a;r=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,o=t("../../dscommon/DSObject"),e.exports=(a=angular.module("ui/filters",[])).name,i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a.run(["$rootScope",function(t){t.filter={calendarHeader:function(t,e){var n,a,u,c,l;if(r&&(t instanceof o||s.invalidArg("doc"),(c=t.__proto__.__props).hasOwnProperty(e)||s.invalidArg("prop"),"moment"!==(l=c[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+l);if(!(n=t.get(e)))throw new Error("Non null date expected in the header");return a=moment(n).format("YYYYMMDD"),u=n.month()+1,u<10&&(u="0"+u),i[n.day()]+" "+n.date()+"/<small>"+u+"</small>"},shortDate:function(t,e){var n,i,a;if(r&&(t instanceof o||s.invalidArg("doc"),(i=t.__proto__.__props).hasOwnProperty(e)||s.invalidArg("prop"),"moment"!==(a=i[e].type)))throw new Error("Expected property with type 'moment', but property '"+e+"' has type "+a);return n=t.get(e),n?n.format("DD.MM"):""},taskPeriod:function(e,n,i){var a,u,c,l,d,p;if(r&&e&&(null===e||e instanceof o||s.invalidArg("doc"),null===n||(l=e.__proto__.__props).hasOwnProperty(n)||s.invalidArg("prop"),"duration"!==(p=l[n].type)))throw new Error("Expected property with type 'duration', but property '"+n+"' has type "+p);return d="",i?(moment.isDuration(i)?(u=Math.floor(i.asHours()),c=i.minutes()):(u=Math.floor((i=i.get("timeMin"))/60),c=i%60),u||c?(d+=u?u+"h ":"",c&&(d+=c+"m")):d+="0"):null===typeof i&&(d+="0"),e&&(a=e.get(n))&&("undefined"!=typeof i&&t.dataService.showTimeSpent&&(d+=" / "),u=Math.floor(a.asHours()),c=a.minutes(),d+=u?u+"h":"",u&&c&&(d+=" "),c&&(d+=c+"m"),d||(d+="0")),d},taskPeriodLight:function(t){var e,n,o;return r&&(moment.isDuration(t)||s.invalidArg("duration")),t?(e=Math.floor(t.asHours()),n=t.minutes(),o=e?e+"h":"",n&&(o+=" "+n+"m"),o||(o="0"),o):""},periodDiff:function(t){var e,n,o,i;return r&&(null===t||moment.isDuration(t)||s.invalidArg("diff")),t&&null!==(i=t.valueOf())?(o=i<0?(t=moment.duration(-i),"- "):"+ ",e=Math.floor(t.asHours()),n=t.minutes(),o+=e+"h",n&&(o+=" "+n+"m"),o||(o="0"),o):""},timeLeft:function(t){var e,n,o,i;return r&&(null===t||moment.isDuration(t)||s.invalidArg("diff")),t&&null!==(i=t.valueOf())?(o=i<0?(t=moment.duration(-i),"- "):"",e=Math.floor(t.asHours()),n=t.minutes(),o+=e+"h "+(n<10?"0"+n:n)+"m"):""},taskEditDueDate:function(t){return r&&t&&!moment.isMoment(t)&&s.invalidArg("date"),t?t.format("DD.MM.YYYY"):""},splitDuration:function(e,n){var o,r,i;return i="",n?(o=Math.floor((n=n.get("timeMin"))/60),r=n%60,o||r?(i+=o?o+"h ":"",r&&(i+=r+"m")):i+="0"):null===typeof n&&(i+="0"),e&&("undefined"!=typeof n&&t.dataService.showTimeSpent&&(i+=" / "),o=Math.floor(e.asHours()),r=e.minutes(),i=o?o+"h":"",r&&(i+=" "+r+"m"),i||(i="0")),i}}}])},{"../../dscommon/DSObject":62,"../../dscommon/util":68}],30:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m;l=t("../../dscommon/util").assert,d=t("../../dscommon/util").error,e.exports=(f=angular.module("ui/layout",[])).name,s=140,a=730,u=10,c=10,m=900,h=s+c,p=40,i=440,r=440,f.directive("uiLayout",["config","$window","$rootScope",function(t,e,n){return e=$(e),{restrict:"A",controller:["$scope",function(o){var r;o.layout=this,this.area1={},this.area2={},this.area3={},this.width=e.width(),this.area3.height=this.height=e.height()-p,r=function(){n.$digest(),n.$broadcast("layout-update")},(this.setVResizer=function(e,n){var o;o=this.area1.width=this.area2.width=this.vResizer=Math.min(Math.max(Math.round(e),a),this.width-c),this.area3.width=this.width-o,t.set("vResizer",this.area1.width/this.width),n||r()}).call(this,this.width*(t.get("vResizer")||.68),!0),(this.setHResizer=function(e,n){var o;o=this.area1.height=this.hResizer=Math.min(Math.max(Math.round(e),s),this.height-u),this.area2.height=this.height-o,t.set("hResizer",this.area1.height/this.height),n||r()}).call(this,this.height*(t.get("hResizer")||.68),!0),this.setSize=function(t,e,n){var o,i,s;e-=p,o=!1,(s=this.width)!==t&&(o=!0,this.setVResizer(this.vResizer*((this.width=Math.max(t,m))/s),!0)),(i=this.height)!==e&&(o=!0,this.setHResizer(this.hResizer*((this.height=Math.max(e,h))/i),!0),this.area3.height=e),o&&!n&&r()}}],link:function(t,n,o,r){var i;e.on("resize",i=function(){r.setSize(e.width(),e.height())}),t.$on("$destroy",function(){e.off("resize",i)})}}}]),f.directive("uiLayoutResizer",["$document",function(t){return{restrict:"A",require:"^uiLayout",link:function(e,n,o,r){var i,s,a,u;i="horizontal"===o.uiLayoutResizer,n.on("mousedown",u=function(e){e.preventDefault(),t.on("mousemove",s),t.on("mouseup",a)}),s=i?function(t){r.setHResizer(t.pageY-p)}:function(t){r.setVResizer(t.pageX)},a=function(e){t.off("mousemove",s),t.off("mouseup",a)},e.$on("$destroy",function(){t.off("mousedown",u),a()})}}}]),o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(t){this.elem=t},t.prototype.innerHeight=function(){return this.elem.innerHeight()},t}(),f.directive("uiLayoutContainer",["$document",function(t){return{restrict:"A",link:function(t,e,n){t.uiContainer=new o(e)}}}])},{"../../dscommon/util":68}],31:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("ui/tasks/TaskSplitWeekView",[t("../../../dscommon/DSView")])).name,u=t("../../../dscommon/util").assert,o=t("../../../dscommon/DSObject"),a=t("../../models/types/TaskSplit"),s=t("../../models/Task"),r=t("../../models/Person"),i=t("../../models/PersonDayStat"),l=t("../time"),c.factory("TaskSplitWeekView",["DSView","$log",function(t,e){var n,s;return n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.begin("DayModel"),e.ds_dstr.push(function(){"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2()}),e.propDuration("timeLeft"),e.propDuration("timeLeftShow"),e.propObj("plan"),e.propDuration("initPlan"),e.propBool("select"),e.end(),e}(o),s=function(e){function o(){return s.apply(this,arguments)}var s;return d(o,e),o.begin("TaskSplitWeekView"),a.addPropType(o),o.propData("personDayStat",i,{mode:"edited"}),o.propList("days",n),o.propMoment("monday"),o.propDoc("responsible",r),o.propMoment("today"),o.propMoment("duedate"),o.propTaskRelativeSplit("split"),s=function(e,o,r,i,s){var c,d,p,f,h,m;u&&(!i instanceof a&&error.invalidArg("split"),moment.isMoment(s)||error.invalidArg("monday")),t.call(this,e,o),this.set("split",i),this.set("monday",s),e.$watch("edit.responsible",function(t){return function(e){t.set("responsible",e),t.__dirty++}}(this)),this.dataUpdate({startDate:s,endDate:moment(s).endOf("week"),mode:e.mode}),h=e.edit.split,m=e.edit.splitDuedate,d=moment(s),this.get("daysList").merge(this,f=function(){var t,o,s;for(t=function(t){return function(t,n){var o;return t.set("initPlan",o=null===h?null:h.get(m,n)),t.set("plan",i.day(r,n)),n.valueOf()===l.today?t.set("select",!0):n>l.today&&(t.__unwatch1=e.$watch("edit.duedate",function(e){t.set("select",null!==e&&n<=e)})),t.__unwatch2=e.$watch(function(){var n,o,r;return[null!=(n=e.$eval("edit.responsible"))?n.$ds_key:void 0,null!=(o=t.get("plan"))?o.val:void 0,null!=(r=t.get("timeLeft"))?r.valueOf():void 0]},function(n){var r,i,s,a,u;a=n[0],i=n[1],u=n[2],"number"!=typeof u?t.set("timeLeftShow",null):(r=moment.duration(u),null!==o&&null!==(s=e.task.get("responsible"))&&s.$ds_key===a&&r.add(o),moment.isDuration(i)&&r.subtract(i),t.set("timeLeftShow",r))},!0)}}(this),s=[],c=o=0;o<7;c=++o)p=new n(this,""+c),t(p,d),(d=moment(d)).add(1,"day"),s.push(p);return s}.call(this))},o.prototype.render=function(){var t,e,n,o,r,i,s,a,c,l,d;if(null===(l=this.get("responsible"))||"ready"!==(d=this.data.get("personDayStatStatus"))&&"update"!==d)for(c=this.get("days"),r=0,s=c.length;r<s;r++)t=c[r],t.set("timeLeft",null);else{if(u&&!this.data.get("personDayStat").hasOwnProperty(l.$ds_key))throw new Error("Missing person");for(e=this.data.get("personDayStat")[l.$ds_key].get("dayStats"),a=this.get("days"),n=o=0,i=a.length;o<i;n=++o)t=a[n],t.set("timeLeft",e[n].get("timeLeft"))}},o.end(),o}(t)}])},{"../../../dscommon/DSObject":62,"../../../dscommon/DSView":67,"../../../dscommon/util":68,"../../models/Person":16,"../../models/PersonDayStat":17,"../../models/Task":21,"../../models/types/TaskSplit":25,"../time":36}],32:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("../../../dscommon/util").assert,c=t("../../../dscommon/util").error,d=t("../../../dscommon/util").serviceOwner,s=t("../../../dscommon/DSObject"),i=t("../../../dscommon/DSDocument"),r=t("../../../dscommon/DSDigest"),o=t("../../models/types/Comments"),a=t("../../models/Person"),e.exports=(l=angular.module("ui/tasks/addCommentAndSave",[t("../../config"),t("../../data/dsDataService"),t("../../data/dsChanges")])).name,l.run(["$rootScope",function(t){t.AddCommentAndSave=null}]),l.factory("addCommentAndSave",["dsDataService","dsChanges","config","$rootScope","$q",function(t,e,n,a,l){var f,h;return f=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.begin("AddCommentAndSave"),n.propDoc("document",i),n.propList("documents",i),n.propObj("changes"),n.propStr("reason",{init:""}),n.propBool("plansChange"),n.prototype.show=function(t,e,n){var o,r,s,d,p,f,h,m,g,y,_,v,w;if(u&&(null!==t&&(Array.isArray(t)&&t.length>0&&t[0]instanceof i||t instanceof i)||c.invalidArg("document"),"boolean"!=typeof e&&c.invalidArg("showDialog"),null!==n&&"object"==typeof n||c.invalidArg("changes")),this.__deferred=l.defer(),n.hasOwnProperty("clipboard")||(n.clipboard=!1),n.hasOwnProperty("plan")&&!n.plan)if(Array.isArray(t)){for(s=0,p=t.length;s<p;s++)if(r=t[s],r.get("plan")){m=this.set("plansChange",!0);break}}else t.get("plan")&&(m=this.set("plansChange",!0));if(Array.isArray(t)){for(d=0,f=t.length;d<f;d++)r=t[d],r.addRef(this);this.get("documentsList").merge(this,t),t=this.set("document",t[0])}else this.set("document",t);h=[],o=!1,v=t.__props;for(_ in v)if(y=v[_],n.hasOwnProperty(_)){if(!t.$u.hasOwnProperty(_)){console.error("Doc "+t.toString()+": Prop "+_+": Property is not editable");continue}if("undefined"==typeof y.valid(w=n[_])){console.error("Doc "+t.toString()+": Prop "+_+": Invalid value '"+w+"'");continue}y.equal(t.get(_),w=n[_])||(o=!0,h.push({propName:_,value:w,text:null===w?"-":y.str(w)})),delete n[_]}for(_ in n)console.error("Doc "+t.toString()+": Has no property '"+_+"'");return g=this.__deferred.promise,o?(this.set("changes",h),e||m?a.addCommentAndSave=this:(this.saveWOComment(),this.freeDocs())):(this.set("document",null),this.get("documentsList").merge(this,[]),this.__deferred.resolve(!0),delete this.__deferred),g},n.prototype.save=function(){this.addCommentAndSave(),a.addCommentAndSave=null},n.prototype.cancel=function(){this.freeDocs(),a.addCommentAndSave=null,this.__deferred.resolve(!1),delete this.__deferred},n.prototype.freeDocs=function(){this.set("reason",""),this.set("document",null),this.get("documentsList").merge(this,[]),this.set("changes",null)},n.prototype.addCommentAndSave=function(){r.block(function(t){return function(){var n,r,i,s,a,u,c,l,d,p,f,h,m;(a=e.get("hist")).startBlock();try{for(i=t.get("document"),0===(s=t.get("documents")).length&&(s=null),h=t.get("changes"),u=0,d=h.length;u<d;u++)if(n=h[u],s)for(c=0,p=s.length;c<p;c++)i=s[c],i.set(n.propName,n.value);else i.set(n.propName,n.value);if((r=t.get("reason").trim()).length>0)if(m=function(t){var e;e=null===(e=t.get("comments"))?new o:e.clone(),e.add(r),t.set("comments",e)},s)for(l=0,f=s.length;l<f;l++)i=s[l],m(i);else m(i)}finally{a.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.prototype.saveWOComment=function(){r.block(function(t){return function(){var n,o,r,i,s,a,u,c,l;(i=e.get("hist")).startBlock();try{for(o=t.get("document"),0===(r=t.get("documents")).length&&(r=null),l=t.get("changes"),s=0,u=l.length;s<u;s++)if(n=l[s],r)for(a=0,c=r.length;a<c;a++)o=r[a],o.set(n.propName,n.value);else o.set(n.propName,n.value)}finally{i.endBlock()}}}(this)),this.freeDocs(),this.__deferred.resolve(!0),delete this.__deferred},n.end(),n}(s),h=d.add(new f(d,"addCommentAndSave")),function(t,e,n){return h.show(t,e,n)}}])},{"../../../dscommon/DSDigest":58,"../../../dscommon/DSDocument":59,"../../../dscommon/DSObject":62,"../../../dscommon/util":68,"../../config":2,"../../data/dsChanges":6,"../../data/dsDataService":7,"../../models/Person":16,"../../models/types/Comments":24}],33:[function(t,e,n){var o;e.exports=(o=angular.module("ui/tasks/rmsTask",[])).name,o.run(["$rootScope",function(t){t.modal={type:null}}]),o.directive("rmsTask",["$rootScope","$timeout",function(t,e){return{restrict:"A",require:"ngModel",link:function(e,n,o,r){var i;n.on("click",function(e){var o;e.stopPropagation(),"task-edit"!==(o=t.modal).type?(t.modal={type:"task-edit",task:r.$viewValue,pos:n.offset()},t.$digest()):o.task!==r.$viewValue&&(t.modal={type:null},t.$digest(),t.$evalAsync(function(){t.modal={type:"task-edit",task:r.$viewValue,pos:n.offset()}},0))}),n.on("mouseover",function(e){e.stopPropagation(),0<=["task-info",null].indexOf(t.modal.type)&&(t.modal={type:"task-info",task:r.$viewValue,pos:n.offset()},t.$digest())}),n.on("mouseleave",function(e){e.stopPropagation(),0<=["task-info"].indexOf(t.modal.type)&&(t.modal={type:null},t.$digest())}),i=void 0,"taskView.time.task"!==o.rmsTask&&e.$watch(o.rmsTask+".style",function(t){n.css("background-color",t.color?t.color:""),n.css("border",t.border?t.border:"")}),e.$watch(o.rmsTask+".$u",function(r){var s;r?(s=n[0],s.draggable=!0,s.addEventListener("dragstart",i=function(r){var i;return t.modal={type:"drag-start",task:i=e.$eval(o.rmsTask),scope:e},t.$digest(),n.addClass("drag-start"),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("task",i),r.dataTransfer.setDragImage($("#task-drag-ghost")[0],20,20),!0}),s.addEventListener("dragend",function(e){return t.modal={type:null},n.removeClass("drag-start"),t.$digest(),!0})):(s=n[0],s.draggable=!1,s.removeEventListener("dragstart",i),n.off("dragend"))})}}}]),o.directive("setTaskVisible",[function(){return{restrict:"A",link:function(t,e,n){var o;o=n.setTaskVisible,t.$eval(o+".setVisible(true)"),t.$on("$destroy",function(){t.$eval(o+".setVisible(false)")})}}}])},{}],34:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p;e.exports=(l=angular.module("ui/tasks/rmsTaskEdit",[t("../../data/dsChanges"),t("../../data/dsDataService"),t("./TaskSplitWeekView"),t("./addCommentAndSave")])).name,c=t("../../../dscommon/util").assert,p=t("../../ui/time"),o=t("../../../dscommon/DSDigest"),r=t("../../../dscommon/DSTags"),a=t("../../models/Tag"),i=t("../../models/Person"),u=t("../../models/types/TaskSplit"),s=t("../../models/PersonDayStat"),d=3,l.directive("rmsTaskEdit",["TaskSplitWeekView","dsDataService","dsChanges","addCommentAndSave","$rootScope","$window","$timeout",function(t,e,n,o,l,f,h){return{restrict:"A",scope:!0,link:function(n,f,h){var m,g,y,v,w,S,D,k,b,T,O,P,A,j,C;return D=l.modal,n.edit=y={},A=null,k=function(e){return new t(n,"TaskSplitWeekView "+e.format(),function(){return y.splitDuedate},y.split,e)},S=function(){var t,e,o;t=y.firstWeek,y.splitView=function(){var n,r,i;for(i=[],o=n=0,r=d;0<=r?n<r:n>r;o=0<=r?++n:--n)e=k(t),(t=moment(t)).add(1,"week"),i.push(e);return i}(),A=n.$watch(function(){var t;return null!=(t=y.split.lastDate(y.splitDuedate))?t.valueOf():void 0},function(t){var e;y.split.shift(e=moment(t),y.splitDuedate),y.splitDuedate=e})},b=function(){var t,e,o,r;for(o=y.splitView,t=0,e=o.length;t<e;t++)r=o[t],r.release(n);y.splitView=null,A()},n.$evalAsync(function(){$($("input",f)[1]).select()}),n.people=_.map(i.pool.items,function(t){return t}),n.task=O=D.task,n.$watch(function(){return p.today.valueOf()},function(){return n.today=p.today}),n.$on("$destroy",function(){"function"==typeof n._unwatch&&n._unwatch(),"function"==typeof n._unwatch2&&n._unwatch2(),y.tags&&y.tags!==O.get("tags")&&y.tags.release(n)}),y.title=O.get("title"),y.duedate=g=O.get("duedate"),y.estimate=O.get("estimate"),y.responsible=O.get("responsible"),y.description=O.get("description"),y.tagsSelect=[],y.tagsClone=!1,y.tags=O.get("tags"),n.$watch(function(){return y.tags},function(t){var e,o;n.orderedTags=t?function(){var n,r;n=t.map,r=[];for(o in n)e=n[o],r.push(e);return r}().sort(function(t,e){return t.get("priority")-e.get("priority")}):[]}),(j=function(){var t;t=e.findDataSet(n,{type:a,mode:"original"}),t.watchStatus(n,function(e,o,r,i){var s,a;n._unwatch2=i,"ready"===o&&(i(),n._unwatch2=null,n.tagsToSelect=function(){var e,n,o;e=t.items,o=[];for(a in e)s=e[a],(null!=(n=y.tags)?n.get(a):void 0)||o.push(s);return o}().sort(function(t,e){return t.get("priority")-e.get("priority")}),t.release(n))})})(),y.tagsSelected=null,n.$watch(function(){return y.tagsSelected},function(){var t,e;y.tagsSelected&&(e=(t=y.tags)?y.tags.clone(n):new r(n),e.set(y.tagsSelected.name,y.tagsSelected),y.tags=e,t&&O.get("tags")!==t&&t.release(n),y.tagsSelected=null,j())}),n.tagsRemove=function(t){var e,o;Object.keys((e=y.tags).map).length>1?(o=e.clone(n),o.set(t.name,!1),y.tags=o):y.tags=null,e&&O.get("tags")!==e&&e.release(n),j()},y.splitDiff=null,y.firstWeek=P=moment().startOf("week"),y.splitDuedate=null!==g?g:moment().startOf("day"),(y.isSplit=null!==(y.split=null!==(T=O.get("split"))?T.clone():null))?(v=moment(T.firstDate(g)).startOf("week"),w=moment(T.lastDate(g)).startOf("week"),(C=moment.duration(w.diff(v)).asWeeks())<d?v.isBefore(P)?y.firstWeek=v:moment.duration(w.diff(P)).asWeeks()<=d||(y.firstWeek=w.subtract(d-1,"week")):y.firstWeek=v,S()):y.splitView=null,(n.viewonly=!O.$u||_.isEmpty(O.$u))||(n.changes=!1,n.$watch(function(){var t,e,n,o,r;return e=[y.title,y.description,null===(g=y.duedate)?null:g.valueOf(),null===(t=y.estimate)?null:t.valueOf(),null===(n=y.responsible)?null:n.$ds_key,null===(o=y.tags)?null:o.valueOf()],null!==(T=y.split)&&(r=T.valueOf()).length>0&&(e=e.concat(r)),e},function(t,e){n.changes=t!==e},!0),n.$watch(function(){return y.isSplit},function(t){var e;t?(null===y.split&&(y.split=new u),null===y.splitView&&S()):null!==y.splitView&&b(),(null!=(e=y.split)?e.valueOf().length:void 0)>0&&(n.changes=!0)}),n.$watch(function(){var t;return null!=(t=y.duedate)?t.valueOf():void 0},function(t,e){t!==e&&(n.changes=!0,null!==y.split&&null!==t&&null!==e&&y.splitDuedate.add(t-e))}),n.$watch(function(){var t;return[null!=(t=y.estimate)?t.valueOf():void 0,y.isSplit,y.split]},function(t){var e,n,o,r,i,s;e=t[0],n=t[1],i=t[2],"number"==typeof e&&n&&null!==i?(r=(o=moment.duration(i.total).subtract(e)).valueOf(),y.splitDiff=0===r||null!==(s=y.splitDiff)&&s.valueOf()===r?null:o):y.splitDiff=null},!0)),n.splitPrevWeek=function(){var t;y.firstWeek=t=moment(y.firstWeek).subtract(1,"week"),y.splitView.unshift(k(t)),y.splitView.pop().release(n)},n.splitNextWeek=function(){var t;t=moment(y.firstWeek.add(1,"week")).add(d-1,"week"),y.splitView.push(k(t)),y.splitView.shift().release(n)},n.close=m=function(){l.modal={type:null}},n.save=function(t,e){var n,r,i,s;c&&"undefined"!=typeof e&&"boolean"!=typeof e&&error.invalidArg("plan"),y.isSplit&&y.split.list.length>0&&(y.duedate=y.splitDuedate,i=T.total,null===(r=y.estimate)?y.estimate=i:0!==(n=r.valueOf()-i.valueOf())&&T.fixEstimate(n)),s={title:y.title,duedate:y.duedate,estimate:y.estimate,responsible:y.responsible,split:y.isSplit&&y.split.valueOf().length>0?y.split:null,tags:y.tags,description:y.description},"boolean"==typeof e&&(s.plan=e),o(O,t.shiftKey,s).then(function(t){t&&m()})},n.showTimeLeft=function(t){var e,o,r,i,s,a,u,c;return null===(u=t.get("timeLeft"))?"":(s=t.get("plan"),r=t.get("initPlan"),e=moment.duration(u),null!==r&&n.task.get("responsible")===y.responsible&&e.add(r),null!==(c=s.val)&&e.subtract(c),a=(c=e.valueOf())<0?(e=moment.duration(-c),"- "):"",o=Math.floor(e.asHours()),i=e.minutes(),a+=o+"h "+(i<10?"0"+i:i)+"m")},n.autoSplitInProgress=!1,n.autoSplit=function(){var t,o,r,i,a,u,l,d;if(c){if(!(null!==y.duedate&&p.today<=y.duedate))throw new Error("Invalid duedate: "+(null!=(a=y.duedate)?a.format():void 0));if(null===y.responsible)throw new Error("Invalid value 'edit.responsible': "+y.responsible);if(!(null!==y.estimate&&y.estimate>0))throw new Error("Invalid value 'edit.estimate': "+(null!=(u=y.estimate)?u.valueOf():void 0))}n.autoSplitInProgress=!0,l=y.responsible.$ds_key,t=moment(g=y.duedate),o=moment.duration(y.estimate),(T=y.split).clear(),y.splitDuedate=moment(t),r=n.task.get("duedate"),i=null!==r&&y.responsible===n.task.get("responsible")?n.task.get("split"):null,(d=function(){var a,u;a=e.findDataSet(n,{type:s,mode:"edited",startDate:u=moment(t).startOf("week"),endDate:moment(t).endOf("week")}),n._unwatch=a.watchStatus(n,function(e,s,a,c){var f,h,m,y,_;if("ready"===s){for(h=e.items[l].get("dayStats");o>0&&p.today<=t&&u<=t;)_=(f=h[moment.duration(t.diff(u)).asDays()]).timeLeft,null!==i&&null!==(y=i.get(r,t))&&(_=moment.duration(_)).add(y),_>0&&(T.set(g,t,m=moment.duration(Math.min(_.valueOf(),o.valueOf()))),o.subtract(m)),t.subtract(1,"day");c(),delete n._unwatch,o>0&&p.today<=t?(t.subtract(2,"days"),d()):n.autoSplitInProgress=!1}}),a.release(n)})()}}}}])},{"../../../dscommon/DSDigest":58,"../../../dscommon/DSTags":66,"../../../dscommon/util":68,"../../data/dsChanges":6,"../../data/dsDataService":7,"../../models/Person":16,"../../models/PersonDayStat":17,"../../models/Tag":20,"../../models/types/TaskSplit":25,"../../ui/time":36,"./TaskSplitWeekView":31,"./addCommentAndSave":32}],35:[function(t,e,n){var o,r,i,s;e.exports=(s=angular.module("ui/tasks/rmsTaskInfo",[])).name,r=t("../../../dscommon/util").assert,i=t("../../../dscommon/util").error,o=t("../../../dscommon/DSObject"),s.directive("rmsTaskInfo",["$rootScope","$window",function(t,e){return{restrict:"A",scope:!0,link:function(e,n,o){var r,i,s,a,u;r=t.modal,$(window).height()>r.pos.top+150?e.top=Math.ceil(r.pos.top+50):e.top=Math.ceil(r.pos.top-100),$(window).width()-$("#sidebar").innerWidth()>r.pos.left?e.left=Math.ceil(r.pos.left+95):e.left=Math.ceil(r.pos.left-300),e.task=u=r.task,e.orderedTags=(a=u.get("tags"))?function(){var t,e;t=a.map,e=[];for(s in t)i=t[s],e.push(i);return e}().sort(function(t,e){return t.get("priority")-e.get("priority")}):[]}}}])},{"../../../dscommon/DSObject":62,"../../../dscommon/util":68}],36:[function(t,e,n){var o,r;e.exports=o={today:moment().startOf("day"),historyLimit:moment().startOf("week").subtract(2,"weeks")},(r=function(){setTimeout(function(){o.today=moment().startOf("day"),r()},moment().startOf("day").add(1,"day").add(20,"seconds").valueOf()-(new Date).getTime())})()},{}],37:[function(t,e,n){var o,r,i,s,a,u,c;i=t("../../dscommon/util").assert,s=t("../../dscommon/util").error,u=t("../../dscommon/util").totalRelease,o=t("../../dscommon/DSObjectBase"),r=t("../models/PersonDayStat"),e.exports=(a=angular.module("ui/ui",["ui.router","ngSanitize",t("./views/view1/View1"),t("./views/view2/View2"),t("./views/view3/View3"),t("./views/changes/ViewChanges"),t("./account/rmsAccount"),t("./widgets/widgetDate"),t("./widgets/widgetDuration"),t("./tasks/rmsTask"),t("./tasks/rmsTaskEdit"),t("./tasks/TaskSplitWeekView"),t("./tasks/rmsTaskInfo"),t("./tasks/addCommentAndSave"),t("./layout"),t("./filters")])).name,a.config(["$urlRouterProvider","$stateProvider","$locationProvider","$httpProvider",function(t,e,n,o){e.state({name:"/",url:"/",templateUrl:function(){return"./ui/main.html"},controller:c}),u&&e.state({name:"totalRelease",url:"/totalRelease",templat:"<div/>"})}]),u&&a.run(["$state","$rootScope",function(t,e){var n;return n=window.totalRelease,window.totalRelease=function(){t.go("totalRelease"),e.$evalAsync(function(){n(),setTimeout(function(){console.info(window.totalPool)},1e3)})}}]),c=["$rootScope","$scope",function(t,e){e.mode="edited",e.setMode=function(t){e.mode=t},e.taskSummaryColor=function(t){var e;return i&&(t instanceof r.DayStat||s.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?"red":e/t.get("contract").valueOf()<=.2?"green":"light-yellow"},e.dayTaskWidth=function(t){var e;return i&&(t instanceof r.DayStat||s.invalidArg("dayStat")),(e=t.get("timeLeft").valueOf())<0?100:Math.round(100*(1-e/t.get("contract").valueOf()))},e.taskViewExpand=function(t){e.period.people[t].tasks.expand=!e.period.people[t].tasks.expand}}]},{"../../dscommon/DSObjectBase":63,"../../dscommon/util":68,"../models/PersonDayStat":17,"./account/rmsAccount":28,"./filters":29,"./layout":30,"./tasks/TaskSplitWeekView":31,"./tasks/addCommentAndSave":32,"./tasks/rmsTask":33,"./tasks/rmsTaskEdit":34,"./tasks/rmsTaskInfo":35,"./views/changes/ViewChanges":38,"./views/view1/View1":40,"./views/view2/View2":44,"./views/view3/View3":45,"./widgets/widgetDate":49,"./widgets/widgetDuration":50}],38:[function(t,e,n){var o,r,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;e.exports=(c=angular.module("ui/views/changes/ViewChanges",[t("../../../data/dsChanges"),t("../../../../dscommon/DSView")])).name,u=t("../../../../dscommon/util").assert,i=t("../../../../dscommon/DSObject"),r=t("../../../../dscommon/DSDigest"),a=t("../../../models/Task"),s=t("../../../models/Person"),o=t("./models/Change"),c.run(["$rootScope",function(t){t.showChanges=function(){t.modal="changes"!==t.modal.type?{type:"changes"}:{type:null}}}]),c.controller("ViewChanges",["$scope","ViewChanges","dsChanges","$rootScope",function(t,e,n,o){t.view=new e(t,"viewChanges"),t.save=function(){n.save().then(function(t){t&&(o.modal={type:null})})},t.reset=function(){n.reset(),o.modal={type:null}}}]),c.directive("viewChangesFix",[function(){return{restrict:"A",link:function(t,e,n){var o,r;r=$(".main-table.header",e),o=$(".main-table.data",e),r.width(o.width())}}}]),c.factory("ViewChanges",["DSView","dsChanges","$log",function(t,e,n){var i;return i=function(n){function i(){return s.apply(this,arguments)}var s;return l(i,n),i.begin("ViewChange"),i.propData("tasks",a,{mode:"changes"}),i.propPool("poolChanges",o),i.propList("changes",o),s=function(e,n){t.call(this,e,n),this.dataUpdate({});
},i.ds_dstr.push(function(){var t,e,n;t=this.get("data").get("tasksSet").items;for(n in t)e=t[n],delete e.__change.__refreshView}),i.prototype.render=function(){var t,n,o,i,s,a,u,c,l,d,p,f,h,m,g,y,_,v,w;if("ready"!==(v=this.get("data").get("tasksStatus"))&&"update"!==v)return void this.get("changesList").merge(this,[]);a=this.get("poolChanges"),n=[],d=(_=this.get("data").get("tasksSet")).type.prototype.__props,i=!1,h=function(t){return function(){t.__dirty++}}(this),p=_.items;for(y in p){g=p[y],i=!i,s=!0,g.__change.__refreshView=h,m=function(t){return function(){var n;(n=e.get("hist")).startBlock();try{r.block(function(){var e,n,o;o=t.__change;for(n in o)e=o[n],"__error"!==n&&"__refreshView"!==n&&t.set(n,t.$ds_doc.get(n))})}finally{n.endBlock()}h()}}(g),f=g.__change;for(l in f)c=f[l],"__error"!==l&&"__refreshView"!==l&&"clipboard"!==l&&(u=d[l],n.push(t=a.find(this,g.$ds_key+"."+l)),t.set("isDark",i),s&&(s=!1,t.set("doc",g)),t.set("prop",l),t.set("value",null===(w=c.v)?" -":u.str(c.v)),t.set("conflict",u.equal(o=g.$ds_doc.get(l),c.s)?null:null===o?" -":u.str(o)),m&&(t.remove=m,m=null));g.__change.__error&&(n.push(t=a.find(this,g.$ds_key+".__error")),t.set("isDark",i),t.set("error",g.__change.__error))}this.get("changesList").merge(this,n)},i.end(),i}(t)}])},{"../../../../dscommon/DSDigest":58,"../../../../dscommon/DSObject":62,"../../../../dscommon/DSView":67,"../../../../dscommon/util":68,"../../../data/dsChanges":6,"../../../models/Person":16,"../../../models/Task":21,"./models/Change":39}],39:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("../../../../../dscommon/util").assert,a=t("../../../../../dscommon/util").error,i=t("../../../../../dscommon/DSObject"),r=t("../../../../../dscommon/DSDocument"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("Change"),e.propDoc("doc",r),e.propStr("prop"),e.propStr("value"),e.propStr("conflict"),e.propStr("error"),e.propBool("isDark"),e.end(),e}(i)},{"../../../../../dscommon/DSDocument":59,"../../../../../dscommon/DSObject":62,"../../../../../dscommon/util":68}],40:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f,h,m=function(t,e){function n(){this.constructor=t}for(var o in e)g.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty;e.exports=(f=angular.module("ui/views/view1/View1",[t("../../../config"),t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,p=t("../../../../dscommon/util").assert,o=t("../../../../dscommon/DSDigest"),l=t("../../../models/Task"),c=t("../../../models/Tag"),i=t("../../../models/Person"),s=t("../../../models/PersonDayStat"),a=t("../../../models/PersonTimeTracking"),r=t("./models/Day"),u=t("./models/Row"),d=t("./models/TaskView"),h=t("../../../../dscommon/util").serviceOwner,f.controller("View1",["$scope","View1","$rootScope",function(t,e,n){n.view1=t.view=new e(t,"view1"),t.$on("$destroy",function(){delete n.view1}),t.expandedHeight=function(t){return t.expand?_.isEmpty(t.tasks)?"height:100px":"height:"+(65*_.maxBy(t.tasks,"y").y+98)+"px":""}}]),f.factory("View1",["DSView","config","$rootScope","$log","TWTasks",function(t,e,n,o,c){var d;return d=function(o){function d(){return p.apply(this,arguments)}var p,f,h;return m(d,o),d.begin("View1"),d.propData("people",i,{watch:["roles","companyId"]}),d.propData("tasks",l,{filter:"assigned",watch:["responsible","duedate","split","estimate","priority"]}),d.propData("personDayStat",s,{}),d.propData("personTimeTracking",a,{watch:[]}),d.propMoment("startDate"),d.propList("days",r),d.propPool("poolRows",u),d.propList("rows",u),d.propObj("hiddenPeople",{init:{}}),d.propNum("hiddenPeopleCount",{init:0}),d.ds_dstr.push(function(){this.__unwatchA(),this.__unwatchB(),this.__unwatchC()}),p=function(o,r){var i,s,a,u,c,l,d,p,f;if(t.call(this,o,r),this.scope=o,this.set("startDate",moment().startOf("week")),o.filterLoad=[o.selectedLoad={id:0,name:"All"},{id:-1,name:"Underload"},{id:1,name:"Overload"}],f=e.get("selectedLoad"))for(l=o.filterLoad,s=0,u=l.length;s<u;s++)i=l[s],i.id===f&&(o.selectedLoad=i);if(e.hasRoles)for(o.filterCompanies=[{id:-1,name:"All"},o.selectedCompany={id:23872,name:"WebProfy"},{id:50486,name:"Freelancers"}],p=e.get("selectedCompany"),d=o.filterCompanies,a=0,c=d.length;a<c;a++)if(i=d[a],i.id===p){o.selectedCompany=i;break}this.__unwatchA=o.$watch(function(t){return function(){var e;return[null!=(e=t.get("startDate"))?e.valueOf():void 0,o.mode,o.dataService.showTimeSpent]}}(this),function(t){return function(e){var n,o,r;r=e[0],n=e[1],o=e[2],t.dataUpdate({startDate:moment(r),endDate:moment(r).add(6,"days"),mode:n,showTimeSpent:o})}}(this),!0),this.__unwatchB=o.$watch(function(){return[o.selectedRole,o.selectedCompany,o.selectedLoad]},function(t){return function(o){var r,i,s;return s=o[0],r=o[1],i=o[2],n.peopleRoles&&e.set("selectedRole",s?s.role:null),e.set("selectedCompany",r?r.id:null),e.set("selectedLoad",i?i.id:0),t.__dirty++}}(this),!0),this.__unwatchC=o.$watch(function(t){return function(){return[e.get("currentUserId"),t.get("data").get("peopleStatus")]}}(this),function(t){return function(n){var o,r;return o=n[0],r=n[1],null===o||"ready"!==r&&"update"!==r?void e.set("currentUser",null):void e.set("currentUser",t.get("data").get("people")[o])}}(this),!0)},d.prototype.periodChange=function(t){this.set("startDate",this.startDate.add(t,"week"))},d.prototype.hideRow=function(t){this.get("hiddenPeople")[t.$ds_key]=!0,this.hiddenPeopleCount++,this.__dirty++},d.prototype.unhideAll=function(){this.set("hiddenPeople",{}),this.hiddenPeopleCount=0,this.__dirty++},d.prototype.render=function(){var t,n,o,i,s,a,u,c,l,p,f,h,m,g,y,v,w,S,D,k,b,T,O,P,$,A,j,C,L,M,R,x,E;if("ready"!==(m=this.get("data").get("peopleStatus"))&&"update"!==m)return void this.get("rowsList").merge(this,[]);L=this.get("startDate"),n=this.get("daysList").merge(this,_.map([0,1,2,3,4,5,6],function(t){return function(e,n){var o,i;return o=moment(L).add(e,"days"),i=new r(t,o.format()),i.set("date",o),i.set("index",n),i.set("x",e),i}}(this))),u=function(){return!0},c=this.get("hiddenPeople");for(p in c){u=function(t){return!c.hasOwnProperty(t.$ds_key)};break}if(e.get("hasRoles")){if((null!=(k=this.scope.selectedCompany)?k.id:void 0)!==-1?(t=this.scope.selectedCompany.id,i=u,u=function(e){return i(e)&&e.get("companyId")===t}):i=u,null!=(b=this.scope.selectedRole)?b.role:void 0)if(C=this.scope.selectedRole,s=u,C.hasOwnProperty("roles")){for($={},T=C.roles.split(","),l=0,f=T.length;l<f;l++)D=T[l],$[D.trim()]=!0;u=function(t){var e;return s(t)&&(null!=(e=t.get("roles"))?e.any($):void 0)}}else if(C.hasOwnProperty("special"))switch(C.special){case"notSupervisors":u=function(t){var e;return s(t)&&(null===(e=t.get("roles"))||!e.get("Manager"))};break;default:console.error("Unexpected role.special value: "+P.special,C)}else P=C.role,u=function(t){var e;return s(t)&&(null!=(e=t.get("roles"))?e.get(P):void 0)};if(0!==(null!=(O=this.scope.selectedLoad)?O.id:void 0)){if("ready"!==(y=this.get("data").get("personDayStatStatus"))&&"update"!==y)return;g=this.get("data").get("personDayStat"),h=1===this.scope.selectedLoad.id?function(t){var e,n,o,r;for(r=g[t.$ds_key].get("dayStats"),n=0,o=r.length;n<o;n++)if(e=r[n],e.get("timeLeft")<0)return!0;return!1}:function(t){var e,n,o,r;for(r=g[t.$ds_key].get("dayStats"),n=0,o=r.length;n<o;n++)if(e=r[n],e.get("timeLeft").valueOf()/e.get("contract").valueOf()>.2)return!0;return!1},a=u,u=function(t){return a(t)&&h(t)}}}j=_.filter(this.data.get("people"),u),j.sort(function(t,e){var n,o;return(n=t.name.toLowerCase())<(o=e.name.toLowerCase())?-1:n>o?1:0}),S=this.get("poolRows"),A=this.get("rowsList").merge(this,_.map(j,function(t){return function(e){var n;return n=S.find(t,e.$ds_key),n.set("person",e),n}}(this))),o=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),E=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),"ready"!==(R=this.get("data").get("tasksStatus"))&&"update"!==R||"ready"!==(y=this.get("data").get("personDayStatStatus"))&&"update"!==y?_.forEach(A,function(t){return function(e){e.get("tasksList").merge(t,[]),e.set("personDayStat",null)}}(this)):(M=_.groupBy(this.data.tasks,function(t){return t.get("responsible").$ds_key}),x=null,"ready"!==(w=this.data.personTimeTrackingStatus)&&"update"!==w||(E=_.map([0,1,2,3,4,5,6],function(){return moment.duration(0)}),x=_.groupBy(v=this.data.personTimeTracking,function(t){return t.get("personId")})),_.forEach(A,function(t){return function(e){var n,r,i,s,a,u,c,l,p,f,h,m,y,w,S,D,k,b,T,O,P,$,A,j;for(e.set("personDayStat",g=t.data.get("personDayStat")[e.$ds_key]),S=r=g.get("dayStats"),u=c=0,l=S.length;c<l;u=++c)s=S[u],o[u].add(s.get("tasksTotal"));if(P=e.get("tasksPool"),b={},O=_.map(M[e.$ds_key],function(n){var o,r,i,s,a,u,c,l,d,p;if(d=P.find(t,n.$ds_key),d.set("task",n),x)if(c=n.get("split"))for(r=n.get("duedate"),l=(i=c.firstDate(r))<=L?0:moment.duration(i.diff(L)).asDays(),u=t.get("days").slice(l,7),a=0,s=u.length;a<s;a++)o=u[a],(p=v[e.$ds_key+"-"+n.$ds_key+"-"+o.get("date").valueOf()])&&(b[p.$ds_key]=!0);else(p=v[e.$ds_key+"-"+n.$ds_key+"-"+n.get("duedate").valueOf()])?(b[p.$ds_key]=!0,d.set("time",p)):d.set("time",null);return d}),x&&(A=x[e.$ds_key])){for(m=0,p=A.length;m<p;m++)$=A[m],b[$.$ds_key]||(O.push(T=P.find(t,$.$ds_key)),T.set("time",$));for(j=_.groupBy(A,function(t){return t.get("date").valueOf()}),D=g.get("dayStats"),u=y=0,f=D.length;y<f;u=++y)n=D[u],(i=j[n.get("day").valueOf()])?E[u].add(n.set("timeSpent",_.reduce(i,function(t,e){return t.add(e.get("timeMin"),"m")},moment.duration()))):n.set("timeSpent",null)}else for(k=g.get("dayStats"),w=0,h=k.length;w<h;w++)n=k[w],n.set("timeSpent",null);e.get("tasksList").merge(t,O),a=null,x&&(a=function(t,n){return($=v[e.$ds_key+"-"+t.get("task").$ds_key+"-"+n.valueOf()])?$:null}),d.layoutTaskView(L,O,a)}}(this))),_.forEach(n,function(t,e){t.set("workTime",o[e]),t.set("timeSpent",0===E[e].valueOf()?null:E[e])})},d.taskViewsSortRule=h=function(t,e){var n,o;return n=t.get("task"),o=e.get("task"),null===n&&null===o?e.get("time").get("taskId")-t.get("time").get("taskId"):null===n?1:null===o?-1:c.tasksSortRule(n,o)},f=function(t,e,n,o,r){var i,s,a,u,c,l,d,p,f,h,m,g,y,_,v,w;if(e.set("x",o),s=t[o],0===o)w=s.length;else for(w=u=0,d=s.length;u<d&&(_=s[w],"undefined"!=typeof _);w=++u);if(e.set("y",w),null===(g=e.get("task"))||null===(m=g.get("split")))e.set("split",null),e.set("len",1),w===s.length&&s.length++,s[w]=!0;else for(l=e.set("len",Math.min(moment.duration(moment(m.lastDate(g.get("duedate"))).diff(n)).asDays()+1,7-o)),v=e.set("split",[]),h=c=0,f=l;0<=f?c<f:c>f;h=0<=f?++c:--c)i=0===h?n:moment(n).add(h,"day"),y=r?r(e,i):null,null===(p=m.get(g.duedate,i))&&null===y||v.push({x:h,plan:p,time:y}),(a=t[o+h]).length<=w&&(a.length=w),a[w]=!0;return w},d.layoutTaskView=function(t,e,n){var o,r,i,s,a,u,c,l,d,p,m,g;if(c=0,_.some(e,function(t){var e;return null!=(e=t.get("task"))?e.get("split"):void 0}))for(m=_.groupBy(e,function(t){var e,n,o;return(o=t.get("task"))?(e=o.get("duedate"),(null!==(n=o.get("split"))?n.firstDate(e):e).valueOf()):t.get("time").get("date").valueOf()}),l=function(){var t,e;for(e=[],s=t=0;t<=6;s=++t)e.push([]);return e}(),i=function(){var t;t=[];for(d in m)t.push(parseInt(d));return t}().sort(),a=0,u=i.length;a<u;a++)o=i[a],(g=m[o]).sort(h),r=moment.duration((p=moment(o)).diff(t)).asDays(),r<0&&(r=0,p=t),_.forEach(g,function(t){c=Math.max(c,f(l,t,p,r,n))});else m=_.groupBy(e,function(t){var e;return((e=t.get("time"))?e.get("date"):t.get("task").get("duedate")).valueOf()}),_.forEach(m,function(e,n){var o,r;e.sort(h),r=moment.duration(((o=e[0].get("time"))?o.get("date"):e[0].get("task").get("duedate")).diff(t)).asDays(),_.forEach(e,function(t,e){t.set("x",r),c=Math.max(c,t.set("y",e)),t.set("len",1),t.set("split",null)})});return c},d.end(),d}(t)}]),f.factory("getDropTasksGroup",["dsDataService","$rootScope",function(t,e){var n;return n=h.add(t.findDataSet(h,{type:l,mode:"edited",filter:"all"})),function(){var t,o,r,i,s,a;return t=e.modal.task.get("duedate").valueOf(),s=e.modal.task.get("responsible"),r=e.modal.task.get("project"),i=function(){var e,i,u;e=n.items,u=[];for(o in e)a=e[o],a.plan||a.split||a.get("responsible")!==s||(null!=(i=a.get("duedate"))?i.valueOf():void 0)!==t||a.get("project")!==r||u.push(a);return u}(),0===i.length?[e.modal.task]:i}}]),f.directive("rmsView1DropTask",["View1","$rootScope","dsChanges","addCommentAndSave","getDropTasksGroup",function(t,e,n,o,r){return{restrict:"A",scope:!0,link:function(t,n,i){var s;return s=n[0],s.addEventListener("dragover",function(t){return t.preventDefault(),!0}),s.addEventListener("drop",function(i){var s,a,u;return s=_.findIndex($(".drop-zone",n),function(t){var e;return e=$(t),e.offset().left+e.width()>=i.clientX}),u=!i.ctrlKey||(a=e.modal).task.split||null===a.task.duedate?[e.modal.task]:r(),s<0?o(u,i.shiftKey,{responsible:t.row.get("person"),plan:!1}):o(u,i.shiftKey,{responsible:t.row.get("person"),duedate:t.view.get("days")[s].get("date"),plan:!1}),e.$digest(),i.stopPropagation(),!1})}}}]),f.directive("rmsView1MouseOverWeekChange",["View1","$rootScope","dsChanges","addCommentAndSave",function(t,e,n,o){return{restrict:"A",link:function(t,n,o){var r,i,s;r=t.$eval(o.rmsView1MouseOverWeekChange),s=0,i=n[0],i.addEventListener("dragover",function(t){return t.timeStamp>s&&(s=t.timeStamp+3e3,e.view1.periodChange(r),e.$digest()),t.preventDefault(),!0})}}}])},{"../../../../dscommon/DSDigest":58,"../../../../dscommon/DSView":67,"../../../../dscommon/util":68,"../../../config":2,"../../../data/dsChanges":6,"../../../data/dsDataService":7,"../../../data/teamwork/TWTasks":12,"../../../models/Person":16,"../../../models/PersonDayStat":17,"../../../models/PersonTimeTracking":18,"../../../models/Tag":20,"../../../models/Task":21,"../../tasks/addCommentAndSave":32,"./models/Day":41,"./models/Row":42,"./models/TaskView":43}],41:[function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),e.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.begin("Day"),e.propMoment("date"),e.propNum("index"),e.propNum("x"),e.propDuration("workTime"),e.propDuration("timeSpent"),e.end(),e}(o)},{"../../../../../dscommon/DSObject":62}],42:[function(t,e,n){var o,r,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;u=t("../../../../../dscommon/util").assert,c=t("../../../../../dscommon/util").error,o=t("../../../../../dscommon/DSObject"),r=t("../../../../models/Person"),i=t("../../../../models/PersonDayStat"),a=t("./TaskView"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.begin("Row"),e.propPool("tasksPool",a),e.propDoc("person",r),e.propDoc("personDayStat",i),e.propList("tasks",a),e.propBool("expand",{init:!1}),e.end(),e}(o)},{"../../../../../dscommon/DSObject":62,"../../../../../dscommon/util":68,"../../../../models/Person":16,"../../../../models/PersonDayStat":17,"./TaskView":43}],43:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,i=t("../../../../models/Task"),r=t("../../../../models/PersonTimeTracking"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TaskView"),e.propDoc("task",i),e.propDoc("time",r),e.propNum("x",{init:0,valid:a.required}),e.propNum("y",{init:0,valid:a.required}),e.propNum("len",{init:1,valid:a.required}),e.propObj("split"),e.end(),e}(o)},{"../../../../../dscommon/DSObject":62,"../../../../../dscommon/util":68,"../../../../models/PersonTimeTracking":18,"../../../../models/Task":21}],44:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e.exports=(a=angular.module("ui/views/view2/View2",[t("../../../data/dsChanges"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../view1/View1"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,s=t("../../../../dscommon/util").assert,o=t("../../../../dscommon/DSDigest"),r=t("../../../models/Task"),i=t("../view1/models/TaskView"),a.controller("View2",["$scope","View2",function(t,e){t.view=new e(t,"view2"),t.tasksHeight=function(t){return!t.expand||_.isEmpty(t.tasks)?"":"height:"+(52*_.maxBy(t.tasks,"y").y+100)+"px"}}]),a.factory("View2",["View1","DSView","$rootScope","$log","TWTasks",function(t,e,n,o,s){var a;return a=function(n){function o(){return a.apply(this,arguments)}var a,c;return u(o,n),o.begin("View2"),o.propData("tasksOverdue",r,{filter:"overdue",watch:["duedate","plan","estimate","priority"]}),o.propData("tasksNotAssigned",r,{filter:"notassigned",watch:["duedate","split","plan","estimate","priority"]}),o.propList("tasksOverdue",r),o.propPool("poolTasksNotassignedViews",i),o.propList("tasksNotAssigned",i),o.propNum("tasksNotAssignedHeight",{init:0}),o.ds_dstr.push(function(){this.__unwatchA()}),a=function(t,n){e.call(this,t,n),this.__unwatchA=t.$watch(function(){var e;return[null!=(e=t.$parent.view.startDate)?e.valueOf():void 0,t.mode]},function(t){return function(e){var n,o;o=e[0],n=e[1],t.dataUpdate({startDate:moment(o),endDate:moment(o).add(6,"days"),mode:n})}}(this),!0)},c=function(t,e){var n,o;return n=t.get("task"),o=e.get("task"),s.tasksSortRule(n,o)},o.prototype.render=function(){var e,n,o,r,i;n=this.__scope.$parent.view.startDate,"ready"!==(o=this.get("data").get("tasksOverdueStatus"))&&"update"!==o?this.get("tasksOverdueList").merge(this,[]):(i=_.map(this.get("data").get("tasksOverdue"),function(t){return function(e){return e.addRef(t),e}}(this)),i.sort(s.tasksSortRule),this.get("tasksOverdueList").merge(this,i)),"ready"!==(o=this.get("data").get("tasksNotAssignedStatus"))&&"update"!==o?(this.get("tasksNotAssignedList").merge(this,[]),this.set("tasksNotAssignedHeight",0)):(e=this.get("poolTasksNotassignedViews"),r=this.get("tasksNotAssignedList").merge(this,_.map(this.get("data").get("tasksNotAssigned"),function(t){return function(n){var o;return o=e.find(t,n.$ds_key),o.set("task",n),o}}(this)).sort(c)),this.set("tasksNotAssignedHeight",t.layoutTaskView(n,r)))},o.end(),o}(e)}]),a.directive("rmsView2DayDropTask",["dsChanges","$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,n,o){return{restrict:"A",scope:!0,link:function(t,r,i){var s,a;s=r[0],a=function(t){var e,n;return e=_.findIndex($(".vertical-lines > .col",r),function(e){var n;return n=$(e),n.offset().left+n.width()>=t.clientX}),-1<=(n=--e)&&n<=6?e:-2},s.addEventListener("dragover",function(t){return a(t)!==-2&&(t.preventDefault(),!0)}),s.addEventListener("drop",function(r){var i,s,u;return i=a(r),u=!r.ctrlKey||(s=e.modal).task.split||null===s.task.duedate?[e.modal.task]:o(),n(u,r.shiftKey,{responsible:null,duedate:i===-1?null:t.view1.get("days")[i].get("date"),plan:!1}),e.$digest(),r.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSDigest":58,"../../../../dscommon/DSView":67,"../../../../dscommon/util":68,"../../../data/dsChanges":6,"../../../data/dsDataService":7,"../../../data/teamwork/TWTasks":12,"../../../models/Task":21,"../../tasks/addCommentAndSave":32,"../view1/View1":40,"../view1/models/TaskView":43}],45:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p,f=function(t,e){function n(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;e.exports=(p=angular.module("ui/views/view3/View3",[t("../../../config"),t("../../../data/dsDataService"),t("../../../../dscommon/DSView"),t("../../tasks/addCommentAndSave"),t("../../../data/teamwork/TWTasks")])).name,l=t("../../../../dscommon/util").assert,d=t("../../../../dscommon/util").error,a=t("../../../models/Task"),u=t("../../../models/TodoList"),r=t("../../../models/Project"),o=t("./models/PersonView"),i=t("./models/ProjectView"),c=t("./models/TodoListView"),s=t("../view1/models/Row"),p.controller("View3",["$scope","View3",function(t,e){t.view=new e(t,"view3")}]),p.factory("View3",["DSView","config","$rootScope","$log","TWTasks",function(t,e,n,s,c){var p;return p=function(s){function p(r,s){t.call(this,r,s),this.scope=r,this.expandedProj={},this.expandedRows={},this.__unwatchA=r.$watch(function(){return[r.mode,e.activeSidebarTab]},function(t){return function(o){var i,s;switch(s=o[0],i=o[1],n.view3ActiveTab=i,i){case-1:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"clipboard",mode:s});break;case 0:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"noduedate",mode:s});break;case 1:t.__unwatchB=r.$watch(function(){var t;return null!=(t=r.$parent.view.startDate)?t.valueOf():void 0},function(o){var r,i;n.startDateVal=o,"number"!=typeof o?e.activeSidebarTab=0:(i=moment(o).add(1,"week"),r=moment(i).endOf("week"),t.dataUpdate({filter:"all",mode:s,startDate:i,endDate:r}))});break;case 2:"function"==typeof t.__unwatchB&&t.__unwatchB(),t.dataUpdate({filter:"all",mode:s})}}}(this),!0),this.__unwatchC=r.$watch(function(){return[e.view3GroupByPerson,e.view3HidePeopleWOTasks,e.view3FilterByPerson,e.view3FilterByProject,e.view3FilterByTask]},function(t){return function(){clearTimeout(t.__timer1),t.__timer1=setTimeout(function(){t.__dirty++,r.$digest()},300)}}(this),!0),r.notAssignedExpanded=!0,r.toggleProjectExpanded=function(t){return function(n){var o,r,s,a,u;return l&&(n instanceof i||d.invalidArg("project")),a=(r=t.expandedProj).hasOwnProperty(o=e.activeSidebarTab)?r[o]:r[o]=u={},a.hasOwnProperty(s=n.$ds_key)?a[s]=!a[s]:a[s]=!(2!==o)}}(this),r.isProjectExpanded=function(t){return function(n){var o,r,s,a;return l&&(n instanceof i||d.invalidArg("project")),(r=t.expandedProj).hasOwnProperty(o=e.activeSidebarTab)&&(a=r[o]).hasOwnProperty(s=n.$ds_key)?a[s]:2!==o}}(this),r.togglePersonExpanded=function(t){return function(n){var r,i,s,a,u;return l&&(n instanceof o||d.invalidArg("personView")),a=(i=t.expandedRows).hasOwnProperty(r=e.activeSidebarTab)?i[r]:i[r]=u={},a.hasOwnProperty(s=n.$ds_key)?a[s]=!a[s]:a[s]=!1}}(this),r.isPersonExpended=function(t){return function(n){var r,i,s,a;return l&&(n instanceof o||d.invalidArg("personView")),!(i=t.expandedRows).hasOwnProperty(r=e.activeSidebarTab)||!(a=i[r]).hasOwnProperty(s=n.$ds_key)||a[s]}}(this)}var h;return f(p,s),p.begin("View3"),p.propData("tasks",a,{watch:["duedate","priority","clipboard"]}),p.propPool("poolPeople",o),p.propList("people",o),p.propPool("poolProjects",i),p.propList("projects",i),p.ds_dstr.push(function(){this.__unwatchA(),"function"==typeof this.__unwatchB&&this.__unwatchB(),this.__unwatchС(),"function"==typeof this.__unwatchD&&this.__unwatchD(),clearTimeout(this.__timer1)}),h=function(t,e){return"null"===t?"not assigned tasks".indexOf(e)>=0:t.person.name.toLowerCase().indexOf(e)>=0||t.person.firstName.toLowerCase().indexOf(e)>=0||t.person.email.toLowerCase().indexOf(e)>=0},p.prototype.render=function(){var t,n,o,i,s,a,l,d,p,f,m,g,y,v,w,S,D,k,b,T,O,P,$,A;if("ready"!==(b=this.get("data").get("tasksStatus"))&&"update"!==b)return void this.get("projectsList").merge(this,[]);if(T=this.get("data").get("tasks"),(null!=(y=o=e.view3FilterByTask)?y.length:void 0)>0&&(o=o.trim().toLowerCase(),T=_.filter(T,function(t){return t.get("title").toLowerCase().indexOf(o)>=0})),0===e.view3GroupByPerson){if($=_.groupBy(T,function(t){return t.get("todoList").$ds_key}),P=_.groupBy($,function(t){return t[0].get("project").$ds_key}),(null!=(v=n=e.view3FilterByProject)?v.length:void 0)>0){n=n.trim().toLowerCase();for(s in P)A=P[s],r.pool.items[s].get("name").toLowerCase().indexOf(n)>=0||delete P[s]}f=this.get("poolProjects"),m=this.get("projectsList").merge(this,_.map(P,function(t){return function(e,n){var o;return o=f.find(t,n),o.set("project",r.pool.items[n]),o.get("todoListsList").merge(t,_.map(e,function(e){var n,r;return n=e[0].get("todoList").$ds_key,r=o.poolTodoLists.find(t,n),r.set("todoList",u.pool.items[n]),r.set("tasksCount",_.size(e)),r.set("totalEstimate",_.reduce(e,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),r.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)}).sort(c.tasksSortRule)),r})),o}}(this)).sort(function(t,e){var n,o;return(n=t.get("project").get("name").toLowerCase())<(o=e.get("project").get("name").toLowerCase())?-1:n>o?1:0})),this.get("peopleList").merge(this,[]),this.__unwatchD&&(this.__unwatchD(),this.__unwatchD=null,this.__src.tasks.watch.length=this.__src.tasks.watch.length-1)}else{for(this.__unwatchD||(this.__unwatchD=this.scope.$watch(function(t){return function(){var e,n,o,r,i;for(r=t.scope.view1.rows,i=[],e=0,n=r.length;e<n;e++)o=r[e],i.push(o.$ds_key);return i}}(this),function(t){return function(e,n){e!==n&&t.__dirty++}}(this),!0),this.__src.tasks.watch.push("responsible")),p=this.get("poolPeople"),(null!=(w=t=e.view3FilterByPerson)?w.length:void 0)>0&&(t=t.trim().toLowerCase()),(null!=(S=n=e.view3FilterByProject)?S.length:void 0)>0&&(n=n.trim().toLowerCase()),O=_.groupBy(T,function(t){var e;return(e=t.get("responsible"))?e.$ds_key:"null"}),k=this.scope.view1.rows,O.hasOwnProperty("null")&&(k=k.concat("null")),D=[],i=0,a=k.length;i<a;i++)if(g=k[i],!t||h(g,t))if(O.hasOwnProperty(d="null"!==g?g.$ds_key:"null")){if($=_.groupBy(O[d],function(t){return t.get("todoList").$ds_key}),P=_.groupBy($,function(t){return t[0].get("project").$ds_key}),n)for(s in P)A=P[s],r.pool.items[s].get("name").toLowerCase().indexOf(n)>=0||delete P[s];if(0===Object.keys(P).length)continue;D.push(l=p.find(this,d)),"null"!==g&&l.set("row",g),f=l.get("poolProjects"),l.get("projectsList").merge(this,_.map(P,function(t){return function(e,n){var o;return o=f.find(t,n),o.set("project",r.pool.items[n]),o.get("todoListsList").merge(t,_.map(e,function(e){var n,r;return n=e[0].get("todoList").$ds_key,r=o.poolTodoLists.find(t,n),r.set("todoList",u.pool.items[n]),r.set("tasksCount",_.size(e)),r.set("totalEstimate",_.reduce(e,function(t,e){var n;return(n=e.get("estimate"))?t.add(n):t},moment.duration(0))),r.get("tasksList").merge(t,_.map(e,function(e){return e.addRef(t)})),r})),o}}(this)).sort(function(t,e){var n,o;return(n=t.get("project").get("name").toLowerCase())<(o=e.get("project").get("name").toLowerCase())?-1:n>o?1:0}))}else e.get("view3HidePeopleWOTasks")||(D.push(l=p.find(this,d)),"null"!==g&&l.set("row",g),l.get("projectsList").merge(this,[]));this.get("peopleList").merge(this,D),this.get("projectsList").merge(this,[])}},p.end(),p}(t)}]),p.directive("rmsView3DropTask",["$rootScope","addCommentAndSave","getDropTasksGroup",function(t,e,n){return{restrict:"A",scope:!0,link:function(o,r,i){var s,a;a=r[0],s=i.rmsView3DropTask.length>0?function(t){return function(){return t}}(parseInt(i.rmsView3DropTask)):function(){return t.view3ActiveTab},a.addEventListener("dragover",function(t){return t.preventDefault(),2===s()}),a.addEventListener("drop",function(o){var r,i,a;switch(a=!o.ctrlKey||(i=t.modal).task.split||null===i.task.duedate?[t.modal.task]:n(),r={plan:!1},s()){case-1:r.duedate=null,r.clipboard=!0;break;case 0:r.duedate=null;break;case 1:r.duedate=moment(t.startDateVal).add(1,"week")}return e(a,o.shiftKey,r),t.$digest(),o.stopPropagation(),!1})}}}])},{"../../../../dscommon/DSView":67,"../../../../dscommon/util":68,"../../../config":2,"../../../data/dsDataService":7,"../../../data/teamwork/TWTasks":12,"../../../models/Project":19,"../../../models/Task":21,"../../../models/TodoList":23,"../../tasks/addCommentAndSave":32,"../view1/models/Row":42,"./models/PersonView":46,"./models/ProjectView":47,"./models/TodoListView":48}],46:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),l=t("../../../../../dscommon/util").validate,r=t("../../../../models/Person"),s=t("../../../../models/Project"),a=t("./ProjectView"),c=t("./TodoListView"),u=t("../../view1/models/Row"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,t),e.begin("PersonView"),e.propDoc("row",u),e.propPool("poolProjects",a),e.propList("projects",c),e.end(),e}(o)},{"../../../../../dscommon/DSObject":62,"../../../../../dscommon/util":68,"../../../../models/Person":16,"../../../../models/Project":19,"../../view1/models/Row":42,"./ProjectView":47,"./TodoListView":48}],47:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,r=t("../../../../models/Project"),s=t("./TodoListView"),e.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("ProjectView"),e.propDoc("project",r),e.propPool("poolTodoLists",s),e.propList("todoLists",s),e.end(),e}(o)},{"../../../../../dscommon/DSObject":62,"../../../../../dscommon/util":68,"../../../../models/Project":19,"./TodoListView":48}],48:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("../../../../../dscommon/DSObject"),a=t("../../../../../dscommon/util").validate,r=t("../../../../models/Task"),i=t("../../../../models/TodoList"),e.exports=s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("TodoListView"),e.propDoc("todoList",i),e.propList("tasks",r),e.propNum("tasksCount",{init:0}),e.propDuration("totalEstimate"),e.propBool("isExpand",{init:!0}),e.end(),e}(o)},{"../../../../../dscommon/DSObject":62,"../../../../../dscommon/util":68,"../../../../models/Task":21,"../../../../models/TodoList":23}],49:[function(t,e,n){var o;e.exports=(o=angular.module("ui/widgets/widgetDate",[])).name,$.datepicker.regional.ru={dateFormat:"dd.mm.yy",firstDay:1},$.datepicker.setDefaults($.datepicker.regional.ru),$.timepicker.regional.ru={},$.timepicker.setDefaults($.timepicker.regional.ru),o.directive("widgetDate",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(n,o,r,i){var s;s=$("input",o),e(function(){s.datepicker(),s.change(function(){var e;i.$setViewValue((e=s.datetimepicker("getDate"))?moment(e.getTime()):null),t.$digest()}),(i.$render=function(){s.datetimepicker("setDate",i.$viewValue?new Date(i.$viewValue.valueOf()):null)})()},0)}}}])},{}],50:[function(t,e,n){var o,r,i;e.exports=(i=angular.module("ui/widgets/widgetDuration",[])).name,o=36e5,r=6e4,i.directive("widgetDuration",["$rootScope","$timeout",function(t,e){return{restrict:"EA",require:"ngModel",link:function(e,n,i,s){var a,u,c,l;l=$("input",n),u=$(l[0]),c=$(l[1]),(s.$render=function(){var t,e,n;(n=s.$viewValue)?(t=Math.floor(n.valueOf()/o),e=Math.floor(n.valueOf()%o/r),u.val(t),c.val(e<10?"0"+e:e)):(u.val(""),c.val(""))})(),a=function(){var e,n,o;n=parseInt(u.val()),o=parseInt(c.val()),e=moment.duration(0),isNaN(n)||e.add(n,"hours"),isNaN(o)||e.add(o,"minutes"),
s.$setViewValue(0===e.valueOf()?null:e),t.$digest()},u.on("input",a),c.on("input",a)}}}])},{}],51:[function(t,e,n){var o,r,i,s,a,u,c;i=t("../../dscommon/util").assert,a=t("../../dscommon/util").error,r=/RMS\s*Data\s*\(DO NOT CHANGE!?\)/i,o=/}\s*END/i,u=function(t){var e,n,o,r;for(n=o=r=t.length-1;o>=0&&("\r"===(e=t.charAt(n))||"\n"===e||" "===e||"\t"===e);n=o+=-1);return n>=0?t.substr(0,n+1):""},c=function(t){var e,n,o,r,i;for(n=-1,o=r=0,i=t.length;r<i;o=r+=1)if("\n"===(e=t.charAt(o)))n=o;else if("\r"!==e&&" "!==e&&"\t"!==e)break;return n===-1?t:o<t.length?t.substr(n+1):""},s=function(t){var e,n,i,a;return(i=t.search(r))===-1?t:(e=t.search(o))!==-1&&i<e?(a=u(t.substr(0,i)),n=c(t.substr(t.substr(i).search(/end/i)+3+i)),s(a.length>0?n.length>0?a+"\r\n\r\n"+n:a:n)):u(t.substr(0,i-1))},e.exports={clear:s,get:function(t){var e,n,s,u,c;if(i&&null!==t&&"string"!=typeof t&&a.invalidArg("description"),null===t||(c=t.search(r))===-1)return null;if((e=t.search(o))!==-1&&c<e&&(u=t.indexOf("{",c))!==-1&&u<e)try{return JSON.parse(t.substr(u,e-u+1).trim())}catch(n){s=n,console.error("ex: ",s)}return console.error("Corrupted RMS Data: ",t),null},put:function(t,e){return i&&(null!==t&&"string"!=typeof t&&a.invalidArg("description"),null!==e&&"object"!=typeof e&&a.invalidArg("data")),t=null===t?"":s(t),null===e||0===_.size(e)?t:(0===t.length?"":""+t)+("\r\n\r\nRMS Data (DO NOT CHANGE!) "+JSON.stringify(e)+" END")}}},{"../../dscommon/util":68}],52:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=t("./util").assert,l=t("./util").error,a=t("./DSHistory"),u=t("./DSPool"),r=t("./DSData"),s=t("./DSDocument"),i=t("./DSDigest"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n,o;return d(e,t),e.begin("DSChangesBase"),e.noCache(),e.propDoc("hist",a),e.propNum("count",{init:0}),n=function(t,e){var n,o,i,s,c,l,d,p;for(r.call(this,t,e,{}),(o=this.set("hist",new a(this,e+".hist"))).release(this),n={add:function(t){return function(){t.count++,t.persist()}}(this),change:function(t){return function(){t.persist()}}(this),remove:function(t){return function(){t.count--,t.persist()}}(this)},this.__unwatch2=p=[],c=this.__proto__.__sets,i=0,s=c.length;i<s;i++)d=c[i],(l=this["_"+d]).$ds_hist=o,(l.$ds_pool=new u(this,e+"."+d+".pool",l.type)).release(this),l.watch(this,n,!0)},e.prototype.saveToLocalStorage=_.noop,e.prototype.persist=function(){},e.prototype.anyChange=function(){return this.get("count")>0},e.prototype.reset=function(){i.block(function(t){return function(){var e,n,o,r,i,s,a,u,c,l,d,p;(e=t.get("hist")).startReset();try{for(c=t.__proto__.__sets,n=0,i=c.length;n<i;n++)for(d=c[n],l=_.map((p=t["_"+d]).items,function(t){return t}),r=0,s=l.length;r<s;r++){o=l[r],a=o.$ds_doc;for(u in o.__change)"__error"!==u&&"__refreshView"!==u&&o.set(u,a.get(u))}}finally{e.endReset()}}}(this))},e.prototype.changesToMap=function(){var t,e,n,o,r,i,s,a,u,c,l,d,p,f,h,m;for(d={},u=this.__proto__.__sets,t=0,r=u.length;t<r;t++){h=u[t],a=(f=this["_"+h]).type.prototype.__props,d[h]=p={},c=f.items;for(o in c){e=c[o],p[o]=n={},l=e.__change;for(s in l)i=l[s],"__error"!==s&&"__refreshView"!==s&&(m=a[s].write)&&(n[s]={v:null===i.v?null:m(i.v),s:null===i.s?null:m(i.s)})}}return d},o=function(t,e,n,o,r){var i,s,a;a=e.hasOwnProperty(i=n.docType)?e[i]:e[i]={},a[t[r]]=s=a.hasOwnProperty(t[r])?a[t[r]]:a[t[r]]=[],s.push(function(t,e,n){return function(o){c&&(null!==o&&o.__proto__.constructor===t&&o.$ds_key===e||l.invalidArg("doc")),n[r]=o}}(n,t[r],o))},e.prototype.mapToChanges=function(t){var e,n,r,i,s,a,u,c,l,d,p,f,h,m,g,y,_,v,w;for(y={load:c={},changes:n={}},m=this.__proto__.__sets,r=0,u=m.length;r<u;r++){v=m[r],f=this["_"+v].type.prototype.__props,n[v]=_={},g=t[v];for(a in g){i=g[a],_[a]=s={};for(p in i)d=i[p],s[p]=function(){if("function"==typeof(w=(l=f[p]).type))return e={v:null,s:null},d.v&&o(d,c,w,e,"v"),d.s&&o(d,c,w,e,"s"),e;if(h=l.read)return{v:null===d.v?null:h.call(this,d.v),s:null===d.s?null:h.call(this,d.s)};throw new Error("Unsupported type "+w)}.call(this)}}return y},e.end(),c&&(e.end=function(){var t,e,n;r.end.call(this),e=this.prototype.__props;for(t in e)if(n=e[t],"set"===n.type&&!n.itemType.ds_editable)throw new Error("Type '"+this.name+"': propSet '"+t+"' has non-editable item type")}),e}(r)},{"./DSData":53,"./DSDigest":58,"./DSDocument":59,"./DSHistory":60,"./DSPool":64,"./util":68}],53:[function(t,e,n){var o,r,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,u=t("./util").serviceOwner,a=t("./util").modeReleaseDataOnReload,r=t("./DSObject"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return c(e,t),e.begin("DSData"),e.propObj("params"),e.noCache=function(t){0===arguments.length||t?this.ds_noCache=!0:delete this.ds_noCache},e.addDataSource(function(t,e){var n,o,r,i;for(r=this.__proto__.__sets,n=0,o=r.length;n<o;n++)i=r[n],this["_"+i].set("status",t);return"update"===t&&1===this.$ds_ref&&a&&!this.ds_noCache?void u.remove(this.release(u)):void("nodata"===t&&this.clear())}),e.prototype._startLoad=function(){var t;switch(t=this.get("status")){case"load":return!1;case"update":return!1}return this.set("status",function(){switch(t){case"nodata":return"load";case"ready":return"update"}}()),this.$ds_ref>1},e.prototype._endLoad=function(t){this.set("status",t?"ready":"nodata")},n=function(t,n,o){if(r.call(this,t,n),i){if(this.__proto__.constructor===e)throw new Error("Cannot instantiate DSData directly");"object"!=typeof o&&s.invalidArg("params")}this.set("params",o),this.__busySets=0,a&&!this.__proto__.constructor.ds_noCache&&u.add(this.addRef(u))},e.prototype.clear=function(){var t,e,n,o;for(n=this.__proto__.__sets,t=0,e=n.length;t<e;t++)o=n[t],this["_"+o].clear()},e.prototype.refresh=function(){this.load()},e.end(),e.end=function(){var t,e;r.end.call(this),this.prototype.__sets=function(){var n,o;n=this.prototype.__props,o=[];for(t in n)e=n[t],"set"===e.type&&o.push(t);return o}.call(this)},e}(r)},{"./DSObject":62,"./util":68}],54:[function(t,e,n){var o,r,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,i=t("./DSDocument"),o=t("./DSData"),r=t("./DSDigest"),s=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(null!==t&&t.ds_editable||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.name]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var u,d;l(n,e),n.begin("DSDataEditable<"+t.docType+">"),n.propDoc("original",s),n.propDoc("changes",s),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatchB&&this._unwatchB(),"function"==typeof this._unwatch1&&this._unwatch1(),"function"==typeof this._unwatch2&&this._unwatch2()}),n.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1,"function"==typeof this._unwatch2&&this._unwatch2(),delete this._unwatch2},n.$u=u={};for(d in t.__super__.__props)u[d]=!0;return n.prototype.init=function(e,n,o){var l,d,p,f,h,m,g,y;if(a){if(n instanceof s||c.invalidArg("changes"),e instanceof s||c.invalidArg("original"),"function"!=typeof o&&"undefined"!=typeof o&&c.invalidArg("filter"),e.type.ds_editable)throw new Error("'original' expected to have non DSDocument.Editable items");if(t!==n.type)throw new Error("'itemType' and 'changes' must have same DSDocument.Editable type");if(e.type.Editable!==n.type)throw new Error("'original' and 'changes' must base on same DSDocument type");if(!n.hasOwnProperty("$ds_pool"))throw new Error("'changes' must be set instantiated as a field of DSChanges object")}this.set("original",e),this.set("changes",n),f=this.get("itemsSet"),p=f.items,d=n.$ds_pool,m=e.items,l=n.items,h=function(t){return function(){var i,s,c,h,g;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null,"function"==typeof t._unwatch2&&t._unwatch2(),t._unwatch2=null,h=function(t){if(a&&!d.items.hasOwnProperty(t.$ds_key))throw new Error("Missing editable item");return d.items[t.$ds_key]},c=function(e){var o;return(o=d.find(t,e.$ds_key)).init&&(o.init(e,n),o.$u=u),o},o?(_.forEach(m,function(e){var n;l.hasOwnProperty(n=e.$ds_key)||f.add(t,c(e))}),_.forEach(l,function(e){o.call(t,e)&&f.add(t,e.addRef(t))}),g=function(t){if(a&&!l.hasOwnProperty(t))throw new Error("Missing edtItem");i(l[t])},i=function(e){o.call(t,e)?p.hasOwnProperty(e.$ds_key)||f.add(t,e.addRef(t)):p.hasOwnProperty(e.$ds_key)&&f.remove(e)},s=function(t){return!!l.hasOwnProperty(t.$ds_key)&&(i(h(t)),!0)},t._unwatch1=e.watch(t,{add:function(e){s(e)||f.add(t,c(e))},remove:function(e){s(e)||(f.remove(h(e)),r.forget(t.$ds_key,e.$ds_key))}}),t._unwatch2=n.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,g)},change:function(e){r.render(t.$ds_key,e.$ds_key,g)},remove:function(e){i.call(t,e),r.forget(t.$ds_key,e.$ds_key)}})):(_.forEach(m,function(e){f.add(t,c(e))}),t._unwatch1=e.watch(t,{add:function(e){f.add(t,c(e))},remove:function(t){f.remove(h(t))}})),t._endLoad(!0)}}(this),g=[e,n],y=function(t){return function(e,n){var o,s,a;if(o=!1,(s=i.integratedStatus(g))!==(a=t.get("status")))switch(s){case"ready":o?(o=!1,t._endLoad(!0)):r.block(h);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(o=!0);break;case"nodata":o?(o=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this),this._unwatchA=e.watchStatus(this,y),this._unwatchB=n.watchStatus(this,y),this.init=null},n.end(),n}(o)}},{"./DSData":53,"./DSDigest":58,"./DSDocument":59,"./DSSet":65,"./util":68}],55:[function(t,e,n){var o,r,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;a=t("./util").assert,c=t("./util").error,i=t("./DSObject"),o=t("./DSData"),r=t("./DSDigest"),s=t("./DSSet"),u={},e.exports=function(t){var e,n;return a&&(i.isAssignableFrom(t)||c.invalidArg("itemType")),u.hasOwnProperty(t.docType)&&(n=u[t.docType]).itemType===t?n:u[t.docType]=e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var i,u;l(n,e),n.begin("DSDataFiltered<"+t.docType+">"),n.propDoc("original",s),n.propSet("items",n.itemType=t),n.ds_dstr.push(function(){"function"==typeof this._unwatchA&&this._unwatchA(),"function"==typeof this._unwatch1&&this._unwatch1()}),n.prototype.clear=function(){o.prototype.clear.call(this),"function"==typeof this._unwatch1&&this._unwatch1(),delete this._unwatch1},n.$u=i={};for(u in t.__super__.__props)i[u]=!0;return n.prototype.init=function(e,n){var o,i,u,l;if(a&&(e instanceof s||c.invalidArg("original"),"function"!=typeof n&&c.invalidArg("filter"),t!==e.type))throw new Error("'itemType' and 'original' must have same DSObject type");this.set("original",e),i=this.get("itemsSet"),o=i.items,l=e.items,u=function(t){return function(){var s,a,u;t._startLoad(),"function"==typeof t._unwatch1&&t._unwatch1(),t._unwatch1=null;for(a in l)s=l[a],n(s)&&(s.addRef(t),i.add(t,s));u=function(e){o.hasOwnProperty(e)?n(s=l[e])||i.remove(s):n(s=l[e])&&(s.addRef(t),i.add(t,s))},t._unwatch1=e.watch(t,{add:function(e){r.render(t.$ds_key,e.$ds_key,u)},change:function(e){r.render(t.$ds_key,e.$ds_key,u)},remove:function(e){i.remove(e),r.forget(t.$ds_key,e.$ds_key)}}),t._endLoad(!0)}}(this),this._unwatchA=e.watchStatus(this,function(t){return function(n,o){var i,s,a;if(i=!1,(s=e.get("status"))!==(a=t.get("status")))switch(s){case"ready":i?(i=!1,t._endLoad(!0)):r.block(u);break;case"load":t._startLoad();break;case"update":t._startLoad()&&(i=!0);break;case"nodata":i?(i=!1,t._endLoad(!1)):t.set("status","nodata")}}}(this)),this.init=null},n.end(),n}(o)}},{"./DSData":53,"./DSDigest":58,"./DSObject":62,"./DSSet":65,"./util":68}],56:[function(t,e,n){var o,r,i,s,a,u=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,r=t("./DSObject"),i=t("./DSPool"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return u(e,t),e.begin("DSDataService"),e.prototype.findDataSet=function(t,e){s&&("object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"==typeof e&&null!==e&&e.hasOwnProperty("type")||a.invalidArg("params"),e.hasOwnProperty("mode")&&["original","edited","changes"].indexOf(e.mode)>=0||a.invalidArg("params.mode"))},e.prototype.requestSources=function(t,e,n){var o,i,u,c;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"object"!=typeof e&&a.invalidArg("params"),"object"==typeof n&&null!==n||a.invalidArg("sources");for(o in n){u=n[o],"object"==typeof u&&null!==u||a.invalidArg("sources");for(i in u)switch(c=u[i],i){case"name":break;case"type":!c instanceof r&&a.invalidArg("sources");break;case"set":!c instanceof r&&a.invalidArg("sources");break;case"params":"object"==typeof c&&null!==c||a.invalidArg("sources");break;case"watch":break;case"unwatch":break;case"unwatchStatus":break;case"listener":break;case"index":break;default:a.invalidArg("sources")}}}},e.end(),e}(r)},{"./DSObject":62,"./DSPool":64,"./util":68}],57:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;e.exports=(c=angular.module("dscommon/DSDataSource",[])).name,l=t("./util").serviceOwner,u=t("./util").modeReleaseDataOnReload,i=t("./util").assert,a=t("./util").error,s=t("../utils/base64"),r=t("./DSObject"),o=t("./DSDigest"),c.factory("DSDataSource",["config","$rootScope","$q","$http",function(t,e,n,u){var c;return c=function(n){function c(){return l.apply(this,arguments)}var l;return d(c,n),c.begin("DSDataSource"),c.addDataSource(),c.setLoadAndRefresh=function(t){var e;return this.set("source",e=t.get("dataSource")),e.watchStatus(this,function(t){return function(e,n,r){switch(n){case"ready":o.block(function(){return t.load()});break;case"nodata":t.set("status","nodata")}}}(this))},l=function(n,o){r.call(this,n,o),this.cancelDefers=[],this._lastRefresh=null,this._refreshTimer=null,e.$watch(function(){return t.refreshPeriod},function(t){return function(e){t._setNextRefresh()}}(this))},c.prototype.setConnection=function(t,e){var n,o,r,u;if(i&&(null===t||"string"==typeof t&&t.length>0||a.invalidArg("url"),"undefined"==typeof e||null===e||"string"==typeof e&&e.length>0||a.invalidArg("token")),t&&("undefined"==typeof e||e)){if(this.url!==t||this.token!==e){for(u=this.cancelDefers,o=0,r=u.length;o<r;o++)n=u[o],n.resolve();this.cancelDefers.length=0,this.set("status","nodata"),this.url=t,this.authHeader=e?"Basic "+s.encode(e):null,this.set("status","ready")}}else this.set("status","nodata")},c.prototype._setNextRefresh=function(){var e,n,o;null!==this._refreshTimer&&clearTimeout(this._refreshTimer),null!==t.refreshPeriod&&(o=null===this._lastRefresh?0:(n=this._lastRefresh.add(t.refreshPeriod,"minutes"),e=moment(),n>=e?n-e:0),this._refreshTimer=setTimeout(function(t){return function(){t.refresh()}}(this),o))},c.prototype.refresh=function(){this._lastRefresh=moment(),this._setNextRefresh(),"ready"===this.get("status")&&(this.set("status","update"),this.set("status","ready"))},c.prototype.httpGet=function(t,e){var n,o;return this.cancelDefers.push(e),o=function(t){return function(n){return _.remove(t.cancelDefers,e),n}}(this),n={timeout:e.promise},this.authHeader&&(n.headers={Authorization:this.authHeader}),u.get(""+this.url+t,n).then(o,o)},c.prototype.httpPost=function(t,e,n){var o,r;return this.cancelDefers.push(n),r=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),o={timeout:n.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),u.post(""+this.url+t,e,o).then(r,r)},c.prototype.httpPut=function(t,e,n){var o,r;return this.cancelDefers.push(n),r=function(t){return function(e){return _.remove(t.cancelDefers,n),e}}(this),o={timeout:n.promise},this.authHeader&&(o.headers={Authorization:this.authHeader}),u.put(""+this.url+t,e,o).then(r,r)},c.end(),c}(r)}])},{"../utils/base64":70,"./DSDigest":58,"./DSObject":62,"./util":68}],58:[function(t,e,n){var o,r,i;r=t("./util").assert,i=t("./util").error,e.exports=o=function(){function t(){}var e,n,o,s;return n=0,e=0,o={},s=function(){var t,n,r,i,a,u,c;i=!0;for(a in o){i=!1;break}if(!i){e++,c=o,o={};for(t in c){n=c[t];for(u in n)(r=n[u])(u)}e--,s()}},t.block=function(t){e++;try{return t()}finally{0===--e&&s()}},t.render=function(t,n,s){var a;r&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||i.invalidArg("key"),"function"!=typeof s&&i.invalidArg("func")),0===e?s(n):(a=o.hasOwnProperty(t)?o[t]:o[t]={},a[n]=s)},t.forget=function(t,n){var s;r&&("string"==typeof t&&t.length>0||i.invalidArg("dataDataKey"),"string"==typeof n&&n.length>0||i.invalidArg("key")),0!==e&&o.hasOwnProperty(t)&&(s=o[t],delete s[n])},t}()},{"./util":68}],59:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;a=t("./util").assert,u=t("./util").error,c=t("../app/features").history,l=t("./util").traceRefs,i=t("./DSObjectBase"),r=t("./DSObject"),s=t("./DSSet"),e.exports=o=function(t){function e(t,n){if(e.__super__.constructor.call(this,t,n),a&&this.__proto__.constructor===e)throw new Error("Cannot instantiate DSDocument directly")}return d(e,t),e.begin("DSDocument"),e.propPool=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propSet=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.propList=function(t,e){throw new Error("This property type is not supported in DSDocument")},e.end(),e.end=function(){var t,e;r.end.call(this),e=this,this.Editable=t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var o,p,f,h,m,g,y;d(n,t),n.begin(e.docType+".Editable"),delete n.prototype.$ds_docType,n.ds_editable=!0,o=null,m=n.__super__.__init;for(p in m)y=m[p],e.prototype.__props[p.substr(1)].calc&&((o||(o={}))[p]=y);n.prototype.__init=o,n.ds_dstr.push(function(){var t,e,n,o;if(a&&(_.find(this.$ds_doc.$ds_evt,function(t){return function(e){return e===t}}(this))||console.error("Not an event listener")),_.remove(this.$ds_doc.$ds_evt,this),this.$ds_doc.release(this),t=this.__change)for(n in t)e=t[n],(o=e.s)instanceof i&&o.release(this),(y=e.v)instanceof i&&y.release(this)}),n.prototype.init=function(t,n,o){var r,c,d,p,f,h,m,g,y,v;if(a&&(null!==t&&t.__proto__.constructor===e||u.invalidArg("serverDoc"),null!==n&&n instanceof s||u.invalidArg("changesSet"),2!==arguments.length&&"object"!=typeof o&&u.invalidArg("changes")),(this.$ds_doc=t).addRef(this),this.$ds_chg=n,this.__change=o){m=!1;for(y in o)g=o[y],this.__props[y].equal(t.get(y),g.v)?delete o[y]:m=!0;if(m){if(l){h=[];for(y in o)r=o[y],r.v instanceof i&&h.push(r.v),r.s instanceof i&&h.push(r.s);for(c=0,f=h.length;c<f;c++)p=h[c],v=p.$ds_referries,0===v.length?console.error(i.desc(p)+": Empty $ds_referries"):(d=v.lastIndexOf(owner))<0?(console.error(i.desc(this)+": Referry not found: "+i.desc(owner)),totalReleaseVerb):(totalReleaseVerb&&(console.info(++util.serviceOwner.msgCount+": transfer: "+i.desc(p)+", refs: "+this.$ds_ref+", from: "+i.desc(owner)+", to: "+i.desc(this)),util.serviceOwner.msgCount===window.totalBreak),v[d]=this)}this.addRef(this),n.add(this,this)}else delete this.__change}t.hasOwnProperty("$ds_evt")?(a&&_.find(t.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),t.$ds_evt.push(this)):t.$ds_evt=[this],this.init=null},n.prototype.__onChange=function(t,e,n,o){var r,s,a,u,l,d,p,f,h,m,g,y;if((f=t.__props[e]).common){if(this.$ds_evt)for(h=this.$ds_evt,a=h.length-1;a>=0;a+=-1)p=h[a],p.__onChange.call(p,this,e,n,o)}else if((r=this.__change)&&r.hasOwnProperty(e)){if(f.equal(y=(f=r[e]).v,n)){for(0===c&&this.$ds_chg.$ds_hist.setSameAsServer(this,e),(g=f.s)instanceof i&&g.release(this),y instanceof i&&y.release(this),delete r[e],s=!0,u=0,d=r.length;u<d;u++)if(e=r[u],"__error"!==e&&"__refreshView"!==e){s=!1;break}s&&(delete this.__change,this.$ds_chg.remove(this))}}else if(this.$ds_evt)for(m=this.$ds_evt,l=m.length-1;l>=0;l+=-1)p=m[l],p.__onChange.call(p,this,e,n,o)},n.prototype._clearChanges=function(){var t,e,n,o,r,s,a;if(t=this.__change){for(r in t){if(o=t[r],0===c&&this.$ds_chg.$ds_hist.setSameAsServer(this,r),this.$ds_evt)for(s=this.$ds_evt,e=s.length-1;e>=0;e+=-1)n=s[e],n.__onChange.call(n,this,r,this.$ds_doc[r],o.v);(a=o.s)instanceof i&&a.release(this),(y=o.v)instanceof i&&y.release(this)}delete this.__change,this.$ds_chg.remove(this)}},h=n.prototype.__props=e.prototype.__props,n.prototype.get=function(t){return a&&(h.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]},n.prototype.set=function(t,e){return a&&(h.hasOwnProperty(t)||u.invalidProp(this,t)),this[t]=e},g=e.prototype.__props;for(p in g)f=g[p],f.calc||!function(t,e,o){var r;return f.common?Object.defineProperty(n.prototype,t,{get:function(){return this.$ds_doc[t]},set:function(e){var n;(n=this.$ds_doc[t])!==e&&(this.$ds_doc[t]=e,this.$ds_chg.$ds_hist.add(this,t,e,n))}}):Object.defineProperty(n.prototype,t,{get:r=function(){var e;return e=this.__change,e&&e.hasOwnProperty(t)?e[t].v:this.$ds_doc[t]},set:function(n){var s,c,l,d,f,h,m,g,_,v,w;if(a&&"undefined"==typeof(n=e(y=n))&&u.invalidValue(this,t,y),!o(m=r.call(this),n)){if(n instanceof i&&n.addRef(this),s=this.__change)if(o(w=this.$ds_doc[t],n)){this.$ds_chg.$ds_hist.add(this,t,void 0,(c=s[t]).v),(y=c.v)instanceof i&&y.release(this),(v=c.s)instanceof i&&v.release(this),delete s[t],l=!0;for(p in s)if("__error"!==p&&"__refreshView"!==p){l=!1;break}if(l){if(this.$ds_evt)for(g=this.$ds_evt,d=g.length-1;d>=0;d+=-1)h=g[d],h.__onChange.call(h,this,t,n,m);return delete this.__change,void this.$ds_chg.remove(this)}}else(c=s[t])?(this.$ds_chg.$ds_hist.add(this,t,n,c.v),(y=c.v)instanceof i&&y.release(this),c.v=n):(w instanceof i&&w.addRef(this),s[t]={v:n,s:w},this.$ds_chg.$ds_hist.add(this,t,n,void 0));else s=this.__change={},m instanceof i&&m.addRef(this),s[t]={v:n,s:m},this.addRef(this),this.$ds_chg.add(this,this),this.$ds_chg.$ds_hist.add(this,t,n,void 0);if(this.$ds_evt)for(_=this.$ds_evt,f=_.length-1;f>=0;f+=-1)h=_[f],h.__onChange.call(h,this,t,n,m)}}})}(f.name,f.valid,f.equal);return r.end.call(n),n}(e)},e}(r)},{"../app/features":15,"./DSObject":62,"./DSObjectBase":63,"./DSSet":65,"./util":68}],60:[function(t,e,n){var o,r,i,s,a,u,c,l,d=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;u=t("./util").assert,c=t("./util").error,l=t("../app/features").history,a=t("./DSObjectBase"),s=t("./DSObject"),o=t("./DSDigest"),r=t("./DSDocument"),e.exports=i=function(t){function e(){return l.apply(this,arguments)}var n,r,i,l,p,f;return d(e,t),e.begin("DSHistory"),e.ds_dstr.push(function(){n.call(this)}),l=function(t,e){s.call(this,t,e),this.hist=[],this.histTop=0},n=function(){var t,e,n,o,r;for(o=this.hist,e=0,n=o.length;e<n;e++)t=o[e],t.i.release(this),"object"==typeof(r=t.o)&&r instanceof a&&r.release(this),"object"==typeof(r=t.n)&&r instanceof a&&r.release(this);this.hist=[],this.histTop=0},f=!1,i=null,r=0,e.prototype.startBlock=function(){i=++r},e.prototype.endBlock=function(){i=null},e.prototype.startReset=function(){f=!0,n.call(this)},e.prototype.endReset=function(){f=!1},e.prototype.add=function(t,e,n,o){var r,s,l,d,p,h,m;if(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop"),0<=["string","number","boolean","object","undefined"].indexOf(typeof n)||c.invalidArg("newVal"),0<=["string","number","boolean","object","undefined"].indexOf(typeof o)||c.invalidArg("oldVal")),!f){if((s=this.hist).length>this.histTop){for(h=s.slice(this.histTop),l=0,d=h.length;l<d;l++)r=h[l],r.i.release(this),"object"==typeof(m=r.o)&&m instanceof a&&m.release(this),"object"==typeof(m=r.n)&&m instanceof a&&m.release(this);s.length=this.histTop}t.addRef(this),n instanceof a&&n.addRef(this),o instanceof a&&o.addRef(this),s.push(p={i:t,p:e,n:n,o:o}),i&&(p.b=i),this.histTop=s.length}},e.prototype.setSameAsServer=function(t,e){var n,o,r,i,s;for(u&&(null!==t&&t.__proto__.constructor.ds_editable||c.invalidArg("item"),"string"==typeof e&&e.length>0||c.invalidArg("prop")),i=this.hist.slice(0,this.histTop),o=r=i.length-1;r>=0;o=r+=-1)if(n=i[o],n.i===t&&n.p===e){"object"==typeof(s=n.n)&&s instanceof a&&s.release(this),"undefined"==typeof n.o?(t.release(this),this.hist.splice(o,1),this.histTop--):n.n=void 0;break}},e.prototype.hasUndo=function(){return this.histTop>0},e.prototype.undo=function(){var t,e,n,r,i;if((r=this.histTop)>0){f=!0;try{e=(n=this.hist)[this.histTop=--r],"number"!=typeof(t=e.b)||0===r||n[r-1].b!==t?"undefined"==typeof(i=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i):o.block(function(o){return function(){for(;;){if("undefined"==typeof(i=e.o)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,i),0===r||(e=n[r-1]).b!==t)break;o.histTop=--r}}}(this))}finally{f=!1}}},e.prototype.hasRedo=p=function(){return this.histTop<this.hist.length},e.prototype.redo=function(){var t,e,n,r,i,s;if(f=!0,(r=this.histTop)<(i=(n=this.hist).length)){f=!0;try{e=n[r],this.histTop=++r,"number"!=typeof(t=e.b)||r===i||n[r].b!==t?"undefined"==typeof(s=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s):o.block(function(o){return function(){for(;;){if("undefined"==typeof(s=e.n)?e.i.set(e.p,e.i.$ds_doc[e.p]):e.i.set(e.p,s),r===i||(e=n[r]).b!==t)break;o.histTop=++r}}}(this))}finally{f=!1}}},e.end(),e}(s)},{"../app/features":15,"./DSDigest":58,"./DSDocument":59,"./DSObject":62,"./DSObjectBase":63,"./util":68}],61:[function(t,e,n){var o,r,i,s,a,u,c,l=function(t,e){function n(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;c=t("./util"),i=t("./util").assert,u=t("./util").traceRefs,a=t("./util").totalReleaseVerb,s=t("./util").error,r=t("./DSObjectBase"),e.exports=o=function(t){function e(){return n.apply(this,arguments)}var n;return l(e,t),e.begin("DSList"),n=function(t,e,n){r.call(this,t,e),i&&!n instanceof r&&s.notDSObjectClass(n),this.type=n,this.items=[]},e.ds_dstr.push(function(){var t,e,n,o;for(n=this.items,t=0,e=n.length;t<e;t++)o=n[t],o.release(this)}),e.prototype.merge=function(t,e){var n,o,l,d,p,f,h,m,g,y;for(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),_.isArray(e)||s.invalidArg("newList")),d=this.items,y=this.type,p=0,h=d.length;p<h;p++)l=d[p],l.release(this);for(d.length=0,n=f=0,m=e.length;f<m;n=++f)l=e[n],!l instanceof y&&s.invalidListValue(this,n,l),u&&(g=l.$ds_referries,0===g.length?console.error(r.desc(DSDitem)+": Empty $ds_referries"):(o=g.lastIndexOf(t))<0?console.error(r.desc(this)+": Referry not found: "+r.desc(t)):(a&&(console.info(++c.serviceOwner.msgCount+": transfer: "+r.desc(l)+", refs: "+this.$ds_ref+", from: "+r.desc(t)+", to: "+r.desc(this)),c.serviceOwner.msgCount===window.totalBreak),g[o]=this)),d.push(l);return d},e.end(),e}(r)},{"./DSObjectBase":63,"./util":68}],62:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=t("./util").assert,l=t("./util").serviceOwner,d=t("./util").totalRelease,l=t("./util").serviceOwner,c=t("./util").error,i=t("./DSObjectBase"),a=t("./DSSet"),o=t("./DSList"),s=t("./DSPool"),e.exports=r=function(t){function e(){return n.apply(this,arguments)}var n;return p(e,t),e.desc=i.desc=function(t){return t.hasOwnProperty("$ds_key")?t instanceof a||t instanceof o||t instanceof s?d?t.$ds_key+"("+t.$ds_globalId+")":t.$ds_key:d?t.$ds_key+":"+t.__proto__.constructor.docType+"("+t.$ds_globalId+")":t.$ds_key+":"+t.__proto__.constructor.docType:t===l?"util.serviceOwner":"function"==typeof t?t.docType:t.$evalAsync&&t.$watch?"$scope{$id: "+t.$id+"}":JSON.stringify(t)},n=function(t,e){if(i.call(this,t,e),u&&this.__proto__.constructor===i)throw new Error("Cannot instantiate DSObjectBsse directly")},e.addPool=function(t){d?Object.defineProperty(this,"pool",{get:function(e){return function(){return e.hasOwnProperty("__pool")||(e.__pool=new s(l,e.docType+".pool",e,t),l.clearPool(function(){e.__pool.release(l),delete e.__pool})),e.__pool}}(this)}):this.pool=new s(l,this.docType+".pool",this,t)},e.propPool=function(t,e,n){var o,r;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),o="_"+t,this.ds_dstr.push(function(){this[o].release(this),delete this[o]}),(r=this.prop({name:t,type:"pool",init:function(){return new s(this,this.$ds_key+"."+t+":pool<"+e.docType+">",e,n)},readonly:!0})).itemType=e,r},e.propSet=function(t,e){var n,o;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(o=this.prop({name:t,type:"set",init:function(){return new a(this,this.$ds_key+"."+t+":set<"+e.docType+">",e,this)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"Status",type:"calc",func:function(){return this[n].get("status")}}),this.prop({name:t+"Set",type:"calc",func:function(){return this[n]}}),o},e.propList=function(t,e){var n,r;return u&&(i.isAssignableFrom(e)||c.invalidArg("itemType")),n="_"+t,this.ds_dstr.push(function(){this[n].release(this)}),(r=this.prop({name:t,type:"list",init:function(){return new o(this,this.$ds_key+"."+t+":list<"+e.docType+">",e)},get:function(){return this[n].items},set:function(e){throw new Error("Use "+t+"Set.merge() instead")},readonly:!0})).itemType=e,this.prop({name:t+"List",type:"calc",func:function(){return this[n]}}),r},e}(i)},{"./DSList":61,"./DSObjectBase":63,"./DSPool":64,"./DSSet":65,"./util":68}],63:[function(t,e,n){var o,r,i,s,a,u,c,l,d;d=t("./util"),r=t("./util").assert,c=t("./util").traceData,s=t("./util").serviceOwner,l=t("./util").traceRefs,a=t("./util").totalRelease,u=t("./util").totalReleaseVerb,i=t("./util").error,e.exports=o=function(){function t(){return e.apply(this,arguments)}var e,n,o,s,p,f,h;return t.isAssignableFrom=function(t){var e;if("function"!=typeof t&&i.invalidArg("clazz"),(e=t)===this)return!0;for(;;){if(!e.hasOwnProperty("__super__"))return!1;if(e=e.__super__.constructor,e===this)return!0}},a&&(h=n=null,(window.totalReleaseReset=function(){n=0,window.totalPool=h={},d.serviceOwner.start(),d.serviceOwner.msgCount=0})(),window.totalRelease=function(){return d.serviceOwner.stop(),h}),e=function(e,o){var s,c,p;if(r){if(this.__proto__.constructor===t)throw new Error("Cannot instantiate DSObjectBаse directly");"object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry"),"string"!=typeof o&&i.invalidArg("key")}if(this.$ds_key=o,this.$ds_ref=1,a&&(h[this.$ds_globalId=++n]=this,u&&(console.info(++d.serviceOwner.msgCount+": ctor: "+t.desc(this)+", refs: 1, ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak)),l&&(this.$ds_referries=[e]),s=this.__proto__.__init)for(c in s)p=s[c],this[c]="function"==typeof p?p.call(this):p;this.__proto__._init.call(this)},t.prototype.addRef=function(e){if(r&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),
0===this.$ds_ref)throw new Error("addRef() on already fully released object");return l&&this.$ds_referries.push(e),this.$ds_ref++,u&&(console.info(++d.serviceOwner.msgCount+":addRef: "+t.desc(this)+", refs: "+this.$ds_ref+", ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak),this},t.prototype.release=function(e){var n,o;if(r&&("object"==typeof e&&e!==window||"function"==typeof e||i.invalidArg("referry")),u&&(console.info(++d.serviceOwner.msgCount+": release: "+t.desc(this)+", refs: "+(this.$ds_ref-1)+", ref: "+t.desc(e)),d.serviceOwner.msgCount===window.totalBreak),0===this.$ds_ref)throw new Error("release() on already fully released object");if(l&&((n=this.$ds_referries.indexOf(e))<0?console.error(t.desc(this)+": Referry not found: "+t.desc(e)):this.$ds_referries.splice(n,1)),0===--this.$ds_ref&&(this.hasOwnProperty("$ds_pool")&&((o=this.$ds_pool).watchOn&&(r&&(_.find(this.$ds_evt,function(t){return function(t){return t===o}}(this))||console.error("Not an event listener")),_.remove(this.$ds_evt,o)),delete this.$ds_pool.items[this.$ds_key]),this.__proto__._dstr.call(this),a)){if(!this.hasOwnProperty("$ds_globalId"))throw new Error("Missing $ds_globalId, which means that something really wrong is going on");if(!h.hasOwnProperty(this.$ds_globalId))throw new Error(t.desc(this)+": Object already not in the totalPool");delete h[this.$ds_globalId]}return this},t.prototype.toString=function(){return this.__proto__.$ds_docType+":"+this.$ds_key+("object"==typeof this.$ds_pool?"@"+this.$ds_pool:"")},t.prototype.writeMap=function(){var t,e,n,o;o={},n=this.__proto__.__props;for(e in n)t=n[e],t.write&&(o[e]=t.write(this["_"+e]));return o},t.prototype.readMap=function(e){var n,o,r,i,s;r=this.__proto__.__props;for(o in e)s=e[o],r.hasOwnProperty(o)&&(n=r[o]).read?(this[o]=i=n.read.call(this,s),i instanceof t&&i.release(this)):console.error("Unexpected property "+o)},t.begin=function(t){var e;r&&"string"!=typeof t&&i.invalidArg("name"),e=this,this.prototype.$ds_docType=this.docType=t,this.ds_ctor=this.__super__.constructor.hasOwnProperty("ds_ctor")?_.clone(this.__super__.constructor.ds_ctor):[],this.ds_dstr=this.__super__.constructor.hasOwnProperty("ds_dstr")?_.clone(this.__super__.constructor.ds_dstr):[]},t.end=function(){var t,e;0===this.ds_ctor.length?this.prototype._init=_.noop:(t=this.ds_ctor,this.prototype._init=function(){var e,n,o;for(n=0,o=t.length;n<o;n++)e=t[n],e.call(this)}),0===this.ds_dstr.length?this.prototype._dstr=_.noop:(e=this.ds_dstr,this.prototype._dstr=function(){var t,n;for(n=e.length-1;n>=0;n+=-1)t=e[n],t.call(this)})},t.prop=function(t){var e,n,o,s,a,u,c,l,d,p;if(r){if("object"!=typeof t&&i.invalidArg("opts"),!t.hasOwnProperty("name"))throw new Error("Missing opts.name");if(!("string"==typeof t.name&&t.name.length>0))throw new Error("Invalid value of opts.name");if(!t.hasOwnProperty("type"))throw new Error("Missing opts.type");if(!("string"==typeof t.type&&t.type.length>0||"function"==typeof t.type))throw new Error("Invalid value of opts.type");if(t.hasOwnProperty("readonly")&&"boolean"!=typeof t.readonly)throw new Error("Invalid value of opts.readonly");if("undefined"!=typeof t.calc&&"boolean"!=typeof t.calc)throw new Error("Invalid value of opts.calc");if("undefined"!=typeof t.common&&"boolean"!=typeof t.common)throw new Error("Invalid value of opts.common");if(t.hasOwnProperty("func")&&"function"!=typeof t.func)throw new Error("Invalid value of opts.func");if(t.hasOwnProperty("value")&&"function"==typeof t.value)throw new Error("Invalid value of opts.value");if(t.hasOwnProperty("init")&&!t.readonly&&!t.calc&&!t.hasOwnProperty("valid"))throw new Error("Missing opts.valid");if(t.hasOwnProperty("valid")&&(t.readonly||!t.hasOwnProperty("init")))throw new Error("Unexpected opts.valid");if(t.hasOwnProperty("valid")&&void 0===t.valid("function"==typeof(o=t.init)?o():o))throw new Error("Invalid init value: "+t.init);if(t.hasOwnProperty("valid")&&"function"!=typeof t.valid)throw new Error("Invalid value of opts.valid");if(t.hasOwnProperty("write")&&t.write&&"function"!=typeof t.write)throw new Error("Invalid value of opts.write");if(t.hasOwnProperty("read")&&t.read&&"function"!=typeof t.read)throw new Error("Invalid value of opts.read");if(t.hasOwnProperty("equal")&&"function"!=typeof t.equal)throw new Error("Invalid value of opts.equal");if(t.hasOwnProperty("str")&&"function"!=typeof t.str)throw new Error("Invalid value of opts.str");if(t.hasOwnProperty("get")&&"function"!=typeof t.get)throw new Error("Invalid value of opts.get");if(t.hasOwnProperty("set")&&"function"!=typeof t.set)throw new Error("Invalid value of opts.set");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("calc")&&t.calc)throw new Error("Ambiguous opts.readonly and opts.calc");if(t.hasOwnProperty("readonly")&&!t.readonly&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.readonly and opts.common");if(t.hasOwnProperty("calc")&&t.calc&&t.hasOwnProperty("common")&&t.common)throw new Error("Ambiguous opts.calc and opts.common")}if(this.prototype.hasOwnProperty("__init")?r&&this.prototype.__props.hasOwnProperty(t.name)&&i.duplicatedProperty(this,t.name):(this.prototype.__init=(l=this.__super__.__init)?_.clone(l):{},c=this.prototype.__props=(d=this.__super__.__props)?_.clone(d):{},this.prototype.get=function(t){return r&&(c.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]},this.prototype.set=function(t,e){return r&&(c.hasOwnProperty(t)||i.invalidProp(this,t)),this[t]=e}),u=this.prototype.__props[t.name]={name:t.name,type:t.type,write:t.write||(t.hasOwnProperty("write")&&!t.write||t.calc||t.common?null:function(t){return null===t?null:t.valueOf()}),read:t.read||(t.hasOwnProperty("read")&&!t.read||t.calc||t.common?null:function(t){return t}),equal:e=t.equal||function(t,e){return(null!=t?t.valueOf():void 0)===(null!=e?e.valueOf():void 0)},str:t.str||function(t){return null===t?"":t.toString()},readonly:t.readonly||!1,calc:t.calc||!1,common:t.common||!1},t.hasOwnProperty("init"))p=u.valid=t.valid,u.init=this.prototype.__init[s="_"+(a=t.name)]=t.init,t.calc&&(t.readonly===!0,this.prototype["__setCalc"+(a.substr(0,1).toUpperCase()+a.substr(1))]=function(t){var n,o,r,u,c;if("undefined"==typeof(t=p(c=t))&&i.invalidValue(this,a,c),!e(u=this[s],t)&&(this[s]=t,n=this.$ds_evt))for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,a,t,u)}),Object.defineProperty(this.prototype,a,{get:t.get||function(){return this[s]},set:t.set||(t.readonly?function(t){i.propIsReadOnly(this,a)}:function(t){var n,o,r,u,c;if("undefined"==typeof(t=p(c=t))&&i.invalidValue(this,a,c),!e(u=this[s],t)&&(this[s]=t,n=this.$ds_evt))for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,a,t,u)})});else if(t.hasOwnProperty("value"))u.value=t.value,u.readonly=!0,Object.defineProperty(this.prototype,t.name,{value:t.value});else{if(!t.hasOwnProperty("func"))throw new Error("Missing get value");u.func=n=t.func,u.readonly=!0,Object.defineProperty(this.prototype,a=t.name,{get:t.get||function(){return n.call(this)},set:t.set||function(t){i.propIsReadOnly(this,a)}})}return u},t.propSimple=function(t,e,n){var o,s;return r&&("number"!==t&&"boolean"!==t&&"string"!==t&&"object"!==t&&i.invalidArg("type"),"string"!=typeof e&&i.invalidArg("name")),s=(o=s)?function(e){return null!==e&&typeof e!==t||void 0===(e=o(e))?void 0:e}:function(e){return null===e||typeof e===t?e:void 0},this.prop(_.assign({name:e,type:t,init:"undefined"==typeof init||null===init?null:"function"==typeof init||"object"!==t?init:function(){return _.clone(init)},valid:s,write:n&&(n.calc||n.common)?null:function(t){return t},read:function(t){return t},equal:function(t,e){return t===e},str:function(t){return null===t?"":t.toString()}},n))},t.propNum=function(t,e){this.propSimple("number",t,e)},t.propBool=function(t,e){return this.propSimple("boolean",t,e)},t.propStr=function(t,e){return this.propSimple("string",t,e)},t.propObj=function(t,e){return this.propSimple("object",t,e)},t.propDoc=function(e,n,o){var s,a,u;return r&&(u&&"function"!=typeof u&&i.invalidArg("valid"),"function"!=typeof n&&i.invalidArg("type"),!n instanceof t&&i.notDSObjectClass(n)),u=(a=u)?function(t){return(null===t||t instanceof n)&&void 0!==(t=a(t))?t:void 0}:function(t){return null===t||t instanceof n?t:void 0},s="_"+e,this.ds_dstr.push(function(){this[s]&&this[s].release(this)}),this.prop(_.assign({name:e,type:n,init:null,valid:u,write:o&&(o.calc||o.common)?null:function(t){return null!==t?t.$ds_key:null},read:function(t){return null},equal:function(t,e){return t===e},str:"function"==typeof n.str?n.str:function(t){return null===t?"":t.$ds_key},set:function(t){var n,o,r,a,c;if("undefined"==typeof(t=u(c=t))&&i.invalidValue(this,e,c),(a=this[s])!==t){if(this[s]=t,t&&t.addRef(this),n=this.$ds_evt)for(o=n.length-1;o>=0;o+=-1)r=n[o],r.__onChange.call(r,this,e,t,a);a&&a.release(this)}}},o))},t.propCalc=function(t,e,n){return r&&(e&&"function"==typeof e||i.invalidArg("func")),this.prop(_.assign({name:t,type:"calc",func:e},n))},t.propConst=function(t,e,n){return r&&"undefined"==typeof e&&i.invalidArg("value"),this.prop(_.assign({name:t,type:"const",value:e},n))},t.propEnum=function(t,e,n){var o,s,a,u,c,l;if(r)for(_.isArray(e)&&0!==e.length||i.invalidArg("values"),o=0,s=e.length;o<s;o++)c=e[o];return l=(u=l)?function(t){return(null===t||e.indexOf(t)>=0)&&u(t)?t:void 0}:function(t){return null===t||e.indexOf(t)>=0?t:void 0},a="_"+t,this.prop(_.assign({name:t,type:"enum",init:e[0],valid:l,set:function(e){var n,o,r,s,u;if("undefined"==typeof(e=l(u=e))&&i.invalidValue(this,t,u),(r=this[a])!==e&&(this[a]=e,this.$ds_evt))for(s=this.$ds_evt,n=s.length-1;n>=0;n+=-1)o=s[n],o.__onChange.call(o,this,t,e,r)}},n))},t.propMoment=function(t,e,n){var o;return r&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(o=e)?function(t){return(null===t||"object"==typeof t&&moment.isMoment(t))&&o(t)?t:void 0}:function(t){return null===t||moment.isMoment(t)?t:void 0},this.prop(_.assign({name:t,type:"moment",valid:e,read:function(t){return null!==t?moment(t):null},init:null},n))},t.propDuration=function(t,e,n){var o;return r&&e&&"function"!=typeof e&&i.invalidArg("valid"),e=(o=e)?function(t){return(null===t||"object"==typeof t&&moment.isDuration(t))&&o(t)?t:void 0}:function(t){return null===t||moment.isDuration(t)?t:void 0},this.prop(_.assign({name:t,type:"duration",valid:e,read:function(t){return null!==t?moment.duration(t):null},init:null},n))},t.onAnyPropChange=function(t){r&&"function"!=typeof t&&i.invalidArg("listener"),this.ds_ctor.push(function(){var e;e={__onChange:function(e){return function(){t.apply(e,arguments)}}(this)},this.hasOwnProperty("$ds_evt")?this.$ds_evt.push(e):this.$ds_evt=[e]})},f=["nodata","load","update","ready"],p=["ready","update","nodata","load"],t.integratedStatus=function(t){var e,n,o,s,a;for(r&&(_.isArray(t)&&_.some(t,function(t){return t.__proto__.constructor.ds_dataSource})||i.invalidArg("sources")),o=-1,e=0,n=t.length;e<n;e++)a=t[e],a&&o<(s=p.indexOf(a.get("status")))&&(o=s);return o===-1?"nodata":p[o]},c&&(s=0,o=0),t.addDataSource=function(e){var n,a;if(r){if(this.ds_dataSource)throw new Error("This class already has data source mixin in it");0!==arguments.length&&"function"!=typeof e&&i.invalidArg("onStatusChange")}this.ds_dataSource=!0,c&&(this.ds_ctor.unshift(function(){this.$ds_sourceId=++s,console.info(++o+":ctor: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak}),this.ds_dstr.push(function(){console.info(++o+":dstr: "+t.desc(this)+"("+this.$ds_sourceId+")"),o===window.sourceBreak})),a=function(t){return null===t||f.indexOf(t)>=0?t:void 0},n=this.prop({name:"status",type:"status",valid:a,init:f[0],set:function(n){var r,s,u,l,d;if("undefined"==typeof(n=a(d=n))&&i.invalidValue(this,"status",d),(u=this._status)!==n)for(c&&(console.info(++o+":newStatus: "+t.desc(this)+"("+this.$ds_sourceId+"), new: "+n+", old: "+u),o===window.sourceBreak),this._status=n,null!=e&&e.call(this,n,u),l=this.$ds_statusWatchers,r=l.length-1;r>=0;r+=-1)s=l[r],s.lst(this,n,u,s.unwatch)}}),n.statusValues=f,this.prototype.__init.$ds_statusWatchers=function(){return[]},this.prototype.watchStatus=function(t,e){var n,o,s,a;return r&&("object"==typeof t&&t!==window||"function"==typeof t||i.invalidArg("referry"),"function"!=typeof e&&i.invalidArg("listener")),(a=this.$ds_statusWatchers).push(s={lst:e}),this.addRef(t),s.unwatch=o=function(e){return function(n){return function(){n||(e.release(t),_.remove(a,s),n=!0)}}}(this)(!1),n=this.get("status"),"update"===n?(e(this,"ready","nodata",o),_.find(a,s)&&e(this,"update","ready",o)):e(this,n,"nodata",o),o}},t}()},{"./util":68}],64:[function(t,e,n){var o,r,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=t("./util").assert,a=t("./util").error,u=t("./util").traceWatch,r=t("./DSObjectBase"),o=t("./DSDigest"),e.exports=i=function(t){function e(){return n.apply(this,arguments)}var n,i;return c(e,t),e.begin("DSPool"),n=function(t,e,n,o){var i;r.call(this,t,e),s&&(r.isAssignableFrom(n)||a.notDSObjectClass(n)),i=this.items={},this.type=n,o&&(this.watchOn=!0,this.evt=[])},i=function(t){var e,n,o,r,i;if((r=this.items).hasOwnProperty(t))for(o=r[t],i=this.evt,n=i.length-1;n>=0;n+=-1)e=i[n],e.lst(o)},e.prototype.__onChange=function(t){this.watchOn&&this.evt.length>0&&o.render(this.$ds_key,t.$ds_key,function(t){return function(e){i.call(t,e)}}(this))},e.prototype.find=function(t,e,n){var o,r;return s&&("string"==typeof e||"object"==typeof e&&null!==e||a.invalidArg("key"),"undefined"==typeof n||"object"==typeof n&&null!==n||a.invalidArg("map")),"object"==typeof e&&(e=JSON.stringify(r=e)),n&&n.hasOwnProperty(e)?n[e]:(this.items.hasOwnProperty(e)?(o=this.items[e]).addRef(t):(o=this.items[e]=new this.type(t,e,r),o.$ds_pool=this,this.evt&&(o.hasOwnProperty("$ds_evt")?(s&&_.find(o.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),o.$ds_evt.push(this)):o.$ds_evt=[this],this.__onChange(o))),n?n[e]=o:o)},e.prototype.enableWatch=function(t){if(s&&!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled");this.watchOn=t},e.prototype.watch=function(t,e){var n,o,i,c,l;if(s){"object"==typeof t&&t!==window||"function"==typeof t||a.invalidArg("owner"),"function"!=typeof e&&a.invalidArg("listener");for(i in e)if(c=e[i],"change"!==i&&"add"!==i&&"remove"!==i)throw new Error("Unexpected event listener: "+i);if(u&&(e.owner=t),!this.evt)throw new Error("Pool '"+r.desc(this)+"' watch functionality is not enabled")}return(o=this.evt).push(l={lst:e}),this.addRef(t),n=!0,function(e){return function(){n&&(n=!1,e.release(t),_.remove(o,l))}}(this)},e.end(),e}(r)},{"./DSDigest":58,"./DSObjectBase":63,"./util":68}],65:[function(t,e,n){var o,r,i,s,a,u,c,l,d,p=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;d=t("./util"),i=t("./util").assert,c=t("./util").traceRefs,l=t("./util").traceWatch,u=t("./util").totalReleaseVerb,a=t("./util").modeReleaseDataOnReload,s=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(){return a.apply(this,arguments)}var n,r,a;return p(e,t),e.begin("DSSet"),e.addDataSource(),e.ds_dstr.push(function(){var t,e,n,o;n=t=this.items;for(e in n)o=n[e],o.release(this),delete t[e]}),a=function(t,e,n,r){o.call(this,t,e),i&&(!n instanceof o&&s.notDSObjectClass(n),"object"!=typeof r&&void 0!==r&&s.invalidArg("data")),this.data=r,this.type=n,this.evt=[],this.items={}},e.prototype.__onChange=function(){var t,e,n,o;for(n=this.evt,e=n.length-1;e>=0;e+=-1)t=n[e],null!=(o=t.change)&&o.apply(t,arguments)},e.prototype.merge=function(t,e){var o,a,u;i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("newMap")),u=this.items;for(a in u)o=u[a],e.hasOwnProperty(a)||r.call(this,o);for(a in e){if(o=e[a],i&&a!==o.$ds_key)throw new Error("Invalid source map.  key: "+a+"; item.$ds_key: "+o.$ds_key);n.call(this,t,o)}return this.items},e.prototype.reset=function(){var t,e,n,o,r;for(t=this.evt,_.forEach(n=this.items,function(e){return function(n){var o,r,i;for(r=0,i=t.length;r<i;r++)o=t[r],"function"==typeof o.remove&&o.remove(n);n.release(e)}}(this)),e=0,r=n.length;e<r;e++)o=n[e],delete n[o]},e.prototype.remove=function(t){this.items.hasOwnProperty(t.$ds_key)&&r.call(this,t)},r=function(t){var e,n,o;for(t.hasOwnProperty("$ds_evt")&&(i&&(_.find(t.$ds_evt,this)||console.error("Not an event listener")),_.remove(t.$ds_evt,this)),delete this.items[t.$ds_key],o=this.evt,n=o.length-1;n>=0;n+=-1)e=o[n],"function"==typeof e.remove&&e.remove(t);t.release(this)},e.prototype.add=n=function(t,e){var n,r,a,l,p,f;if(i&&("object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),e instanceof this.type||s.invalidMapElementType(this,e)),(l=this.items).hasOwnProperty(e.$ds_key))e.release(t);else for(e.hasOwnProperty("$ds_evt")?(i&&_.find(e.$ds_evt,function(t){return function(e){return e===t}}(this))&&console.error("Already a listener"),e.$ds_evt.push(this)):e.$ds_evt=[this],l[e.$ds_key]=e,c&&(f=e.$ds_referries,0===f.length?console.error(o.desc(e)+": Empty $ds_referries"):(a=f.lastIndexOf(t))<0?console.error(o.desc(this)+": Referry not found: "+o.desc(t)):(u&&(console.info(++d.serviceOwner.msgCount+": transfer: "+o.desc(e)+", refs: "+this.$ds_ref+", from: "+o.desc(t)+", to: "+o.desc(this)),d.serviceOwner.msgCount===window.totalBreak),f[a]=this)),p=this.evt,r=p.length-1;r>=0;r+=-1)n=p[r],"function"==typeof n.add&&n.add(e)},e.prototype.clear=function(){this.merge(this,{}),this.set("status","nodata")},e.prototype.watch=function(t,e,n){var o,r,a,u;if(i){"object"==typeof t&&t!==window||"function"==typeof t||s.invalidArg("owner"),"object"!=typeof e&&s.invalidArg("listener");for(a in e)if(u=e[a],"change"!==a&&"add"!==a&&"remove"!==a)throw new Error("Unexpected event listener: "+a);l&&(e.owner=t)}if(_.find(this.evt,function(t){return t===e})&&(e=_.clone(e)),(r=this.evt).push(e),!n)return this.addRef(t),o=!0,function(n){return function(){o&&(o=!1,n.release(t),_.remove(r,function(t){return t===e}))}}(this)},e.prototype.addRef=function(t){var n;return 1===this.$ds_ref&&(n=this.data)&&1===++n.__busySets&&n.addRef(n.__backRef=this),e.__super__.addRef.call(this,t),this},e.prototype.release=function(t){var n;return e.__super__.release.call(this,t),1===this.$ds_ref&&(n=this.data)&&0===--n.__busySets&&n.release(n.__backRef),this},e.end(),e}(o)},{"./DSObjectBase":63,"./util":68}],66:[function(t,e,n){var o,r,i,s,a=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("./util").assert,s=t("./util").error,o=t("./DSObjectBase"),e.exports=r=function(t){function e(t,n){var r,a,u,c,l,d,p,f,h,m;if(e.__super__.constructor.call(this,t,""+ ++e.nextTags),i&&(2===arguments.length&&"object"==typeof(f=arguments[1])||void 0!==n&&"string"!=typeof n&&s.invalidArg("enums")),2===arguments.length&&"object"==typeof(f=arguments[1])){f.__proto__===e.prototype?(this.map=_.clone(f.map),this.value=f.value):(this.map=l=_.clone(n),this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")),d=this.map;for(u in d)m=d[u],m instanceof o&&m.addRef(this)}else{if(this.map=l={},"string"==typeof n)for(p=n.split(","),r=0,c=p.length;r<c;r++)h=p[r],l[h.trim()]=!0;this.value=_.sortBy(function(){var t;t=[];for(a in l)t.push(a);return t}()).join(", ")}}return a(e,t),e.nextTags=0,e.begin("DSTags"),e.addPropType=function(t){t.propDSTags=function(n,o){var r,a;return i&&o&&"function"!=typeof o&&s.invalidArg("valid"),o=(a=o)?function(t){return(null===t||"object"==typeof t&&t instanceof e)&&a(t)?t:void 0}:function(t){return null===t||t instanceof e?t:void 0},r="_"+n,this.ds_dstr.push(function(){this[r]&&this[r].release(this)}),t.prop({name:n,type:"DSTags",valid:o,read:function(t){return null!==t?new e(this,t):null},str:function(t){return t.value},init:null,set:function(t){var e,i,a,u,c;if("undefined"==typeof(t=o(c=t))&&s.invalidValue(this,n,c),(u=this[r])!==t){if(this[r]=t,t&&t.addRef(this),e=this.$ds_evt)for(i=e.length-1;i>=0;i+=-1)a=e[i],a.__onChange.call(a,this,n,t,u);u&&u.release(this)}}})}},e.ds_dstr.push(function(){var t,e,n;e=this.map;for(t in e)n=e[t],n instanceof o&&n.release(this)}),e.prototype.clone=function(t){return new e(t,this)},e.prototype.toString=function(){return this.value},e.prototype.valueOf=function(){return this.value},e.prototype.set=function(t,e){var n,r,a,u;return i&&("string"!=typeof t&&s.invalidArg("enumValue"),"undefined"==typeof e&&s.invalidArg("value")),e?(n=(a=this.map).hasOwnProperty(t),e instanceof o&&e.addRef(this),(u=a[t])instanceof o&&u.release(this),a[t]=e,n||(this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", "))):(a=this.map).hasOwnProperty(t)&&((u=a[t])instanceof o&&u.release(this),delete this.map[t],this.value=_.sortBy(function(){var t;t=[];for(r in a)t.push(r);return t}()).join(", ")),this},e.prototype.get=function(t){return i&&"string"!=typeof t&&s.invalidArg("enumValue"),!!this.map.hasOwnProperty(t)&&this.map[t]},e.prototype.any=function(t){var e;for(e in t)if(this.map.hasOwnProperty(e))return!0;return!1},e.prototype.empty=function(){var t;for(t in this.map)return!1;return!0},e.prototype.diff=function(t){var n,o,r;return i&&("object"==typeof t&&t.__proto__===e.prototype||s.invalidArg("src")),r=t.map,function(){var t;t=[];for(n in o=this.map)r.hasOwnProperty(n)||t.push("+"+n);return t}.call(this).concat(function(){var t;t=[];for(n in r)o.hasOwnProperty(n)||t.push("-"+n);return t}()).join(", ")},e.end(),e}(o)},{"./DSObjectBase":63,"./util":68}],67:[function(t,e,n){var o,r,i,s,a,u,c=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;e.exports=(a=angular.module("dscommon/DSView",[t("../app/data/dsDataService")])).name,u=t("./util").traceView,i=t("./util").assert,s=t("./util").error,o=t("./DSObject"),r=t("./DSSet"),a.factory("DSView",["dsDataService","$log",function(t,e){var n,r;return r=function(){function t(){}return t.prototype.get=function(t){return i&&(this.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]},t.prototype.set=function(t,e){return i&&(this.hasOwnProperty(t)||s.invalidProp(this,t)),this[t]=e},t}(),n=function(e){function n(){return a.apply(this,arguments)}var a,l;return c(n,e),n.begin("DSView"),n.begin=function(t){var e;o.begin.call(this,t),this.prototype.__src=(e=this.__super__.__src)?_.clone(e):{}},n.propData=function(t,e,n){var o,r;if(i){if("undefined"!=typeof this.prototype._src)throw new Error("Duplicate data set name: "+t);"undefined"==typeof n||"object"==typeof n&&null!==n||s.invalidArg("params")}"object"==typeof n&&(n.hasOwnProperty("watch")?(r=n.watch,delete n.watch):r=null,i&&(_.isArray(r)||null===r||s.invalidArg("params.watch"))),this.prototype.__srcLength=(o=_.size(this.prototype.__src))+1,this.prototype.__src[t]={name:t,type:e,watch:r,params:n,index:o}},n.ds_dstr.push(function(){var t,e,n;"function"==typeof this.__unwatch1&&this.__unwatch1(),"function"==typeof this.__unwatch2&&this.__unwatch2(),e=this.__src;for(t in e)n=e[t],"function"==typeof n.unwatch&&n.unwatch(),"function"==typeof n.unwatchStatus&&n.unwatchStatus(),n.hasOwnProperty("set")&&n.set.release(this)}),a=function(t,e){var n,r,a,u,c;o.call(this,t,e),i&&"object"!=typeof t&&s.invalidArg("$scope"),this.__unwatch1=(this.__scope=t).$on("$destroy",function(e){return function(){return delete e.__unwatch1,e.release(t)}}(this)),this.__dirty=0,this.__src=_.cloneDeep(this.__proto__.__src),this.__srcList=new Array(__proto__.__srcLength),this.dataStatus="nodata",a=function(t){return function(){t.__dirty++}}(this),r=this.__src;for(n in r)u=r[n],c=u.watch,u.listener={add:a,remove:a,change:c?function(t){return function(e){return function(n,o){e.indexOf(o)!==-1&&t.__dirty++}}}(this)(c):a}},n.prop({name:"data",type:"DSView.data",readonly:!0,init:function(){return new r}}),l=0,n.prototype.dataUpdate=function(e){var n,r,a,c,d,p,f,h,m;"undefined"==typeof e&&(e={}),i&&"object"!=typeof e&&null!==e&&s.invalidArg("params"),t.requestSources(this,e,this.__src),f=this.__src;for(a in f)if(m=f[a],m.hasOwnProperty("newSet")){if(d=m.newSet,m.hasOwnProperty("set")&&(m.set.release(this),m.unwatch(),m.unwatchStatus()),Object.defineProperty(n=this.get("data"),a,{configurable:!0,enumerable:!0,value:d.items}),Object.defineProperty(n,a+"Set",{configurable:!0,get:function(t){return function(){return t}}(d)}),Object.defineProperty(n,a+"Status",{configurable:!0,get:function(t){return function(){return t.get("status")}}(d)}),this.__srcList[m.index]=m.set=d,delete m.newSet,this.__dirty++,m.unwatch=d.watch(this,m.listener),p=!0,null!==m.watch)for(h=m.watch,r=0,c=h.length;r<c;r++){a=h[r],p=!1;break}else p=!1;m.unwatchStatus=function(t){return function(e){return d.watchStatus(t,function(n,r,i){var s;(i=t.dataStatus)!==(s=o.integratedStatus(t.__srcList))&&(t.dataStatus=s,!e&&("ready"===s&&"update"===i||"update"===s&&"ready"===i)||t.__dirty++)})}}(this)(p)}this.hasOwnProperty("__unwatch2")||(this.__unwatch2=this.__scope.$watch(function(t){return function(){return t.__dirty}}(this),function(t){return function(e,n){var r,i,s,a;if(u){i="",r=t.__src;for(a in r)s=r[a],i+=", "+a+": "+s.set.get("status");console.info(++l+":"+o.desc(t)+".render(): dataStatus: "+t.dataStatus+i),l===window.viewBreak}t.render()}}(this)))},n.end(),n}(o)}])},{"../app/data/dsDataService":7,"./DSObject":62,"./DSSet":65,"./util":68}],68:[function(t,e,n){var o,r;e.exports=r={assert:!0,traceData:!1,traceWatch:!1,traceView:!1,traceRefs:!1,totalRelease:!1,totalReleaseVerb:!1,modeReleaseDataOnReload:!0,serviceOwner:new(o=function(){function t(){return e.apply(this,arguments)}var e;return e=function(){this.name="serviceOwner",this.services=[],this.poolCleaners=[]},t.prototype.start=function(){this.services=[],this.poolCleaners=[]},t.prototype.stop=function(){var t,e,n,o,r,i,s,a;for(i=this.services,e=0,o=i.length;e<o;e++)a=i[e],a.release(this);if(this.poolCleaners)for(s=this.poolCleaners,n=0,r=s.length;n<r;n++)(t=s[n])()},t.prototype.add=function(t){return this.services.push(t),t},t.prototype.remove=function(t){_.remove(this.services,t)},t.prototype.clearPool=function(t){return this.poolCleaners.push(t)},t}()),validate:{required:function(t){return"undefined"!=typeof t&&null!==t?t:void 0},trimString:function(t){return"string"!=typeof t?null:0===(t=t.trim()).length?null:t}},error:{invalidArg:function(t){throw new Error("Invalid '"+t+"' parameter")},notDSObjectClass:function(t){throw new Error("Not a DSObject class")},invalidProp:function(t,e){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid property")},invalidListValue:function(t,e){throw new Error("Invalid value '"+e+"' at position "+t)},duplicatedProperty:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Duplicated property name")},propIsReadOnly:function(t,e){throw new Error("Class '"+t.docType+"': Prop '"+e+"': Property is read-only")},invalidValue:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")},invalidMapElementType:function(t){throw new Error("Invalid element type '"+t+"'")},invalidPropMapElementType:function(t,e,n){throw new Error("Obj '"+t+"': Prop '"+e+"': Invalid value '"+n+"'")}}}},{}],69:[function(t,e,n){!function(t,e,n){"use strict";function o(t){return/^-?\d+\.?\d*$/.test(t.replace(/["']/g,""))}var r=e.isDefined,i=e.isUndefined,s=e.isNumber,a=e.isObject,u=e.isArray,c=e.extend,l=e.toJson,d=e.fromJson,p=e.module("LocalStorageModule",[]);p.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(t){return this.prefix=t,this},this.setStorageType=function(t){return this.storageType=t,this},this.setStorageCookie=function(t,e){return this.cookie={expiry:t,path:e},this},this.setStorageCookieDomain=function(t){return this.cookie.domain=t,this},this.setNotify=function(t,e){return this.notify={setItem:t,removeItem:e},this},this.$get=["$rootScope","$window","$document","$parse",function(t,e,n,p){var f,h=this,m=h.prefix,g=h.cookie,y=h.notify,_=h.storageType;n?n[0]&&(n=n[0]):n=document,"."!==m.substr(-1)&&(m=m?m+".":"");var v=function(t){return m+t},w=function(){try{var n=_ in e&&null!==e[_],o=v("__"+Math.round(1e7*Math.random()));return n&&(f=e[_],f.setItem(o,""),f.removeItem(o)),n}catch(r){return _="cookie",t.$broadcast("LocalStorageModule.notification.error",r.message),!1}}(),S=function(e,n){if(i(n)?n=null:(a(n)||u(n)||s(+n||n))&&(n=l(n)),!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:"cookie"}),P(e,n);try{(a(n)||u(n))&&(n=l(n)),f&&f.setItem(v(e),n),y.setItem&&t.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:n,storageType:h.storageType})}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),P(e,n)}return!0},D=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),$(e);var n=f?f.getItem(v(e)):null;return n&&"null"!==n?"{"===n.charAt(0)||"["===n.charAt(0)||o(n)?d(n):n:null},k=function(e){if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:"cookie"}),A(e);try{f.removeItem(v(e)),y.removeItem&&t.$broadcast("LocalStorageModule.notification.removeitem",{key:e,storageType:h.storageType})}catch(n){return t.$broadcast("LocalStorageModule.notification.error",n.message),A(e)}return!0},b=function(){if(!w)return t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var e=m.length,n=[];for(var o in f)if(o.substr(0,e)===m)try{n.push(o.substr(e))}catch(r){return t.$broadcast("LocalStorageModule.notification.error",r.Description),[]}return n},T=function(e){e=e||"";var n=m.slice(0,-1),o=new RegExp(n+"."+e);if(!w||"cookie"===h.storageType)return w||t.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),j();var r=m.length;for(var i in f)if(o.test(i))try{k(i.substr(r))}catch(s){return t.$broadcast("LocalStorageModule.notification.error",s.message),j()}return!0},O=function(){try{return e.navigator.cookieEnabled||"cookie"in n&&(n.cookie.length>0||(n.cookie="test").indexOf.call(n.cookie,"test")>-1)}catch(o){return t.$broadcast("LocalStorageModule.notification.error",o.message),!1}}(),P=function(e,o){if(i(o))return!1;if((u(o)||a(o))&&(o=l(o)),!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var r="",s=new Date,c="";if(null===o?(s.setTime(s.getTime()+-864e5),r="; expires="+s.toGMTString(),o=""):0!==g.expiry&&(s.setTime(s.getTime()+24*g.expiry*60*60*1e3),r="; expires="+s.toGMTString()),e){var d="; path="+g.path;g.domain&&(c="; domain="+g.domain),n.cookie=v(e)+"="+encodeURIComponent(o)+r+d+c}}catch(p){return t.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},$=function(e){if(!O)return t.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=n.cookie&&n.cookie.split(";")||[],r=0;r<o.length;r++){for(var i=o[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(v(e)+"=")){var s=decodeURIComponent(i.substring(m.length+e.length+1,i.length));try{var a=JSON.parse(s);return d(a)}catch(u){return s}}}return null},A=function(t){P(t,null)},j=function(){for(var t=null,e=m.length,o=n.cookie.split(";"),r=0;r<o.length;r++){for(t=o[r];" "===t.charAt(0);)t=t.substring(1,t.length);
var i=t.substring(e,t.indexOf("="));A(i)}},C=function(){return _},L=function(t,e,n,o){o=o||e;var i=D(o);return null===i&&r(n)?i=n:a(i)&&a(n)&&(i=c(n,i)),p(e).assign(t,i),t.$watch(e,function(t){S(o,t)},a(t[e]))},M=function(){for(var t=0,n=e[_],o=0;o<n.length;o++)0===n.key(o).indexOf(m)&&t++;return t};return{isSupported:w,getStorageType:C,set:S,add:S,get:D,keys:b,remove:k,clearAll:T,bind:L,deriveKey:v,length:M,cookie:{isSupported:O,set:P,add:P,get:$,remove:A,clearAll:j}}}]})}(window,window.angular)},{}],70:[function(t,e,n){var o;o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.exports={encode:function(t){var e,n,r,i,s,a,u,c,l;for(l="",e=void 0,n=void 0,r="",i=void 0,s=void 0,a=void 0,u="",c=0;;)if(e=t.charCodeAt(c++),n=t.charCodeAt(c++),r=t.charCodeAt(c++),i=e>>2,s=(3&e)<<4|n>>4,a=(15&n)<<2|r>>6,u=63&r,isNaN(n)?a=u=64:isNaN(r)&&(u=64),l=l+o.charAt(i)+o.charAt(s)+o.charAt(a)+o.charAt(u),e=n=r="",i=s=a=u="",!(c<t.length))break;return l},decode:function(t){var e,n,r,i,s,a,u,c,l,d;for(d="",n=void 0,r=void 0,i="",s=void 0,a=void 0,u=void 0,c="",l=0,e=/[^A-Za-z0-9\+\/\=]/g,e.exec(t)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");;)if(s=o.indexOf(t.charAt(l++)),a=o.indexOf(t.charAt(l++)),u=o.indexOf(t.charAt(l++)),c=o.indexOf(t.charAt(l++)),n=s<<2|a>>4,r=(15&a)<<4|u>>2,i=(3&u)<<6|c,d+=String.fromCharCode(n),64!==u&&(d+=String.fromCharCode(r)),64!==c&&(d+=String.fromCharCode(i)),n=r=i="",s=a=u=c="",!(l<t.length))break;return d}}},{}]},{},[1]);